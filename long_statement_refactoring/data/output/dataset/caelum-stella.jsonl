{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Beneficiario;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Pagador;\n\nimport static org.junit.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\npublic class BancoDoBrasilTest {\n\n\tprivate Boleto boleto;\n\tprivate BancoDoBrasil banco;\n\tprivate Beneficiario beneficiario;\n\n\t@Before\n\tpublic void setUp() {\n\t\tDatas datas = Datas.novasDatas().comDocumento(4, 5, 2008).comProcessamento(4, 5, 2008)\n\t\t\t\t.comVencimento(2, 5, 2008);\n\n\t\tthis.beneficiario = Beneficiario.novoBeneficiario().comNomeBeneficiario(\"Caue\")\n\t\t\t\t.comAgencia(\"1824\").comDigitoAgencia(\"4\")\n\t\t\t\t.comCodigoBeneficiario(\"76000\")\n\t\t\t\t.comNumeroConvenio(\"1207113\")\n\t\t\t\t.comDigitoCodigoBeneficiario(\"5\")\n\t\t\t\t.comCarteira(\"18\")\n\t\t\t\t.comNossoNumero(\"9000206\");\n\n\t\tPagador pagador = Pagador.novoPagador().comNome(\"Fulano\");\n\n\t\tthis.banco = new BancoDoBrasil();\n\n\t\tthis.boleto = Boleto.novoBoleto().comDatas(datas).comBeneficiario(this.beneficiario).comPagador(pagador)\n\t\t\t\t.comValorBoleto(\"40.00\").comNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void numeroDoConvenioFormatadoDeveTerSeisDigitos() {\n\t\tBeneficiario beneficiario = Beneficiario.novoBeneficiario().comNumeroConvenio(\"1234\");\n\t\t\n\t\tString numeroFormatado = this.banco.getNumeroConvenioFormatado(beneficiario);\n\t\tassertEquals(6, numeroFormatado.length());\n\t\tassertEquals(\"001234\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerOnzeDigitos() {\n\t\tBeneficiario beneficiario = Beneficiario.novoBeneficiario().comNossoNumero(\"9000206\").comCarteira(\"11\");\n\t\tString numeroFormatado = this.banco.getNossoNumeroFormatado(beneficiario);\n\t\tassertEquals(11, numeroFormatado.length());\n\t\tassertEquals(\"00009000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerDezesseteDigitosComCarteira18() {\n\t\tBeneficiario beneficiario = Beneficiario.novoBeneficiario().comNossoNumero(\"9000206\").comCarteira(\"18\");\n\t\tString numeroFormatado = this.banco.getNossoNumeroFormatado(beneficiario);\n\t\tassertEquals(17, numeroFormatado.length());\n\t\tassertEquals(\"00000000009000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerDoisDigitos() {\n\t\tBeneficiario beneficiario = Beneficiario.novoBeneficiario().comCarteira(\"1\");\n\t\tString numeroFormatado = this.banco.getCarteiraFormatado(beneficiario);\n\t\tassertEquals(2, numeroFormatado.length());\n\t\tassertEquals(\"01\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerOitoDigitos() {\n\t\tString numeroFormatado = this.banco.getCodigoBeneficiarioFormatado(this.beneficiario);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"00076000\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testNumeroFormatadoNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"001\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(0, 3));\n\t}\n\n\t@Test\n\tpublic void testCodEspecieMoedaNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"9\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(3, 4));\n\t}\n\n\t@Test\n\tpublic void testDigitoVerificadorNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"5\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(4, 5));\n\t}\n\n\t@Test\n\tpublic void testFatorVencimentoNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"3860\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(5, 9));\n\t}\n\n\t@Test\n\tpublic void testValorNominalNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"0000004000\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(9, 19));\n\t}\n\n\t@Test\n\tpublic void testCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"0000001207113000900020618\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(19, 44));\n\t}\n\n\t@Test\n\tpublic void testZerosNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"000000\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(19, 25));\n\t}\n\n\t@Test\n\tpublic void testNumConvenioFormatadoNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"1207113\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(25, 32));\n\t}\n\n\t@Test\n\tpublic void testNossoNumeroFormatadoNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"0009000206\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(32, 42));\n\t}\n\n\t@Test\n\tpublic void testCarteiraNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"18\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(42, 44));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"00195386000000040000000001207113000900020618\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\t\tGeradorDeLinhaDigitavel linhaDigitavelGenerator = new GeradorDeLinhaDigitavel();\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\n\t\tassertEquals(\"00190.00009  01207.113000  09000.206186  5  38600000004000\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(codigoDeBarras,this.banco));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n\n\t@Test\n\tpublic void testCarteira17ComConvenioSeteDigitosMaior1000000() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\t\t\n\t\tBeneficiario beneficiario = Beneficiario.novoBeneficiario().comNumeroConvenio(\"2670001\").comCarteira(\"17\");\n\t\tthis.boleto.comBeneficiario(beneficiario);\n\n\t\tassertEquals(\"00191386000000040000000002670001000000000017\", this.banco.geraCodigoDeBarrasPara(boleto));\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Beneficiario;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Pagador;\n\nimport static org.junit.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\npublic class BancoDoBrasilTest {\n\n\tprivate Boleto boleto;\n\tprivate BancoDoBrasil banco;\n\tprivate Beneficiario beneficiario;\n\n\t@Before\n\tpublic void setUp() {\n                String numeroConvenio = \"1207113\";\n                int numeroComplemento = 9000206; //identificador interno do BB ou do beneficiário\n                \n                //Responsabilidade do desenvolvedor compor o nosso número\n                String nossoNumero = numeroConvenio + String.format(\"%010d\", numeroComplemento);\n                \n\t\tDatas datas = Datas.novasDatas().comDocumento(4, 5, 2008).comProcessamento(4, 5, 2008)\n\t\t\t\t.comVencimento(2, 5, 2008);\n\t\tthis.beneficiario = Beneficiario.novoBeneficiario().comNomeBeneficiario(\"Caue\")\n\t\t\t\t.comAgencia(\"1824\").comDigitoAgencia(\"4\")\n\t\t\t\t.comCodigoBeneficiario(\"76000\")\n\t\t\t\t.comNumeroConvenio(numeroConvenio)\n\t\t\t\t.comDigitoCodigoBeneficiario(\"5\")\n\t\t\t\t.comCarteira(\"18\")\n\t\t\t\t.comNossoNumero(nossoNumero);\n\n\t\tPagador pagador = Pagador.novoPagador().comNome(\"Fulano\");\n\n\t\tthis.banco = new BancoDoBrasil();\n\n\t\tthis.boleto = Boleto.novoBoleto().comDatas(datas).comBeneficiario(this.beneficiario).comPagador(pagador)\n\t\t\t\t.comValorBoleto(\"40.00\").comNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerDoisDigitos() {\n\t\tBeneficiario beneficiario = Beneficiario.novoBeneficiario().comCarteira(\"1\");\n\t\tString numeroFormatado = this.banco.getCarteiraFormatado(beneficiario);\n                \n\t\tassertEquals(2, numeroFormatado.length());\n\t\tassertEquals(\"01\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testNumeroFormatadoNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"001\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(0, 3));\n\t}\n\n\t@Test\n\tpublic void testCodEspecieMoedaNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"9\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(3, 4));\n\t}\n\n\t@Test\n\tpublic void testDigitoVerificadorNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"5\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(4, 5));\n\t}\n\n\t@Test\n\tpublic void testFatorVencimentoNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"3860\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(5, 9));\n\t}\n\n\t@Test\n\tpublic void testValorNominalNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"0000004000\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(9, 19));\n\t}\n\n\t@Test\n\tpublic void testCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"0000001207113000900020618\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(19, 44));\n\t}\n\n\t@Test\n\tpublic void testZerosNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"000000\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(19, 25));\n\t}\n\n\t@Test\n\tpublic void testNumConvenioFormatadoNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"1207113\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(25, 32));\n\t}\n\n\t@Test\n\tpublic void testNossoNumeroFormatadoConvenio7LivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n                \n\t\tassertEquals(\"12071130009000206\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(25, 42));\n\t}\n\n\t@Test\n\tpublic void testCarteiraNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"18\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(42, 44));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\n\t\tassertEquals(\"00195386000000040000000001207113000900020618\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\t\tGeradorDeLinhaDigitavel linhaDigitavelGenerator = new GeradorDeLinhaDigitavel();\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\n\t\tassertEquals(\"00190.00009  01207.113000  09000.206186  5  38600000004000\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(codigoDeBarras,this.banco));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n\n\t@Test\n\tpublic void testCarteira17ComConvenioSeteDigitosMaior1000000() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n                String numeroConvenio = \"2670001\";\n\t\tString nossoNumero = numeroConvenio + String.format(\"%010d\", 0);\n\t\tBeneficiario beneficiario = Beneficiario.novoBeneficiario().comNumeroConvenio(numeroConvenio).comCarteira(\"17\").comNossoNumero(nossoNumero);\n\t\tthis.boleto.comBeneficiario(beneficiario);\n\n\t\tassertEquals(\"00191386000000040000000002670001000000000017\", this.banco.geraCodigoDeBarrasPara(boleto));\n\t}\n\n}\n","lineNo":22}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Beneficiario;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigito;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigitoSantander;\nimport static br.com.caelum.stella.boleto.utils.StellaStringUtils.leftPadWithZeros;\n\npublic class Santander implements Banco {\n\n\tprivate static final long serialVersionUID = 1L;\n\n\tprivate final static String NUMERO_SANTANDER = \"033\";\n\tprivate final static String DIGITO_SANTANDER = \"7\";\n\tprivate GeradorDeDigito gdivSantander = new GeradorDeDigitoSantander();\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tBeneficiario beneficiario = boleto.getBeneficiario();\n\t\tStringBuilder campoLivre = new StringBuilder(\"9\");\n\t\tcampoLivre.append(getNumeroConvenioFormatado(beneficiario));\n\t\tcampoLivre.append(getNossoNumeroFormatado(beneficiario));\n\t\tcampoLivre.append(\"0\").append(beneficiario.getCarteira());\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\t\n\t@Override\n\tpublic URL getImage() {\n\t\tString pathDoArquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(pathDoArquivo, NUMERO_SANTANDER);\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_SANTANDER;\n\t}\n\n\t@Override\n\tpublic String getCarteiraFormatado(Beneficiario beneficiario) {\n\t\treturn leftPadWithZeros(beneficiario.getCarteira(), 3);\n\t}\n\n\t@Override\n\tpublic String getCodigoBeneficiarioFormatado(Beneficiario beneficiario) {\n\t\treturn leftPadWithZeros(beneficiario.getCodigoBeneficiario(), 7);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroFormatado(Beneficiario beneficiario) {\n\t\tif (beneficiario.getDigitoNossoNumero() != null) {\n\t\t\treturn leftPadWithZeros(beneficiario.getNossoNumero()+beneficiario.getDigitoNossoNumero(), 13);\n\t\t}\n\t\treturn leftPadWithZeros(beneficiario.getNossoNumero(), 13);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(NUMERO_SANTANDER).append(\"-\");\n\t\treturn builder.append(DIGITO_SANTANDER).toString();\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoBeneficiario(Beneficiario beneficiario) {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(leftPadWithZeros(beneficiario.getAgencia(), 5));\n\t\tbuilder.append(\"/\").append(getNumeroConvenioFormatado(beneficiario));\n\t\treturn builder.toString();\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodigoDocumento(Boleto boleto) {\n\t\tBeneficiario beneficiario = boleto.getBeneficiario();\n\t\t\n\t\tString nossoNumero = getNossoNumeroFormatado(beneficiario);\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(nossoNumero.substring(0, 12));\n\t\tbuilder.append(\"-\").append(nossoNumero.substring(12));\n\t\treturn  builder.toString();\n\t}\n \n\t@Override\n\tpublic GeradorDeDigito getGeradorDeDigito() {\n\t\treturn gdivSantander;\n\t}\n\t\n\tpublic String getNumeroConvenioFormatado(Beneficiario beneficiario) {\n\t\treturn leftPadWithZeros(beneficiario.getNumeroConvenio(), 7);\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport static br.com.caelum.stella.boleto.utils.StellaStringUtils.leftPadWithZeros;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Beneficiario;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigitoSantander;\n\npublic class Santander implements Banco {\n\n\tprivate static final long serialVersionUID = 1L;\n\n\tprivate final static String NUMERO_SANTANDER = \"033\";\n\tprivate final static String DIGITO_SANTANDER = \"7\";\n\tprivate GeradorDeDigitoSantander gdivSantander = new GeradorDeDigitoSantander();\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tBeneficiario beneficiario = boleto.getBeneficiario();\n\t\tStringBuilder campoLivre = new StringBuilder(\"9\");\n\t\tcampoLivre.append(getNumeroConvenioFormatado(beneficiario));\n\t\tcampoLivre.append(getNossoNumeroFormatado(beneficiario));\n\t\tcampoLivre.append(\"0\").append(beneficiario.getCarteira());\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\t\n\t@Override\n\tpublic URL getImage() {\n\t\tString pathDoArquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(pathDoArquivo, NUMERO_SANTANDER);\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_SANTANDER;\n\t}\n\n\t@Override\n\tpublic String getCarteiraFormatado(Beneficiario beneficiario) {\n\t\treturn leftPadWithZeros(beneficiario.getCarteira(), 3);\n\t}\n\n\t@Override\n\tpublic String getCodigoBeneficiarioFormatado(Beneficiario beneficiario) {\n\t\treturn leftPadWithZeros(beneficiario.getCodigoBeneficiario(), 7);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroFormatado(Beneficiario beneficiario) {\n\t\tString nossoNumero = beneficiario.getNossoNumero();\n\t\tif (beneficiario.getDigitoNossoNumero() != null) {\n\t\t\treturn leftPadWithZeros(nossoNumero+beneficiario.getDigitoNossoNumero(), 13);\n\t\t} \n\t\treturn leftPadWithZeros(nossoNumero+getGeradorDeDigito().calculaDVNossoNumero(nossoNumero), 13);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(NUMERO_SANTANDER).append(\"-\");\n\t\treturn builder.append(DIGITO_SANTANDER).toString();\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoBeneficiario(Beneficiario beneficiario) {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(leftPadWithZeros(beneficiario.getAgencia(), 5));\n\t\tbuilder.append(\"/\").append(getNumeroConvenioFormatado(beneficiario));\n\t\treturn builder.toString();\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodigoDocumento(Boleto boleto) {\n\t\tBeneficiario beneficiario = boleto.getBeneficiario();\n\t\t\n\t\tString nossoNumero = getNossoNumeroFormatado(beneficiario);\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(nossoNumero.substring(0, 12));\n\t\tbuilder.append(\"-\").append(nossoNumero.substring(12));\n\t\treturn  builder.toString();\n\t}\n \n\t@Override\n\tpublic GeradorDeDigitoSantander getGeradorDeDigito() {\n\t\treturn gdivSantander;\n\t}\n\t\n\tpublic String getNumeroConvenioFormatado(Beneficiario beneficiario) {\n\t\treturn leftPadWithZeros(beneficiario.getNumeroConvenio(), 7);\n\t}\n}\n","lineNo":54}
{"Smelly Sample":"package br.com.caelum.stella.integration.boleto.transformer;\n\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileNotFoundException;\nimport java.io.IOException;\nimport java.util.Locale;\n\nimport org.junit.After;\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Beneficiario;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Sacado;\nimport br.com.caelum.stella.boleto.bancos.BancoDoBrasil;\nimport br.com.caelum.stella.boleto.transformer.GeradorDeBoletoHTML;\n\nimport static org.junit.Assert.assertTrue;\n\n/**\n * Test para testar o boleto html, deixei em um teste separado pois ainda não\n * foi colocado no BoletoGenerator.\n * \n * @author Alberto\n * \n */\npublic class BoletoHTMLTransformerIntegrationTest extends DefaultIntegrationTest{\n\t\n\tprivate static final String FILE_NAME = \"arquivo.html\";\n\t\n\t\n\t@After\n\tpublic void removeFiles(){\n\t\tdelete(new File(FILE_NAME));\n\t\tdelete(new File(FILE_NAME + \"_files\"));\n\t}\n\t\n\tprivate boolean delete(File file) {\n\t\tif (file.isDirectory()) {\n\t\t\tString[] children = file.list();\n\t\t\tfor (int i = 0; i < children.length; i++) {\n\t\t\t\tboolean success = delete(new File(file, children[i]));\n\t\t\t\tif (!success) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn file.delete();\n\t}\n\t\n\t@Before\n\tpublic void setUp() throws Exception {\n\n\t\tLocale.setDefault(new Locale(\"pt\", \"br\"));\n\n\t\tBoleto boleto;\n\t\tDatas datas = Datas.novasDatas().comDocumento(4, 5, 2008).comProcessamento(4, 5, 2008)\n\t\t\t\t.comVencimento(2, 5, 2008);\n\t\tBeneficiario beneficiario = Beneficiario.novoBeneficiario()\n\t\t\t\t.comNomeBeneficiario(\"Caue\").comAgencia(\"1824\").comDigitoAgencia(\"4\")\n\t\t\t\t.comCodigoBeneficiario(\"76000\").comNumeroConvenio(\"1207113\")\n\t\t\t\t.comDigitoCodigoBeneficiario(\"5\").comCarteira(\"18\")\n\t\t\t\t.comNossoNumero(\"9000206\");\n\n\t\tSacado sacado = Sacado.novoSacado().comNome(\"Fulano da Silva\").comCpf(\"111.222.333-12\")\n\t\t\t\t.comEndereco(\"Av dos testes, 111 apto 333\").comBairro(\"Bairro Teste\").comCep(\"01234-111\")\n\t\t\t\t.comCidade(\"São Paulo\").comUf(\"SP\");\n\n\t\tString[] descricoes = { \"descricao 1\", \"descricao 2\", \"descricao 3\", \"descricao 4\", \"descricao 5\" };\n\n\t\tString[] locaisDePagamento = { \"local 1\", \"local 2\" };\n\n\t\tString[] instrucoes = { \"instrucao 1\", \"instrucao 2\", \"instrucao 3\", \"instrucao 4\", \"instrucao 5\" };\n\n\t\tBanco banco = new BancoDoBrasil();\n\n\t\tboleto = Boleto.novoBoleto().comBanco(banco).comDatas(datas).comDescricoes(descricoes).comBeneficiario(beneficiario)\n\t\t\t\t.comSacado(sacado).comValorBoleto(\"40.00\").comNumeroDoDocumento(\"4323\").comInstrucoes(instrucoes)\n\t\t\t\t.comLocaisDePagamento(locaisDePagamento);\n\n\t\tGeradorDeBoletoHTML gerador = new GeradorDeBoletoHTML(boleto);\n\t\tgerador.geraHTML(FILE_NAME);\n\t}\n\n\t@Test\n\tpublic void testHTMLWriterGeneration() {\n\t\tassertTrue(new File(FILE_NAME).exists());\n\t}\n\n\t@Test\n\tpublic void testHTMLWriterEscreveValorCorreto() {\n\t\tassertTrue(lerArquivo().contains(\"40,00\"));\n\t}\n\n\t@Test\n\tpublic void testHTMLWriterEscreveLinhaDigitavelCorreta() {\n\t\tassertTrue(lerArquivo().contains(\"00190.00009 01207.113000 09000.206186 5 38600000004000\"));\n\t}\n\t\n\tprivate String lerArquivo() {\n\t\ttry {\n\t\t\t@SuppressWarnings(\"resource\")\n\t\t\tFileInputStream fileInputStream = new FileInputStream(new File(FILE_NAME));\n\t\t\tint c = 0;\n\t\t\tStringBuffer boleto = new StringBuffer();\n\t\t\twhile ((c = fileInputStream.read()) != -1) {\n\t\t\t\tboleto.append((char) c);\n\t\t\t}\n\t\t\treturn boleto.toString().replaceAll(\"&nbsp;\", \"\");\n\t\t} catch (FileNotFoundException fileNotFoundException) {\n\t\t\tthrow new RuntimeException(fileNotFoundException);\n\t\t} catch (IOException ioException) {\n\t\t\tthrow new RuntimeException(ioException);\n\t\t}\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.integration.boleto.transformer;\n\nimport static org.junit.Assert.assertTrue;\n\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileNotFoundException;\nimport java.io.IOException;\nimport java.util.Locale;\n\nimport org.junit.After;\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Beneficiario;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Endereco;\nimport br.com.caelum.stella.boleto.Pagador;\nimport br.com.caelum.stella.boleto.bancos.BancoDoBrasil;\nimport br.com.caelum.stella.boleto.transformer.GeradorDeBoletoHTML;\n\n/**\n * Test para testar o boleto html, deixei em um teste separado pois ainda não\n * foi colocado no BoletoGenerator.\n * \n * @author Alberto\n * \n */\npublic class BoletoHTMLTransformerIntegrationTest extends DefaultIntegrationTest{\n\t\n\tprivate static final String FILE_NAME = \"arquivo.html\";\n\t\n\t\n\t@After\n\tpublic void removeFiles(){\n\t\tdelete(new File(FILE_NAME));\n\t\tdelete(new File(FILE_NAME + \"_files\"));\n\t}\n\t\n\tprivate boolean delete(File file) {\n\t\tif (file.isDirectory()) {\n\t\t\tString[] children = file.list();\n\t\t\tfor (int i = 0; i < children.length; i++) {\n\t\t\t\tboolean success = delete(new File(file, children[i]));\n\t\t\t\tif (!success) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn file.delete();\n\t}\n\t\n\t@Before\n\tpublic void setUp() throws Exception {\n\n\t\tLocale.setDefault(new Locale(\"pt\", \"br\"));\n\n\t\tBoleto boleto;\n\t\tDatas datas = Datas.novasDatas().comDocumento(4, 5, 2008).comProcessamento(4, 5, 2008)\n\t\t\t\t.comVencimento(2, 5, 2008);\n\t\tBeneficiario beneficiario = Beneficiario.novoBeneficiario()\n\t\t\t\t.comNomeBeneficiario(\"Caue\").comAgencia(\"1824\").comDigitoAgencia(\"4\")\n\t\t\t\t.comCodigoBeneficiario(\"76000\").comNumeroConvenio(\"1207113\")\n\t\t\t\t.comDigitoCodigoBeneficiario(\"5\").comCarteira(\"18\")\n\t\t\t\t.comNossoNumero(\"9000206\");\n\n\t\tEndereco endereco = new Endereco(\"Av dos testes, 111 apto 333\", \"Bairro Teste\", \"01234-111\", \"São Paulo\", \"SP\");\n\n\t\tPagador pagador = Pagador.novoPagador().comNome(\"Fulano da Silva\").comCpf(\"111.222.333-12\")\n\t\t\t\t.comEndereco(endereco);\n\n\t\tString[] descricoes = { \"descricao 1\", \"descricao 2\", \"descricao 3\", \"descricao 4\", \"descricao 5\" };\n\n\t\tString[] locaisDePagamento = { \"local 1\", \"local 2\" };\n\n\t\tString[] instrucoes = { \"instrucao 1\", \"instrucao 2\", \"instrucao 3\", \"instrucao 4\", \"instrucao 5\" };\n\n\t\tBanco banco = new BancoDoBrasil();\n\n\t\tboleto = Boleto.novoBoleto().comBanco(banco).comDatas(datas).comDescricoes(descricoes).comBeneficiario(beneficiario)\n\t\t\t\t.comPagador(pagador).comValorBoleto(\"40.00\").comNumeroDoDocumento(\"4323\").comInstrucoes(instrucoes)\n\t\t\t\t.comLocaisDePagamento(locaisDePagamento);\n\n\t\tGeradorDeBoletoHTML gerador = new GeradorDeBoletoHTML(boleto);\n\t\tgerador.geraHTML(FILE_NAME);\n\t}\n\n\t@Test\n\tpublic void testHTMLWriterGeneration() {\n\t\tassertTrue(new File(FILE_NAME).exists());\n\t}\n\n\t@Test\n\tpublic void testHTMLWriterEscreveValorCorreto() {\n\t\tassertTrue(lerArquivo().contains(\"40,00\"));\n\t}\n\n\t@Test\n\tpublic void testHTMLWriterEscreveLinhaDigitavelCorreta() {\n\t\tassertTrue(lerArquivo().contains(\"00190.00009 01207.113000 09000.206186 5 38600000004000\"));\n\t}\n\t\n\tprivate String lerArquivo() {\n\t\ttry {\n\t\t\t@SuppressWarnings(\"resource\")\n\t\t\tFileInputStream fileInputStream = new FileInputStream(new File(FILE_NAME));\n\t\t\tint c = 0;\n\t\t\tStringBuffer boleto = new StringBuffer();\n\t\t\twhile ((c = fileInputStream.read()) != -1) {\n\t\t\t\tboleto.append((char) c);\n\t\t\t}\n\t\t\treturn boleto.toString().replaceAll(\"&nbsp;\", \"\");\n\t\t} catch (FileNotFoundException fileNotFoundException) {\n\t\t\tthrow new RuntimeException(fileNotFoundException);\n\t\t} catch (IOException ioException) {\n\t\t\tthrow new RuntimeException(ioException);\n\t\t}\n\t}\n\n}\n","lineNo":70}
{"Smelly Sample":"package br.com.caelum.stella.integration.boleto.transformer;\n\nimport java.io.File;\nimport java.io.IOException;\nimport java.util.Locale;\n\nimport org.junit.After;\nimport org.junit.Before;\nimport org.junit.Test;\nimport org.pdfbox.pdmodel.PDDocument;\nimport org.pdfbox.util.PDFTextStripper;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Beneficiario;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Sacado;\nimport br.com.caelum.stella.boleto.bancos.BancoDoBrasil;\nimport br.com.caelum.stella.boleto.transformer.GeradorDeBoleto;\n\nimport static org.junit.Assert.assertTrue;\n\n/**\n * Teste de INTEGRACAO apesar de estar no de unidade FIXME\n * \n */\npublic class BoletoTransformerIntegrationTest extends DefaultIntegrationTest{\n\n\t@Before\n\tpublic void setUp() {\n\n\t\tLocale.setDefault(new Locale(\"pt\", \"br\"));\n\n\t\tapagaArquivosGerados();\n\n\t\tBoleto boleto;\n\t\tDatas datas = Datas.novasDatas().comDocumento(4, 5, 2008).comProcessamento(4, 5, 2008)\n\t\t\t\t.comVencimento(2, 5, 2008);\n\t\tBeneficiario beneficiario = Beneficiario.novoBeneficiario().comNomeBeneficiario(\"Caue\").comAgencia(\"1824\").comDigitoAgencia(\"4\")\n\t\t\t\t.comCodigoBeneficiario(\"76000\").comNumeroConvenio(\"1207113\").comDigitoCodigoBeneficiario(\"5\").comCarteira(\"18\")\n\t\t\t\t.comNossoNumero(\"9000206\");\n\n\t\tSacado sacado = Sacado.novoSacado().comNome(\"Fulano da Silva\").comCpf(\"111.222.333-12\")\n\t\t\t\t.comEndereco(\"Av dos testes, 111 apto 333\").comBairro(\"Bairro Teste\").comCep(\"01234-111\")\n\t\t\t\t.comCidade(\"São Paulo\").comUf(\"SP\");\n\n\t\tString[] descricoes = { \"descricao 1\", \"descricao 2\", \"descricao 3\", \"descricao 4\", \"descricao 5\" };\n\n\t\tString[] locaisDePagamento = { \"local 1\", \"local 2\" };\n\n\t\tString[] instrucoes = { \"instrucao 1\", \"instrucao 2\", \"instrucao 3\", \"instrucao 4\", \"instrucao 5\" };\n\n\t\tBanco banco = new BancoDoBrasil();\n\n\t\tboleto = Boleto.novoBoleto().comBanco(banco).comDatas(datas).comDescricoes(descricoes).comBeneficiario(beneficiario)\n\t\t\t\t.comSacado(sacado).comValorBoleto(\"40.00\").comNumeroDoDocumento(\"4323\").comInstrucoes(instrucoes)\n\t\t\t\t.comLocaisDePagamento(locaisDePagamento);\n\n\t\tGeradorDeBoleto generator = new GeradorDeBoleto(boleto);\n\n\t\tgenerator.geraPDF(\"arquivo.pdf\");\n\t\tgenerator.geraPNG(\"arquivo.png\");\n\n\t}\n\n\t@Test\n\tpublic void testPDFWriterGeneration() {\n\t\tassertTrue(new File(\"arquivo.pdf\").exists());\n\t}\n\n\t@Test\n\tpublic void testPDFWriterEscreveValorCorreto() throws IOException {\n\t\tPDFTextStripper stripper = new PDFTextStripper();\n\n\t\tPDDocument document = PDDocument.load(new File(\"arquivo.pdf\"));\n\t\tString text = stripper.getText(document);\n\t\tdocument.close();\n\t\tassertTrue(text.contains(\"40,00\"));\n\t}\n\n\t@Test\n\tpublic void testPDFWriterEscreveLinhaDigitavelCorreta() throws IOException {\n\t\tPDFTextStripper stripper = new PDFTextStripper();\n\n\t\tPDDocument document = PDDocument.load(new File(\"arquivo.pdf\"));\n\t\tString text = stripper.getText(document);\n\t\tdocument.close();\n\n\t\tassertTrue(text.contains(\"00190.00009  01207.113000  09000.206186  5  38600000004000\"));\n\t}\n\n\t@Test\n\tpublic void testPNGWriteGeneration() {\n\t\tassertTrue(new File(\"arquivo.png\").exists());\n\t}\n\n\t@After\n\tpublic void apagaArquivosGerados() {\n\t\tfinal File pngFile = new File(\"arquivo.png\");\n\t\tfinal File pdfFile = new File(\"arquivo.pdf\");\n\t\tapagaArquivoSeExistir(pngFile);\n\t\tapagaArquivoSeExistir(pdfFile);\n\t}\n\n\tprivate void apagaArquivoSeExistir(final File pngFile) {\n\t\tif (pngFile.exists()) {\n\t\t\tpngFile.delete();\n\t\t}\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.integration.boleto.transformer;\n\nimport java.io.File;\nimport java.io.IOException;\nimport java.util.Locale;\n\nimport org.junit.After;\nimport org.junit.Before;\nimport org.junit.Test;\nimport org.pdfbox.pdmodel.PDDocument;\nimport org.pdfbox.util.PDFTextStripper;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Beneficiario;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Endereco;\nimport br.com.caelum.stella.boleto.Pagador;\nimport br.com.caelum.stella.boleto.bancos.BancoDoBrasil;\nimport br.com.caelum.stella.boleto.transformer.GeradorDeBoleto;\nimport static org.junit.Assert.assertTrue;\n\n/**\n * Teste de INTEGRACAO apesar de estar no de unidade FIXME\n * \n */\npublic class BoletoTransformerIntegrationTest extends DefaultIntegrationTest{\n\n\t@Before\n\tpublic void setUp() {\n\n\t\tLocale.setDefault(new Locale(\"pt\", \"br\"));\n\n\t\tapagaArquivosGerados();\n\n\t\tBoleto boleto;\n\t\tDatas datas = Datas.novasDatas().comDocumento(4, 5, 2008).comProcessamento(4, 5, 2008)\n\t\t\t\t.comVencimento(2, 5, 2008);\n\t\tBeneficiario beneficiario = Beneficiario.novoBeneficiario().comNomeBeneficiario(\"Caue\").comAgencia(\"1824\").comDigitoAgencia(\"4\")\n\t\t\t\t.comCodigoBeneficiario(\"76000\").comNumeroConvenio(\"1207113\").comDigitoCodigoBeneficiario(\"5\").comCarteira(\"18\")\n\t\t\t\t.comNossoNumero(\"9000206\");\n\n\t\tEndereco endereco = new Endereco(\"Av dos testes, 111 apto 333\", \"Bairro Teste\", \"01234-111\", \"São Paulo\", \"SP\");\n\n\t\tPagador pagador = Pagador.novoPagador().comNome(\"Fulano da Silva\").comCpf(\"111.222.333-12\")\n\t\t\t\t.comEndereco(endereco);\n\n\t\tString[] descricoes = { \"descricao 1\", \"descricao 2\", \"descricao 3\", \"descricao 4\", \"descricao 5\" };\n\n\t\tString[] locaisDePagamento = { \"local 1\", \"local 2\" };\n\n\t\tString[] instrucoes = { \"instrucao 1\", \"instrucao 2\", \"instrucao 3\", \"instrucao 4\", \"instrucao 5\" };\n\n\t\tBanco banco = new BancoDoBrasil();\n\n\t\tboleto = Boleto.novoBoleto().comBanco(banco).comDatas(datas).comDescricoes(descricoes).comBeneficiario(beneficiario)\n\t\t\t\t.comPagador(pagador).comValorBoleto(\"40.00\").comNumeroDoDocumento(\"4323\").comInstrucoes(instrucoes)\n\t\t\t\t.comLocaisDePagamento(locaisDePagamento);\n\n\t\tGeradorDeBoleto generator = new GeradorDeBoleto(boleto);\n\n\t\tgenerator.geraPDF(\"arquivo.pdf\");\n\t\tgenerator.geraPNG(\"arquivo.png\");\n\n\t}\n\n\t@Test\n\tpublic void testPDFWriterGeneration() {\n\t\tassertTrue(new File(\"arquivo.pdf\").exists());\n\t}\n\n\t@Test\n\tpublic void testPDFWriterEscreveValorCorreto() throws IOException {\n\t\tPDFTextStripper stripper = new PDFTextStripper();\n\n\t\tPDDocument document = PDDocument.load(new File(\"arquivo.pdf\"));\n\t\tString text = stripper.getText(document);\n\t\tdocument.close();\n\t\tassertTrue(text.contains(\"40,00\"));\n\t}\n\n\t@Test\n\tpublic void testPDFWriterEscreveLinhaDigitavelCorreta() throws IOException {\n\t\tPDFTextStripper stripper = new PDFTextStripper();\n\n\t\tPDDocument document = PDDocument.load(new File(\"arquivo.pdf\"));\n\t\tString text = stripper.getText(document);\n\t\tdocument.close();\n\n\t\tassertTrue(text.contains(\"00190.00009  01207.113000  09000.206186  5  38600000004000\"));\n\t}\n\n\t@Test\n\tpublic void testPNGWriteGeneration() {\n\t\tassertTrue(new File(\"arquivo.png\").exists());\n\t}\n\n\t@After\n\tpublic void apagaArquivosGerados() {\n\t\tfinal File pngFile = new File(\"arquivo.png\");\n\t\tfinal File pdfFile = new File(\"arquivo.pdf\");\n\t\tapagaArquivoSeExistir(pngFile);\n\t\tapagaArquivoSeExistir(pdfFile);\n\t}\n\n\tprivate void apagaArquivoSeExistir(final File pngFile) {\n\t\tif (pngFile.exists()) {\n\t\t\tpngFile.delete();\n\t\t}\n\t}\n\n}\n","lineNo":43}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\nimport static br.com.caelum.stella.boleto.utils.StellaStringUtils.leftPadWithZeros;\n\n/**\n * Gera dados de um boleto relativos ao Banco do Brasil.\n * \n * @author Cauê Guerra\n * @author Paulo Silveira\n */\npublic class BancoDoBrasil extends AbstractBanco implements Banco {\n\n\tprivate static final long serialVersionUID = 1L;\n\n\n\tprivate static final String NUMERO_BB = \"001\";\n\tprivate static final String DIGITO_NUMERO_BB = \"9\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tEmissor emissor = boleto.getEmissor();\n\t\t\n\t\tif (convenioAntigo(emissor.getNumeroConvenio())) {\n\t\t\tif (emissor.getCarteira().equals(\"16\") || emissor.getCarteira().equals(\"18\")) {\n\t\t\t\tcampoLivre.append(getNumeroConvenioDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(\"21\");\n\t\t\t} else {\n\t\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(emissor.getAgenciaFormatado());\n\t\t\t\tcampoLivre.append(emissor.getCedente());\n\t\t\t\tcampoLivre.append(boleto.getBanco().getCarteiraDoEmissorFormatado(emissor));\n\t\t\t}\n\t\t} else if (emissor.getCarteira().equals(\"17\") || emissor.getCarteira().equals(\"18\")) {\n\t\t\tcampoLivre.append(\"000000\");\n\t\t\tcampoLivre.append(getNumeroConvenioDoEmissorFormatado(emissor));\n\t\t\tcampoLivre.append(emissor.getCarteira().equals(\"17\") ? getNossoNumeroDoEmissorFormatado(emissor).substring(1) : getNossoNumeroDoEmissorFormatado(emissor).substring(7));\n\t\t\tcampoLivre.append(boleto.getBanco().getCarteiraDoEmissorFormatado(emissor));\n\t\t} else {\n\t\t\tthrow new CriacaoBoletoException(\n\t\t\t\t\t\"Erro na geração do código de barras. Nenhuma regra se aplica. \" +\n\t\t\t\t\t\"Verifique carteira e demais dados.\");\n\t\t}\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\tprivate boolean convenioAntigo(String convenio) {\n\t\tlong numeroConvenio = Long.parseLong(convenio);\n\t\treturn numeroConvenio < 1000000;\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_BB;\n\t}\n\n\t@Override\n\tpublic java.net.URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\tpublic String getNumeroConvenioDoEmissorFormatado(Emissor emissor) {\n\t\tif (convenioAntigo(emissor.getNumeroConvenio())) {\n\t\t\treturn leftPadWithZeros(emissor.getNumeroConvenio(), 6);\n\t\t} else {\n\t\t\treturn leftPadWithZeros(emissor.getNumeroConvenio(), 7);\n\t\t}\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getContaCorrente(), 8);\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getCarteira(),2);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tif (emissor.getCarteira().equals(\"18\")) {\n\t\t\treturn leftPadWithZeros(emissor.getNossoNumero(), 17);\n\t\t} else {\n\t\t\treturn leftPadWithZeros(emissor.getNossoNumero(), 11);\n\t\t}\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_BB + \"-\" + DIGITO_NUMERO_BB;\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Boleto boleto) {\n\t\treturn getNossoNumeroDoEmissorFormatado(boleto.getEmissor());\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\nimport static br.com.caelum.stella.boleto.utils.StellaStringUtils.leftPadWithZeros;\n\n/**\n * Gera dados de um boleto relativos ao Banco do Brasil.\n * \n * @author Cauê Guerra\n * @author Paulo Silveira\n */\npublic class BancoDoBrasil extends AbstractBanco implements Banco {\n\n\tprivate static final long serialVersionUID = 1L;\n\n\tprivate static final String NUMERO_BB = \"001\";\n\tprivate static final String DIGITO_NUMERO_BB = \"9\";\n\tprivate static final String CARTEIRA_16 = \"16\";\n\tprivate static final String CARTEIRA_17 = \"17\";\n\tprivate static final String CARTEIRA_18 = \"18\";\n\tprivate static final String ZEROS_CONVENIOS_NOVOS = \"000000\";\n\tprivate static final String TIPO_MODALIDADE_COBRANCA_CARTEIRA_SEM_REGISTRO = \"21\";\n\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tEmissor emissor = boleto.getEmissor();\n\t\t\n\t\tif (convenioAntigo(emissor.getNumeroConvenio())) {\n\t\t\tif (emissor.getCarteira().equals(CARTEIRA_16) || emissor.getCarteira().equals(CARTEIRA_18)) {\n\t\t\t\tcampoLivre.append(getNumeroConvenioDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(TIPO_MODALIDADE_COBRANCA_CARTEIRA_SEM_REGISTRO);\n\t\t\t} else {\n\t\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(emissor.getAgenciaFormatado());\n\t\t\t\tcampoLivre.append(emissor.getCedente());\n\t\t\t\tcampoLivre.append(boleto.getBanco().getCarteiraDoEmissorFormatado(emissor));\n\t\t\t}\n\t\t} else if (emissor.getCarteira().equals(CARTEIRA_17) || emissor.getCarteira().equals(CARTEIRA_18)) {\n\t\t\tcampoLivre.append(ZEROS_CONVENIOS_NOVOS);\n\t\t\tcampoLivre.append(getNumeroConvenioDoEmissorFormatado(emissor));\n\t\t\tcampoLivre.append(getNossoNumeroParaCarteiras17e18(emissor));\n\t\t\tcampoLivre.append(boleto.getBanco().getCarteiraDoEmissorFormatado(emissor));\n\t\t} else {\n\t\t\tthrow new CriacaoBoletoException(\n\t\t\t\t\t\"Erro na geração do código de barras. Nenhuma regra se aplica. \" +\n\t\t\t\t\t\"Verifique carteira e demais dados.\");\n\t\t}\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\tprivate String getNossoNumeroParaCarteiras17e18(Emissor emissor) {\n\t\tint indice = emissor.getCarteira().equals(CARTEIRA_17) ? 1 : 7;\n\t\treturn  getNossoNumeroDoEmissorFormatado(emissor).substring(indice);\n\t}\n\n\tprivate boolean convenioAntigo(String convenio) {\n\t\tlong numeroConvenio = Long.parseLong(convenio);\n\t\treturn numeroConvenio < 1000000;\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_BB;\n\t}\n\n\t@Override\n\tpublic java.net.URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\tpublic String getNumeroConvenioDoEmissorFormatado(Emissor emissor) {\n\t\tif (convenioAntigo(emissor.getNumeroConvenio())) {\n\t\t\treturn leftPadWithZeros(emissor.getNumeroConvenio(), 6);\n\t\t} else {\n\t\t\treturn leftPadWithZeros(emissor.getNumeroConvenio(), 7);\n\t\t}\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getContaCorrente(), 8);\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getCarteira(),2);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tif (emissor.getCarteira().equals(CARTEIRA_18)) {\n\t\t\treturn leftPadWithZeros(emissor.getNossoNumero(), 17);\n\t\t} else {\n\t\t\treturn leftPadWithZeros(emissor.getNossoNumero(), 11);\n\t\t}\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_BB + \"-\" + DIGITO_NUMERO_BB;\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Boleto boleto) {\n\t\treturn getNossoNumeroDoEmissorFormatado(boleto.getEmissor());\n\t}\n\n}\n","lineNo":58}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport static br.com.caelum.stella.boleto.utils.StellaStringUtils.leftPadWithZeros;\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigito;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigitoSantander;\n\npublic class Santander implements Banco {\n\n\tprivate static final long serialVersionUID = 1L;\n\n\tprivate final static String NUMERO_SANTANDER = \"033\";\n\tprivate final static String DIGITO_SANTANDER = \"7\";\n\tprivate GeradorDeDigito gdivSantander = new GeradorDeDigitoSantander();\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder campoLivre = new StringBuilder(\"9\");\n\t\tcampoLivre.append(getContaCorrenteDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(\"0\").append(emissor.getCarteira());\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\t\n\t@Override\n\tpublic URL getImage() {\n\t\tString pathDoArquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(pathDoArquivo, NUMERO_SANTANDER);\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_SANTANDER;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getCarteira(), 3);\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getContaCorrente(), 7);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getNossoNumero(), 13);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(NUMERO_SANTANDER).append(\"-\");\n\t\treturn builder.append(DIGITO_SANTANDER).toString();\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(leftPadWithZeros(emissor.getAgencia(), 5));\n\t\tbuilder.append(\"/\").append(emissor.getContaCorrente());\n\t\treturn builder.toString();\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Boleto boleto) {\n\t\tEmissor emissor = boleto.getEmissor();\n\t\t\n\t\tString nossoNumero = getNossoNumeroDoEmissorFormatado(emissor);\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(nossoNumero.substring(0, 12));\n\t\tbuilder.append(\"-\").append(nossoNumero.substring(12));\n\t\treturn  builder.toString();\n\t}\n \n\t@Override\n\tpublic GeradorDeDigito getGeradorDeDigito() {\n\t\treturn gdivSantander;\n\t}\n\t\n\tpublic int calcularDigitoVerificador(Emissor emissor) {\n\t\tif (emissor == null || emissor.getNossoNumero() == null || emissor.getNossoNumero().length() != 12) {\n\t\t\tthrow new IllegalArgumentException();\n\t\t}\n\t\tint soma = 0;\n\t\tfor (int i = 2, multiplicador = 2, fim = 12; i < 14; i++) {\n\t\t\tif (i < 10) {\n\t\t\t\tsoma += i * Integer.parseInt(emissor.getNossoNumero().substring(fim-1, fim));\n\t\t\t} else {\n\t\t\t\tsoma += multiplicador * Integer.parseInt(emissor.getNossoNumero().substring(fim-1, fim));\n\t\t\t\tmultiplicador++;\n\t\t\t}\n\t\t\tfim--;\n\t\t}\n\t\tint resto = (soma * 10) % 11;\n\t\tif (resto == 1 || resto == 0) {\n\t\t\treturn 0;\n\t\t} else if (resto == 10) {\n\t\t\treturn 1;\n\t\t} else {\n\t\t\treturn resto;\n\t\t}\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport static br.com.caelum.stella.boleto.utils.StellaStringUtils.leftPadWithZeros;\nimport br.com.caelum.stella.DigitoPara;\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigito;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigitoSantander;\n\npublic class Santander implements Banco {\n\n\tprivate static final long serialVersionUID = 1L;\n\n\tprivate final static String NUMERO_SANTANDER = \"033\";\n\tprivate final static String DIGITO_SANTANDER = \"7\";\n\tprivate GeradorDeDigito gdivSantander = new GeradorDeDigitoSantander();\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder campoLivre = new StringBuilder(\"9\");\n\t\tcampoLivre.append(getContaCorrenteDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(\"0\").append(emissor.getCarteira());\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\t\n\t@Override\n\tpublic URL getImage() {\n\t\tString pathDoArquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(pathDoArquivo, NUMERO_SANTANDER);\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_SANTANDER;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getCarteira(), 3);\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getContaCorrente(), 7);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getNossoNumero(), 13);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(NUMERO_SANTANDER).append(\"-\");\n\t\treturn builder.append(DIGITO_SANTANDER).toString();\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(leftPadWithZeros(emissor.getAgencia(), 5));\n\t\tbuilder.append(\"/\").append(emissor.getContaCorrente());\n\t\treturn builder.toString();\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Boleto boleto) {\n\t\tEmissor emissor = boleto.getEmissor();\n\t\t\n\t\tString nossoNumero = getNossoNumeroDoEmissorFormatado(emissor);\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(nossoNumero.substring(0, 12));\n\t\tbuilder.append(\"-\").append(nossoNumero.substring(12));\n\t\treturn  builder.toString();\n\t}\n \n\t@Override\n\tpublic GeradorDeDigito getGeradorDeDigito() {\n\t\treturn gdivSantander;\n\t}\n\t\n\tpublic String calcularDigitoVerificador(Emissor emissor) {\n\t\tif (emissor == null || emissor.getNossoNumero() == null || emissor.getNossoNumero().length() > 12) {\n\t\t\tthrow new IllegalArgumentException();\n\t\t}\n\t\tDigitoPara digitoPara = new DigitoPara(leftPadWithZeros(emissor.getNossoNumero(), 12));\n\t\tString resultado = digitoPara.comMultiplicadoresDeAte(2,9).mod(11).complementarAoModulo().calcula();\n\t\tif (resultado.equals(\"1\") || resultado.equals(\"0\")) {\n\t\t\treturn \"0\";\n\t\t} else if (resultado.equals(\"10\")) {\n\t\t\treturn \"1\";\n\t\t} else {\n\t\t\treturn resultado;\n\t\t}\n\t}\n}\n","lineNo":94}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\nimport java.text.SimpleDateFormat;\nimport java.util.Calendar;\n\nimport br.com.caelum.stella.DigitoPara;\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\npublic class HSBC extends AbstractBanco implements Banco {\n\n\tprivate static final long serialVersionUID = 1L;\n\n\tprivate static final String NUMERO_HSBC = \"399\";\n\tprivate static final String DIGITO_HSBC = \"9\";\n\tprivate static final String CODIGO_APLICATIVO = \"2\";\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_HSBC + \"-\" + DIGITO_HSBC;\n\t}\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tString codigoAgencia = boleto.getEmissor().getCodigoFornecidoPelaAgencia();\n\t\tcampoLivre.append(String.format(\"%07d\", codigoAgencia));\n\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\t\tcampoLivre.append(getDataFormatoJuliano(boleto.getDatas().getVencimento(), 4));\n\t\tcampoLivre.append(HSBC.CODIGO_APLICATIVO);\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\tpublic String getDataFormatoJuliano(Calendar vencimento, int tipo) {\n\t\tString result;\n\t\tCalendar dataLimite = Calendar.getInstance();\n\t\tdataLimite.set(Calendar.DAY_OF_MONTH, 1);\n\t\tdataLimite.set(Calendar.MONTH, 7 - 1);\n\t\tdataLimite.set(Calendar.YEAR, 1997);\n\t\tif (vencimento.before(dataLimite)) {\n\t\t\tresult = \"0000\";\n\t\t} else {\n\t\t\tint diaDoAno = vencimento.get(Calendar.DAY_OF_YEAR);\n\t\t\tint digitoDoAno = vencimento.get(Calendar.YEAR) % 10;\n\t\t\tresult = String.format(\"%03d%d\", diaDoAno, digitoDoAno);\n\t\t}\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn \"CNR\";\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%013d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn HSBC.NUMERO_HSBC;\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\n\t\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Boleto boleto) {\n\t\t\n\t\tEmissor emissor = boleto.getEmissor();\n\t\t\n\t\tString nossoNumero = getNossoNumeroDoEmissorFormatado(emissor);\n\t\tString beneficiario = emissor.getCodigoFornecidoPelaAgencia();\n\t\tString dataVcto = new SimpleDateFormat(\"ddMMyy\").format(boleto.getDatas().getVencimento().getTime());;\n\t\t\n\t\tDigitoPara calculadorMod = getModuloNossoNumero(nossoNumero);\n\t\tString primeiroDigito = calculadorMod.calcula();\n\t\t\n\t\tString nossoNumeroComDigitos = nossoNumero + primeiroDigito + 4; // 4 é fixo\n\t\n\t\tlong nossoNum = Long.parseLong(nossoNumeroComDigitos);\n\t\tlong vcto = Long.parseLong(dataVcto);\n\t\t\n\t\tString somatorio = String.valueOf(nossoNum + beneficiario + vcto);\n\t\t\n\t\tString segundoDigito = getModuloNossoNumero(somatorio).calcula();\n\t\treturn nossoNumeroComDigitos + segundoDigito;\n\t}\n\n\tprivate DigitoPara getModuloNossoNumero(String nossoNumero) {\n\t\treturn new DigitoPara(nossoNumero).comMultiplicadores(9,8,7,6,5,4,3,2).mod(11);\n\t}\n\t\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\nimport java.text.SimpleDateFormat;\nimport java.util.Calendar;\n\nimport static br.com.caelum.stella.boleto.utils.StellaStringUtils.leftPadWithZeros;\nimport br.com.caelum.stella.DigitoPara;\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\npublic class HSBC extends AbstractBanco implements Banco {\n\n\tprivate static final long serialVersionUID = 1L;\n\n\tprivate static final String NUMERO_HSBC = \"399\";\n\tprivate static final String DIGITO_HSBC = \"9\";\n\tprivate static final String CODIGO_APLICATIVO = \"2\";\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_HSBC + \"-\" + DIGITO_HSBC;\n\t}\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tString codigoAgencia = boleto.getEmissor().getCodigoFornecidoPelaAgencia();\n\t\tcampoLivre.append(leftPadWithZeros(codigoAgencia, 7));\n\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\t\tcampoLivre.append(getDataFormatoJuliano(boleto.getDatas().getVencimento(), 4));\n\t\tcampoLivre.append(HSBC.CODIGO_APLICATIVO);\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\tpublic String getDataFormatoJuliano(Calendar vencimento, int tipo) {\n\t\tString result;\n\t\tCalendar dataLimite = Calendar.getInstance();\n\t\tdataLimite.set(Calendar.DAY_OF_MONTH, 1);\n\t\tdataLimite.set(Calendar.MONTH, 7 - 1);\n\t\tdataLimite.set(Calendar.YEAR, 1997);\n\t\tif (vencimento.before(dataLimite)) {\n\t\t\tresult = \"0000\";\n\t\t} else {\n\t\t\tint diaDoAno = vencimento.get(Calendar.DAY_OF_YEAR);\n\t\t\tint digitoDoAno = vencimento.get(Calendar.YEAR) % 10;\n\t\t\tresult = String.format(\"%03d%d\", diaDoAno, digitoDoAno);\n\t\t}\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn \"CNR\";\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getContaCorrente(), 7);\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getNossoNumero(), 13);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn HSBC.NUMERO_HSBC;\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\treturn leftPadWithZeros(emissor.getCodigoFornecidoPelaAgencia(), 7);\n\t}\n\t\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Boleto boleto) {\n\t\t\n\t\tEmissor emissor = boleto.getEmissor();\n\t\t\n\t\tString nossoNumero = getNossoNumeroDoEmissorFormatado(emissor);\n\t\tString beneficiario = emissor.getCodigoFornecidoPelaAgencia();\n\t\tString dataVcto = new SimpleDateFormat(\"ddMMyy\").format(boleto.getDatas().getVencimento().getTime());;\n\t\t\n\t\tDigitoPara calculadorMod = getModuloNossoNumero(nossoNumero);\n\t\tString primeiroDigito = calculadorMod.calcula();\n\t\t\n\t\tString nossoNumeroComDigitos = nossoNumero + primeiroDigito + 4; // 4 é fixo\n\t\n\t\tlong nossoNum = Long.parseLong(nossoNumeroComDigitos);\n\t\tlong vcto = Long.parseLong(dataVcto);\n\t\tlong benef = Long.parseLong(beneficiario);\n\t\t\n\t\tString somatorio = String.valueOf(nossoNum + benef + vcto);\n\t\t\n\t\tString segundoDigito = getModuloNossoNumero(somatorio).calcula();\n\t\treturn nossoNumeroComDigitos + segundoDigito;\n\t}\n\n\tprivate DigitoPara getModuloNossoNumero(String nossoNumero) {\n\t\treturn new DigitoPara(nossoNumero).comMultiplicadores(9,8,7,6,5,4,3,2).mod(11);\n\t}\n\t\n}\n","lineNo":101}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\nimport java.text.SimpleDateFormat;\nimport java.util.Calendar;\n\nimport br.com.caelum.stella.DigitoPara;\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\npublic class HSBC extends AbstractBanco implements Banco {\n\n\tprivate static final long serialVersionUID = 1L;\n\n\tprivate static final String NUMERO_HSBC = \"399\";\n\tprivate static final String DIGITO_HSBC = \"9\";\n\tprivate static final String CODIGO_APLICATIVO = \"2\";\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_HSBC + \"-\" + DIGITO_HSBC;\n\t}\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tint codigoAgencia = boleto.getEmissor().getCodigoFornecidoPelaAgencia();\n\t\tcampoLivre.append(String.format(\"%07d\", codigoAgencia));\n\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\t\tcampoLivre.append(getDataFormatoJuliano(boleto.getDatas().getVencimento(), 4));\n\t\tcampoLivre.append(HSBC.CODIGO_APLICATIVO);\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\tpublic String getDataFormatoJuliano(Calendar vencimento, int tipo) {\n\t\tString result;\n\t\tCalendar dataLimite = Calendar.getInstance();\n\t\tdataLimite.set(Calendar.DAY_OF_MONTH, 1);\n\t\tdataLimite.set(Calendar.MONTH, 7 - 1);\n\t\tdataLimite.set(Calendar.YEAR, 1997);\n\t\tif (vencimento.before(dataLimite)) {\n\t\t\tresult = \"0000\";\n\t\t} else {\n\t\t\tint diaDoAno = vencimento.get(Calendar.DAY_OF_YEAR);\n\t\t\tint digitoDoAno = vencimento.get(Calendar.YEAR) % 10;\n\t\t\tresult = String.format(\"%03d%d\", diaDoAno, digitoDoAno);\n\t\t}\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn \"CNR\";\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%013d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn HSBC.NUMERO_HSBC;\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\n\t\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Boleto boleto) {\n\t\t\n\t\tEmissor emissor = boleto.getEmissor();\n\t\t\n\t\tString nossoNumero = getNossoNumeroDoEmissorFormatado(emissor);\n\t\tint beneficiario = emissor.getCodigoFornecidoPelaAgencia();\n\t\tString dataVcto = new SimpleDateFormat(\"ddMMyy\").format(boleto.getDatas().getVencimento().getTime());;\n\t\t\n\t\tDigitoPara calculadorMod = getModuloNossoNumero(nossoNumero);\n\t\tString primeiroDigito = calculadorMod.calcula();\n\t\t\n\t\tString nossoNumeroComDigitos = nossoNumero + primeiroDigito + 4; // 4 é fixo\n\t\n\t\tlong nossoNum = Long.parseLong(nossoNumeroComDigitos);\n\t\tlong vcto = Long.parseLong(dataVcto);\n\t\t\n\t\tString somatorio = String.valueOf(nossoNum + beneficiario + vcto);\n\t\t\n\t\tString segundoDigito = getModuloNossoNumero(somatorio).calcula();\n\t\treturn nossoNumeroComDigitos + segundoDigito;\n\t}\n\n\tprivate DigitoPara getModuloNossoNumero(String nossoNumero) {\n\t\treturn new DigitoPara(nossoNumero).comMultiplicadores(9,8,7,6,5,4,3,2).mod(11);\n\t}\n\t\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\nimport java.text.SimpleDateFormat;\nimport java.util.Calendar;\n\nimport br.com.caelum.stella.DigitoPara;\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\npublic class HSBC extends AbstractBanco implements Banco {\n\n\tprivate static final long serialVersionUID = 1L;\n\n\tprivate static final String NUMERO_HSBC = \"399\";\n\tprivate static final String DIGITO_HSBC = \"9\";\n\tprivate static final String CODIGO_APLICATIVO = \"2\";\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_HSBC + \"-\" + DIGITO_HSBC;\n\t}\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tint codigoAgencia = boleto.getEmissor().getCodigoFornecidoPelaAgencia();\n\t\tcampoLivre.append(String.format(\"%07d\", codigoAgencia));\n\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\t\tcampoLivre.append(getDataFormatoJuliano(boleto.getDatas().getVencimento(), 4));\n\t\tcampoLivre.append(HSBC.CODIGO_APLICATIVO);\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\tpublic String getDataFormatoJuliano(Calendar vencimento, int tipo) {\n\t\tString result;\n\t\tCalendar dataLimite = Calendar.getInstance();\n\t\tdataLimite.set(Calendar.DAY_OF_MONTH, 1);\n\t\tdataLimite.set(Calendar.MONTH, 7 - 1);\n\t\tdataLimite.set(Calendar.YEAR, 1997);\n\t\tif (vencimento.before(dataLimite)) {\n\t\t\tresult = \"0000\";\n\t\t} else {\n\t\t\tint diaDoAno = vencimento.get(Calendar.DAY_OF_YEAR);\n\t\t\tint digitoDoAno = vencimento.get(Calendar.YEAR) % 10;\n\t\t\tresult = String.format(\"%03d%d\", diaDoAno, digitoDoAno);\n\t\t}\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn \"CNR\";\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%013d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn HSBC.NUMERO_HSBC;\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\n\t\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Boleto boleto) {\n\t\t\n\t\tEmissor emissor = boleto.getEmissor();\n\t\t\n\t\tString nossoNumero = getNossoNumeroDoEmissorFormatado(emissor);\n\t\tint beneficiario = emissor.getCodigoFornecidoPelaAgencia();\n\t\tString dataVcto = new SimpleDateFormat(\"ddMMyy\").format(boleto.getDatas().getVencimento().getTime());;\n\t\t\n\t\tDigitoPara calculadorMod = getModuloNossoNumero(nossoNumero);\n\t\tString primeiroDigito = calculadorMod.calcula();\n\t\t\n\t\tString nossoNumeroComDigitos = nossoNumero + primeiroDigito + 4; // 4 é fixo\n\t\n\t\tlong nossoNum = Long.parseLong(nossoNumeroComDigitos);\n\t\tlong vcto = Long.parseLong(dataVcto);\n\t\t\n\t\tString somatorio = String.valueOf(nossoNum + beneficiario + vcto);\n\t\t\n\t\tDigitoPara calculadorMod2 = getModuloNossoNumero(somatorio);\n\t\tString segundoDigito = calculadorMod2.calcula();\n\t\treturn nossoNumeroComDigitos + segundoDigito;\n\t}\n\n\tprivate DigitoPara getModuloNossoNumero(String nossoNumero) {\n\t\treturn new DigitoPara(nossoNumero)\n\t\t\t\t\t\t.trocandoPorSeEncontrar(\"0\",10,11)\n\t\t\t\t\t\t.comMultiplicadores(9,8,7,6,5,4,3,2)\n\t\t\t\t\t\t.mod(11);\n\t}\n\t\n}\n","lineNo":104}
{"Smelly Sample":"package br.com.caelum.stella.tinytype;\n\nimport br.com.caelum.stella.format.CNPJFormatter;\nimport br.com.caelum.stella.validation.CNPJValidator;\n\n/**\n * Representa um Cadastro Nacional da Pessoa Jurídica - CNPJ.\n * \n * @author leobessa\n * \n */\npublic final class CNPJ {\n\n    private final String numero;\n\n    /**\n     * @param número do CNPJ.\n     */\n    public CNPJ(String numero) {\n    \tString numeroCnpj;\n    \ttry {\n    \t\tnumeroCnpj = new CNPJFormatter().unformat(numero);\n\t\t} catch (IllegalArgumentException e) {\n\t\t\tnumeroCnpj = numero;\n\t\t}\n    \tthis.numero = numeroCnpj;\n    }\n\n    /**\n     * @return número do CNPJ.\n     */\n    public String getNumero() {\n        return numero;\n    }\n    \n    /**\n     * @return número do CNPJ formatado.\n     */\n    public String getNumeroFormatado() {\n    \treturn new CNPJFormatter().format(numero);\n    }\n\n    /**\n     * @return se o número do CNPJ é valido.\n     */\n    public boolean isValid() {\n    \treturn new CNPJValidator().invalidMessagesFor(numero).isEmpty();\n    }\n    \n    /**\n     * @return número do CNPJ formatado.\n     */\n    @Override\n    public String toString() {\n    \treturn getNumeroFormatado();\n    }\n\n    @Override\n    public int hashCode() {\n        final int prime = 31;\n        int result = 1;\n        result = prime * result + ((numero == null) ? 0 : numero.hashCode());\n        return result;\n    }\n\n    @Override\n    public boolean equals(Object obj) {\n        if (this == obj)\n            return true;\n        if (obj == null)\n            return false;\n        if (getClass() != obj.getClass())\n            return false;\n        final CNPJ other = (CNPJ) obj;\n        if (numero == null) {\n            if (other.numero != null)\n                return false;\n        } else if (!numero.equals(other.numero))\n            return false;\n        return true;\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.tinytype;\n\nimport br.com.caelum.stella.format.CNPJFormatter;\nimport br.com.caelum.stella.validation.CNPJValidator;\n\n/**\n * Representa um Cadastro Nacional da Pessoa Jurídica - CNPJ.\n *\n * @author leobessa\n *\n */\npublic final class CNPJ {\n\n    private final String numero;\n\tprivate String numeroFormatado;\n\n    /**\n     * @param número do CNPJ.\n     */\n    public CNPJ(String numero) {\n    \tCNPJFormatter formatter = new CNPJFormatter();\n    \tif (formatter.isFormatted(numero)) {\n\t\t\tthis.numero = formatter.unformat(numero);\n\t\t\tthis.numeroFormatado = numero;\n\t\t} else if (formatter.canBeFormatted(numero)) {\n\t\t\tthis.numero = numero;\n\t\t\tthis.numeroFormatado = formatter.format(numero);\n\t\t} else {\n\t\t\tthis.numero = this.numeroFormatado = numero;\n\t\t}\n    }\n\n    /**\n     * @return número do CNPJ.\n     */\n    public String getNumero() {\n        return numero;\n    }\n\n    /**\n     * @return número do CNPJ formatado.\n     */\n    public String getNumeroFormatado() {\n    \treturn numeroFormatado;\n    }\n\n    /**\n     * @return se o número do CNPJ é valido.\n     */\n    public boolean isValid() {\n    \treturn new CNPJValidator().invalidMessagesFor(numero).isEmpty();\n    }\n\n    /**\n     * @return número do CNPJ formatado.\n     */\n    @Override\n    public String toString() {\n    \treturn getNumeroFormatado();\n    }\n\n    @Override\n    public int hashCode() {\n        final int prime = 31;\n        int result = 1;\n        result = prime * result + ((numero == null) ? 0 : numero.hashCode());\n        return result;\n    }\n\n    @Override\n    public boolean equals(Object obj) {\n        if (this == obj) {\n\t\t\treturn true;\n\t\t}\n        if (obj == null) {\n\t\t\treturn false;\n\t\t}\n        if (getClass() != obj.getClass()) {\n\t\t\treturn false;\n\t\t}\n        final CNPJ other = (CNPJ) obj;\n        if (numero == null) {\n            if (other.numero != null) {\n\t\t\t\treturn false;\n\t\t\t}\n        } else if (!numero.equals(other.numero)) {\n\t\t\treturn false;\n\t\t}\n        return true;\n    }\n\n}\n","lineNo":21}
{"Smelly Sample":"package br.com.caelum.stella.tinytype;\n\nimport br.com.caelum.stella.format.CPFFormatter;\nimport br.com.caelum.stella.validation.CPFValidator;\n\n/**\n * Representa um Cadastro de Pessoas Física - CPF.\n * \n * @author leobessa\n * \n */\npublic final class CPF {\n\n    private final String numero;\n\n    /**\n     * @param número do CPF.\n     */\n    public CPF(String numero) {\n    \tString numeroCpf;\n    \ttry {\n    \t\tnumeroCpf = new CPFFormatter().unformat(numero);\n\t\t} catch (IllegalArgumentException e) {\n\t\t\tnumeroCpf = numero;\n\t\t}\n    \tthis.numero = numeroCpf;\n    }\n\n    /**\n     * @return número do CPF.\n     */\n    public String getNumero() {\n        return numero;\n    }\n    \n    /**\n     * @return número do CPF formatado.\n     */\n    public String getNumeroFormatado() {\n    \treturn new CPFFormatter().format(numero);\n    }\n\n    /**\n     * @return se o número do CPF é valido.\n     */\n\tpublic boolean isValido() {\n\t\treturn new CPFValidator().invalidMessagesFor(numero).isEmpty();\n\t}\n\n    /**\n     * @return número do CPF formatado.\n     */\n    @Override\n    public String toString() {\n        return getNumeroFormatado();\n    }\n\n    @Override\n    public int hashCode() {\n        final int prime = 31;\n        int result = 1;\n        result = prime * result + ((numero == null) ? 0 : numero.hashCode());\n        return result;\n    }\n\n    @Override\n    public boolean equals(Object obj) {\n        if (this == obj)\n            return true;\n        if (obj == null)\n            return false;\n        if (getClass() != obj.getClass())\n            return false;\n        final CPF other = (CPF) obj;\n        if (numero == null) {\n            if (other.numero != null)\n                return false;\n        } else if (!numero.equals(other.numero))\n            return false;\n        return true;\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.tinytype;\n\nimport br.com.caelum.stella.format.CPFFormatter;\nimport br.com.caelum.stella.validation.CPFValidator;\n\n/**\n * Representa um Cadastro de Pessoas Física - CPF.\n *\n * @author leobessa\n *\n */\npublic final class CPF {\n\n    private final String numero;\n\n    /**\n     * @param número do CPF.\n     */\n    public CPF(String numero) {\n    \tString numeroCpf;\n    \tCPFFormatter formatter = new CPFFormatter();\n    \tif (formatter.isFormatted(numero)) {\n\t\t\tnumeroCpf = formatter.unformat(numero);\n\t\t} else {\n\t\t\tnumeroCpf = numero;\n\t\t}\n    \tthis.numero = numeroCpf;\n    }\n\n    /**\n     * @return número do CPF.\n     */\n    public String getNumero() {\n        return numero;\n    }\n\n    /**\n     * @return número do CPF formatado.\n     */\n    public String getNumeroFormatado() {\n    \treturn new CPFFormatter().format(numero);\n    }\n\n    /**\n     * @return se o número do CPF é valido.\n     */\n\tpublic boolean isValido() {\n\t\treturn new CPFValidator().invalidMessagesFor(numero).isEmpty();\n\t}\n\n    /**\n     * @return número do CPF formatado.\n     */\n    @Override\n    public String toString() {\n        return getNumeroFormatado();\n    }\n\n    @Override\n    public int hashCode() {\n        final int prime = 31;\n        int result = 1;\n        result = prime * result + ((numero == null) ? 0 : numero.hashCode());\n        return result;\n    }\n\n    @Override\n    public boolean equals(Object obj) {\n        if (this == obj) {\n\t\t\treturn true;\n\t\t}\n        if (obj == null) {\n\t\t\treturn false;\n\t\t}\n        if (getClass() != obj.getClass()) {\n\t\t\treturn false;\n\t\t}\n        final CPF other = (CPF) obj;\n        if (numero == null) {\n            if (other.numero != null) {\n\t\t\t\treturn false;\n\t\t\t}\n        } else if (!numero.equals(other.numero)) {\n\t\t\treturn false;\n\t\t}\n        return true;\n    }\n\n}\n","lineNo":21}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.SimpleMessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\nimport br.com.caelum.stella.format.RenavamFormatter;\nimport br.com.caelum.stella.validation.error.RenavamError;\n\n/**\n * <p>\n * Verifica se uma cadeia (String) representa um Renavam válido.\n * <\/p>\n * \n * <p>\n * O Renavam, ou Registro nacional de veículos automotores, é o número único de\n * cada veículo e é composto de 8 (oito) dígitos, mais um digito verificador.\n * <\/p>\n * \n * Formato do Renavam: \"dd.dddddd-d\" onde \"d\" é um digito decimal.\n * \n * @author Rafael Carvalho\n */\npublic class RenavamValidator implements Validator<String> {\n\n    private final BaseValidator baseValidator;\n    private static final Integer fator = 0;\n    private static final Integer mod = 11;\n    private static final Integer[] pesos = { 9, 8, 7, 6, 5, 4, 3, 2 };\n    private static final Integer posicaoDoDigitoVerificador = 9;\n    private static final RotinaDeDigitoVerificador[] rotinas = { new RotinaComumDeDigitoVerificador() };\n    private static final DigitoVerificadorInfo digitoVerificadorInfo = new DigitoVerificadorInfo(fator, rotinas, mod,\n            pesos,\n            posicaoDoDigitoVerificador);\n    private static final ValidadorDeDV validatorDeDigitoVerificador = new ValidadorDeDV(digitoVerificadorInfo);\n    private final boolean isFormatted;\n\n    /**\n     * Construtor padrão de validador do Renavam. Este considera, por padrão,\n     * que as cadeias estão formatadas e utiliza um\n     * {@linkplain SimpleMessageProducer} para geração de mensagens.\n     */\n    public RenavamValidator() {\n        this(true);\n    }\n\n    /**\n     * Construtor de validador de Renavam. O validador utiliza um\n     * {@linkplain SimpleMessageProducer} para geração de mensagens.\n     * \n     * @param isFormatted\n     *            Informa se a cadeia de caracteres a ser validada está ou não\n     *            formatada\n     */\n    public RenavamValidator(boolean isFormatted) {\n        this.isFormatted = isFormatted;\n        this.baseValidator = new BaseValidator();\n    }\n\n    /**\n     * <p>\n     * Construtor do validador de Renavam\n     * <\/p>\n     * \n     * @param messageProducer\n     *            produtor de mensagem de erro.\n     * @param isFormatted\n     *            Informa se a cadeia de caracteres a ser validada está ou não\n     *            formatada\n     */\n    public RenavamValidator(MessageProducer messageProducer, boolean isFormatted) {\n        this.isFormatted = isFormatted;\n        this.baseValidator = new BaseValidator(messageProducer);\n    }\n\n    public void assertValid(String renavam) {\n        baseValidator.assertValid(getInvalidValues(renavam));\n    }\n\n    private boolean isCheckDigitValid(String renavam) {\n        return validatorDeDigitoVerificador.isDVValid(unformat(renavam));\n    }\n\n    public List<ValidationMessage> invalidMessagesFor(String renavam) {\n        return baseValidator.generateValidationMessages(getInvalidValues(renavam));\n    }\n\n    /**\n     * Valida se a cadeia está de acordo com as regras de validação do Renavam.\n     * \n     * @see br.com.caelum.stella.validation.Validator#assertValid(java.lang.Object)\n     * \n     * @param renavam\n     *            Cadeia de caracteres representando o Renavam a ser validado\n     * @return Uma lista de {@linkplain InvalidValue} com os erros encontrados\n     *         ou uma lista vazia, caso não haja nenhum erro.\n     */\n    private List<InvalidValue> getInvalidValues(String renavam) {\n        List<InvalidValue> errors = new ArrayList<InvalidValue>();\n        if (!isEligible(renavam)) {\n            errors.add(RenavamError.INVALID_DIGITS);\n        } else if (!isCheckDigitValid(renavam)) {\n            errors.add(RenavamError.INVALID_CHECK_DIGIT);\n        }\n        return errors;\n    }\n\n    public boolean isEligible(String renavam) {\n        boolean isEligible;\n        if (isFormatted) {\n            isEligible = RenavamFormatter.FORMATTED.matcher(renavam).matches();\n        } else {\n            isEligible = RenavamFormatter.UNFORMATTED.matcher(renavam).matches();\n        }\n        return isEligible;\n    }\n\n    /**\n     * Remove a formatação da cadeia\n     * \n     * @param renavam\n     *            Cadeia de caracteres representando o Renavam\n     * @return O renvam informado, sem formatação.\n     */\n    private String unformat(String renavam) {\n        String result = renavam;\n        if (isFormatted) {\n            result = new RenavamFormatter().unformat(renavam);\n        }\n        return result;\n    }\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.regex.Pattern;\n\nimport br.com.caelum.stella.DigitoPara;\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.SimpleMessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\nimport br.com.caelum.stella.format.RenavamFormatter;\nimport br.com.caelum.stella.validation.error.RenavamError;\n\n/**\n * <p>\n * Verifica se uma cadeia (String) representa um Renavam válido.\n * <\/p>\n * \n * <p>\n * O Renavam, ou Registro nacional de veículos automotores, é o número único de\n * cada veículo e é composto de 10 (oito) dígitos, mais um digito verificador.\n * <\/p>\n * \n * Formato do Renavam: \"dddd.dddddd-d\" onde \"d\" é um digito decimal.\n * \n * @author Rafael Carvalho\n */\npublic class RenavamValidator implements Validator<String> {\n\n\tpublic static final Pattern FORMATED = Pattern.compile(\"(\\\\d{4})[.](\\\\d{6})-(\\\\d{1})\");\n\tpublic static final Pattern UNFORMATED = Pattern.compile(\"(\\\\d{4})(\\\\d{6})(\\\\d{1})\");\n\n    private boolean isFormatted = false;\n    private MessageProducer messageProducer;\n\n    /**\n     * Construtor padrão de validador do Renavam. Este considera, por padrão,\n     * que as cadeias estão formatadas e utiliza um\n     * {@linkplain SimpleMessageProducer} para geração de mensagens.\n     */\n    public RenavamValidator() {\n    \tthis.messageProducer = new SimpleMessageProducer();\n    }\n\n    /**\n     * Construtor de validador de Renavam. O validador utiliza um\n     * {@linkplain SimpleMessageProducer} para geração de mensagens.\n     * \n     * @param isFormatted\n     *            Informa se a cadeia de caracteres a ser validada está ou não\n     *            formatada\n     */\n    public RenavamValidator(boolean isFormatted) {\n        this.isFormatted = isFormatted;\n        this.messageProducer = new SimpleMessageProducer();\n    }\n\n    /**\n     * <p>\n     * Construtor do validador de Renavam\n     * <\/p>\n     * \n     * @param messageProducer\n     *            produtor de mensagem de erro.\n     * @param isFormatted\n     *            Informa se a cadeia de caracteres a ser validada está ou não\n     *            formatada\n     */\n    public RenavamValidator(MessageProducer messageProducer, boolean isFormatted) {\n        this.isFormatted = isFormatted;\n        this.messageProducer = messageProducer;\n    }\n\n    public void assertValid(String renavam) {\n        List<ValidationMessage> errors = getInvalidValues(renavam);\n        if (!errors.isEmpty()) {\n\t\t\tthrow new InvalidStateException(errors);\n\t\t}\n    }\n\n    public List<ValidationMessage> invalidMessagesFor(String renavam) {\n        return getInvalidValues(renavam);\n    }\n\n    /**\n     * Valida se a cadeia está de acordo com as regras de validação do Renavam.\n     * \n     * @see br.com.caelum.stella.validation.Validator#assertValid(java.lang.Object)\n     * \n     * @param renavam\n     *            Cadeia de caracteres representando o Renavam a ser validado\n     * @return Uma lista de {@linkplain ValidationMessage} com os erros encontrados\n     *         ou uma lista vazia, caso não haja nenhum erro.\n     */\n    private List<ValidationMessage> getInvalidValues(String renavam) {\n        List<ValidationMessage> errors = new ArrayList<ValidationMessage>();\n\t\tif (renavam != null) {\n\n\t\t\trenavam = formataPadraoNovo(renavam);\n\t\t\t\n\t\t\tif (isFormatted && !FORMATED.matcher(renavam).matches()) {\n\t\t\t\terrors.add(messageProducer.getMessage(RenavamError.INVALID_FORMAT));\n\t\t\t}\n\n\t\t\tString unformatedRenavam = null;\n\t\t\ttry {\n\t\t\t\tunformatedRenavam = new RenavamFormatter().unformat(renavam);\n\t\t\t} catch (IllegalArgumentException e) {\n\t\t\t\terrors.add(messageProducer.getMessage(RenavamError.INVALID_DIGITS));\n\t\t\t\treturn errors;\n\t\t\t}\n\t\t\t\n\t\t\tif (unformatedRenavam.length() != 11 || !unformatedRenavam.matches(\"[0-9]*\")) {\n\t\t\t\terrors.add(messageProducer.getMessage(RenavamError.INVALID_DIGITS));\n\t\t\t}\n\n\t\t\tString renavamSemDigito = unformatedRenavam.substring(0, unformatedRenavam.length() - 1);\n\t\t\tString digito = unformatedRenavam.substring(unformatedRenavam.length() - 1);\n\n\t\t\tString digitoCalculado = calculaDigito(renavamSemDigito);\n\n\t\t\tif (!digito.equals(digitoCalculado)) {\n\t\t\t\terrors.add(messageProducer.getMessage(RenavamError.INVALID_CHECK_DIGIT));\n\t\t\t}\n\t\t}\n\t\treturn errors;\n    }\n\n\tprivate String formataPadraoNovo(String renavam) {\n\t\tif ((isFormatted && renavam.length() == 11) || (!isFormatted && renavam.length() == 9)) {\n\t\t\treturn \"00\" + renavam;\n\t\t}\n\t\treturn renavam;\n\t}\n\n\tprivate String calculaDigito(String renavamSemDigito) {\n    \treturn new DigitoPara(renavamSemDigito).complementarAoModulo().trocandoPorSeEncontrar(\"0\",10,11).mod(11).calcula();\n\t}\n\n\tpublic boolean isEligible(String renavam) {\n        boolean isEligible;\n        if (isFormatted) {\n            isEligible = RenavamFormatter.FORMATTED.matcher(renavam).matches();\n        } else {\n            isEligible = RenavamFormatter.UNFORMATTED.matcher(renavam).matches();\n        }\n        return isEligible;\n    }\n\n}\n","lineNo":75}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.regex.Pattern;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.SimpleMessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\nimport br.com.caelum.stella.format.TituloEleitoralFormatter;\nimport br.com.caelum.stella.validation.error.TituloEleitoralError;\n\n/**\n * Representa um validador de Título de Eleitor. O algoritmo utilzado foi\n * basaedo na seguinte referência.\n * \n * http://www.tre-al.gov.br/unidades/corregedoria/resolucoes/res21538.pdf\n * <p>\n * Art. 12. Os tribunais regionais eleitorais farão distribuir, observada a\n * seqüência numérica fornecida pela secretaria de informática, às zonas\n * eleitorais da respectiva circunscrição, séries de números de inscrição\n * eleitoral, a serem utilizados na forma deste artigo.\n * <\/p>\n * <p>\n * Parágrafo único. O número de inscrição compor-se-á de até 12 algarismos, por\n * unidade da Federação, assim discriminados:\n * <\/p>\n * \n * a) os oito primeiros algarismos serão seqüenciados,desprezando-se, na\n * emissão, os zeros à esquerda;\n * \n * b) os dois algarismos seguintes serão representativos da unidade da Federação\n * de origem da inscrição, conforme códigos constantes da seguinte tabela:\n * \n * <ul>\n * <li>01 - São Paulo<\/li>\n * <li>02 - Minas Gerais<\/li>\n * <li>03 - Rio de Janeiro<\/li>\n * <li>04 - Rio Grande do Sul<\/li>\n * <li>05 - Bahia<\/li>\n * <li>06 - Paraná<\/li>\n * <li>07 - Ceará<\/li>\n * <li>08 - Pernambuco<\/li>\n * <li>09 - Santa Catarina<\/li>\n * <li>10 - Goiás<\/li>\n * <li>11 - Maranhão<\/li>\n * <li>12 - Paraíba<\/li>\n * <li>13 - Pará<\/li>\n * <li>14 - Espírito Santo<\/li>\n * <li>15 - Piauí<\/li>\n * <li>16 - Rio Grande do Norte<\/li>\n * <li>17 - Alagoas<\/li>\n * <li>18 - Mato Grosso<\/li>\n * <li>19 - Mato Grosso do Sul<\/li>\n * <li>20 - Distrito Federal<\/li>\n * <li>21 - Sergipe<\/li>\n * <li>22 - Amazonas<\/li>\n * <li>23 - Rondônia<\/li>\n * <li>24 - Acre<\/li>\n * <li>25 - Amapá<\/li>\n * <li>26 - Roraima<\/li>\n * <li>27 - Tocantins<\/li>\n * <li>28 - Exterior (ZZ)<\/li>\n * <\/ul>\n * \n * <p>\n * c) os dois últimos algarismos constituirão dígitos verificadores,\n * determinados com base no módulo 11, sendo o primeiro calculado sobre o número\n * seqüencial e o último sobre o código da unidade da Federação seguido do\n * primeiro dígito verificador.\n * <\/p>\n * \n * @author Leonardo Bessa\n */\npublic class TituloEleitoralValidator implements Validator<String> {\n\n    private final BaseValidator baseValidator;\n    \n    private final boolean isFormatted;\n\n    private static final int MOD = 11;\n\n    private static final int DV1_POSITION = 11;\n\n    private static final int DV2_POSITION = 12;\n\n    private static final Integer[] DV1_MULTIPLIERS = { 9, 8, 7, 6, 5, 4, 3, 2 };\n\n    private static final Integer[] DV2_MULTIPLIERS = { 0, 0, 0, 0, 0, 0, 0, 0, 4, 3, 2 };\n\n    public static final Pattern FORMATED = Pattern.compile(\"(\\\\d{10})/(\\\\d{2})\");\n\n    public static final Pattern UNFORMATED = Pattern.compile(\"(\\\\d{10})(\\\\d{2})\");\n\n    private enum Rotina implements RotinaDeDigitoVerificador {\n        POS_PRODUTO_INTERNO {\n            public Integer transform(RotinaParameters parameter) {\n                Integer mod = parameter.getDigitoVerificadorInfo().getMod();\n                Integer result = parameter.getResult() % mod;\n                if (result < 2) {\n                    result = 0;\n                } else {\n                    result = 11 - result;\n                }\n                return result;\n            }\n        }\n    }\n\n    private static final DigitoVerificadorInfo DV1_INFO = new DigitoVerificadorInfo(0,\n            new Rotina[] { Rotina.POS_PRODUTO_INTERNO }, MOD, DV1_MULTIPLIERS, DV1_POSITION);\n\n    private static final DigitoVerificadorInfo DV2_INFO = new DigitoVerificadorInfo(0,\n            new Rotina[] { Rotina.POS_PRODUTO_INTERNO }, MOD, DV2_MULTIPLIERS, DV2_POSITION);\n\n    private static final ValidadorDeDV DV1_CHECKER = new ValidadorDeDV(DV1_INFO);\n\n    private static final ValidadorDeDV DV2_CHECKER = new ValidadorDeDV(DV2_INFO);\n\n    /**\n     * Utiliza um {@linkplain SimpleMessageProducer} para geração de mensagens.\n     */\n    public TituloEleitoralValidator(boolean isFormatted) {\n        this.baseValidator = new BaseValidator();\n        this.isFormatted = isFormatted;\n    }\n    public TituloEleitoralValidator(){\n    \tthis(false);\n    }\n\n \n    /**\n     * <p>\n     * Construtor do Validador de Titulo de Eleitor.\n     * <\/p>\n     * \n     * @param messageProducer\n     *            produtor de mensagem de erro.\n     */\n    public TituloEleitoralValidator(MessageProducer messageProducer,boolean isFormatted) {\n        this.baseValidator = new BaseValidator(messageProducer);\n        this.isFormatted = isFormatted;\n    }\n    \n    public TituloEleitoralValidator(MessageProducer messageProducer) {\n        this.baseValidator = new BaseValidator(messageProducer);\n        this.isFormatted = false;\n    }\n    \n\n    private List<InvalidValue> getInvalidValues(String tituloDeEleitor) {\n        List<InvalidValue> errors = new ArrayList<InvalidValue>();\n        errors.clear();\n        if (tituloDeEleitor != null) { \n        \t\n        \tif (!isEligible(tituloDeEleitor)) {\n                 if (isFormatted) {\n                     errors.add(TituloEleitoralError.INVALID_FORMAT);\n                 } else {\n                     errors.add(TituloEleitoralError.INVALID_DIGITS);\n                 }\n        \t}\n        \t\n            else {\n                String unformated;\n                if(isFormatted){\n                \t TituloEleitoralFormatter formatter = new TituloEleitoralFormatter();\n                     unformated = formatter.unformat(tituloDeEleitor);\n                }\n                else {\n                    unformated = tituloDeEleitor;\n                }\n                if (!hasValidCheckDigits(unformated)) {\n                    errors.add(TituloEleitoralError.INVALID_CHECK_DIGITS);\n                }\n                if (hasCodigoDeEstadoInvalido(tituloDeEleitor)) {\n                    errors.add(TituloEleitoralError.INVALID_CODIGO_DE_ESTADO);\n                }\n            }\n        }\n        return errors;\n    }\n\n    private boolean hasCodigoDeEstadoInvalido(String tituloDeEleitor) {\n        final int length = tituloDeEleitor.length();\n        int codigo;\n        if(isFormatted){\n        \tcodigo = Integer.parseInt(tituloDeEleitor.substring(length - 5, length - 3));\n        }\n        else{\n        \tcodigo= Integer.parseInt(tituloDeEleitor.substring(length - 4, length - 2));\n        }\n        return !(codigo >= 01 && codigo <= 28);\n    }\n\n    private boolean hasValidCheckDigits(String value) {\n        return (DV1_CHECKER.isDVValid(value)) && (DV2_CHECKER.isDVValid(value));\n    }\n\n    public boolean isEligible(String value) {\n    \t boolean result;\n         if (isFormatted) {\n             result = FORMATED.matcher(value).matches();\n         } else {\n             result = UNFORMATED.matcher(value).matches();\n         }\n         return result;\n    }\n\n    public void assertValid(String tituloDeEleitor) {\n        baseValidator.assertValid(getInvalidValues(tituloDeEleitor));\n    }\n\n    public List<ValidationMessage> invalidMessagesFor(String tituloDeEleitor) {\n        return baseValidator.generateValidationMessages(getInvalidValues(tituloDeEleitor));\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.regex.Pattern;\n\nimport br.com.caelum.stella.DigitoPara;\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.SimpleMessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\nimport br.com.caelum.stella.format.TituloEleitoralFormatter;\nimport br.com.caelum.stella.validation.error.TituloEleitoralError;\n\n/**\n * Representa um validador de Título de Eleitor. O algoritmo utilzado foi\n * basaedo na seguinte referência.\n * \n * http://www.tre-al.gov.br/unidades/corregedoria/resolucoes/res21538.pdf\n * <p>\n * Art. 12. Os tribunais regionais eleitorais farão distribuir, observada a\n * seqüência numérica fornecida pela secretaria de informática, às zonas\n * eleitorais da respectiva circunscrição, séries de números de inscrição\n * eleitoral, a serem utilizados na forma deste artigo.\n * <\/p>\n * <p>\n * Parágrafo único. O número de inscrição compor-se-á de até 12 algarismos, por\n * unidade da Federação, assim discriminados:\n * <\/p>\n * \n * a) os oito primeiros algarismos serão seqüenciados,desprezando-se, na\n * emissão, os zeros à esquerda;\n * \n * b) os dois algarismos seguintes serão representativos da unidade da Federação\n * de origem da inscrição, conforme códigos constantes da seguinte tabela:\n * \n * <ul>\n * <li>01 - São Paulo<\/li>\n * <li>02 - Minas Gerais<\/li>\n * <li>03 - Rio de Janeiro<\/li>\n * <li>04 - Rio Grande do Sul<\/li>\n * <li>05 - Bahia<\/li>\n * <li>06 - Paraná<\/li>\n * <li>07 - Ceará<\/li>\n * <li>08 - Pernambuco<\/li>\n * <li>09 - Santa Catarina<\/li>\n * <li>10 - Goiás<\/li>\n * <li>11 - Maranhão<\/li>\n * <li>12 - Paraíba<\/li>\n * <li>13 - Pará<\/li>\n * <li>14 - Espírito Santo<\/li>\n * <li>15 - Piauí<\/li>\n * <li>16 - Rio Grande do Norte<\/li>\n * <li>17 - Alagoas<\/li>\n * <li>18 - Mato Grosso<\/li>\n * <li>19 - Mato Grosso do Sul<\/li>\n * <li>20 - Distrito Federal<\/li>\n * <li>21 - Sergipe<\/li>\n * <li>22 - Amazonas<\/li>\n * <li>23 - Rondônia<\/li>\n * <li>24 - Acre<\/li>\n * <li>25 - Amapá<\/li>\n * <li>26 - Roraima<\/li>\n * <li>27 - Tocantins<\/li>\n * <li>28 - Exterior (ZZ)<\/li>\n * <\/ul>\n * \n * <p>\n * c) os dois últimos algarismos constituirão dígitos verificadores,\n * determinados com base no módulo 11, sendo o primeiro calculado sobre o número\n * seqüencial e o último sobre o código da unidade da Federação seguido do\n * primeiro dígito verificador.\n * <\/p>\n * \n * @author Leonardo Bessa\n */\npublic class TituloEleitoralValidator implements Validator<String> {\n\n    public static final Pattern FORMATED = Pattern.compile(\"(\\\\d{10})/(\\\\d{2})\");\n    public static final Pattern UNFORMATED = Pattern.compile(\"(\\\\d{10})(\\\\d{2})\");\n    \n    private boolean isFormatted = false;\n    private MessageProducer messageProducer;\n\n    \n    /**\n     * Construtor do TituloEleitoralValidator. Considera por padrão que as cadeias não estão formatadas.\n     * Utiliza um {@linkplain SimpleMessageProducer} para geração de mensagens.\n     */\n    public TituloEleitoralValidator(){\n    \tthis.messageProducer = new SimpleMessageProducer();\n    }\n\n    /**\n     * Considera se cadeias não estão formatadas ou não.\n     * Utiliza um {@linkplain SimpleMessageProducer} para geração de mensagens.\n     */\n    public TituloEleitoralValidator(boolean isFormatted) {\n    \tthis.messageProducer = new SimpleMessageProducer();\n        this.isFormatted = isFormatted;\n    }\n    \n    /**\n     * <p>\n     * Construtor do Validador de Titulo de Eleitor.\n     * <\/p>\n     * \n     * @param messageProducer\n     *            produtor de mensagem de erro.\n     */\n    public TituloEleitoralValidator(MessageProducer messageProducer,boolean isFormatted) {\n    \tthis.messageProducer = messageProducer;\n        this.isFormatted = isFormatted;\n    }\n    \n    public TituloEleitoralValidator(MessageProducer messageProducer) {\n    \tthis.messageProducer = messageProducer;\n    }\n    \n\n    private List<ValidationMessage> getInvalidValues(String tituloDeEleitor) {\n        List<ValidationMessage> errors = new ArrayList<ValidationMessage>();\n        if (tituloDeEleitor != null) { \n        \t\n\t\t\tif (isFormatted && !FORMATED.matcher(tituloDeEleitor).matches()) {\n\t\t\t\terrors.add(messageProducer.getMessage(TituloEleitoralError.INVALID_FORMAT));\n\t\t\t}\n\n\t\t\tString unformatedTitulo = null;\n\t\t\ttry {\n\t\t\t\tunformatedTitulo = new TituloEleitoralFormatter().unformat(tituloDeEleitor);\n\t\t\t} catch (IllegalArgumentException e) {\n\t\t\t\terrors.add(messageProducer.getMessage(TituloEleitoralError.INVALID_DIGITS));\n\t\t\t\treturn errors;\n\t\t\t}\n\n\t\t\tif (unformatedTitulo.length() != 12 || !unformatedTitulo.matches(\"[0-9]*\")) {\n\t\t\t\terrors.add(messageProducer.getMessage(TituloEleitoralError.INVALID_DIGITS));\n\t\t\t}\n\t\t\t\n\t\t\tif (hasCodigoDeEstadoInvalido(unformatedTitulo)) {\n\t\t\t\terrors.add(messageProducer.getMessage(TituloEleitoralError.INVALID_CODIGO_DE_ESTADO));\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\tString tituloSemDigito = unformatedTitulo.substring(0, unformatedTitulo.length() - 2);\n\t\t\t\tString digitos = unformatedTitulo.substring(unformatedTitulo.length() - 2);\n\t\t\t\t\n\t\t\t\tString digitosCalculados = calculaDigitos(tituloSemDigito);\n\t\t\t\t\n\t\t\t\tif (!digitos.equals(digitosCalculados)) {\n\t\t\t\t\terrors.add(messageProducer.getMessage(TituloEleitoralError.INVALID_CHECK_DIGITS));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\n\t\t\t\n        }\n        return errors;\n    }\n\n    private String calculaDigitos(String tituloSemDigito) {\n    \tint length = tituloSemDigito.length();\n\n    \tString sequencial = tituloSemDigito.substring(0,length - 2);\n\t\tString digito1 = new DigitoPara(sequencial).complementarAoModulo().trocandoPorSeEncontrar(\"0\",10,11).mod(11).calcula();\n    \t\n\t\tString codigoEstado = tituloSemDigito.substring(length - 2, length);\n\t\tString digito2 = new DigitoPara(codigoEstado + digito1).complementarAoModulo().trocandoPorSeEncontrar(\"0\",10,11).mod(11).calcula();\n\n\t\treturn digito1 + digito2;\n\t}\n\n\tprivate boolean hasCodigoDeEstadoInvalido(String tituloDeEleitor) {\n        int codigo= Integer.parseInt(tituloDeEleitor.substring(tituloDeEleitor.length() - 4, tituloDeEleitor.length() - 2));\n        return !(codigo >= 01 && codigo <= 28);\n    }\n\n\tpublic boolean isEligible(String value) {\n\t\tboolean result;\n\t\tif (isFormatted) {\n\t\t\tresult = FORMATED.matcher(value).matches();\n\t\t} else {\n\t\t\tresult = UNFORMATED.matcher(value).matches();\n\t\t}\n\t\treturn result;\n\t}\n\n\tpublic void assertValid(String tituloDeEleitor) {\n\t\tList<ValidationMessage> errors = getInvalidValues(tituloDeEleitor);\n\t\tif (!errors.isEmpty()) {\n\t\t\tthrow new InvalidStateException(errors);\n\t\t}\n\t}\n\n\tpublic List<ValidationMessage> invalidMessagesFor(String tituloDeEleitor) {\n\t\treturn getInvalidValues(tituloDeEleitor);\n\t}\n\n}\n","lineNo":188}
{"Smelly Sample":"package br.com.caelum.stella.tinytype;\n\nimport br.com.caelum.stella.format.CNPJFormatter;\nimport br.com.caelum.stella.validation.CNPJValidator;\n\n/**\n * Representa um Cadastro Nacional da Pessoa Jurídica - CNPJ.\n * \n * @author leobessa\n * \n */\npublic final class CNPJ {\n\n    private final String numero;\n\n    /**\n     * @param número do CNPJ.\n     */\n    public CNPJ(String numero) {\n        this.numero = new CNPJFormatter().unformat(numero);\n    }\n\n    /**\n     * @return número do CNPJ.\n     */\n    public String getNumero() {\n        return numero;\n    }\n    \n    /**\n     * @return número do CNPJ formatado.\n     */\n    public String getNumeroFormatado() {\n    \treturn new CNPJFormatter().format(numero);\n    }\n\n    /**\n     * @return se o número do CNPJ é valido.\n     */\n    public boolean isValid() {\n    \treturn new CNPJValidator().invalidMessagesFor(numero).isEmpty();\n    }\n    \n    /**\n     * @return número do CNPJ formatado.\n     */\n    @Override\n    public String toString() {\n    \treturn getNumeroFormatado();\n    }\n\n    @Override\n    public int hashCode() {\n        final int prime = 31;\n        int result = 1;\n        result = prime * result + ((numero == null) ? 0 : numero.hashCode());\n        return result;\n    }\n\n    @Override\n    public boolean equals(Object obj) {\n        if (this == obj)\n            return true;\n        if (obj == null)\n            return false;\n        if (getClass() != obj.getClass())\n            return false;\n        final CNPJ other = (CNPJ) obj;\n        if (numero == null) {\n            if (other.numero != null)\n                return false;\n        } else if (!numero.equals(other.numero))\n            return false;\n        return true;\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.tinytype;\n\nimport br.com.caelum.stella.format.CNPJFormatter;\nimport br.com.caelum.stella.validation.CNPJValidator;\n\n/**\n * Representa um Cadastro Nacional da Pessoa Jurídica - CNPJ.\n * \n * @author leobessa\n * \n */\npublic final class CNPJ {\n\n    private final String numero;\n\n    /**\n     * @param número do CNPJ.\n     */\n    public CNPJ(String numero) {\n    \tString numeroCnpj;\n    \ttry {\n    \t\tnumeroCnpj = new CNPJFormatter().unformat(numero);\n\t\t} catch (IllegalArgumentException e) {\n\t\t\tnumeroCnpj = numero;\n\t\t}\n    \tthis.numero = numeroCnpj;\n    }\n\n    /**\n     * @return número do CNPJ.\n     */\n    public String getNumero() {\n        return numero;\n    }\n    \n    /**\n     * @return número do CNPJ formatado.\n     */\n    public String getNumeroFormatado() {\n    \treturn new CNPJFormatter().format(numero);\n    }\n\n    /**\n     * @return se o número do CNPJ é valido.\n     */\n    public boolean isValid() {\n    \treturn new CNPJValidator().invalidMessagesFor(numero).isEmpty();\n    }\n    \n    /**\n     * @return número do CNPJ formatado.\n     */\n    @Override\n    public String toString() {\n    \treturn getNumeroFormatado();\n    }\n\n    @Override\n    public int hashCode() {\n        final int prime = 31;\n        int result = 1;\n        result = prime * result + ((numero == null) ? 0 : numero.hashCode());\n        return result;\n    }\n\n    @Override\n    public boolean equals(Object obj) {\n        if (this == obj)\n            return true;\n        if (obj == null)\n            return false;\n        if (getClass() != obj.getClass())\n            return false;\n        final CNPJ other = (CNPJ) obj;\n        if (numero == null) {\n            if (other.numero != null)\n                return false;\n        } else if (!numero.equals(other.numero))\n            return false;\n        return true;\n    }\n\n}\n","lineNo":20}
{"Smelly Sample":"package br.com.caelum.stella.tinytype;\n\nimport br.com.caelum.stella.format.CPFFormatter;\nimport br.com.caelum.stella.validation.CPFValidator;\n\n/**\n * Representa um Cadastro de Pessoas Física - CPF.\n * \n * @author leobessa\n * \n */\npublic final class CPF {\n\n    private final String numero;\n\n    /**\n     * @param número do CPF.\n     */\n    public CPF(String numero) {\n        this.numero = new CPFFormatter().unformat(numero);\n    }\n\n    /**\n     * @return número do CPF.\n     */\n    public String getNumero() {\n        return numero;\n    }\n    \n    /**\n     * @return número do CPF formatado.\n     */\n    public String getNumeroFormatado() {\n    \treturn new CPFFormatter().format(numero);\n    }\n\n    /**\n     * @return se o número do CPF é valido.\n     */\n\tpublic boolean isValido() {\n\t\treturn new CPFValidator(false).invalidMessagesFor(numero).isEmpty();\n\t}\n\n    /**\n     * @return número do CPF formatado.\n     */\n    @Override\n    public String toString() {\n        return getNumeroFormatado();\n    }\n\n    @Override\n    public int hashCode() {\n        final int prime = 31;\n        int result = 1;\n        result = prime * result + ((numero == null) ? 0 : numero.hashCode());\n        return result;\n    }\n\n    @Override\n    public boolean equals(Object obj) {\n        if (this == obj)\n            return true;\n        if (obj == null)\n            return false;\n        if (getClass() != obj.getClass())\n            return false;\n        final CPF other = (CPF) obj;\n        if (numero == null) {\n            if (other.numero != null)\n                return false;\n        } else if (!numero.equals(other.numero))\n            return false;\n        return true;\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.tinytype;\n\nimport br.com.caelum.stella.format.CPFFormatter;\nimport br.com.caelum.stella.validation.CPFValidator;\n\n/**\n * Representa um Cadastro de Pessoas Física - CPF.\n * \n * @author leobessa\n * \n */\npublic final class CPF {\n\n    private final String numero;\n\n    /**\n     * @param número do CPF.\n     */\n    public CPF(String numero) {\n    \tString numeroCpf;\n    \ttry {\n    \t\tnumeroCpf = new CPFFormatter().unformat(numero);\n\t\t} catch (IllegalArgumentException e) {\n\t\t\tnumeroCpf = numero;\n\t\t}\n    \tthis.numero = numeroCpf;\n    }\n\n    /**\n     * @return número do CPF.\n     */\n    public String getNumero() {\n        return numero;\n    }\n    \n    /**\n     * @return número do CPF formatado.\n     */\n    public String getNumeroFormatado() {\n    \treturn new CPFFormatter().format(numero);\n    }\n\n    /**\n     * @return se o número do CPF é valido.\n     */\n\tpublic boolean isValido() {\n\t\treturn new CPFValidator(false).invalidMessagesFor(numero).isEmpty();\n\t}\n\n    /**\n     * @return número do CPF formatado.\n     */\n    @Override\n    public String toString() {\n        return getNumeroFormatado();\n    }\n\n    @Override\n    public int hashCode() {\n        final int prime = 31;\n        int result = 1;\n        result = prime * result + ((numero == null) ? 0 : numero.hashCode());\n        return result;\n    }\n\n    @Override\n    public boolean equals(Object obj) {\n        if (this == obj)\n            return true;\n        if (obj == null)\n            return false;\n        if (getClass() != obj.getClass())\n            return false;\n        final CPF other = (CPF) obj;\n        if (numero == null) {\n            if (other.numero != null)\n                return false;\n        } else if (!numero.equals(other.numero))\n            return false;\n        return true;\n    }\n\n}\n","lineNo":20}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.regex.Pattern;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.SimpleMessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\nimport br.com.caelum.stella.format.CPFFormatter;\nimport br.com.caelum.stella.validation.error.CPFError;\n\n/**\n * Verifica se uma cadeia (String) é válida para o documento de CPF (Cadastro de\n * Pessoa Física).\n * \n * @author Leonardo Bessa\n */\npublic class CPFValidator implements Validator<String> {\n    private final BaseValidator baseValidator;\n\n    private static final int MOD = 11;\n\n    private final boolean isFormatted;\n\n    private final boolean isIgnoringRepeatedDigits;\n\n    public static final Pattern FORMATED = Pattern.compile(\"(\\\\d{3})[.](\\\\d{3})[.](\\\\d{3})-(\\\\d{2})\");\n\n    public static final Pattern UNFORMATED = Pattern.compile(\"(\\\\d{3})(\\\\d{3})(\\\\d{3})(\\\\d{2})\");\n\n    private static final Integer DV1_POSITION = 10;\n\n    private static final Integer[] DV1_MULTIPLIERS = { 10, 9, 8, 7, 6, 5, 4, 3, 2 };\n\n    private static final Integer DV2_POSITION = 11;\n\n    private static final Integer[] DV2_MULTIPLIERS = { 11, 10, 9, 8, 7, 6, 5, 4, 3, 2 };\n\n    private static final DigitoVerificadorInfo DV1_INFO = new DigitoVerificadorInfo(0,\n            new RotinaDeDigitoVerificador[] { new RotinaComumDeDigitoVerificador() }, MOD, DV1_MULTIPLIERS,\n            DV1_POSITION);\n\n    private static final DigitoVerificadorInfo DV2_INFO = new DigitoVerificadorInfo(0,\n            new RotinaDeDigitoVerificador[] { new RotinaComumDeDigitoVerificador() }, MOD, DV2_MULTIPLIERS,\n            DV2_POSITION);\n\n    private static final ValidadorDeDV DV1_CHECKER = new ValidadorDeDV(DV1_INFO);\n\n    private static final ValidadorDeDV DV2_CHECKER = new ValidadorDeDV(DV2_INFO);\n\n    /**\n     * Construtor padrão de validador de CPF. Este considera, por padrão, que as\n     * cadeias estão formatadas e utiliza um {@linkplain SimpleMessageProducer}\n     * para geração de mensagens.\n     */\n    public CPFValidator() {\n        this(true);\n    }\n\n    /**\n     * Construtor de validador de CPF. O validador utiliza um\n     * {@linkplain SimpleMessageProducer} para geração de mensagens.\n     */\n    public CPFValidator(boolean isFormatted) {\n        this.baseValidator = new BaseValidator();\n        this.isFormatted = isFormatted;\n        this.isIgnoringRepeatedDigits = false;\n    }\n    \n    /**\n     * Construtor de validador de CPF. O validador utiliza um\n     * @param isFormatted indica se o CPF está formatado.\n     *  @param isIgnoringRepeatedDigits\n     *            condição para ignorar cadeias de CPF com todos os dígitos\n     *            repetidos.\n     * {@linkplain SimpleMessageProducer} para geração de mensagens.\n     */\n    public CPFValidator(boolean isFormatted, boolean isIgnoringRepeatedDigits) {\n        this.baseValidator = new BaseValidator();\n        this.isFormatted = isFormatted;\n        this.isIgnoringRepeatedDigits = isIgnoringRepeatedDigits;\n    }\n\n    /**\n     * <p>\n     * Construtor do Validador de CPF.\n     * <\/p>\n     * <p>\n     * Por padrão o validador criado não aceita cadeias de CPF com todos os dígitos\n     * repetidos, quando todas as outras condições de validação são aceitas.\n     * Para considerar estes documentos válidos use o construtor\n     * {@link #CPFValidator(MessageProducer, boolean, boolean)} com a váriavel\n     * {@linkplain #isIgnoringRepeatedDigits} em <code>true<\/code>.\n     * <\/p>\n     * \n     * @param messageProducer\n     *            produtor de mensagem de erro.\n     * @param isFormatted\n     *            considera cadeia no formato de CPF: \"ddd.ddd.ddd-dd\" onde \"d\"\n     *            é um dígito decimal.\n     */\n    public CPFValidator(MessageProducer messageProducer, boolean isFormatted) {\n        this(messageProducer, isFormatted, false);\n    }\n\n    /**\n     * @param messageProducer\n     *            produtor de mensagem de erro.\n     * @param isFormatted\n     *            condição para considerar cadeia no formato de CPF:\n     *            \"ddd.ddd.ddd-dd\" onde \"d\" é um dígito decimal.\n     * @param isIgnoringRepeatedDigits\n     *            condição para ignorar cadeias de CPF com todos os dígitos\n     *            repetidos.\n     */\n    public CPFValidator(MessageProducer messageProducer, boolean isFormatted, boolean isIgnoringRepeatedDigits) {\n        this.baseValidator = new BaseValidator(messageProducer);\n        this.isFormatted = isFormatted;\n        this.isIgnoringRepeatedDigits = isIgnoringRepeatedDigits;\n    }\n\n    /**\n     * Valida se a cadeia está de acordo com as regras de um CPF.\n     * \n     * @see br.com.caelum.stella.validation.Validator#assertValid(java.lang.Object)\n     * @return <code>true<\/code> se a cadeia é válida ou é nula;\n     *         <code>false<\/code> caso contrario.\n     */\n    private List<InvalidValue> getInvalidValues(String cpf) {\n        List<InvalidValue> errors = new ArrayList<InvalidValue>();\n        if (cpf != null) {\n\n            if (!isEligible(cpf)) {\n                if (isFormatted) {\n                    errors.add(CPFError.INVALID_FORMAT);\n                } else {\n                    errors.add(CPFError.INVALID_DIGITS);\n                }\n            } else {\n                String unformatedCPF;\n                if (isFormatted) {\n                    CPFFormatter formatter = new CPFFormatter();\n                    unformatedCPF = formatter.unformat(cpf);\n                } else {\n                    unformatedCPF = cpf;\n                }\n                if (errors.isEmpty()) {\n                    if ((!isIgnoringRepeatedDigits) && hasAllRepeatedDigits(unformatedCPF)) {\n                        errors.add(CPFError.REPEATED_DIGITS);\n                    }\n                }\n                if (errors.isEmpty()) {\n                    if (!hasValidCheckDigits(unformatedCPF)) {\n                        errors.add(CPFError.INVALID_CHECK_DIGITS);\n                    }\n                }\n            }\n        }\n        return errors;\n    }\n\n    private boolean hasValidCheckDigits(String value) {\n        return (DV1_CHECKER.isDVValid(value)) && (DV2_CHECKER.isDVValid(value));\n    }\n\n    private boolean hasAllRepeatedDigits(String cpf) {\n        for (int i = 1; i < cpf.length(); i++) {\n            if (cpf.charAt(i) != cpf.charAt(0)) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    @Override\n\tpublic boolean isEligible(String value) {\n        boolean result;\n        if (isFormatted) {\n            result = FORMATED.matcher(value).matches();\n        } else {\n            result = UNFORMATED.matcher(value).matches();\n        }\n        return result;\n    }\n\n    @Override\n\tpublic void assertValid(String cpf) {\n        baseValidator.assertValid(getInvalidValues(cpf));\n    }\n\n    @Override\n\tpublic List<ValidationMessage> invalidMessagesFor(String cpf) {\n        return baseValidator.generateValidationMessages(getInvalidValues(cpf));\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.regex.Pattern;\n\nimport br.com.caelum.stella.DigitoPara;\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.SimpleMessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\nimport br.com.caelum.stella.format.CPFFormatter;\nimport br.com.caelum.stella.validation.error.CPFError;\n\n/**\n * Verifica se uma cadeia (String) é válida para o documento de CPF (Cadastro de\n * Pessoa Física).\n * \n * @author Leonardo Bessa\n */\npublic class CPFValidator implements Validator<String> {\n\n\tpublic static final Pattern FORMATED = Pattern.compile(\"(\\\\d{3})[.](\\\\d{3})[.](\\\\d{3})-(\\\\d{2})\");\n\tpublic static final Pattern UNFORMATED = Pattern.compile(\"(\\\\d{3})(\\\\d{3})(\\\\d{3})(\\\\d{2})\");\n\n\tprivate boolean isFormatted = false;\n\tprivate boolean isIgnoringRepeatedDigits = false;\n\tprivate MessageProducer messageProducer;\n\n\t/**\n\t * Construtor padrão de validador de CPF. Este considera, por padrão, que as\n\t * cadeias estão formatadas e utiliza um {@linkplain SimpleMessageProducer}\n\t * para geração de mensagens.\n\t */\n\tpublic CPFValidator() {\n\t\tmessageProducer = new SimpleMessageProducer();\n\t}\n\n\t/**\n\t * Construtor de validador de CPF. O validador utiliza um\n\t * {@linkplain SimpleMessageProducer} para geração de mensagens. Leva em\n\t * conta se o valor está ou não formatado.\n\t * \n\t * @param isFormatted\n\t *            considera cadeia no formato de CPF:\"ddd.ddd.ddd-dd\" onde \"d\" é\n\t *            um dígito decimal.\n\t */\n\tpublic CPFValidator(boolean isFormatted) {\n\t\tthis.isFormatted = isFormatted;\n\t\tthis.messageProducer = new SimpleMessageProducer();\n\t}\n\n\t/**\n\t * Construtor de validador de CPF. O validador utiliza um\n\t * \n\t * @param isFormatted\n\t *            indica se o CPF está formatado.\n\t * @param isIgnoringRepeatedDigits\n\t *            condição para ignorar cadeias de CPF com todos os dígitos\n\t *            repetidos. {@linkplain SimpleMessageProducer} para geração de\n\t *            mensagens.\n\t */\n\tpublic CPFValidator(boolean isFormatted, boolean isIgnoringRepeatedDigits) {\n\t\tthis.isFormatted = isFormatted;\n\t\tthis.isIgnoringRepeatedDigits = isIgnoringRepeatedDigits;\n\t\tthis.messageProducer = new SimpleMessageProducer();\n\t}\n\n\t/**\n\t * <p>\n\t * Construtor do Validador de CPF. Leva em consideração se o valor está\n\t * formatado.\n\t * <\/p>\n\t * <p>\n\t * Por padrão o validador criado não aceita cadeias de CPF com todos os\n\t * dígitos repetidos, quando todas as outras condições de validação são\n\t * aceitas. Para considerar estes documentos válidos use o construtor\n\t * {@link #CPFValidator(MessageProducer, boolean, boolean)} com a váriavel\n\t * {@linkplain #isIgnoringRepeatedDigits} em <code>true<\/code>.\n\t * <\/p>\n\t * \n\t * @param messageProducer\n\t *            produtor de mensagem de erro.\n\t * @param isFormatted\n\t *            considera cadeia no formato de CPF: \"ddd.ddd.ddd-dd\" onde \"d\"\n\t *            é um dígito decimal.\n\t */\n\tpublic CPFValidator(MessageProducer messageProducer, boolean isFormatted) {\n\t\tthis(messageProducer, isFormatted, false);\n\t}\n\n\t/**\n\t * @param messageProducer\n\t *            produtor de mensagem de erro.\n\t * @param isFormatted\n\t *            condição para considerar cadeia no formato de CPF:\n\t *            \"ddd.ddd.ddd-dd\" onde \"d\" é um dígito decimal.\n\t * @param isIgnoringRepeatedDigits\n\t *            condição para ignorar cadeias de CPF com todos os dígitos\n\t *            repetidos.\n\t */\n\tpublic CPFValidator(MessageProducer messageProducer, boolean isFormatted, boolean isIgnoringRepeatedDigits) {\n\t\tthis.messageProducer = messageProducer;\n\t\tthis.isFormatted = isFormatted;\n\t\tthis.isIgnoringRepeatedDigits = isIgnoringRepeatedDigits;\n\t}\n\n\t/**\n\t * Valida se a cadeia está de acordo com as regras de um CPF.\n\t * \n\t * @see br.com.caelum.stella.validation.Validator#assertValid(java.lang.Object)\n\t * @return <code>true<\/code> se a cadeia é válida ou é nula;\n\t *         <code>false<\/code> caso contrario.\n\t */\n\tprivate List<ValidationMessage> getInvalidValues(String cpf) {\n\n\t\tList<ValidationMessage> errors = new ArrayList<ValidationMessage>();\n\n\t\tif (cpf != null) {\n\t\t\tif (isFormatted && !FORMATED.matcher(cpf).matches()) {\n\t\t\t\terrors.add(messageProducer.getMessage(CPFError.INVALID_FORMAT));\n\t\t\t}\n\n\t\t\tString unformatedCPF = null;\n\t\t\ttry {\n\t\t\t\tunformatedCPF = new CPFFormatter().unformat(cpf);\n\t\t\t} catch (IllegalArgumentException e) {\n\t\t\t\terrors.add(messageProducer.getMessage(CPFError.INVALID_DIGITS));\n\t\t\t\treturn errors;\n\t\t\t}\n\n\t\t\tif (unformatedCPF.length() != 11 || !unformatedCPF.matches(\"[0-9]*\")) {\n\t\t\t\terrors.add(messageProducer.getMessage(CPFError.INVALID_DIGITS));\n\t\t\t}\n\n\t\t\tif ((!isIgnoringRepeatedDigits) && hasAllRepeatedDigits(unformatedCPF)) {\n\t\t\t\terrors.add(messageProducer.getMessage(CPFError.REPEATED_DIGITS));\n\t\t\t}\n\n\t\t\tString cpfSemDigito = unformatedCPF.substring(0, unformatedCPF.length() - 2);\n\t\t\tString digitos = unformatedCPF.substring(unformatedCPF.length() - 2);\n\n\t\t\tString digito1 = obtemDigito(cpfSemDigito);\n\t\t\tString digito2 = new DigitoPara(cpfSemDigito + digito1).comMultiplicadoresDeAte(2, 11).complementarAoModulo().trocandoPorSeEncontrar(\"0\",10,11).mod(11);\n\n\t\t\tif (!digitos.equals(digito1.concat(digito2))) {\n\t\t\t\terrors.add(messageProducer.getMessage(CPFError.INVALID_CHECK_DIGITS));\n\t\t\t}\n\t\t}\n\t\treturn errors;\n\t}\n\n\tprivate String obtemDigito(String cpfSemDigito) {\n\t\treturn new DigitoPara(cpfSemDigito).comMultiplicadoresDeAte(2, 11).complementarAoModulo().trocandoPorSeEncontrar(\"0\",10,11).mod(11);\n\t}\n\n\tprivate boolean hasAllRepeatedDigits(String cpf) {\n\t\tfor (int i = 1; i < cpf.length(); i++) {\n\t\t\tif (cpf.charAt(i) != cpf.charAt(0)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t@Override\n\tpublic boolean isEligible(String value) {\n\t\tboolean result;\n\t\tif (isFormatted) {\n\t\t\tresult = FORMATED.matcher(value).matches();\n\t\t} else {\n\t\t\tresult = UNFORMATED.matcher(value).matches();\n\t\t}\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic void assertValid(String cpf) {\n\t\tList<ValidationMessage> errors = getInvalidValues(cpf);\n\t\tif (!errors.isEmpty()) {\n\t\t\tthrow new InvalidStateException(errors);\n\t\t}\n\t}\n\n\t@Override\n\tpublic List<ValidationMessage> invalidMessagesFor(String cpf) {\n\t\treturn getInvalidValues(cpf);\n\t}\n\n}\n","lineNo":178}
{"Smelly Sample":"package br.com.caelum.stella;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.Collections;\nimport java.util.List;\n\n/**\n * Uma fluent interface para o cálculo de dígitos, que é usado em diversos boletos e \n * documentos. \n * \n * Para exemplificar, o dígito do trecho 0000039104766 para os multiplicadores indo de \n * 2 a 7 e usando módulo 11 é a seguinte:\n * \n * <pre>\n *\t0  0  0  0  0  3  9  1  0  4  7  6  6 (trecho numérico)\n *\t2  7  6  5  4  3  2  7  6  5  4  3  2 (multiplicadores, da direita para a esquerda e ciclando)\n *\t----------------------------------------- multiplicações algarismo a algarismo \n *\t 0  0  0  0  0  9 18  7  0 20 28 18 12 ---> soma = 112\n * <\/pre>\n * \n * Tira-se o módulo dessa soma e, então, calcula-se o complementar do módulo e, se o número \n * for 0, 10 ou 11, o dígito passa a ser 1.\n * \n * <pre>\n * \t\tsoma = 112\n * \t\tsoma % 11 = 2\n * \t\t11 - (soma % 11) = 9\n * <\/pre>\n * \n * @author ceci\n */\npublic class DigitoPara {\n\n\tprivate List<Integer> numero;\n\tprivate List<Integer> multiplicadores = new ArrayList<Integer>();\n\tprivate boolean complementar;\n\tprivate List<Integer> aSubstituir;\n\tprivate String substituto;\n\n\t/**\n\t * Cria o objeto a ser preenchido com interface fluente e armazena o trecho numérico\n\t * em uma lista de algarismos. Isso é necessário porque a linha digitada pode ser \n\t * muito maior do que um int suporta.\n\t * \n\t * @param trecho Refere-se à linha numérica sobre a qual o dígito deve ser calculado\n\t */\n\tpublic DigitoPara(String trecho) {\n\t\tcomMultiplicadoresDeAte(2, 9);\n\t\tthis.aSubstituir = Collections.emptyList();\n\t\tthis.numero = new ArrayList<Integer>();\n\t\tchar[] digitos = trecho.toCharArray();\n\t\tfor (char digito : digitos) {\n\t\t\tthis.numero.add(Character.getNumericValue(digito));\n\t\t}\n\t\tCollections.reverse(numero);\n\t}\n\n\t/**\n\t * Para multiplicadores (ou pesos) sequenciais e em ordem crescente, esse método permite \n\t * criar a lista de multiplicadores que será usada cíclicamente, caso o número base seja\n\t * maior do que a sequência de multiplicadores. Por padrão os multiplicadores são iniciados\n\t * de 2 a 9. No momento em que você inserir outro valor este default será sobrescrito.\n\t * \n\t * @param inicio Primeiro número do intervalo sequencial de multiplicadores\n\t * @param fim Último número do intervalo sequencial de multiplicadores\n\t */\n\tpublic DigitoPara comMultiplicadoresDeAte(int inicio, int fim) {\n\t\tthis.multiplicadores.clear();\n\t\tfor (int i = inicio; i <= fim; i++) {\n\t\t\tmultiplicadores.add(i);\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Há documentos em que os multiplicadores não usam todos os números de um intervalo \n\t * ou alteram sua ordem. Nesses casos, a lista de multiplicadores pode ser passada \n\t * através de varargs.\n\t * \n\t * @param multiplicadoresEmOrdem Sequência de inteiros com os multiplicadores em ordem\n\t */\n\tpublic DigitoPara comMultiplicadores(Integer... multiplicadoresEmOrdem) {\n\t\tthis.multiplicadores = Arrays.asList(multiplicadoresEmOrdem);\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * \u2030 comum que os geradores de dígito precisem do complementar do módulo em vez\n\t * do módulo em sí. Então, a chamada desse método habilita a flag que é usada \n\t * no método mod para decidir se o resultado devolvido é o módulo puro ou seu \n\t * complementar.\n\t */\n\tpublic DigitoPara complementarAoModulo() {\n\t\tthis.complementar = true;\n\t\treturn this;\n\t}\n\n\t\n\tpublic DigitoPara trocandoPorSeEncontrar(String substituto, Integer... i) {\n\t\tthis.substituto = substituto;\n\t\tthis.aSubstituir = Arrays.asList(i);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Faz a soma geral das multiplicações dos algarismos pelos multiplicadores, tira o \n\t * módulo e devolve seu complementar.\n\t * \n\t * @param modulo Inteiro pelo qual o resto será tirado e também seu complementar\n\t * @return String o dígito vindo do módulo com o número passado e configurações extra.\n\t */\n\tpublic String mod(int modulo) {\n\t\tint soma = 0;\n\t\tint multiplicadorDaVez = 0;\n\t\tfor (int algarismo : numero) {\n\t\t\tsoma += algarismo * multiplicadores.get(multiplicadorDaVez);\n\t\t\tmultiplicadorDaVez = proximoMultiplicador(multiplicadorDaVez);\n\t\t}\n\t\tint resultado = soma % modulo;\n\t\tif (complementar)\n\t\t\tresultado = modulo - resultado;\n\t\treturn aSubstituir.contains(resultado) ? substituto : String.valueOf(resultado);\n\t}\n\n\t/**\n\t * Devolve o próximo multiplicador a ser usado, isto é, a próxima posição da lista de\n\t * multiplicadores ou, se chegar ao fim da lista, a primeira posição, novamente.\n\t *  \n\t * @param multiplicadorDaVez Essa é a posição do último multiplicador usado.\n\t */\n\tprivate int proximoMultiplicador(int multiplicadorDaVez) {\n\t\tmultiplicadorDaVez++;\n\t\tif (multiplicadorDaVez == multiplicadores.size())\n\t\t\tmultiplicadorDaVez = 0;\n\t\treturn multiplicadorDaVez;\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.Collections;\nimport java.util.List;\n\n/**\n * Uma fluent interface para o cálculo de dígitos, que é usado em diversos boletos e \n * documentos. \n * \n * Para exemplificar, o dígito do trecho 0000039104766 para os multiplicadores indo de \n * 2 a 7 e usando módulo 11 é a seguinte:\n * \n * <pre>\n *\t0  0  0  0  0  3  9  1  0  4  7  6  6 (trecho numérico)\n *\t2  7  6  5  4  3  2  7  6  5  4  3  2 (multiplicadores, da direita para a esquerda e ciclando)\n *\t----------------------------------------- multiplicações algarismo a algarismo \n *\t 0  0  0  0  0  9 18  7  0 20 28 18 12 ---> soma = 112\n * <\/pre>\n * \n * Tira-se o módulo dessa soma e, então, calcula-se o complementar do módulo e, se o número \n * for 0, 10 ou 11, o dígito passa a ser 1.\n * \n * <pre>\n * \t\tsoma = 112\n * \t\tsoma % 11 = 2\n * \t\t11 - (soma % 11) = 9\n * <\/pre>\n * \n * @author ceci\n */\npublic class DigitoPara {\n\n\tprivate List<Integer> numero;\n\tprivate List<Integer> multiplicadores = new ArrayList<Integer>();\n\tprivate boolean complementar;\n\tprivate List<Integer> aSubstituir;\n\tprivate String substituto;\n\n\t/**\n\t * Cria o objeto a ser preenchido com interface fluente e armazena o trecho numérico\n\t * em uma lista de algarismos. Isso é necessário porque a linha digitada pode ser \n\t * muito maior do que um int suporta.\n\t * \n\t * @param trecho Refere-se à linha numérica sobre a qual o dígito deve ser calculado\n\t */\n\tpublic DigitoPara(String trecho) {\n\t\tcomMultiplicadoresDeAte(2, 9);\n\t\tthis.aSubstituir = Collections.emptyList();\n\t\tthis.numero = new ArrayList<Integer>();\n\t\tchar[] digitos = trecho.toCharArray();\n\t\tfor (char digito : digitos) {\n\t\t\tthis.numero.add(Character.getNumericValue(digito));\n\t\t}\n\t\tCollections.reverse(numero);\n\t}\n\n\t/**\n\t * Para multiplicadores (ou pesos) sequenciais e em ordem crescente, esse método permite \n\t * criar a lista de multiplicadores que será usada cíclicamente, caso o número base seja\n\t * maior do que a sequência de multiplicadores. Por padrão os multiplicadores são iniciados\n\t * de 2 a 9. No momento em que você inserir outro valor este default será sobrescrito.\n\t * \n\t * @param inicio Primeiro número do intervalo sequencial de multiplicadores\n\t * @param fim Último número do intervalo sequencial de multiplicadores\n\t */\n\tpublic DigitoPara comMultiplicadoresDeAte(int inicio, int fim) {\n\t\tthis.multiplicadores.clear();\n\t\tfor (int i = inicio; i <= fim; i++) {\n\t\t\tmultiplicadores.add(i);\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Há documentos em que os multiplicadores não usam todos os números de um intervalo \n\t * ou alteram sua ordem. Nesses casos, a lista de multiplicadores pode ser passada \n\t * através de varargs.\n\t * \n\t * @param multiplicadoresEmOrdem Sequência de inteiros com os multiplicadores em ordem\n\t */\n\tpublic DigitoPara comMultiplicadores(Integer... multiplicadoresEmOrdem) {\n\t\tthis.multiplicadores = Arrays.asList(multiplicadoresEmOrdem);\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * \u2030 comum que os geradores de dígito precisem do complementar do módulo em vez\n\t * do módulo em sí. Então, a chamada desse método habilita a flag que é usada \n\t * no método mod para decidir se o resultado devolvido é o módulo puro ou seu \n\t * complementar.\n\t */\n\tpublic DigitoPara complementarAoModulo() {\n\t\tthis.complementar = true;\n\t\treturn this;\n\t}\n\n\t\n\tpublic DigitoPara trocandoPorSeEncontrar(String substituto, Integer... i) {\n\t\tthis.substituto = substituto;\n\t\tthis.aSubstituir = Arrays.asList(i);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Faz a soma geral das multiplicações dos algarismos pelos multiplicadores, tira o \n\t * módulo e devolve seu complementar.\n\t * \n\t * @param modulo Inteiro pelo qual o resto será tirado e também seu complementar\n\t * @return String o dígito vindo do módulo com o número passado e configurações extra.\n\t */\n\tpublic String mod(int modulo) {\n\t\tint soma = 0;\n\t\tint multiplicadorDaVez = 0;\n\t\tfor (int algarismo : numero) {\n\t\t\tint multiplicador = multiplicadores.get(multiplicadorDaVez);\n\t\t\tsoma += algarismo * multiplicador;\n\t\t\tmultiplicadorDaVez = proximoMultiplicador(multiplicadorDaVez);\n\t\t}\n\t\tint resultado = soma % modulo;\n\t\tif (complementar)\n\t\t\tresultado = modulo - resultado;\n\t\treturn aSubstituir.contains(resultado) ? substituto : String.valueOf(resultado);\n\t}\n\n\t/**\n\t * Devolve o próximo multiplicador a ser usado, isto é, a próxima posição da lista de\n\t * multiplicadores ou, se chegar ao fim da lista, a primeira posição, novamente.\n\t *  \n\t * @param multiplicadorDaVez Essa é a posição do último multiplicador usado.\n\t */\n\tprivate int proximoMultiplicador(int multiplicadorDaVez) {\n\t\tmultiplicadorDaVez++;\n\t\tif (multiplicadorDaVez == multiplicadores.size())\n\t\t\tmultiplicadorDaVez = 0;\n\t\treturn multiplicadorDaVez;\n\t}\n}\n","lineNo":117}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.regex.Pattern;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.SimpleMessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\nimport br.com.caelum.stella.format.CNPJFormatter;\nimport br.com.caelum.stella.validation.error.CNPJError;\n\n/**\n * Representa um validador de CNPJ.\n * \n * @author Leonardo Bessa\n */\npublic class CNPJValidator implements Validator<String> {\n\n    private final BaseValidator baseValidator;\n\n    private final boolean isFormatted;\n\n    private static final int MOD = 11;\n\n    private static final int DV1_POSITION = 13;\n\n    private static final int DV2_POSITION = 14;\n\n    private static final Integer[] DV1_MULTIPLIERS = { 5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2 };\n\n    private static final Integer[] DV2_MULTIPLIERS = { 6, 5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2 };\n\n    public static final Pattern FORMATED = Pattern.compile(\"(\\\\d{2})[.](\\\\d{3})[.](\\\\d{3})/(\\\\d{4})-(\\\\d{2})\");\n\n    public static final Pattern UNFORMATED = Pattern.compile(\"(\\\\d{2})(\\\\d{3})(\\\\d{3})(\\\\d{4})(\\\\d{2})\");\n\n\n    private static final DigitoVerificadorInfo DV1_INFO = new DigitoVerificadorInfo(0,\n            new RotinaComumDeDigitoVerificador[] { new RotinaComumDeDigitoVerificador() }, MOD, DV1_MULTIPLIERS,\n            DV1_POSITION);\n\n    private static final DigitoVerificadorInfo DV2_INFO = new DigitoVerificadorInfo(0,\n            new RotinaComumDeDigitoVerificador[] { new RotinaComumDeDigitoVerificador() }, MOD, DV2_MULTIPLIERS,\n            DV2_POSITION);\n\n    private static final ValidadorDeDV DV1_CHECKER = new ValidadorDeDV(DV1_INFO);\n\n    private static final ValidadorDeDV DV2_CHECKER = new ValidadorDeDV(DV2_INFO);\n\n    /**\n     * Este considera, por padrão, que as cadeias estão formatadas e utiliza um\n     * {@linkplain SimpleMessageProducer} para geração de mensagens.\n     */\n    public CNPJValidator() {\n        this(true);\n    }\n\n    /**\n     * O validador utiliza um {@linkplain SimpleMessageProducer} para geração de\n     * mensagens.\n     * \n     * @param isFormatted\n     *            considera cadeia no formato de CNPJ: \"dd.ddd.ddd/dddd-dd\" onde\n     *            \"d\" é um dígito decimal.\n     */\n    public CNPJValidator(boolean isFormatted) {\n        this.baseValidator = new BaseValidator();\n        this.isFormatted = isFormatted;\n    }\n\n    /**\n     * <p>\n     * Construtor do Validador de CNPJ.\n     * <\/p>\n     * <p>\n     * \n     * @param messageProducer\n     *            produtor de mensagem de erro.\n     * @param isFormatted\n     *            considera cadeia no formato de CNPJ: \"dd.ddd.ddd/dddd-dd\" onde\n     *            \"d\" é um dígito decimal.\n     */\n    public CNPJValidator(MessageProducer messageProducer, boolean isFormatted) {\n        this.baseValidator = new BaseValidator(messageProducer);\n        this.isFormatted = isFormatted;\n    }\n\n    private List<InvalidValue> getInvalidValues(String cnpj) {\n        List<InvalidValue> errors = new ArrayList<InvalidValue>();\n        errors.clear();\n        if (cnpj != null) {\n            if (!isEligible(cnpj)) {\n                if (isFormatted) {\n                    errors.add(CNPJError.INVALID_FORMAT);\n                } else {\n                    errors.add(CNPJError.INVALID_DIGITS);\n                }\n            } else {\n                String unformatedCNPJ;\n                if (isFormatted) {\n                    CNPJFormatter formatter = new CNPJFormatter();\n                    unformatedCNPJ = formatter.unformat(cnpj);\n                } else {\n                    unformatedCNPJ = cnpj;\n                }\n                if (!hasValidCheckDigits(unformatedCNPJ)) {\n                    errors.add(CNPJError.INVALID_CHECK_DIGITS);\n                }\n            }\n        }\n        return errors;\n    }\n\n    private boolean hasValidCheckDigits(String value) {\n        return (DV1_CHECKER.isDVValid(value)) && (DV2_CHECKER.isDVValid(value));\n    }\n\n    public boolean isEligible(String value) {\n        boolean result;\n        if (isFormatted) {\n            result = FORMATED.matcher(value).matches();\n        } else {\n            result = UNFORMATED.matcher(value).matches();\n        }\n        return result;\n    }\n\n    public void assertValid(String cnpj) {\n        baseValidator.assertValid(getInvalidValues(cnpj));\n    }\n\n    public List<ValidationMessage> invalidMessagesFor(String cnpj) {\n        return baseValidator.generateValidationMessages(getInvalidValues(cnpj));\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.regex.Pattern;\n\nimport br.com.caelum.stella.DigitoPara;\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.SimpleMessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\nimport br.com.caelum.stella.format.CNPJFormatter;\nimport br.com.caelum.stella.validation.error.CNPJError;\n\n/**\n * Representa um validador de CNPJ.\n * \n * @author Leonardo Bessa\n */\npublic class CNPJValidator implements Validator<String> {\n\n    public static final Pattern FORMATED = Pattern.compile(\"(\\\\d{2})[.](\\\\d{3})[.](\\\\d{3})/(\\\\d{4})-(\\\\d{2})\");\n    public static final Pattern UNFORMATED = Pattern.compile(\"(\\\\d{2})(\\\\d{3})(\\\\d{3})(\\\\d{4})(\\\\d{2})\");\n\t\n    private boolean isFormatted = false;\n\tprivate MessageProducer messageProducer;\n    \n    /**\n     * Este considera, por padrão, que as cadeias estão formatadas e utiliza um\n     * {@linkplain SimpleMessageProducer} para geração de mensagens.\n     */\n    public CNPJValidator() {\n    \tmessageProducer = new SimpleMessageProducer();\n    }\n\n    /**\n     * O validador utiliza um {@linkplain SimpleMessageProducer} para geração de\n     * mensagens. Leva em conta se o valor está ou não formatado.\n     * \n     * @param isFormatted\n     *            considera cadeia no formato de CNPJ: \"dd.ddd.ddd/dddd-dd\" onde\n     *            \"d\" é um dígito decimal.\n     */\n    public CNPJValidator(boolean isFormatted) {\n\t\tthis.isFormatted  = isFormatted;\n\t\tthis.messageProducer = new SimpleMessageProducer();\n    }\n\n    /**\n     * <p>\n     * Construtor do Validador de CNPJ. Leva em consideração se o valor está formatado.\n     * <\/p>\n     * <p>\n     * \n     * @param messageProducer\n     *            produtor de mensagem de erro.\n     * @param isFormatted\n     *            considera cadeia no formato de CNPJ: \"dd.ddd.ddd/dddd-dd\" onde\n     *            \"d\" é um dígito decimal.\n     */\n    public CNPJValidator(MessageProducer messageProducer, boolean isFormatted) {\n\t\tthis.messageProducer = messageProducer;\n\t\tthis.isFormatted  = isFormatted;\n    }\n    \n    public CNPJValidator(MessageProducer messageProducer){\n\t\tthis.messageProducer = messageProducer;\n    }\n\n    private List<ValidationMessage> getInvalidValues(String cnpj) {\n\n    \tList<ValidationMessage> errors = new ArrayList<ValidationMessage>();    \t\n        \n        if (cnpj != null) {\n        \t\n        \tif(isFormatted && !FORMATED.matcher(cnpj).matches()){\n        \t\terrors.add(messageProducer.getMessage(CNPJError.INVALID_FORMAT));\n        \t}\n        \t\n        \tString unformatedCNPJ = null;\n        \ttry{\n\t\t\t\tunformatedCNPJ = new CNPJFormatter().unformat(cnpj);\n        \t}catch(IllegalArgumentException e){\n        \t\terrors.add(messageProducer.getMessage(CNPJError.INVALID_DIGITS));\n        \t\treturn errors;\n        \t}\n        \t\n            if(unformatedCNPJ.length() != 14 || !unformatedCNPJ.matches(\"[0-9]*\")){\n            \terrors.add(messageProducer.getMessage(CNPJError.INVALID_DIGITS));\n            }\n           \n            String cnpjSemDigito = unformatedCNPJ.substring(0, unformatedCNPJ.length() - 2);\n            String digitos = unformatedCNPJ.substring(unformatedCNPJ.length() - 2);\n            \n            String digito1 = obtemDigito(cnpjSemDigito);\n            String digito2 = new DigitoPara(cnpjSemDigito + digito1).complementarAoModulo().trocandoPorSeEncontrar(\"0\",10,11).mod(11);\n            \n            if(!digitos.equals(digito1.concat(digito2))){\n            \terrors.add(messageProducer.getMessage(CNPJError.INVALID_CHECK_DIGITS));\n            }\n            \n        }\n        return errors;\n    }\n\n\tprivate String obtemDigito(String cnpjSemDigito) {\n\t\treturn new DigitoPara(cnpjSemDigito).complementarAoModulo().trocandoPorSeEncontrar(\"0\",10,11).mod(11);\n\t}\n\n    public boolean isEligible(String value) {\n        boolean result;\n        if (isFormatted) {\n            result = FORMATED.matcher(value).matches();\n        } else {\n            result = UNFORMATED.matcher(value).matches();\n        }\n        return result;\n    }\n\n    @Override\n    public void assertValid(String cnpj) {\n    \t\n        List<ValidationMessage> errors = getInvalidValues(cnpj);\n\t\tif (!errors.isEmpty()) {\n            throw new InvalidStateException(errors);\n        }\n    }\n\n    @Override\n    public List<ValidationMessage> invalidMessagesFor(String cnpj) {\n        return getInvalidValues(cnpj);\n    }\n\n}\n","lineNo":122}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.*;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\n\npublic class SafraTest {\n\n\tprivate Safra banco;\n\tprivate Emissor emissor;\n\tprivate Boleto boleto;\n\n\t@Before\n\tpublic void setup(){\n\t\tDatas datas = Datas.novasDatas()\n\t\t\t\t\t\t\t\t.comDocumento(25,07,2013)\n\t\t\t\t\t\t\t\t.comVencimento(26, 07, 2013)\n\t\t\t\t\t\t\t\t.comProcessamento(25, 07, 2013);\n\t\tthis.emissor = Emissor.novoEmissor()\n\t\t\t\t\t\t\t\t.comCedente(\"Supermercado Pedreira LT\")\n\t\t\t\t\t\t\t\t.comAgencia(1)\n\t\t\t\t\t\t\t\t.comDigitoAgencia('8')\n\t\t\t\t\t\t\t\t.comContaCorrente(1245)\n\t\t\t\t\t\t\t\t.comDigitoContaCorrente('1')\n\t\t\t\t\t\t\t\t.comNossoNumero(4)\n\t\t\t\t\t\t\t\t.comDigitoNossoNumero(\"3\");\n\t\t\n\t\tSacado sacado = Sacado.novoSacado().comNome(\"Doutor Cenoura\");\n\t\t\n\t\tbanco = new Safra();\n\t\t\n\t\tthis.boleto = Boleto.novoBoleto()\n\t\t\t\t\t\t\t\t.comDatas(datas)\n\t\t\t\t\t\t\t\t.comEmissor(this.emissor)\n\t\t\t\t\t\t\t\t.comSacado(sacado)\n\t\t\t\t\t\t\t\t.comValorBoleto(19.80)\n\t\t\t\t\t\t\t\t.comNumeroDoDocumento(\"14048\");\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void numeroDoBancoDeveTerTresDigitos(){\n\t\tassertEquals(banco.getNumeroFormatado().length(),3);\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void codigoDeBarrasDeveTerQuarentaEQuatroPosicoes(){\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\t\t\n\t\tassertEquals(banco.geraCodigoDeBarrasPara(this.boleto).length(), 44, 0);\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void contaCorrenteDoEmissorDeveTerNoveDigitos(){\n\t\tassertEquals(9, this.banco.getContaCorrenteDoEmissorFormatado(this.emissor).length());\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void carteiraFormatadoDeveTerDoisDigitos() {\n\t\tEmissor emissor = Emissor.novoEmissor().comCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(2, numeroFormatado.length());\n\t\tassertEquals(\"01\", numeroFormatado);\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void nossoNumeroDoEmissorDeveTerNoveDigitos(){\n\t\tassertEquals(9, this.banco.getNossoNumeroDoEmissorFormatado(this.emissor).length());\n\t}\n\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void numeroComDigitoDeveTerCincoDigitos(){\n\t\tString numeroDoBanco = this.banco.getNumeroFormatadoComDigito();\n\t\tassertEquals(\"422-7\", numeroDoBanco);\n\t\tassertEquals(5, numeroDoBanco.length());\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void dadoOsDadosDoBancoEDoEmissorDeveGerarALinhaDoCodigoDeBarras(){\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\t\t\n\t\tassertEquals(\"42299577100000019807000010000124510000000482\", \n\t\t\tthis.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void dadoOBancoEAMoedaODigitoVerificadorDaPosicaoCincoDeveSerNove(){\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\t\t\n\t\tString linhaCodigoDeBarras = this.banco.geraCodigoDeBarrasPara(this.boleto);\n\t\t\n\t\tassertEquals(\"9\", linhaCodigoDeBarras.substring(4,5));\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.*;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\n\npublic class SafraTest {\n\n\tprivate Safra banco;\n\tprivate Emissor emissor;\n\tprivate Boleto boleto;\n\n\t@Before\n\tpublic void setup(){\n\t\tDatas datas = Datas.novasDatas()\n\t\t\t\t\t\t\t\t.comDocumento(25,07,2013)\n\t\t\t\t\t\t\t\t.comVencimento(26, 07, 2013)\n\t\t\t\t\t\t\t\t.comProcessamento(25, 07, 2013);\n\t\tthis.emissor = Emissor.novoEmissor()\n\t\t\t\t\t\t\t\t.comCedente(\"Supermercado Pedreira LT\")\n\t\t\t\t\t\t\t\t.comAgencia(1)\n\t\t\t\t\t\t\t\t.comDigitoAgencia('8')\n\t\t\t\t\t\t\t\t.comContaCorrente(1245)\n\t\t\t\t\t\t\t\t.comDigitoContaCorrente('1')\n\t\t\t\t\t\t\t\t.comNossoNumero(4)\n\t\t\t\t\t\t\t\t.comDigitoNossoNumero(\"3\");\n\t\t\n\t\tSacado sacado = Sacado.novoSacado().comNome(\"Doutor Cenoura\");\n\t\t\n\t\tbanco = new Safra();\n\t\t\n\t\tthis.boleto = Boleto.novoBoleto()\n\t\t\t\t\t\t\t\t.comDatas(datas)\n\t\t\t\t\t\t\t\t.comEmissor(this.emissor)\n\t\t\t\t\t\t\t\t.comSacado(sacado)\n\t\t\t\t\t\t\t\t.comValorBoleto(19.80)\n\t\t\t\t\t\t\t\t.comNumeroDoDocumento(\"14048\");\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void numeroDoBancoDeveTerTresDigitos(){\n\t\tassertEquals(banco.getNumeroFormatado().length(),3);\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void contaCorrenteDoEmissorDeveTerNoveDigitos(){\n\t\tassertEquals(9, this.banco.getContaCorrenteDoEmissorFormatado(this.emissor).length());\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void carteiraFormatadoDeveTerDoisDigitos() {\n\t\tEmissor emissor = Emissor.novoEmissor().comCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(2, numeroFormatado.length());\n\t\tassertEquals(\"01\", numeroFormatado);\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void nossoNumeroDoEmissorDeveTerNoveDigitos(){\n\t\tassertEquals(9, this.banco.getNossoNumeroDoEmissorFormatado(this.emissor).length());\n\t}\n\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void numeroComDigitoDeveTerCincoDigitos(){\n\t\tString numeroDoBanco = this.banco.getNumeroFormatadoComDigito();\n\t\tassertEquals(\"422-7\", numeroDoBanco);\n\t\tassertEquals(5, numeroDoBanco.length());\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void dadoOsDadosDoBancoEDoEmissorDeveGerarALinhaDigitavelDoCodigoDeBarras(){\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\t\t\n\t\tGeradorDeLinhaDigitavel linhaDigitavelGenerator = new GeradorDeLinhaDigitavel();\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\t\t\n\t\tassertEquals(\"42297.00002  10000.124510  00000.000422  4  57710000001980\", \n\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void dadoOBancoEAMoedaODigitoVerificadorDaPosicaoCincoDeveSerQuatro(){\n\t\tthis.boleto = this.boleto.comBanco(this.banco);\n\t\t\n\t\tString linhaCodigoDeBarras = this.banco.geraCodigoDeBarrasPara(this.boleto);\n\t\t\n\t\tassertEquals(\"4\", linhaCodigoDeBarras.substring(4,5));\n\t}\n\t\n\t@SuppressWarnings(\"deprecation\") @Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","lineNo":82}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\n\n/**\n * Gera dados de um boleto relativos ao Banco do Brasil.\n * \n * @see <a *\n *      href=\"http://stella.caelum.com.br/boleto-setup.html\">http://stella.caelum\n *      * .com.br/boleto-setup.html< /a>\n * \n * @author Cauê Guerra\n * @author Paulo Silveira\n * \n */\npublic class BancoDoBrasil extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_BB = \"001\";\n\tprivate static final String DIGITO_NUMERO_BB = \"9\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tif (emissor.getNumeroConvenio() < 1000000) {\n\t\t\tif (emissor.getCarteira() == 16 || emissor.getCarteira() == 18) {\n\t\t\t\tcampoLivre.append(getNumeroConvenioDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(\"21\");\n\t\t\t} else {\n\t\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(emissor.getAgenciaFormatado());\n\t\t\t\tcampoLivre.append(emissor.getCedente());\n\t\t\t\tcampoLivre.append(boleto.getBanco().getCarteiraDoEmissorFormatado(emissor));\n\t\t\t}\n\t\t} else if (emissor.getCarteira() == 17 || emissor.getCarteira() == 18) {\n\t\t\tcampoLivre.append(\"000000\");\n\t\t\tcampoLivre.append(getNumeroConvenioDoEmissorFormatado(emissor));\n\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor).substring(7));\n\t\t\tcampoLivre.append(boleto.getBanco().getCarteiraDoEmissorFormatado(emissor));\n\t\t} else {\n\t\t\tthrow new CriacaoBoletoException(\n\t\t\t\t\t\"Erro na geração do código de barras. Nenhuma regra se aplica. Verifique carteira e demais dados.\");\n\t\t}\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_BB;\n\t}\n\n\t@Override\n\tpublic java.net.URL getImage() {\n\t\treturn getClass().getResource(String.format(\"/br/com/caelum/stella/boleto/img/%s.png\", getNumeroFormatado()));\n\t}\n\n\t@Deprecated\n\tpublic String getNumConvenioDoEmissorFormatado(Emissor emissor) {\n\t\treturn getNumeroConvenioDoEmissorFormatado(emissor);\n\t}\n\n\tpublic String getNumeroConvenioDoEmissorFormatado(Emissor emissor) {\n\t\tif (emissor.getNumeroConvenio() < 1000000) {\n\t\t\treturn String.format(\"%06d\", emissor.getNumeroConvenio());\n\t\t} else {\n\t\t\treturn String.format(\"%07d\", emissor.getNumeroConvenio());\n\t\t}\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tif (emissor.getCarteira() == 18) {\n\t\t\treturn String.format(\"%017d\", emissor.getNossoNumero());\n\t\t} else {\n\t\t\treturn String.format(\"%011d\", emissor.getNossoNumero());\n\t\t}\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_BB + \"-\" + DIGITO_NUMERO_BB;\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\treturn getNossoNumeroDoEmissorFormatado(emissor);\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\n\n/**\n * Gera dados de um boleto relativos ao Banco do Brasil.\n * \n * @author Cauê Guerra\n * @author Paulo Silveira\n */\npublic class BancoDoBrasil extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_BB = \"001\";\n\tprivate static final String DIGITO_NUMERO_BB = \"9\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tif (emissor.getNumeroConvenio() < 1000000) {\n\t\t\tif (emissor.getCarteira() == 16 || emissor.getCarteira() == 18) {\n\t\t\t\tcampoLivre.append(getNumeroConvenioDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(\"21\");\n\t\t\t} else {\n\t\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(emissor.getAgenciaFormatado());\n\t\t\t\tcampoLivre.append(emissor.getCedente());\n\t\t\t\tcampoLivre.append(boleto.getBanco().getCarteiraDoEmissorFormatado(emissor));\n\t\t\t}\n\t\t} else if (emissor.getCarteira() == 17 || emissor.getCarteira() == 18) {\n\t\t\tcampoLivre.append(\"000000\");\n\t\t\tcampoLivre.append(getNumeroConvenioDoEmissorFormatado(emissor));\n\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor).substring(7));\n\t\t\tcampoLivre.append(boleto.getBanco().getCarteiraDoEmissorFormatado(emissor));\n\t\t} else {\n\t\t\tthrow new CriacaoBoletoException(\n\t\t\t\t\t\"Erro na geração do código de barras. Nenhuma regra se aplica. \" +\n\t\t\t\t\t\"Verifique carteira e demais dados.\");\n\t\t}\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_BB;\n\t}\n\n\t@Override\n\tpublic java.net.URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\tpublic String getNumeroConvenioDoEmissorFormatado(Emissor emissor) {\n\t\tif (emissor.getNumeroConvenio() < 1000000) {\n\t\t\treturn String.format(\"%06d\", emissor.getNumeroConvenio());\n\t\t} else {\n\t\t\treturn String.format(\"%07d\", emissor.getNumeroConvenio());\n\t\t}\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tif (emissor.getCarteira() == 18) {\n\t\t\treturn String.format(\"%017d\", emissor.getNossoNumero());\n\t\t} else {\n\t\t\treturn String.format(\"%011d\", emissor.getNossoNumero());\n\t\t}\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_BB + \"-\" + DIGITO_NUMERO_BB;\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\treturn getNossoNumeroDoEmissorFormatado(emissor);\n\t}\n\n}\n","lineNo":54}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\n\n/**\n * Gera dados de um boleto relativos ao Banco do Brasil.\n * \n * @see <a *\n *      href=\"http://stella.caelum.com.br/boleto-setup.html\">http://stella.caelum\n *      * .com.br/boleto-setup.html< /a>\n * \n * @author Cauê Guerra\n * @author Paulo Silveira\n * \n */\npublic class BancoDoBrasil extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_BB = \"001\";\n\tprivate static final String DIGITO_NUMERO_BB = \"9\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tif (emissor.getNumeroConvenio() < 1000000) {\n\t\t\tif (emissor.getCarteira() == 16 || emissor.getCarteira() == 18) {\n\t\t\t\tcampoLivre.append(getNumeroConvenioDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(\"21\");\n\t\t\t} else {\n\t\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(emissor.getAgenciaFormatado());\n\t\t\t\tcampoLivre.append(emissor.getCedente());\n\t\t\t\tcampoLivre.append(boleto.getBanco().getCarteiraDoEmissorFormatado(emissor));\n\t\t\t}\n\t\t} else if (emissor.getCarteira() == 17 || emissor.getCarteira() == 18) {\n\t\t\tcampoLivre.append(\"000000\");\n\t\t\tcampoLivre.append(getNumeroConvenioDoEmissorFormatado(emissor));\n\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor).substring(7));\n\t\t\tcampoLivre.append(boleto.getBanco().getCarteiraDoEmissorFormatado(emissor));\n\t\t} else {\n\t\t\tthrow new CriacaoBoletoException(\n\t\t\t\t\t\"Erro na geração do código de barras. Nenhuma regra se aplica. Verifique carteira e demais dados.\");\n\t\t}\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_BB;\n\t}\n\n\t@Override\n\tpublic java.net.URL getImage() {\n\t\treturn getClass().getResource(String.format(\"/br/com/caelum/stella/boleto/img/%s.png\", getNumeroFormatado()));\n\t}\n\n\t@Deprecated\n\tpublic String getNumConvenioDoEmissorFormatado(Emissor emissor) {\n\t\treturn getNumeroConvenioDoEmissorFormatado(emissor);\n\t}\n\n\tpublic String getNumeroConvenioDoEmissorFormatado(Emissor emissor) {\n\t\tif (emissor.getNumeroConvenio() < 1000000) {\n\t\t\treturn String.format(\"%06d\", emissor.getNumeroConvenio());\n\t\t} else {\n\t\t\treturn String.format(\"%07d\", emissor.getNumeroConvenio());\n\t\t}\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tif (emissor.getCarteira() == 18) {\n\t\t\treturn String.format(\"%017d\", emissor.getNossoNumero());\n\t\t} else {\n\t\t\treturn String.format(\"%011d\", emissor.getNossoNumero());\n\t\t}\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_BB + \"-\" + DIGITO_NUMERO_BB;\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\treturn getNossoNumeroDoEmissorFormatado(emissor);\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\n\n/**\n * Gera dados de um boleto relativos ao Banco do Brasil.\n * \n * @author Cauê Guerra\n * @author Paulo Silveira\n */\npublic class BancoDoBrasil extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_BB = \"001\";\n\tprivate static final String DIGITO_NUMERO_BB = \"9\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tif (emissor.getNumeroConvenio() < 1000000) {\n\t\t\tif (emissor.getCarteira() == 16 || emissor.getCarteira() == 18) {\n\t\t\t\tcampoLivre.append(getNumeroConvenioDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(\"21\");\n\t\t\t} else {\n\t\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t\t\tcampoLivre.append(emissor.getAgenciaFormatado());\n\t\t\t\tcampoLivre.append(emissor.getCedente());\n\t\t\t\tcampoLivre.append(boleto.getBanco().getCarteiraDoEmissorFormatado(emissor));\n\t\t\t}\n\t\t} else if (emissor.getCarteira() == 17 || emissor.getCarteira() == 18) {\n\t\t\tcampoLivre.append(\"000000\");\n\t\t\tcampoLivre.append(getNumeroConvenioDoEmissorFormatado(emissor));\n\t\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor).substring(7));\n\t\t\tcampoLivre.append(boleto.getBanco().getCarteiraDoEmissorFormatado(emissor));\n\t\t} else {\n\t\t\tthrow new CriacaoBoletoException(\n\t\t\t\t\t\"Erro na geração do código de barras. Nenhuma regra se aplica. \" +\n\t\t\t\t\t\"Verifique carteira e demais dados.\");\n\t\t}\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_BB;\n\t}\n\n\t@Override\n\tpublic java.net.URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\tpublic String getNumeroConvenioDoEmissorFormatado(Emissor emissor) {\n\t\tif (emissor.getNumeroConvenio() < 1000000) {\n\t\t\treturn String.format(\"%06d\", emissor.getNumeroConvenio());\n\t\t} else {\n\t\t\treturn String.format(\"%07d\", emissor.getNumeroConvenio());\n\t\t}\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tif (emissor.getCarteira() == 18) {\n\t\t\treturn String.format(\"%017d\", emissor.getNossoNumero());\n\t\t} else {\n\t\t\treturn String.format(\"%011d\", emissor.getNossoNumero());\n\t\t}\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_BB + \"-\" + DIGITO_NUMERO_BB;\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\treturn getNossoNumeroDoEmissorFormatado(emissor);\n\t}\n\n}\n","lineNo":55}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\n\n/**\n * Gera dados de um boleto relativos ao Banco Bradesco.\n * \n * @see <a *\n *      href=\"http://stella.caelum.com.br/boleto-setup.html\">http://stella.caelum\n *      * .com.br/boleto-setup.html< /a>\n * \n * @see <a * href=\n *      \"http://www.bradesco.com.br/br/pj/conteudo/sol_rec/pdf/manualtecnico.pdf\"\n *      >MANUAL * DO BLOQUETO DE COBRAN\u2021A< /a>\n * \n * @author Leonardo Bessa\n * \n */\npublic class Bradesco extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_BRADESCO = \"237\";\n\n\tprivate static final String DIGITO_NUMERO_BRADESCO = \"2\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tcampoLivre.append(emissor.getAgenciaFormatado());\n\t\tcampoLivre.append(getCarteiraDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(getContaCorrenteDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(\"0\");\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_BRADESCO + \"-\" + DIGITO_NUMERO_BRADESCO;\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_BRADESCO;\n\t}\n\n\t@Override\n\tpublic java.net.URL getImage() {\n\t\treturn getClass().getResource(String.format(\"/br/com/caelum/stella/boleto/img/%s.png\", getNumeroFormatado()));\n\t}\n\n\t@Deprecated\n\tpublic String getNumConvenioDoEmissorFormatado(Emissor emissor) {\n\t\treturn getNumeroConvenioDoEmissorFormatado(emissor);\n\t}\n\n\tpublic String getNumeroConvenioDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getNumeroConvenio());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%011d\", emissor.getNossoNumero());\n\t}\n\n\tpublic String getDigitoNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.valueOf(emissor.getDigitoNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\treturn emissor.getCarteira() + \" / \" + getNossoNumeroDoEmissorFormatado(emissor)\n\t\t\t\t+ getDigitoNossoNumero(emissor);\n\n\t}\n\n\tprivate String getDigitoNossoNumero(Emissor emissor) {\n\t\treturn emissor.getDigitoNossoNumero() != null && !emissor.getDigitoNossoNumero().isEmpty() ? \"-\"\n\t\t\t\t+ emissor.getDigitoNossoNumero() : \"\";\n\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\n/**\n * Gera dados de um boleto relativos ao Banco Bradesco.\n * \n * @see <a href=\"http://www.bradesco.com.br/br/pj/conteudo/sol_rec\n * /pdf/manualtecnico.pdf\" >MANUAL DO BLOQUETO DE COBRAN\u2021A <\/a>\n * \n * @author Leonardo Bessa\n * \n */\npublic class Bradesco extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_BRADESCO = \"237\";\n\n\tprivate static final String DIGITO_NUMERO_BRADESCO = \"2\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tcampoLivre.append(emissor.getAgenciaFormatado());\n\t\tcampoLivre.append(getCarteiraDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(getContaCorrenteDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(\"0\");\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(getNumeroFormatado()).append(\"-\");\n\t\treturn builder.append(DIGITO_NUMERO_BRADESCO).toString();\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_BRADESCO;\n\t}\n\n\t@Override\n\tpublic java.net.URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\tpublic String getNumeroConvenioDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getNumeroConvenio());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%011d\", emissor.getNossoNumero());\n\t}\n\n\tpublic String getDigitoNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.valueOf(emissor.getDigitoNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\tStringBuilder builder = new StringBuilder(emissor.getCarteira());\n\t\tbuilder.append(\"/\").append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\treturn builder.append(getDigitoNossoNumero(emissor)).toString();\n\t}\n\n\tprivate String getDigitoNossoNumero(Emissor emissor) {\n\t\treturn emissor.getDigitoNossoNumero() != null \n\t\t\t&& !emissor.getDigitoNossoNumero().isEmpty() \n\t\t\t\t? \"-\" + emissor.getDigitoNossoNumero() : \"\";\n\t}\n}\n","lineNo":48}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\n\n/**\n * Gera dados de um boleto relativos ao Banco Bradesco.\n * \n * @see <a *\n *      href=\"http://stella.caelum.com.br/boleto-setup.html\">http://stella.caelum\n *      * .com.br/boleto-setup.html< /a>\n * \n * @see <a * href=\n *      \"http://www.bradesco.com.br/br/pj/conteudo/sol_rec/pdf/manualtecnico.pdf\"\n *      >MANUAL * DO BLOQUETO DE COBRAN\u2021A< /a>\n * \n * @author Leonardo Bessa\n * \n */\npublic class Bradesco extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_BRADESCO = \"237\";\n\n\tprivate static final String DIGITO_NUMERO_BRADESCO = \"2\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tcampoLivre.append(emissor.getAgenciaFormatado());\n\t\tcampoLivre.append(getCarteiraDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(getContaCorrenteDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(\"0\");\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_BRADESCO + \"-\" + DIGITO_NUMERO_BRADESCO;\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_BRADESCO;\n\t}\n\n\t@Override\n\tpublic java.net.URL getImage() {\n\t\treturn getClass().getResource(String.format(\"/br/com/caelum/stella/boleto/img/%s.png\", getNumeroFormatado()));\n\t}\n\n\t@Deprecated\n\tpublic String getNumConvenioDoEmissorFormatado(Emissor emissor) {\n\t\treturn getNumeroConvenioDoEmissorFormatado(emissor);\n\t}\n\n\tpublic String getNumeroConvenioDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getNumeroConvenio());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%011d\", emissor.getNossoNumero());\n\t}\n\n\tpublic String getDigitoNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.valueOf(emissor.getDigitoNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\treturn emissor.getCarteira() + \" / \" + getNossoNumeroDoEmissorFormatado(emissor)\n\t\t\t\t+ getDigitoNossoNumero(emissor);\n\n\t}\n\n\tprivate String getDigitoNossoNumero(Emissor emissor) {\n\t\treturn emissor.getDigitoNossoNumero() != null && !emissor.getDigitoNossoNumero().isEmpty() ? \"-\"\n\t\t\t\t+ emissor.getDigitoNossoNumero() : \"\";\n\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\n/**\n * Gera dados de um boleto relativos ao Banco Bradesco.\n * \n * @see <a href=\"http://www.bradesco.com.br/br/pj/conteudo/sol_rec\n * /pdf/manualtecnico.pdf\" >MANUAL DO BLOQUETO DE COBRAN\u2021A <\/a>\n * \n * @author Leonardo Bessa\n * \n */\npublic class Bradesco extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_BRADESCO = \"237\";\n\n\tprivate static final String DIGITO_NUMERO_BRADESCO = \"2\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder campoLivre = new StringBuilder();\n\t\tcampoLivre.append(emissor.getAgenciaFormatado());\n\t\tcampoLivre.append(getCarteiraDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(getContaCorrenteDoEmissorFormatado(emissor));\n\t\tcampoLivre.append(\"0\");\n\t\treturn new CodigoDeBarrasBuilder(boleto).comCampoLivre(campoLivre);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(getNumeroFormatado()).append(\"-\");\n\t\treturn builder.append(DIGITO_NUMERO_BRADESCO).toString();\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_BRADESCO;\n\t}\n\n\t@Override\n\tpublic java.net.URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\tpublic String getNumeroConvenioDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getNumeroConvenio());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%011d\", emissor.getNossoNumero());\n\t}\n\n\tpublic String getDigitoNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.valueOf(emissor.getDigitoNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\tStringBuilder builder = new StringBuilder(emissor.getCarteira());\n\t\tbuilder.append(\"/\").append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\treturn builder.append(getDigitoNossoNumero(emissor)).toString();\n\t}\n\n\tprivate String getDigitoNossoNumero(Emissor emissor) {\n\t\treturn emissor.getDigitoNossoNumero() != null \n\t\t\t&& !emissor.getDigitoNossoNumero().isEmpty() \n\t\t\t\t? \"-\" + emissor.getDigitoNossoNumero() : \"\";\n\t}\n}\n","lineNo":49}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\npublic class Caixa extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_CAIXA = \"104\";\n\tprivate static final String DIGITO_CAIXA = \"0\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\t\tcodigoDeBarras.append(emissor.getCarteira());\n\t\tcodigoDeBarras.append(String.format(\"%06d\", emissor.getContaCorrente()));\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcodigoDeBarras.insert(4, this.dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\t\treturn codigoDeBarras.toString();\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(getNumeroFormatado()).append(\"-\");\n\t\treturn builder.append(DIGITO_CAIXA).toString();\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%05d\", emissor.getContaCorrente());\n\t}\n\t\n\tpublic String getCodigoFornecidoPelaAgenciaFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\n\tpublic String getCodigoOperacaoFormatado(Emissor emissor) {\n\t\treturn String.format(\"%03d\", emissor.getCodigoOperacao());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%017d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_CAIXA;\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\npublic class Caixa extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_CAIXA = \"104\";\n\tprivate static final String DIGITO_CAIXA = \"0\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\t\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tint carteiraDoEmissor = emissor.getCarteira();\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\t\t\n\t\tif (carteiraDoEmissor == 1) {\n\t\t\tcodigoDeBarras.append(carteiraDoEmissor);\n\t\t\tcodigoDeBarras.append(String.format(\"%06d\", emissor.getContaCorrente()));\n\t\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t}\n\t\telse if (carteiraDoEmissor == 2) {\n\t\t\tString nossoNumeroCompleto = getNossoNumeroDoEmissorFormatado(emissor);\n\t\t\tcodigoDeBarras.append(String.format(\"%06d\", emissor.getContaCorrente()));\n\t\t\tcodigoDeBarras.append(emissor.getDigitoContaCorrente());\n\t\t\tcodigoDeBarras.append(nossoNumeroCompleto.substring(2, 5));\n\t\t\tcodigoDeBarras.append(nossoNumeroCompleto.substring(0, 1));\n\t\t\tcodigoDeBarras.append(nossoNumeroCompleto.substring(5 ,8));\n\t\t\tcodigoDeBarras.append(nossoNumeroCompleto.substring(1, 2));\n\t\t\tcodigoDeBarras.append(nossoNumeroCompleto.substring(8));\n\t\t\tcodigoDeBarras.append(dvGenerator.geraDigitoMod11(codigoDeBarras.substring(18)));\n\t\t}\n\t\telse {\n\t\t\tthrow new IllegalArgumentException(\"A carteira digitada não é suportada\");\n\t\t}\n\t\t\n\t\tcodigoDeBarras.insert(4, dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\t\treturn codigoDeBarras.toString();\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(getNumeroFormatado()).append(\"-\");\n\t\treturn builder.append(DIGITO_CAIXA).toString();\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%05d\", emissor.getContaCorrente());\n\t}\n\t\n\tpublic String getCodigoFornecidoPelaAgenciaFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\n\tpublic String getCodigoOperacaoFormatado(Emissor emissor) {\n\t\treturn String.format(\"%03d\", emissor.getCodigoOperacao());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%017d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_CAIXA;\n\t}\n\t\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\t\n\t\tString nn = getNossoNumeroDoEmissorFormatado(emissor);\n\t\tStringBuilder builder = new StringBuilder(nn);\n\t\t\n\t\tif(emissor.getDigitoNossoNumero() != null \n\t\t\t\t&& !emissor.getDigitoNossoNumero().isEmpty()){\n\t\t\tbuilder.append(\"-\").append(emissor.getDigitoNossoNumero());\n\t\t}\n\t\treturn builder.toString();\n\t}\n}\n","lineNo":18}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\n\npublic class Caixa extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_CAIXA = \"104\";\n\tprivate static final String DIGITO_CAIXA = \"0\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\t// Digito Verificador sera inserido aqui.\n\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\n\t\tEmissor emissor = boleto.getEmissor();\n\n\t\tcodigoDeBarras.append(emissor.getCarteira());\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor));\n\n\t\tcodigoDeBarras.append(emissor.getAgenciaFormatado());\n\t\tcodigoDeBarras.append(getCodigoOperacaoFormatado(emissor));\n\t\tcodigoDeBarras.append(getCodigoFornecidoPelaAgenciaFormatado(emissor));\n\n\t\tcodigoDeBarras.insert(4, this.dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\n\t\tString result = codigoDeBarras.toString();\n\n\t\tif (result.length() != 44) {\n\t\t\tthrow new CriacaoBoletoException(\n\t\t\t\t\t\"Erro na geração do código de barras. Número de digitos diferente de 44. Verifique todos os dados.\"\n\t\t\t\t\t\t\t+ result.length());\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_CAIXA + \"-\" + DIGITO_CAIXA;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%05d\", emissor.getContaCorrente());\n\t}\n\n\tpublic String getCodigoFornecidoPelaAgenciaFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\n\tpublic String getCodigoOperacaoFormatado(Emissor emissor) {\n\t\treturn String.format(\"%03d\", emissor.getCodigoOperacao());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\treturn getClass().getResource(String.format(\"/br/com/caelum/stella/boleto/img/%s.png\", getNumeroFormatado()));\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tint length = 10 - (emissor.getCarteira() / 10);\n\t\treturn String.format(\"%0\" + (length - 1) + \"d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_CAIXA;\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\npublic class Caixa extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_CAIXA = \"104\";\n\tprivate static final String DIGITO_CAIXA = \"0\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\t\tcodigoDeBarras.append(emissor.getCarteira());\n\t\tcodigoDeBarras.append(String.format(\"%06d\", emissor.getContaCorrente()));\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcodigoDeBarras.insert(4, this.dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\t\treturn codigoDeBarras.toString();\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(getNumeroFormatado()).append(\"-\");\n\t\treturn builder.append(DIGITO_CAIXA).toString();\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%05d\", emissor.getContaCorrente());\n\t}\n\t\n\tpublic String getCodigoFornecidoPelaAgenciaFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\n\tpublic String getCodigoOperacaoFormatado(Emissor emissor) {\n\t\treturn String.format(\"%03d\", emissor.getCodigoOperacao());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%017d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_CAIXA;\n\t}\n}\n","lineNo":56}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\n\npublic class Caixa extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_CAIXA = \"104\";\n\tprivate static final String DIGITO_CAIXA = \"0\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\t// Digito Verificador sera inserido aqui.\n\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\n\t\tEmissor emissor = boleto.getEmissor();\n\n\t\tcodigoDeBarras.append(emissor.getCarteira());\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor));\n\n\t\tcodigoDeBarras.append(emissor.getAgenciaFormatado());\n\t\tcodigoDeBarras.append(getCodigoOperacaoFormatado(emissor));\n\t\tcodigoDeBarras.append(getCodigoFornecidoPelaAgenciaFormatado(emissor));\n\n\t\tcodigoDeBarras.insert(4, this.dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\n\t\tString result = codigoDeBarras.toString();\n\n\t\tif (result.length() != 44) {\n\t\t\tthrow new CriacaoBoletoException(\n\t\t\t\t\t\"Erro na geração do código de barras. Número de digitos diferente de 44. Verifique todos os dados.\"\n\t\t\t\t\t\t\t+ result.length());\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_CAIXA + \"-\" + DIGITO_CAIXA;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%05d\", emissor.getContaCorrente());\n\t}\n\n\tpublic String getCodigoFornecidoPelaAgenciaFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\n\tpublic String getCodigoOperacaoFormatado(Emissor emissor) {\n\t\treturn String.format(\"%03d\", emissor.getCodigoOperacao());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\treturn getClass().getResource(String.format(\"/br/com/caelum/stella/boleto/img/%s.png\", getNumeroFormatado()));\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tint length = 10 - (emissor.getCarteira() / 10);\n\t\treturn String.format(\"%0\" + (length - 1) + \"d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_CAIXA;\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\npublic class Caixa extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_CAIXA = \"104\";\n\tprivate static final String DIGITO_CAIXA = \"0\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\t\tcodigoDeBarras.append(emissor.getCarteira());\n\t\tcodigoDeBarras.append(String.format(\"%06d\", emissor.getContaCorrente()));\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcodigoDeBarras.insert(4, this.dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\t\treturn codigoDeBarras.toString();\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(getNumeroFormatado()).append(\"-\");\n\t\treturn builder.append(DIGITO_CAIXA).toString();\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%05d\", emissor.getContaCorrente());\n\t}\n\t\n\tpublic String getCodigoFornecidoPelaAgenciaFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\n\tpublic String getCodigoOperacaoFormatado(Emissor emissor) {\n\t\treturn String.format(\"%03d\", emissor.getCodigoOperacao());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%017d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_CAIXA;\n\t}\n}\n","lineNo":57}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class CaixaTest {\n\tprivate Boleto boleto;\n\tprivate Caixa banco;\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\tDatas datas = Datas.newDatas().withDocumento(31, 5, 2006).withProcessamento(31, 5, 2006)\n\t\t\t\t.withVencimento(31, 5, 2006);\n\n\t\tthis.emissor = Emissor.newEmissor().withCedente(\"Caue Guerra\").withAgencia(2949).withDigitoAgencia('1')\n\t\t\t\t.withContaCorrente(6580).withNumeroConvenio(1207113).withDigitoContaCorrente('3').withCarteira(9)\n\t\t\t\t.withNossoNumero(1200200).withCodigoFornecidoPelaAgencia(789).withCodigoOperacao(123);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\");\n\n\t\tthis.banco = new Caixa();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(this.emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(1.00).withNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void codFornecidoPelaAgenciaDeveTerOitoDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCodigoFornecidoPelaAgencia(2);\n\t\tString numeroFormatado = this.banco.getCodigoFornecidoPelaAgenciaFormatado(emissor);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"00000002\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void codOperacaoDeveTerTresDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCodigoOperacao(2);\n\t\tString numeroFormatado = this.banco.getCodigoOperacaoFormatado(emissor);\n\t\tassertEquals(3, numeroFormatado.length());\n\t\tassertEquals(\"002\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerDoisDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(2, numeroFormatado.length());\n\t\tassertEquals(\"01\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerCincoDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(5, numeroFormatado.length());\n\t\tassertEquals(\"06580\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoCaixa() {\n\t\tthis.banco = new Caixa();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tGeradorDeLinhaDigitavel linhaDigitavelGenerator = new GeradorDeLinhaDigitavel();\n\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\n\t\tassertEquals(\"10499.00127  00200.294916  23000.007890  8  31580000000100\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoCaixa() {\n\t\tthis.banco = new Caixa();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"10498315800000001009001200200294912300000789\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class CaixaTest {\n\n\tprivate Boleto boleto;\n\tprivate Caixa banco = new Caixa();\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\n\t\tDatas datas = Datas.newDatas().withDocumento(22, 04, 2013)\n\t\t\t.withProcessamento(22, 04, 2013).withVencimento(29, 04, 2013);\n\n\t\tthis.emissor = Emissor.newEmissor().withCedente(\"Rodrigo Turini\")\n\t\t\t.withAgencia(2873).withCarteira(1)\n\t\t\t.withContaCorrente(2359).withNossoNumero(990000000003994458l)\n\t\t\t.withDigitoNossoNumero(\"0\");\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Mario Amaral\");\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas)\n\t\t\t.withEmissor(emissor).withBanco(this.banco).withSacado(sacado)\n\t\t\t.withValorBoleto(4016.10).withNumeroDoDocumento(\"3084373\");\n\t}\n\n\t@Test\n\tpublic void codFornecidoPelaAgenciaDeveTerOitoDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor()\n\t\t\t\t.withCodigoFornecidoPelaAgencia(2);\n\t\tString numeroFormatado = this.banco\n\t\t\t\t.getCodigoFornecidoPelaAgenciaFormatado(emissor);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"00000002\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void codOperacaoDeveTerTresDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCodigoOperacao(2);\n\t\tString numeroFormatado = this.banco.getCodigoOperacaoFormatado(emissor);\n\t\tassertEquals(3, numeroFormatado.length());\n\t\tassertEquals(\"002\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerDoisDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco\n\t\t\t\t.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(2, numeroFormatado.length());\n\t\tassertEquals(\"01\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerCincoDigitos() {\n\t\tString numeroFormatado = this.banco\n\t\t\t.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(5, numeroFormatado.length());\n\t\tassertEquals(\"02359\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoCaixa() {\n\t\tGeradorDeLinhaDigitavel gerador = new GeradorDeLinhaDigitavel();\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\t\tString linha = \"10491.00231  59990.000008  00039.944582  2  56830000401610\";\n\t\tassertEquals(linha, gerador.geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoCaixa() {\n\t\tassertEquals(\"10492568300004016101002359990000000003994458\",\n\t\t\t\tthis.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","lineNo":77}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\nimport java.util.Calendar;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\n/**\n * @author Alberto Pc\n */\npublic class HSBC extends AbstractBanco implements Banco {\n\t/*\n\t * codigo cedente - Codigo do cedente fornecido pela empresa. - Campo numero\n\t * do documento - CNR(ate 13 posicoes) ou CNRFacil(ate 6 posicoes) - Campo\n\t * data de processamente nao preencher(sem registro) - Campo nosso\n\t * numero/codigo do documento - Nosso numero + 3 digitos\n\t * verificadores(1->modulo 11,2->tipoIdentificador,3->modulo 11) - Campo\n\t * carteira - Inserir CNR - Campo unidade cedente - Codigo e nome da agencia\n\t * cedente - Campo sacado - Linha 1 -> Nome e CPF/CNPJ, Linha2 -> Endereco\n\t * do sacado, Linha3 -> Cep,Distrito... - Campo carteira - inserir CNR\n\t * \n\t * \n\t * OBS: Data de processamento deve ser nulo(nessa sem registro)\n\t */\n\tpublic static final String LOCAL_PAGAMENTO = \"Pagar preferencialmente em agência do HSBC\";\n\tprivate static final String NUMERO_HSBC = \"399\";\n\tprivate static final String DIGITO_HSBC = \"9\";\n\tprivate static final String CODIGO_APLICATIVO = \"2\";\n\n\tprivate int getSegundoDigitoVerificador(Boleto boleto) {\n\t\t/*\n\t\t * estou deixando todo mundo com o mesmo numero de digitos do codigo\n\t\t * para facilitar no calculo.\n\t\t */\n\n\t\tint tipo = getTipoIdentificador(boleto);\n\t\tlong codigoDoDocumento = Long.parseLong(getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\t\tlong codigo = Long.valueOf(\"\" + codigoDoDocumento + getPrimeiroDigitoVerificador(boleto) + tipo);\n\t\tint codigoDoCedente = boleto.getEmissor().getCodigoFornecidoPelaAgencia();\n\n\t\tint resultado;\n\t\tString soma;\n\t\tif (tipo == 4) {\n\n\t\t\tint data = Integer.valueOf(String.format(\"%1$td%1$tm%1$ty\", boleto.getDatas().getVencimento()));\n\t\t\tsoma = String.format(\"%010d\", codigo + codigoDoCedente + data);\n\t\t} else {\n\t\t\tsoma = String.format(\"%010d\", codigo + codigoDoCedente);\n\t\t}\n\t\tresultado = 0;\n\t\tint i = 0;\n\t\tfor (int x : new int[] { 8, 9, 2, 3, 4, 5, 6, 7, 8, 9 }) {\n\t\t\tint parcela = x * (soma.charAt(i) - '0');\n\t\t\tresultado += parcela;\n\t\t\ti++;\n\t\t}\n\t\tresultado %= 11;\n\t\tresultado %= 10;\n\t\treturn resultado;\n\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_HSBC + \"-\" + DIGITO_HSBC;\n\t}\n\n\tpublic String getCodigoDoDocumentoFinalComDigitosVerificadores(Boleto boleto) {\n\t\treturn String.format(\"%s%d%d%d\", boleto.getNumeroDoDocumento(), getPrimeiroDigitoVerificador(boleto),\n\t\t\t\tgetTipoIdentificador(boleto), getSegundoDigitoVerificador(boleto));\n\t}\n\n\tprivate int getPrimeiroDigitoVerificador(Boleto boleto) {\n\t\treturn dvGenerator.geraDigitoMod11(getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\t}\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder digitosVerificadores = new StringBuilder();\n\t\tint primeiroDigitoVerificador = getPrimeiroDigitoVerificador(boleto);\n\t\tint tipo = getTipoIdentificador(boleto);\n\t\tint segundoDigitoVerificador = getSegundoDigitoVerificador(boleto);\n\t\tdigitosVerificadores.append(primeiroDigitoVerificador);\n\t\tdigitosVerificadores.append(tipo);\n\t\tdigitosVerificadores.append(segundoDigitoVerificador);\n\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(boleto.getCodigoEspecieMoeda());\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\t\t/*\n\t\t * codigo do cedente\n\t\t */\n\t\tcodigoDeBarras.append(String.format(\"%07d\", boleto.getEmissor().getCodigoFornecidoPelaAgencia()));\n\t\t/*\n\t\t * codigo do documento.\n\t\t */\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\n\t\t/*\n\t\t * não sei o que é retorno de tres digitos\n\t\t */\n\n\t\tcodigoDeBarras.append(getDataFormatoJuliano(boleto.getDatas().getVencimento(), tipo));\n\t\tcodigoDeBarras.append(HSBC.CODIGO_APLICATIVO);\n\t\tcodigoDeBarras.insert(4, dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\t\treturn codigoDeBarras.toString();\n\t}\n\n\tprivate int getTipoIdentificador(Boleto boleto) {\n\t\tint tipo = 4;\n\t\tif (boleto.getDatas().getVencimento() == null\n\t\t\t\t|| (boleto.getFatorVencimento() == null || boleto.getFatorVencimento().trim().equals(\"\"))) {\n\t\t\t// tipo = 5;\n\t\t\tthrow new IllegalArgumentException(\"Boletos do HSBC sem data de vencimento não são suportados.\");\n\t\t}\n\t\treturn tipo;\n\t}\n\n\t/**\n\t * @param vencimento\n\t *            vencimento do boleto\n\t * @param tipo\n\t *            tipo do identificador, 4 ou 5\n\t * @return data no formato Juliano\n\t */\n\tpublic String getDataFormatoJuliano(Calendar vencimento, int tipo) {\n\t\t/*\n\t\t * aqui tem outra verificação, que é o tal de um retorno de 3 dígitos\n\t\t * que ainda não identifiquei. Por enquanto, é tipo 4 eu estou\n\t\t * calculando.\n\t\t */\n\t\tString result;\n\t\tCalendar dataLimite = Calendar.getInstance();\n\t\tdataLimite.set(Calendar.DAY_OF_MONTH, 1);\n\t\tdataLimite.set(Calendar.MONTH, 7 - 1);\n\t\tdataLimite.set(Calendar.YEAR, 1997);\n\t\tif (vencimento.before(dataLimite)) {\n\t\t\tresult = \"0000\";\n\t\t} else {\n\t\t\tif (tipo == 4) {\n\t\t\t\t/*\n\t\t\t\t * http://java.sun.com/j2se/1.4.2/docs/api/java/util/\n\t\t\t\t * GregorianCalendar.html\n\t\t\t\t * \n\t\t\t\t * The only difference between the Gregorian and the Julian\n\t\t\t\t * calendar is the leap year rule. The Julian calendar specifies\n\t\t\t\t * leap years every four years, whereas the Gregorian calendar\n\t\t\t\t * omits century years which are not divisible by 400.\n\t\t\t\t * \n\t\t\t\t * A linha abaixo não funcionará corretamente apenas no ano de\n\t\t\t\t * 2100.\n\t\t\t\t */\n\t\t\t\tint diaDoAno = vencimento.get(Calendar.DAY_OF_YEAR);\n\t\t\t\tint digitoDoAno = vencimento.get(Calendar.YEAR) % 10;\n\t\t\t\tresult = String.format(\"%03d%d\", diaDoAno, digitoDoAno);\n\n\t\t\t} else if (tipo == 5) {\n\t\t\t\tresult = \"0000\";\n\t\t\t} else {\n\t\t\t\tthrow new IllegalArgumentException(\"Tipo inválido\");\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn \"CNR\";\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\treturn getClass().getResource(String.format(\"/br/com/caelum/stella/boleto/img/%s.png\", getNumeroFormatado()));\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%013d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn HSBC.NUMERO_HSBC;\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\nimport java.util.Calendar;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\npublic class HSBC extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_HSBC = \"399\";\n\tprivate static final String DIGITO_HSBC = \"9\";\n\tprivate static final String CODIGO_APLICATIVO = \"2\";\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_HSBC + \"-\" + DIGITO_HSBC;\n\t}\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\t\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(boleto.getCodigoEspecieMoeda());\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\t\tcodigoDeBarras.append(String.format(\"%07d\", boleto.getEmissor().getCodigoFornecidoPelaAgencia()));\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\t\tcodigoDeBarras.append(getDataFormatoJuliano(boleto.getDatas().getVencimento(), 4));\n\t\tcodigoDeBarras.append(HSBC.CODIGO_APLICATIVO);\n\t\tcodigoDeBarras.insert(4, dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\t\treturn codigoDeBarras.toString();\n\t}\n\n\tpublic String getDataFormatoJuliano(Calendar vencimento, int tipo) {\n\t\tString result;\n\t\tCalendar dataLimite = Calendar.getInstance();\n\t\tdataLimite.set(Calendar.DAY_OF_MONTH, 1);\n\t\tdataLimite.set(Calendar.MONTH, 7 - 1);\n\t\tdataLimite.set(Calendar.YEAR, 1997);\n\t\tif (vencimento.before(dataLimite)) {\n\t\t\tresult = \"0000\";\n\t\t} else {\n\t\t\tint diaDoAno = vencimento.get(Calendar.DAY_OF_YEAR);\n\t\t\tint digitoDoAno = vencimento.get(Calendar.YEAR) % 10;\n\t\t\tresult = String.format(\"%03d%d\", diaDoAno, digitoDoAno);\n\t\t}\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn \"CNR\";\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%016d\", emissor.getNossoNumero()).substring(0, 13);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn HSBC.NUMERO_HSBC;\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\t\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\treturn String.format(\"%016d\", emissor.getNossoNumero());\n\t}\n\t\n}\n","lineNo":65}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\nimport java.util.Calendar;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\n/**\n * @author Alberto Pc\n */\npublic class HSBC extends AbstractBanco implements Banco {\n\t/*\n\t * codigo cedente - Codigo do cedente fornecido pela empresa. - Campo numero\n\t * do documento - CNR(ate 13 posicoes) ou CNRFacil(ate 6 posicoes) - Campo\n\t * data de processamente nao preencher(sem registro) - Campo nosso\n\t * numero/codigo do documento - Nosso numero + 3 digitos\n\t * verificadores(1->modulo 11,2->tipoIdentificador,3->modulo 11) - Campo\n\t * carteira - Inserir CNR - Campo unidade cedente - Codigo e nome da agencia\n\t * cedente - Campo sacado - Linha 1 -> Nome e CPF/CNPJ, Linha2 -> Endereco\n\t * do sacado, Linha3 -> Cep,Distrito... - Campo carteira - inserir CNR\n\t * \n\t * \n\t * OBS: Data de processamento deve ser nulo(nessa sem registro)\n\t */\n\tpublic static final String LOCAL_PAGAMENTO = \"Pagar preferencialmente em agência do HSBC\";\n\tprivate static final String NUMERO_HSBC = \"399\";\n\tprivate static final String DIGITO_HSBC = \"9\";\n\tprivate static final String CODIGO_APLICATIVO = \"2\";\n\n\tprivate int getSegundoDigitoVerificador(Boleto boleto) {\n\t\t/*\n\t\t * estou deixando todo mundo com o mesmo numero de digitos do codigo\n\t\t * para facilitar no calculo.\n\t\t */\n\n\t\tint tipo = getTipoIdentificador(boleto);\n\t\tlong codigoDoDocumento = Long.parseLong(getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\t\tlong codigo = Long.valueOf(\"\" + codigoDoDocumento + getPrimeiroDigitoVerificador(boleto) + tipo);\n\t\tint codigoDoCedente = boleto.getEmissor().getCodigoFornecidoPelaAgencia();\n\n\t\tint resultado;\n\t\tString soma;\n\t\tif (tipo == 4) {\n\n\t\t\tint data = Integer.valueOf(String.format(\"%1$td%1$tm%1$ty\", boleto.getDatas().getVencimento()));\n\t\t\tsoma = String.format(\"%010d\", codigo + codigoDoCedente + data);\n\t\t} else {\n\t\t\tsoma = String.format(\"%010d\", codigo + codigoDoCedente);\n\t\t}\n\t\tresultado = 0;\n\t\tint i = 0;\n\t\tfor (int x : new int[] { 8, 9, 2, 3, 4, 5, 6, 7, 8, 9 }) {\n\t\t\tint parcela = x * (soma.charAt(i) - '0');\n\t\t\tresultado += parcela;\n\t\t\ti++;\n\t\t}\n\t\tresultado %= 11;\n\t\tresultado %= 10;\n\t\treturn resultado;\n\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_HSBC + \"-\" + DIGITO_HSBC;\n\t}\n\n\tpublic String getCodigoDoDocumentoFinalComDigitosVerificadores(Boleto boleto) {\n\t\treturn String.format(\"%s%d%d%d\", boleto.getNumeroDoDocumento(), getPrimeiroDigitoVerificador(boleto),\n\t\t\t\tgetTipoIdentificador(boleto), getSegundoDigitoVerificador(boleto));\n\t}\n\n\tprivate int getPrimeiroDigitoVerificador(Boleto boleto) {\n\t\treturn dvGenerator.geraDigitoMod11(getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\t}\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder digitosVerificadores = new StringBuilder();\n\t\tint primeiroDigitoVerificador = getPrimeiroDigitoVerificador(boleto);\n\t\tint tipo = getTipoIdentificador(boleto);\n\t\tint segundoDigitoVerificador = getSegundoDigitoVerificador(boleto);\n\t\tdigitosVerificadores.append(primeiroDigitoVerificador);\n\t\tdigitosVerificadores.append(tipo);\n\t\tdigitosVerificadores.append(segundoDigitoVerificador);\n\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(boleto.getCodigoEspecieMoeda());\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\t\t/*\n\t\t * codigo do cedente\n\t\t */\n\t\tcodigoDeBarras.append(String.format(\"%07d\", boleto.getEmissor().getCodigoFornecidoPelaAgencia()));\n\t\t/*\n\t\t * codigo do documento.\n\t\t */\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\n\t\t/*\n\t\t * não sei o que é retorno de tres digitos\n\t\t */\n\n\t\tcodigoDeBarras.append(getDataFormatoJuliano(boleto.getDatas().getVencimento(), tipo));\n\t\tcodigoDeBarras.append(HSBC.CODIGO_APLICATIVO);\n\t\tcodigoDeBarras.insert(4, dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\t\treturn codigoDeBarras.toString();\n\t}\n\n\tprivate int getTipoIdentificador(Boleto boleto) {\n\t\tint tipo = 4;\n\t\tif (boleto.getDatas().getVencimento() == null\n\t\t\t\t|| (boleto.getFatorVencimento() == null || boleto.getFatorVencimento().trim().equals(\"\"))) {\n\t\t\t// tipo = 5;\n\t\t\tthrow new IllegalArgumentException(\"Boletos do HSBC sem data de vencimento não são suportados.\");\n\t\t}\n\t\treturn tipo;\n\t}\n\n\t/**\n\t * @param vencimento\n\t *            vencimento do boleto\n\t * @param tipo\n\t *            tipo do identificador, 4 ou 5\n\t * @return data no formato Juliano\n\t */\n\tpublic String getDataFormatoJuliano(Calendar vencimento, int tipo) {\n\t\t/*\n\t\t * aqui tem outra verificação, que é o tal de um retorno de 3 dígitos\n\t\t * que ainda não identifiquei. Por enquanto, é tipo 4 eu estou\n\t\t * calculando.\n\t\t */\n\t\tString result;\n\t\tCalendar dataLimite = Calendar.getInstance();\n\t\tdataLimite.set(Calendar.DAY_OF_MONTH, 1);\n\t\tdataLimite.set(Calendar.MONTH, 7 - 1);\n\t\tdataLimite.set(Calendar.YEAR, 1997);\n\t\tif (vencimento.before(dataLimite)) {\n\t\t\tresult = \"0000\";\n\t\t} else {\n\t\t\tif (tipo == 4) {\n\t\t\t\t/*\n\t\t\t\t * http://java.sun.com/j2se/1.4.2/docs/api/java/util/\n\t\t\t\t * GregorianCalendar.html\n\t\t\t\t * \n\t\t\t\t * The only difference between the Gregorian and the Julian\n\t\t\t\t * calendar is the leap year rule. The Julian calendar specifies\n\t\t\t\t * leap years every four years, whereas the Gregorian calendar\n\t\t\t\t * omits century years which are not divisible by 400.\n\t\t\t\t * \n\t\t\t\t * A linha abaixo não funcionará corretamente apenas no ano de\n\t\t\t\t * 2100.\n\t\t\t\t */\n\t\t\t\tint diaDoAno = vencimento.get(Calendar.DAY_OF_YEAR);\n\t\t\t\tint digitoDoAno = vencimento.get(Calendar.YEAR) % 10;\n\t\t\t\tresult = String.format(\"%03d%d\", diaDoAno, digitoDoAno);\n\n\t\t\t} else if (tipo == 5) {\n\t\t\t\tresult = \"0000\";\n\t\t\t} else {\n\t\t\t\tthrow new IllegalArgumentException(\"Tipo inválido\");\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn \"CNR\";\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\treturn getClass().getResource(String.format(\"/br/com/caelum/stella/boleto/img/%s.png\", getNumeroFormatado()));\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%013d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn HSBC.NUMERO_HSBC;\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\nimport java.util.Calendar;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\npublic class HSBC extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_HSBC = \"399\";\n\tprivate static final String DIGITO_HSBC = \"9\";\n\tprivate static final String CODIGO_APLICATIVO = \"2\";\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_HSBC + \"-\" + DIGITO_HSBC;\n\t}\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\t\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(boleto.getCodigoEspecieMoeda());\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\t\tcodigoDeBarras.append(String.format(\"%07d\", boleto.getEmissor().getCodigoFornecidoPelaAgencia()));\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\t\tcodigoDeBarras.append(getDataFormatoJuliano(boleto.getDatas().getVencimento(), 4));\n\t\tcodigoDeBarras.append(HSBC.CODIGO_APLICATIVO);\n\t\tcodigoDeBarras.insert(4, dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\t\treturn codigoDeBarras.toString();\n\t}\n\n\tpublic String getDataFormatoJuliano(Calendar vencimento, int tipo) {\n\t\tString result;\n\t\tCalendar dataLimite = Calendar.getInstance();\n\t\tdataLimite.set(Calendar.DAY_OF_MONTH, 1);\n\t\tdataLimite.set(Calendar.MONTH, 7 - 1);\n\t\tdataLimite.set(Calendar.YEAR, 1997);\n\t\tif (vencimento.before(dataLimite)) {\n\t\t\tresult = \"0000\";\n\t\t} else {\n\t\t\tint diaDoAno = vencimento.get(Calendar.DAY_OF_YEAR);\n\t\t\tint digitoDoAno = vencimento.get(Calendar.YEAR) % 10;\n\t\t\tresult = String.format(\"%03d%d\", diaDoAno, digitoDoAno);\n\t\t}\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn \"CNR\";\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%016d\", emissor.getNossoNumero()).substring(0, 13);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn HSBC.NUMERO_HSBC;\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getCodigoFornecidoPelaAgencia());\n\t}\n\t\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\treturn String.format(\"%016d\", emissor.getNossoNumero());\n\t}\n\t\n}\n","lineNo":66}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport static org.junit.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport java.io.IOException;\n\nimport org.junit.Assert;\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class HSBCTest {\n\tprivate Boleto boleto;\n\tprivate Banco banco;\n\t/*\n\t * no documento informa, que a carteira deve ser CNR\n\t */\n\tprivate int carteiraSimbolica = 0;\n\n\t@Before\n\tpublic void setUp() {\n\n\t\tDatas datas = Datas.newDatas().withDocumento(03, 7, 2000).withVencimento(04, 7, 2000);\n\n\t\tEmissor emissor = Emissor.newEmissor().withCedente(\"Alberto\").withAgencia(501).withContaCorrente(6703255)\n\t\t\t\t.withNossoNumero(39104766).withCodigoFornecidoPelaAgencia(351202).withCarteira(carteiraSimbolica);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\").withCidade(\"Salvador\").withBairro(\"Rio Vermelho\")\n\t\t\t\t.withCep(\"40000000\").withEndereco(\"Endereco em salvador\").withCpf(\"94312885087\").withUf(\"BA\");\n\n\t\tthis.banco = new HSBC();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"1200.00\").withNumeroDoDocumento(\"39104766\");\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoHSBC() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\n\t\tassertEquals(\"39990.35128  02000.003919  04766.186029  3  10010000120000\",\n\t\t\t\tnew GeradorDeLinhaDigitavel().geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testDataJuliana() {\n\t\tHSBC hsbc = (HSBC) banco;\n\t\tAssert.assertEquals(\"1860\", hsbc.getDataFormatoJuliano(boleto.getDatas().getVencimento(), 4));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoHSBC() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tassertEquals(\"39993100100001200000351202000003910476618602\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() throws IOException {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport static org.junit.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport java.io.IOException;\nimport java.util.Calendar;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class HSBCTest {\n\t\n\tprivate Boleto boleto;\n\tprivate HSBC banco = new HSBC();\n\n\t@Before\n\tpublic void setUp() {\n\n\t\tDatas datas = Datas.newDatas().withDocumento(28,1,2013)\n\t\t\t\t.withProcessamento(29,1,2013).withVencimento(30,1,2013);\n\n\t\tEmissor emissor = Emissor.newEmissor().withCedente(\"Rodrigo Turini\")\n\t\t\t.withCodigoFornecidoPelaAgencia(4146239).withNossoNumero(1476147);\n\n\t    Sacado sacado = Sacado.newSacado().withNome(\"Paulo Silveira\");\n\t\t\n\t    this.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(emissor)\n\t    \t.withBanco(this.banco).withSacado(sacado).withValorBoleto(3383.00)\n\t    \t.withNumeroDoDocumento(\"0789201\");\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoHSBC() {\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\t\tassertEquals(\"39994.14620  39000.000008  01476.030323  2  55940000338300\",\n\t\t\tnew GeradorDeLinhaDigitavel().geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testDataJuliana() {\n\t\tCalendar vencimento = boleto.getDatas().getVencimento();\n\t\tassertEquals(\"0303\", banco.getDataFormatoJuliano(vencimento, 4));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoHSBC() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tString codigoDeBarras = this.banco.geraCodigoDeBarrasPara(this.boleto);\n\t\tassertEquals(\"39992559400003383004146239000000000147603032\", codigoDeBarras);\n\t}\n\n\t@Test\n\tpublic void testGetImage() throws IOException {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","lineNo":54}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\n\npublic class Itau extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_ITAU = \"341\";\n\tprivate static final String DIGITO_ITAU = \"7\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\t// Digito Verificador sera inserido aqui.\n\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\n\t\tEmissor emissor = boleto.getEmissor();\n\n\t\tcodigoDeBarras.append(getCarteiraDoEmissorFormatado(emissor));\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t// Digito Verificador sera inserido aqui.\n\n\t\tcodigoDeBarras.append(emissor.getAgenciaFormatado());\n\t\tcodigoDeBarras.append(getContaCorrenteDoEmissorFormatado(emissor));\n\t\t// Digito Verificador sera inserido aqui.\n\n\t\tcodigoDeBarras.append(\"000\");\n\n\t\tcodigoDeBarras.insert(38, this.dvGenerator.geraDigitoMod10(codigoDeBarras.substring(30, 38)));\n\n\t\tcodigoDeBarras.insert(\n\t\t\t\t29,\n\t\t\t\tthis.dvGenerator.geraDigitoMod10(codigoDeBarras.substring(30, 38).concat(\n\t\t\t\t\t\tcodigoDeBarras.substring(18, 28))));\n\n\t\tcodigoDeBarras.insert(4, this.dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\n\t\tString result = codigoDeBarras.toString();\n\n\t\tif (result.length() != 44) {\n\t\t\tthrow new CriacaoBoletoException(\n\t\t\t\t\t\"Erro na geração do código de barras. Número de digitos diferente de 44. Verifique todos os dados.\");\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_ITAU + \"-\" + DIGITO_ITAU;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%03d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%05d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\treturn getClass().getResource(String.format(\"/br/com/caelum/stella/boleto/img/%s.png\", getNumeroFormatado()));\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_ITAU;\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\n\npublic class Itau extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_ITAU = \"341\";\n\tprivate static final String DIGITO_ITAU = \"7\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\t\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\t\tcodigoDeBarras.append(getCarteiraDoEmissorFormatado(emissor));\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcodigoDeBarras.append(emissor.getAgenciaFormatado());\n\t\tcodigoDeBarras.append(getContaCorrenteDoEmissorFormatado(emissor)).append(\"000\");\n\n\t\tcodigoDeBarras.insert(38, this.dvGenerator\n\t\t\t\t.geraDigitoMod10(codigoDeBarras.substring(30, 38)));\n\n\t\tcodigoDeBarras.insert(29, this.dvGenerator\n\t\t\t\t.geraDigitoMod10(codigoDeBarras.substring(30, 38)\n\t\t\t\t\t\t.concat(codigoDeBarras.substring(18, 29))));\n\n\t\tcodigoDeBarras.insert(4, this.dvGenerator\n\t\t\t\t.geraDigitoMod11(codigoDeBarras.toString()));\n\n\t\tString codigoDeBarrasGerado = codigoDeBarras.toString();\n\n\t\tif (codigoDeBarrasGerado.length() != 44) {\n\t\t\tthrow new CriacaoBoletoException(\"Erro na geração do código de barras. \" +\n\t\t\t\t\t\"Número de digitos diferente de 44. Verifique todos os dados.\");\n\t\t}\n\t\treturn codigoDeBarrasGerado;\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(getNumeroFormatado()).append(\"-\");\n\t\treturn builder.append(DIGITO_ITAU).toString();\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%03d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%05d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getNossoNumero());\n\t}\n\t\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\tString valor = super.getNossoNumeroECodDocumento(emissor);\n\t\treturn valor.concat(\"-\").concat(emissor.getDigitoNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_ITAU;\n\t}\n\t\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(emissor.getAgenciaFormatado()).append(\"/\");\n\t\tbuilder.append(getContaCorrenteDoEmissorFormatado(emissor));\n\t\tbuilder.append(\"-\").append(emissor.getDigitoContaCorrente());\n\t\treturn builder.toString();\n\t}\n}\n","lineNo":67}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\n\npublic class Itau extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_ITAU = \"341\";\n\tprivate static final String DIGITO_ITAU = \"7\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\t// Digito Verificador sera inserido aqui.\n\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\n\t\tEmissor emissor = boleto.getEmissor();\n\n\t\tcodigoDeBarras.append(getCarteiraDoEmissorFormatado(emissor));\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\t// Digito Verificador sera inserido aqui.\n\n\t\tcodigoDeBarras.append(emissor.getAgenciaFormatado());\n\t\tcodigoDeBarras.append(getContaCorrenteDoEmissorFormatado(emissor));\n\t\t// Digito Verificador sera inserido aqui.\n\n\t\tcodigoDeBarras.append(\"000\");\n\n\t\tcodigoDeBarras.insert(38, this.dvGenerator.geraDigitoMod10(codigoDeBarras.substring(30, 38)));\n\n\t\tcodigoDeBarras.insert(\n\t\t\t\t29,\n\t\t\t\tthis.dvGenerator.geraDigitoMod10(codigoDeBarras.substring(30, 38).concat(\n\t\t\t\t\t\tcodigoDeBarras.substring(18, 28))));\n\n\t\tcodigoDeBarras.insert(4, this.dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\n\t\tString result = codigoDeBarras.toString();\n\n\t\tif (result.length() != 44) {\n\t\t\tthrow new CriacaoBoletoException(\n\t\t\t\t\t\"Erro na geração do código de barras. Número de digitos diferente de 44. Verifique todos os dados.\");\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_ITAU + \"-\" + DIGITO_ITAU;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%03d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%05d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\treturn getClass().getResource(String.format(\"/br/com/caelum/stella/boleto/img/%s.png\", getNumeroFormatado()));\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_ITAU;\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\n\npublic class Itau extends AbstractBanco implements Banco {\n\n\tprivate static final String NUMERO_ITAU = \"341\";\n\tprivate static final String DIGITO_ITAU = \"7\";\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\t\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(getNumeroFormatado());\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\t\tcodigoDeBarras.append(getCarteiraDoEmissorFormatado(emissor));\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcodigoDeBarras.append(emissor.getAgenciaFormatado());\n\t\tcodigoDeBarras.append(getContaCorrenteDoEmissorFormatado(emissor)).append(\"000\");\n\n\t\tcodigoDeBarras.insert(38, this.dvGenerator\n\t\t\t\t.geraDigitoMod10(codigoDeBarras.substring(30, 38)));\n\n\t\tcodigoDeBarras.insert(29, this.dvGenerator\n\t\t\t\t.geraDigitoMod10(codigoDeBarras.substring(30, 38)\n\t\t\t\t\t\t.concat(codigoDeBarras.substring(18, 29))));\n\n\t\tcodigoDeBarras.insert(4, this.dvGenerator\n\t\t\t\t.geraDigitoMod11(codigoDeBarras.toString()));\n\n\t\tString codigoDeBarrasGerado = codigoDeBarras.toString();\n\n\t\tif (codigoDeBarrasGerado.length() != 44) {\n\t\t\tthrow new CriacaoBoletoException(\"Erro na geração do código de barras. \" +\n\t\t\t\t\t\"Número de digitos diferente de 44. Verifique todos os dados.\");\n\t\t}\n\t\treturn codigoDeBarrasGerado;\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(getNumeroFormatado()).append(\"-\");\n\t\treturn builder.append(DIGITO_ITAU).toString();\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%03d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%05d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\tString arquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(arquivo, getNumeroFormatado());\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%08d\", emissor.getNossoNumero());\n\t}\n\t\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\tString valor = super.getNossoNumeroECodDocumento(emissor);\n\t\treturn valor.concat(\"-\").concat(emissor.getDigitoNossoNumero());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_ITAU;\n\t}\n\t\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(emissor.getAgenciaFormatado()).append(\"/\");\n\t\tbuilder.append(getContaCorrenteDoEmissorFormatado(emissor));\n\t\tbuilder.append(\"-\").append(emissor.getDigitoContaCorrente());\n\t\treturn builder.toString();\n\t}\n}\n","lineNo":68}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class ItauTest {\n\tprivate Boleto boleto;\n\tprivate Itau banco;\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\tDatas datas = Datas.newDatas().withDocumento(31, 5, 2006).withProcessamento(31, 5, 2006)\n\t\t\t\t.withVencimento(10, 6, 2006);\n\n\t\tthis.emissor = Emissor.newEmissor().withCedente(\"Caue Guerra\").withAgencia(2949).withDigitoAgencia('1')\n\t\t\t\t.withContaCorrente(6580).withNumeroConvenio(1207113).withDigitoContaCorrente('3').withCarteira(6)\n\t\t\t\t.withNossoNumero(3);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\");\n\n\t\tthis.banco = new Itau();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(this.emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"1.00\").withNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerOitoDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNossoNumero(9000206);\n\t\tString numeroFormatado = this.banco.getNossoNumeroDoEmissorFormatado(emissor);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"09000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerTresDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(3, numeroFormatado.length());\n\t\tassertEquals(\"001\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerCincoDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(5, numeroFormatado.length());\n\t\tassertEquals(\"06580\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoItau() {\n\t\tthis.banco = new Itau();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tGeradorDeLinhaDigitavel linhaDigitavelGenerator = new GeradorDeLinhaDigitavel();\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\n\t\tassertEquals(\"34190.06006  00000.332940  90658.090007  9  31680000000100\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoItau() {\n\t\tthis.banco = new Itau();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"34199316800000001000060000000332949065809000\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class ItauTest {\n\t\n\tprivate Boleto boleto;\n\tprivate Itau banco = new Itau();\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\t\n\t    Datas datas = Datas.newDatas().withDocumento(20, 03, 2013)\n\t            .withProcessamento(20, 03, 2013).withVencimento(01, 04, 2013);  \n\n\t\t    this.emissor = Emissor.newEmissor().withCedente(\"Rodrigo Turini\")\n\t            .withAgencia(167).withCarteira(157).withContaCorrente(45145)\n\t            .withNossoNumero(21897666l).withDigitoNossoNumero(\"6\");  \n\n\t\t    Sacado sacado = Sacado.newSacado().withNome(\"Paulo Silveira\");\n\t\t    \n\t\t    this.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(emissor)\n\t\t    \t.withBanco(banco).withSacado(sacado).withValorBoleto(2680.16)\n\t\t    \t.withNumeroDoDocumento(\"575\");\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerOitoDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNossoNumero(9000206);\n\t\tString numeroFormatado = this.banco.getNossoNumeroDoEmissorFormatado(emissor);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"09000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerTresDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(3, numeroFormatado.length());\n\t\tassertEquals(\"001\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerCincoDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(5, numeroFormatado.length());\n\t\tassertEquals(\"45145\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoItau() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tGeradorDeLinhaDigitavel gerador = new GeradorDeLinhaDigitavel();\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\t\tString linha = \"34191.57213  89766.660164  74514.590004  6  56550000268016\";\n\t\tassertEquals(linha, gerador.geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoItau() {\n\t\tString codigoDeBarras = this.banco.geraCodigoDeBarrasPara(this.boleto);\n\t\tassertEquals(\"34196565500002680161572189766660167451459000\", codigoDeBarras);\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","lineNo":65}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class ItauTest {\n\tprivate Boleto boleto;\n\tprivate Itau banco;\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\tDatas datas = Datas.newDatas().withDocumento(31, 5, 2006).withProcessamento(31, 5, 2006)\n\t\t\t\t.withVencimento(10, 6, 2006);\n\n\t\tthis.emissor = Emissor.newEmissor().withCedente(\"Caue Guerra\").withAgencia(2949).withDigitoAgencia('1')\n\t\t\t\t.withContaCorrente(6580).withNumeroConvenio(1207113).withDigitoContaCorrente('3').withCarteira(6)\n\t\t\t\t.withNossoNumero(3);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\");\n\n\t\tthis.banco = new Itau();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(this.emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"1.00\").withNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerOitoDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNossoNumero(9000206);\n\t\tString numeroFormatado = this.banco.getNossoNumeroDoEmissorFormatado(emissor);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"09000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerTresDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(3, numeroFormatado.length());\n\t\tassertEquals(\"001\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerCincoDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(5, numeroFormatado.length());\n\t\tassertEquals(\"06580\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoItau() {\n\t\tthis.banco = new Itau();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tGeradorDeLinhaDigitavel linhaDigitavelGenerator = new GeradorDeLinhaDigitavel();\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\n\t\tassertEquals(\"34190.06006  00000.332940  90658.090007  9  31680000000100\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoItau() {\n\t\tthis.banco = new Itau();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"34199316800000001000060000000332949065809000\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class ItauTest {\n\t\n\tprivate Boleto boleto;\n\tprivate Itau banco = new Itau();\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\t\n\t    Datas datas = Datas.newDatas().withDocumento(20, 03, 2013)\n\t            .withProcessamento(20, 03, 2013).withVencimento(01, 04, 2013);  \n\n\t\t    this.emissor = Emissor.newEmissor().withCedente(\"Rodrigo Turini\")\n\t            .withAgencia(167).withCarteira(157).withContaCorrente(45145)\n\t            .withNossoNumero(21897666l).withDigitoNossoNumero(\"6\");  \n\n\t\t    Sacado sacado = Sacado.newSacado().withNome(\"Paulo Silveira\");\n\t\t    \n\t\t    this.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(emissor)\n\t\t    \t.withBanco(banco).withSacado(sacado).withValorBoleto(2680.16)\n\t\t    \t.withNumeroDoDocumento(\"575\");\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerOitoDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNossoNumero(9000206);\n\t\tString numeroFormatado = this.banco.getNossoNumeroDoEmissorFormatado(emissor);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"09000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerTresDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(3, numeroFormatado.length());\n\t\tassertEquals(\"001\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerCincoDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(5, numeroFormatado.length());\n\t\tassertEquals(\"45145\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoItau() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tGeradorDeLinhaDigitavel gerador = new GeradorDeLinhaDigitavel();\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\t\tString linha = \"34191.57213  89766.660164  74514.590004  6  56550000268016\";\n\t\tassertEquals(linha, gerador.geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoItau() {\n\t\tString codigoDeBarras = this.banco.geraCodigoDeBarrasPara(this.boleto);\n\t\tassertEquals(\"34196565500002680161572189766660167451459000\", codigoDeBarras);\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","lineNo":71}
{"Smelly Sample":"package br.com.caelum.stella.inwords;\n\nimport java.text.DecimalFormat;\nimport java.text.DecimalFormatSymbols;\nimport java.util.MissingResourceException;\n\n/**\n * Responsável por transformar um número em sua representação por extenso.\n * \n * @author Victor dos Santos Pereira\n * @author Leonardo Bessa\n * \n */\npublic class NumericToWordsConverter {\n\n    private final FormatoDeExtenso formato;\n\n    /**\n     * @param formato\n     *            formato desejado para a transfomação por extenso\n     */\n    public NumericToWordsConverter(FormatoDeExtenso formato) {\n        this.formato = formato;\n    }\n\n    /**\n     * @param number\n     *            número a ser transformado\n     * @return Representação do número por extenso.\n     */\n    public String toWords(long number) {\n        try {\n            if (number < 0) {\n                throw new IllegalArgumentException(\"Não é possível transforma número negativos.\");\n            }\n            StringBuffer result = new StringBuffer();\n            if (number == 0) {\n                result.append(getNumber(0));\n            } else {\n                DecimalFormatSymbols symbols = new DecimalFormatSymbols();\n                symbols.setGroupingSeparator(',');\n                symbols.setDecimalSeparator('.');\n                DecimalFormat formatter = new DecimalFormat(\"###,###\", symbols);\n                String formattedInt = formatter.format(number);\n                String[] ints = formattedInt.split(\"[,]\");\n                ThousandBlock[] blocks = new ThousandBlock[ints.length];\n                for (int i = 0; i < blocks.length; i++) {\n                    String block = ints[i];\n                    blocks[i] = new ThousandBlock(block);\n                }\n\n                appendIntegers(result, blocks);\n                appendIntegersUnits(number, result, blocks);\n            }\n            return result.toString();\n        } catch (MissingResourceException e) {\n            throw new IllegalArgumentException(\"Número muito grande para ser transformado em extenso.\");\n        }\n    }\n\n    /**\n     * @param number\n     *            número a ser transformado\n     * @return Representação do número por extenso.\n     */\n    public String toWords(double number) {\n        try {\n            if (number < 0) {\n                throw new IllegalArgumentException(\"Não é possível transforma número negativos.\");\n            }\n            StringBuffer result = new StringBuffer();\n            if (number == 0) {\n                result.append(getNumber(0));\n            } else {\n\n                String[] parts = split(number);\n                String formattedInt = parts[0];\n                String[] ints = formattedInt.split(\"[,]\");\n                ThousandBlock[] blocks = new ThousandBlock[ints.length];\n                for (int i = 0; i < blocks.length; i++) {\n                    String block = ints[i];\n                    blocks[i] = new ThousandBlock(block);\n                }\n                String formattedMod = parts[1];\n                ThousandBlock modBlock = new ThousandBlock(formattedMod);\n\n                boolean hasMod = !modBlock.isZero();\n                boolean hasInteger = (blocks.length > 1) || (!blocks[blocks.length - 1].isZero());\n\n                if (hasInteger) {\n                    appendIntegers(result, blocks);\n                    appendIntegersUnits(number, result, blocks);\n                }\n                if (hasInteger && hasMod) {\n                    result.append(getAndSeparator());\n                }\n                if (hasMod) {\n                    appendIntegers(result, modBlock);\n                    appendDecimalUnits(result, modBlock);\n                }\n            }\n            return result.toString();\n        } catch (MissingResourceException e) {\n            throw new IllegalArgumentException(\"Número muito grande para ser transformado em extenso.\");\n        }\n    }\n\n    private void appendDecimalUnits(StringBuffer result, ThousandBlock modBlock) {\n        result.append(\" \");\n        if (modBlock.isUnitary()) {\n            result.append(formato.getUnidadeDecimalNoSingular());\n        } else {\n            result.append(formato.getUnidadeDecimalNoPlural());\n        }\n    }\n\n    private String[] split(double number) {\n        final StringBuffer pattern = new StringBuffer();\n        pattern.append(\"###,000.\");\n        for (int i = 1; i <= formato.getCasasDecimais(); i++) {\n            pattern.append(\"0\");\n        }\n        DecimalFormatSymbols symbols = new DecimalFormatSymbols();\n        symbols.setGroupingSeparator(',');\n        symbols.setDecimalSeparator('.');\n        DecimalFormat decimalFormat = new DecimalFormat(pattern.toString(), symbols);\n        String formatted = decimalFormat.format(number);\n        String[] parts = formatted.split(\"[.]\");\n        return parts;\n    }\n\n    private void appendIntegersUnits(double number, StringBuffer result, ThousandBlock[] blocks) {\n        if (blocks.length != 1 || !blocks[0].isZero()) {\n            result.append(\" \");\n            if (number >= 2) {\n                int length = blocks.length;\n                if (length > 2 && blocks[length - 1].isZero() && blocks[length - 2].isZero()) {\n                    result.append(\"de \");\n                }\n                result.append(formato.getUnidadeInteiraNoPlural());\n            } else {\n                result.append(formato.getUnidadeInteiraNoSingular());\n            }\n        }\n    }\n\n    private void appendIntegers(StringBuffer result, ThousandBlock... blocks) {\n        boolean hasStarted = false;\n        for (int i = 0; i < blocks.length; i++) {\n            ThousandBlock thousandBlock = blocks[i];\n            if (!(hasStarted && thousandBlock.isZero())) {\n                int thousandPower = (blocks.length - i - 1);\n                if (hasStarted) {\n                    if (thousandBlock.isUnitary()) {\n                        result.append(getAndSeparator());\n                    } else {\n                        if (thousandPower < 1) {\n                            result.append(getAndSeparator());\n                        } else {\n                            result.append(getThousandSeparator());\n                        }\n                    }\n                }\n\n                result.append(thousandBlock.toWords());\n\n                if (thousandPower > 0) {\n                    result.append(\" \");\n                    result.append(this.getString(\"1e\" + 3 * thousandPower + \".\"\n                            + (thousandBlock.isUnitary() ? \"singular\" : \"plural\")));\n                }\n                hasStarted = true;\n            }\n        }\n    }\n\n    private final class ThousandBlock {\n\n        private int numberValue;\n\n        public ThousandBlock(String number) {\n            super();\n            if (number.length() > 3) {\n                throw new IllegalArgumentException(\"ThousandBlock deve conter numeros\" + \" de no maximo 3 digitos.\");\n            }\n            this.numberValue = Integer.parseInt(number);\n        }\n\n        public boolean isZero() {\n            return numberValue == 0;\n        }\n\n        public boolean isUnitary() {\n            return numberValue == 1;\n        }\n\n        public String toWords() {\n            String result;\n            if (numberValue <= 20) {\n                result = NumericToWordsConverter.this.getNumber(numberValue);\n            } else if (numberValue <= 99) {\n                result = getNumberUnder100(numberValue);\n            } else if (numberValue == 100) {\n                result = NumericToWordsConverter.this.getNumber(100);\n            } else {\n                int c = (numberValue / 100) * 100;\n                String centena;\n                if (c == 100) {\n                    centena = NumericToWordsConverter.this.getString(\"100+?\");\n                } else {\n                    centena = NumericToWordsConverter.this.getNumber(c);\n                }\n                int resto = numberValue % 100;\n                if (resto == 0) {\n                    result = centena;\n                } else {\n                    result = centena + getAndSeparator() + getNumberUnder100(resto);\n                }\n            }\n            return result;\n        }\n\n        private String getNumberUnder100(int number) {\n            String result = null;\n            if (number <= 20) {\n                result = getNumber(number);\n            } else if (number <= 99) {\n                int d = number / 10;\n                int u = number % 10;\n                String dezena = getNumber(d * 10);\n                if (u == 0) {\n                    result = dezena;\n                } else {\n                    String unidade = getNumber(u);\n                    result = dezena + getAndSeparator() + unidade;\n                }\n            }\n            return result;\n        }\n\n    }\n\n    private String getThousandSeparator() {\n        return getString(\"sep.mil\");\n    }\n\n    private String getAndSeparator() {\n        return getString(\"sep\");\n    }\n\n    private String getString(String paramMessage) {\n        return Messages.getString(\"Extenso.\" + paramMessage);\n    }\n\n    private String getNumber(int number) {\n        DecimalFormat formater = new DecimalFormat(\"000\");\n        String formatted = formater.format(number);\n        return Messages.getString(\"Extenso.\" + formatted);\n    }\n}\n","Method after Refactoring":"package br.com.caelum.stella.inwords;\n\nimport java.text.DecimalFormat;\nimport java.text.DecimalFormatSymbols;\nimport java.util.MissingResourceException;\n\n/**\n * Responsável por transformar um número em sua representação por extenso.\n * \n * @author Victor dos Santos Pereira\n * @author Leonardo Bessa\n * \n */\npublic class NumericToWordsConverter {\n\n    private final FormatoDeExtenso formato;\n\n    /**\n     * @param formato\n     *            formato desejado para a transfomação por extenso\n     */\n    public NumericToWordsConverter(FormatoDeExtenso formato) {\n        this.formato = formato;\n    }\n\n    /**\n     * @param number\n     *            número a ser transformado\n     * @return Representação do número por extenso.\n     */\n    public String toWords(long number) {\n        try {\n            if (number < 0) {\n                throw new IllegalArgumentException(\"Não é possível transformar números negativos.\");\n            }\n            StringBuffer result = new StringBuffer();\n            if (number == 0) {\n                result.append(getNumber(0));\n            } else {\n                DecimalFormatSymbols symbols = new DecimalFormatSymbols();\n                symbols.setGroupingSeparator(',');\n                symbols.setDecimalSeparator('.');\n                DecimalFormat formatter = new DecimalFormat(\"###,###\", symbols);\n                String formattedInt = formatter.format(number);\n                String[] ints = formattedInt.split(\"[,]\");\n                ThousandBlock[] blocks = new ThousandBlock[ints.length];\n                for (int i = 0; i < blocks.length; i++) {\n                    String block = ints[i];\n                    blocks[i] = new ThousandBlock(block);\n                }\n\n                appendIntegers(result, blocks);\n                appendIntegersUnits(number, result, blocks);\n            }\n            return result.toString();\n        } catch (MissingResourceException e) {\n            throw new IllegalArgumentException(\"Número muito grande para ser transformado em extenso.\");\n        }\n    }\n\n    /**\n     * @param number\n     *            número a ser transformado\n     * @return Representação do número por extenso.\n     */\n    public String toWords(double number) {\n        try {\n            if (number < 0) {\n                throw new IllegalArgumentException(\"Não é possível transformar números negativos.\");\n            }\n            StringBuffer result = new StringBuffer();\n            if (number == 0) {\n                result.append(getNumber(0));\n            } else {\n\n                String[] parts = split(number);\n                String formattedInt = parts[0];\n                String[] ints = formattedInt.split(\"[,]\");\n                ThousandBlock[] blocks = new ThousandBlock[ints.length];\n                for (int i = 0; i < blocks.length; i++) {\n                    String block = ints[i];\n                    blocks[i] = new ThousandBlock(block);\n                }\n                String formattedMod = parts[1];\n                ThousandBlock modBlock = new ThousandBlock(formattedMod);\n\n                boolean hasMod = !modBlock.isZero();\n                boolean hasInteger = (blocks.length > 1) || (!blocks[blocks.length - 1].isZero());\n\n                if (hasInteger) {\n                    appendIntegers(result, blocks);\n                    appendIntegersUnits(number, result, blocks);\n                }\n                if (hasInteger && hasMod) {\n                    result.append(getAndSeparator());\n                }\n                if (hasMod) {\n                    appendIntegers(result, modBlock);\n                    appendDecimalUnits(result, modBlock);\n                }\n            }\n            return result.toString();\n        } catch (MissingResourceException e) {\n            throw new IllegalArgumentException(\"Número muito grande para ser transformado em extenso.\");\n        }\n    }\n\n    private void appendDecimalUnits(StringBuffer result, ThousandBlock modBlock) {\n        result.append(\" \");\n        if (modBlock.isUnitary()) {\n            result.append(formato.getUnidadeDecimalNoSingular());\n        } else {\n            result.append(formato.getUnidadeDecimalNoPlural());\n        }\n    }\n\n    private String[] split(double number) {\n        final StringBuffer pattern = new StringBuffer();\n        pattern.append(\"###,000.\");\n        for (int i = 1; i <= formato.getCasasDecimais(); i++) {\n            pattern.append(\"0\");\n        }\n        DecimalFormatSymbols symbols = new DecimalFormatSymbols();\n        symbols.setGroupingSeparator(',');\n        symbols.setDecimalSeparator('.');\n        DecimalFormat decimalFormat = new DecimalFormat(pattern.toString(), symbols);\n        String formatted = decimalFormat.format(number);\n        String[] parts = formatted.split(\"[.]\");\n        if(formato.getCasasDecimais()==0) {\n        \tparts = new String[]{parts[0], \"0\"};\n        }\n        return parts;\n    }\n\n    private void appendIntegersUnits(double number, StringBuffer result, ThousandBlock[] blocks) {\n        if (blocks.length != 1 || !blocks[0].isZero()) {\n            if (number >= 2) {\n                String unit = formato.getUnidadeInteiraNoPlural();\n                if(unit!=null && !unit.isEmpty() ) {\n                    result.append(\" \");\n                int length = blocks.length;\n                if (length > 2 && blocks[length - 1].isZero() && blocks[length - 2].isZero()) {\n                    result.append(\"de \");\n                }\n                \tresult.append(unit);\n                }\n            } else {\n                String unit = formato.getUnidadeInteiraNoSingular();\n                if(unit!=null && !unit.isEmpty() ) {\n                    result.append(\" \").append(unit);\n                }\n            }\n        }\n    }\n\n    private void appendIntegers(StringBuffer result, ThousandBlock... blocks) {\n        boolean hasStarted = false;\n        for (int i = 0; i < blocks.length; i++) {\n            ThousandBlock thousandBlock = blocks[i];\n            if (!(hasStarted && thousandBlock.isZero())) {\n                int thousandPower = (blocks.length - i - 1);\n                if (hasStarted) {\n                    if (thousandBlock.isUnitary()) {\n                        result.append(getAndSeparator());\n                    } else {\n                        if (thousandPower < 1) {\n                            result.append(getAndSeparator());\n                        } else {\n                            result.append(getThousandSeparator());\n                        }\n                    }\n                }\n\n                result.append(thousandBlock.toWords());\n\n                if (thousandPower > 0) {\n                    result.append(\" \");\n                    result.append(this.getString(\"1e\" + 3 * thousandPower + \".\"\n                            + (thousandBlock.isUnitary() ? \"singular\" : \"plural\")));\n                }\n                hasStarted = true;\n            }\n        }\n    }\n\n    private final class ThousandBlock {\n\n        private int numberValue;\n\n        public ThousandBlock(String number) {\n            super();\n            if (number.length() > 3) {\n                throw new IllegalArgumentException(\"ThousandBlock deve conter numeros\" + \" de no maximo 3 digitos.\");\n            }\n            this.numberValue = Integer.parseInt(number);\n        }\n\n        public boolean isZero() {\n            return numberValue == 0;\n        }\n\n        public boolean isUnitary() {\n            return numberValue == 1;\n        }\n\n        public String toWords() {\n            String result;\n            if (numberValue <= 20) {\n                result = NumericToWordsConverter.this.getNumber(numberValue);\n            } else if (numberValue <= 99) {\n                result = getNumberUnder100(numberValue);\n            } else if (numberValue == 100) {\n                result = NumericToWordsConverter.this.getNumber(100);\n            } else {\n                int c = (numberValue / 100) * 100;\n                String centena;\n                if (c == 100) {\n                    centena = NumericToWordsConverter.this.getString(\"100+?\");\n                } else {\n                    centena = NumericToWordsConverter.this.getNumber(c);\n                }\n                int resto = numberValue % 100;\n                if (resto == 0) {\n                    result = centena;\n                } else {\n                    result = centena + getAndSeparator() + getNumberUnder100(resto);\n                }\n            }\n            return result;\n        }\n\n        private String getNumberUnder100(int number) {\n            String result = null;\n            if (number <= 20) {\n                result = getNumber(number);\n            } else if (number <= 99) {\n                int d = number / 10;\n                int u = number % 10;\n                String dezena = getNumber(d * 10);\n                if (u == 0) {\n                    result = dezena;\n                } else {\n                    String unidade = getNumber(u);\n                    result = dezena + getAndSeparator() + unidade;\n                }\n            }\n            return result;\n        }\n\n    }\n\n    private String getThousandSeparator() {\n        return getString(\"sep.mil\");\n    }\n\n    private String getAndSeparator() {\n        return getString(\"sep\");\n    }\n\n    private String getString(String paramMessage) {\n        return Messages.getString(\"Extenso.\" + paramMessage);\n    }\n\n    private String getNumber(int number) {\n        DecimalFormat formater = new DecimalFormat(\"000\");\n        String formatted = formater.format(number);\n        return Messages.getString(\"Extenso.\" + formatted);\n    }\n}\n","lineNo":138}
{"Smelly Sample":"package br.com.caelum.stella.inwords;\n\nimport java.text.DecimalFormat;\nimport java.text.DecimalFormatSymbols;\nimport java.util.MissingResourceException;\n\n/**\n * Responsável por transformar um número em sua representação por extenso.\n * \n * @author Victor dos Santos Pereira\n * @author Leonardo Bessa\n * \n */\npublic class NumericToWordsConverter {\n\n    private final FormatoDeExtenso formato;\n\n    /**\n     * @param formato\n     *            formato desejado para a transfomação por extenso\n     */\n    public NumericToWordsConverter(FormatoDeExtenso formato) {\n        this.formato = formato;\n    }\n\n    /**\n     * @param number\n     *            número a ser transformado\n     * @return Representação do número por extenso.\n     */\n    public String toWords(long number) {\n        try {\n            if (number < 0) {\n                throw new IllegalArgumentException(\"Não é possível transforma número negativos.\");\n            }\n            StringBuffer result = new StringBuffer();\n            if (number == 0) {\n                result.append(getNumber(0));\n            } else {\n                DecimalFormatSymbols symbols = new DecimalFormatSymbols();\n                symbols.setGroupingSeparator(',');\n                symbols.setDecimalSeparator('.');\n                DecimalFormat formatter = new DecimalFormat(\"###,###\", symbols);\n                String formattedInt = formatter.format(number);\n                String[] ints = formattedInt.split(\"[,]\");\n                ThousandBlock[] blocks = new ThousandBlock[ints.length];\n                for (int i = 0; i < blocks.length; i++) {\n                    String block = ints[i];\n                    blocks[i] = new ThousandBlock(block);\n                }\n\n                appendIntegers(result, blocks);\n                appendIntegersUnits(number, result, blocks);\n            }\n            return result.toString();\n        } catch (MissingResourceException e) {\n            throw new IllegalArgumentException(\"Número muito grande para ser transformado em extenso.\");\n        }\n    }\n\n    /**\n     * @param number\n     *            número a ser transformado\n     * @return Representação do número por extenso.\n     */\n    public String toWords(double number) {\n        try {\n            if (number < 0) {\n                throw new IllegalArgumentException(\"Não é possível transforma número negativos.\");\n            }\n            StringBuffer result = new StringBuffer();\n            if (number == 0) {\n                result.append(getNumber(0));\n            } else {\n\n                String[] parts = split(number);\n                String formattedInt = parts[0];\n                String[] ints = formattedInt.split(\"[,]\");\n                ThousandBlock[] blocks = new ThousandBlock[ints.length];\n                for (int i = 0; i < blocks.length; i++) {\n                    String block = ints[i];\n                    blocks[i] = new ThousandBlock(block);\n                }\n                String formattedMod = parts[1];\n                ThousandBlock modBlock = new ThousandBlock(formattedMod);\n\n                boolean hasMod = !modBlock.isZero();\n                boolean hasInteger = (blocks.length > 1) || (!blocks[blocks.length - 1].isZero());\n\n                if (hasInteger) {\n                    appendIntegers(result, blocks);\n                    appendIntegersUnits(number, result, blocks);\n                }\n                if (hasInteger && hasMod) {\n                    result.append(getAndSeparator());\n                }\n                if (hasMod) {\n                    appendIntegers(result, modBlock);\n                    appendDecimalUnits(result, modBlock);\n                }\n            }\n            return result.toString();\n        } catch (MissingResourceException e) {\n            throw new IllegalArgumentException(\"Número muito grande para ser transformado em extenso.\");\n        }\n    }\n\n    private void appendDecimalUnits(StringBuffer result, ThousandBlock modBlock) {\n        result.append(\" \");\n        if (modBlock.isUnitary()) {\n            result.append(formato.getUnidadeDecimalNoSingular());\n        } else {\n            result.append(formato.getUnidadeDecimalNoPlural());\n        }\n    }\n\n    private String[] split(double number) {\n        final StringBuffer pattern = new StringBuffer();\n        pattern.append(\"###,000.\");\n        for (int i = 1; i <= formato.getCasasDecimais(); i++) {\n            pattern.append(\"0\");\n        }\n        DecimalFormatSymbols symbols = new DecimalFormatSymbols();\n        symbols.setGroupingSeparator(',');\n        symbols.setDecimalSeparator('.');\n        DecimalFormat decimalFormat = new DecimalFormat(pattern.toString(), symbols);\n        String formatted = decimalFormat.format(number);\n        String[] parts = formatted.split(\"[.]\");\n        return parts;\n    }\n\n    private void appendIntegersUnits(double number, StringBuffer result, ThousandBlock[] blocks) {\n        if (blocks.length != 1 || !blocks[0].isZero()) {\n            result.append(\" \");\n            if (number >= 2) {\n                int length = blocks.length;\n                if (length > 2 && blocks[length - 1].isZero() && blocks[length - 2].isZero()) {\n                    result.append(\"de \");\n                }\n                result.append(formato.getUnidadeInteiraNoPlural());\n            } else {\n                result.append(formato.getUnidadeInteiraNoSingular());\n            }\n        }\n    }\n\n    private void appendIntegers(StringBuffer result, ThousandBlock... blocks) {\n        boolean hasStarted = false;\n        for (int i = 0; i < blocks.length; i++) {\n            ThousandBlock thousandBlock = blocks[i];\n            if (!(hasStarted && thousandBlock.isZero())) {\n                int thousandPower = (blocks.length - i - 1);\n                if (hasStarted) {\n                    if (thousandBlock.isUnitary()) {\n                        result.append(getAndSeparator());\n                    } else {\n                        if (thousandPower < 1) {\n                            result.append(getAndSeparator());\n                        } else {\n                            result.append(getThousandSeparator());\n                        }\n                    }\n                }\n\n                result.append(thousandBlock.toWords());\n\n                if (thousandPower > 0) {\n                    result.append(\" \");\n                    result.append(this.getString(\"1e\" + 3 * thousandPower + \".\"\n                            + (thousandBlock.isUnitary() ? \"singular\" : \"plural\")));\n                }\n                hasStarted = true;\n            }\n        }\n    }\n\n    private final class ThousandBlock {\n\n        private int numberValue;\n\n        public ThousandBlock(String number) {\n            super();\n            if (number.length() > 3) {\n                throw new IllegalArgumentException(\"ThousandBlock deve conter numeros\" + \" de no maximo 3 digitos.\");\n            }\n            this.numberValue = Integer.parseInt(number);\n        }\n\n        public boolean isZero() {\n            return numberValue == 0;\n        }\n\n        public boolean isUnitary() {\n            return numberValue == 1;\n        }\n\n        public String toWords() {\n            String result;\n            if (numberValue <= 20) {\n                result = NumericToWordsConverter.this.getNumber(numberValue);\n            } else if (numberValue <= 99) {\n                result = getNumberUnder100(numberValue);\n            } else if (numberValue == 100) {\n                result = NumericToWordsConverter.this.getNumber(100);\n            } else {\n                int c = (numberValue / 100) * 100;\n                String centena;\n                if (c == 100) {\n                    centena = NumericToWordsConverter.this.getString(\"100+?\");\n                } else {\n                    centena = NumericToWordsConverter.this.getNumber(c);\n                }\n                int resto = numberValue % 100;\n                if (resto == 0) {\n                    result = centena;\n                } else {\n                    result = centena + getAndSeparator() + getNumberUnder100(resto);\n                }\n            }\n            return result;\n        }\n\n        private String getNumberUnder100(int number) {\n            String result = null;\n            if (number <= 20) {\n                result = getNumber(number);\n            } else if (number <= 99) {\n                int d = number / 10;\n                int u = number % 10;\n                String dezena = getNumber(d * 10);\n                if (u == 0) {\n                    result = dezena;\n                } else {\n                    String unidade = getNumber(u);\n                    result = dezena + getAndSeparator() + unidade;\n                }\n            }\n            return result;\n        }\n\n    }\n\n    private String getThousandSeparator() {\n        return getString(\"sep.mil\");\n    }\n\n    private String getAndSeparator() {\n        return getString(\"sep\");\n    }\n\n    private String getString(String paramMessage) {\n        return Messages.getString(\"Extenso.\" + paramMessage);\n    }\n\n    private String getNumber(int number) {\n        DecimalFormat formater = new DecimalFormat(\"000\");\n        String formatted = formater.format(number);\n        return Messages.getString(\"Extenso.\" + formatted);\n    }\n}\n","Method after Refactoring":"package br.com.caelum.stella.inwords;\n\nimport java.text.DecimalFormat;\nimport java.text.DecimalFormatSymbols;\nimport java.util.MissingResourceException;\n\n/**\n * Responsável por transformar um número em sua representação por extenso.\n * \n * @author Victor dos Santos Pereira\n * @author Leonardo Bessa\n * \n */\npublic class NumericToWordsConverter {\n\n    private final FormatoDeExtenso formato;\n\n    /**\n     * @param formato\n     *            formato desejado para a transfomação por extenso\n     */\n    public NumericToWordsConverter(FormatoDeExtenso formato) {\n        this.formato = formato;\n    }\n\n    /**\n     * @param number\n     *            número a ser transformado\n     * @return Representação do número por extenso.\n     */\n    public String toWords(long number) {\n        try {\n            if (number < 0) {\n                throw new IllegalArgumentException(\"Não é possível transformar números negativos.\");\n            }\n            StringBuffer result = new StringBuffer();\n            if (number == 0) {\n                result.append(getNumber(0));\n            } else {\n                DecimalFormatSymbols symbols = new DecimalFormatSymbols();\n                symbols.setGroupingSeparator(',');\n                symbols.setDecimalSeparator('.');\n                DecimalFormat formatter = new DecimalFormat(\"###,###\", symbols);\n                String formattedInt = formatter.format(number);\n                String[] ints = formattedInt.split(\"[,]\");\n                ThousandBlock[] blocks = new ThousandBlock[ints.length];\n                for (int i = 0; i < blocks.length; i++) {\n                    String block = ints[i];\n                    blocks[i] = new ThousandBlock(block);\n                }\n\n                appendIntegers(result, blocks);\n                appendIntegersUnits(number, result, blocks);\n            }\n            return result.toString();\n        } catch (MissingResourceException e) {\n            throw new IllegalArgumentException(\"Número muito grande para ser transformado em extenso.\");\n        }\n    }\n\n    /**\n     * @param number\n     *            número a ser transformado\n     * @return Representação do número por extenso.\n     */\n    public String toWords(double number) {\n        try {\n            if (number < 0) {\n                throw new IllegalArgumentException(\"Não é possível transformar números negativos.\");\n            }\n            StringBuffer result = new StringBuffer();\n            if (number == 0) {\n                result.append(getNumber(0));\n            } else {\n\n                String[] parts = split(number);\n                String formattedInt = parts[0];\n                String[] ints = formattedInt.split(\"[,]\");\n                ThousandBlock[] blocks = new ThousandBlock[ints.length];\n                for (int i = 0; i < blocks.length; i++) {\n                    String block = ints[i];\n                    blocks[i] = new ThousandBlock(block);\n                }\n                String formattedMod = parts[1];\n                ThousandBlock modBlock = new ThousandBlock(formattedMod);\n\n                boolean hasMod = !modBlock.isZero();\n                boolean hasInteger = (blocks.length > 1) || (!blocks[blocks.length - 1].isZero());\n\n                if (hasInteger) {\n                    appendIntegers(result, blocks);\n                    appendIntegersUnits(number, result, blocks);\n                }\n                if (hasInteger && hasMod) {\n                    result.append(getAndSeparator());\n                }\n                if (hasMod) {\n                    appendIntegers(result, modBlock);\n                    appendDecimalUnits(result, modBlock);\n                }\n            }\n            return result.toString();\n        } catch (MissingResourceException e) {\n            throw new IllegalArgumentException(\"Número muito grande para ser transformado em extenso.\");\n        }\n    }\n\n    private void appendDecimalUnits(StringBuffer result, ThousandBlock modBlock) {\n        result.append(\" \");\n        if (modBlock.isUnitary()) {\n            result.append(formato.getUnidadeDecimalNoSingular());\n        } else {\n            result.append(formato.getUnidadeDecimalNoPlural());\n        }\n    }\n\n    private String[] split(double number) {\n        final StringBuffer pattern = new StringBuffer();\n        pattern.append(\"###,000.\");\n        for (int i = 1; i <= formato.getCasasDecimais(); i++) {\n            pattern.append(\"0\");\n        }\n        DecimalFormatSymbols symbols = new DecimalFormatSymbols();\n        symbols.setGroupingSeparator(',');\n        symbols.setDecimalSeparator('.');\n        DecimalFormat decimalFormat = new DecimalFormat(pattern.toString(), symbols);\n        String formatted = decimalFormat.format(number);\n        String[] parts = formatted.split(\"[.]\");\n        if(formato.getCasasDecimais()==0) {\n        \tparts = new String[]{parts[0], \"0\"};\n        }\n        return parts;\n    }\n\n    private void appendIntegersUnits(double number, StringBuffer result, ThousandBlock[] blocks) {\n        if (blocks.length != 1 || !blocks[0].isZero()) {\n            if (number >= 2) {\n                String unit = formato.getUnidadeInteiraNoPlural();\n                if(unit!=null && !unit.isEmpty() ) {\n                    result.append(\" \");\n                int length = blocks.length;\n                if (length > 2 && blocks[length - 1].isZero() && blocks[length - 2].isZero()) {\n                    result.append(\"de \");\n                }\n                \tresult.append(unit);\n                }\n            } else {\n                String unit = formato.getUnidadeInteiraNoSingular();\n                if(unit!=null && !unit.isEmpty() ) {\n                    result.append(\" \").append(unit);\n                }\n            }\n        }\n    }\n\n    private void appendIntegers(StringBuffer result, ThousandBlock... blocks) {\n        boolean hasStarted = false;\n        for (int i = 0; i < blocks.length; i++) {\n            ThousandBlock thousandBlock = blocks[i];\n            if (!(hasStarted && thousandBlock.isZero())) {\n                int thousandPower = (blocks.length - i - 1);\n                if (hasStarted) {\n                    if (thousandBlock.isUnitary()) {\n                        result.append(getAndSeparator());\n                    } else {\n                        if (thousandPower < 1) {\n                            result.append(getAndSeparator());\n                        } else {\n                            result.append(getThousandSeparator());\n                        }\n                    }\n                }\n\n                result.append(thousandBlock.toWords());\n\n                if (thousandPower > 0) {\n                    result.append(\" \");\n                    result.append(this.getString(\"1e\" + 3 * thousandPower + \".\"\n                            + (thousandBlock.isUnitary() ? \"singular\" : \"plural\")));\n                }\n                hasStarted = true;\n            }\n        }\n    }\n\n    private final class ThousandBlock {\n\n        private int numberValue;\n\n        public ThousandBlock(String number) {\n            super();\n            if (number.length() > 3) {\n                throw new IllegalArgumentException(\"ThousandBlock deve conter numeros\" + \" de no maximo 3 digitos.\");\n            }\n            this.numberValue = Integer.parseInt(number);\n        }\n\n        public boolean isZero() {\n            return numberValue == 0;\n        }\n\n        public boolean isUnitary() {\n            return numberValue == 1;\n        }\n\n        public String toWords() {\n            String result;\n            if (numberValue <= 20) {\n                result = NumericToWordsConverter.this.getNumber(numberValue);\n            } else if (numberValue <= 99) {\n                result = getNumberUnder100(numberValue);\n            } else if (numberValue == 100) {\n                result = NumericToWordsConverter.this.getNumber(100);\n            } else {\n                int c = (numberValue / 100) * 100;\n                String centena;\n                if (c == 100) {\n                    centena = NumericToWordsConverter.this.getString(\"100+?\");\n                } else {\n                    centena = NumericToWordsConverter.this.getNumber(c);\n                }\n                int resto = numberValue % 100;\n                if (resto == 0) {\n                    result = centena;\n                } else {\n                    result = centena + getAndSeparator() + getNumberUnder100(resto);\n                }\n            }\n            return result;\n        }\n\n        private String getNumberUnder100(int number) {\n            String result = null;\n            if (number <= 20) {\n                result = getNumber(number);\n            } else if (number <= 99) {\n                int d = number / 10;\n                int u = number % 10;\n                String dezena = getNumber(d * 10);\n                if (u == 0) {\n                    result = dezena;\n                } else {\n                    String unidade = getNumber(u);\n                    result = dezena + getAndSeparator() + unidade;\n                }\n            }\n            return result;\n        }\n\n    }\n\n    private String getThousandSeparator() {\n        return getString(\"sep.mil\");\n    }\n\n    private String getAndSeparator() {\n        return getString(\"sep\");\n    }\n\n    private String getString(String paramMessage) {\n        return Messages.getString(\"Extenso.\" + paramMessage);\n    }\n\n    private String getNumber(int number) {\n        DecimalFormat formater = new DecimalFormat(\"000\");\n        String formatted = formater.format(number);\n        return Messages.getString(\"Extenso.\" + formatted);\n    }\n}\n","lineNo":148}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigito;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigitoSantander;\n\npublic class Santander extends AbstractBanco implements Banco {\n\n\tprivate final static String NUMERO_SANTANDER = \"033\";\n\tprivate final static String DIGITO_SANTANDER = \"7\";\n\n\tprivate final GeradorDeDigito dvGenerator = new GeradorDeDigitoSantander();\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(NUMERO_SANTANDER);\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\t// Digito Verificador sera inserido aqui.\n\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\n\t\tEmissor emissor = boleto.getEmissor();\n\t\t// campo livre\n\t\tcodigoDeBarras.append(String.format(\"%05d\", Integer.parseInt(emissor.getAgenciaFormatado())));\n\t\tcodigoDeBarras.append(getContaCorrenteDoEmissorFormatado(emissor));\n\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorLimpo(emissor));\n\t\tcodigoDeBarras.append(\"00\"); // filler\n\t\tcodigoDeBarras.append(NUMERO_SANTANDER);\n\n\t\tcodigoDeBarras.append(calculaDV1(codigoDeBarras));\n\n\t\tcodigoDeBarras.append(calculaDV2(codigoDeBarras));\n\n\t\tcodigoDeBarras.insert(4, this.dvGenerator.geraDigitoMod10(codigoDeBarras.toString()));\n\t\treturn codigoDeBarras.toString();\n\t}\n\n\tprivate Object getNossoNumeroDoEmissorLimpo(Emissor emissor) {\n\t\tString nossoNumero = String.valueOf(emissor.getNossoNumero());\n\n\t\tif (nossoNumero.length() > 7) {\n\t\t\tnossoNumero = nossoNumeroSemAgencia(nossoNumero);\n\t\t}\n\t\treturn String.format(\"%07d\", Long.parseLong(nossoNumero));\n\t}\n\n\tprotected int calculaDV2(StringBuilder codigoDeBarras) {\n\n\t\tint tamanho = codigoDeBarras.length();\n\t\tint ultimaPosicao = tamanho - 1;\n\t\tint dv1 = Integer.parseInt(codigoDeBarras.substring(ultimaPosicao));\n\n\t\tint digito = this.dvGenerator.geraDigitoMod(codigoDeBarras.substring(18), 2, 7, 11);\n\t\tif (digito == 1) {\n\t\t\tint novoDV1 = (dv1 + 1) % 10;\n\t\t\tcodigoDeBarras.replace(ultimaPosicao, tamanho, String.valueOf(novoDV1));\n\t\t\treturn calculaDV2(codigoDeBarras);\n\t\t}\n\n\t\tif (digito > 1) {\n\t\t\treturn 11 - digito;\n\t\t}\n\t\treturn digito;\n\t}\n\n\tprotected int calculaDV1(StringBuilder codigoDeBarras) {\n\t\treturn this.dvGenerator.geraDigitoMod10(codigoDeBarras.substring(18));\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\treturn getClass().getResource(String.format(\"/br/com/caelum/stella/boleto/img/%s.png\", NUMERO_SANTANDER));\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_SANTANDER;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\tString valor = String.valueOf(emissor.getContaCorrente());\n\n\t\tif (emissor.getDigitoContaCorrente() != 0) {\n\t\t\tvalor += emissor.getDigitoContaCorrente();\n\t\t}\n\n\t\treturn String.format(\"%06d\", Long.parseLong(valor));\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tString digito = calculaDigitoNossoNumero(emissor.getNossoNumero());\n\t\treturn String.format(\"%07d\", Long.parseLong(emissor.getNossoNumero() + digito));\n\t}\n\n\tprivate String calculaDigitoNossoNumero(long nossoNumero) {\n\t\tint[] pesos = { 7, 3, 1, 9 };\n\t\tString nnumero = String.valueOf(nossoNumero);\n\t\tint soma = 0;\n\n\t\tfor (int i = 0, j = 0; i < nnumero.length(); i++, j++) {\n\n\t\t\tif (j == pesos.length)\n\t\t\t\tj = 0;\n\t\t\tsoma += Integer.parseInt(String.valueOf(nnumero.charAt(i))) * pesos[j];\n\t\t}\n\n\t\tint resto = soma % 10;\n\n\t\tint dv = 10 - resto;\n\n\t\tif (dv == 10) {\n\t\t\treturn \"0\";\n\t\t} else {\n\t\t\treturn String.valueOf(dv);\n\t\t}\n\t}\n\n\tprotected String nossoNumeroSemAgencia(String nossoNumero) {\n\t\treturn nossoNumero.substring(3, nossoNumero.length());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_SANTANDER + \"-\" + DIGITO_SANTANDER;\n\t}\n\n\t@Override\n\tpublic GeradorDeDigito getGeradorDeDigito() {\n\t\treturn dvGenerator;\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigito;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigitoSantander;\n\npublic class Santander implements Banco {\n\n\tprivate final static String NUMERO_SANTANDER = \"033\";\n\tprivate final static String DIGITO_SANTANDER = \"7\";\n\tprivate GeradorDeDigito gdivSantander = new GeradorDeDigitoSantander();\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\t\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder codigoDeBarrasBuilder = new StringBuilder();\n\t\tcodigoDeBarrasBuilder.append(NUMERO_SANTANDER);\n\t\tcodigoDeBarrasBuilder.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\tcodigoDeBarrasBuilder.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarrasBuilder.append(boleto.getValorFormatado()).append(\"9\");\n\t\tcodigoDeBarrasBuilder.append(emissor.getCodigoCliente());\n\t\tcodigoDeBarrasBuilder.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcodigoDeBarrasBuilder.append(\"0\").append(emissor.getCarteira());\n\t\tint digito = gdivSantander.geraDigitoMod11(codigoDeBarrasBuilder.toString());\n\t\tcodigoDeBarrasBuilder.insert(4, digito);\n\t\treturn codigoDeBarrasBuilder.toString();\n\t}\n\t\n\t@Override\n\tpublic URL getImage() {\n\t\tString pathDoArquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(pathDoArquivo, NUMERO_SANTANDER);\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_SANTANDER;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%03d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tString nossoNumero = String.valueOf(emissor.getNossoNumero());\n\t\treturn String.format(\"%13d\", Long.parseLong(nossoNumero));\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(NUMERO_SANTANDER).append(\"-\");\n\t\treturn builder.append(DIGITO_SANTANDER).toString();\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(String.format(\"%05d\", emissor.getAgencia()));\n\t\tbuilder.append(\"/\").append(emissor.getCodigoCliente());\n\t\treturn builder.toString();\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\tString nossoNumero = getNossoNumeroDoEmissorFormatado(emissor);\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(nossoNumero.substring(0, 12));\n\t\tbuilder.append(\"-\").append(nossoNumero.substring(12));\n\t\treturn  builder.toString();\n\t}\n \n\t@Override\n\tpublic GeradorDeDigito getGeradorDeDigito() {\n\t\treturn gdivSantander;\n\t}\n}\n","lineNo":36}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigito;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigitoSantander;\n\npublic class Santander extends AbstractBanco implements Banco {\n\n\tprivate final static String NUMERO_SANTANDER = \"033\";\n\tprivate final static String DIGITO_SANTANDER = \"7\";\n\n\tprivate final GeradorDeDigito dvGenerator = new GeradorDeDigitoSantander();\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(NUMERO_SANTANDER);\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\t// Digito Verificador sera inserido aqui.\n\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\n\t\tEmissor emissor = boleto.getEmissor();\n\t\t// campo livre\n\t\tcodigoDeBarras.append(String.format(\"%05d\", Integer.parseInt(emissor.getAgenciaFormatado())));\n\t\tcodigoDeBarras.append(getContaCorrenteDoEmissorFormatado(emissor));\n\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorLimpo(emissor));\n\t\tcodigoDeBarras.append(\"00\"); // filler\n\t\tcodigoDeBarras.append(NUMERO_SANTANDER);\n\n\t\tcodigoDeBarras.append(calculaDV1(codigoDeBarras));\n\n\t\tcodigoDeBarras.append(calculaDV2(codigoDeBarras));\n\n\t\tcodigoDeBarras.insert(4, this.dvGenerator.geraDigitoMod10(codigoDeBarras.toString()));\n\t\treturn codigoDeBarras.toString();\n\t}\n\n\tprivate Object getNossoNumeroDoEmissorLimpo(Emissor emissor) {\n\t\tString nossoNumero = String.valueOf(emissor.getNossoNumero());\n\n\t\tif (nossoNumero.length() > 7) {\n\t\t\tnossoNumero = nossoNumeroSemAgencia(nossoNumero);\n\t\t}\n\t\treturn String.format(\"%07d\", Long.parseLong(nossoNumero));\n\t}\n\n\tprotected int calculaDV2(StringBuilder codigoDeBarras) {\n\n\t\tint tamanho = codigoDeBarras.length();\n\t\tint ultimaPosicao = tamanho - 1;\n\t\tint dv1 = Integer.parseInt(codigoDeBarras.substring(ultimaPosicao));\n\n\t\tint digito = this.dvGenerator.geraDigitoMod(codigoDeBarras.substring(18), 2, 7, 11);\n\t\tif (digito == 1) {\n\t\t\tint novoDV1 = (dv1 + 1) % 10;\n\t\t\tcodigoDeBarras.replace(ultimaPosicao, tamanho, String.valueOf(novoDV1));\n\t\t\treturn calculaDV2(codigoDeBarras);\n\t\t}\n\n\t\tif (digito > 1) {\n\t\t\treturn 11 - digito;\n\t\t}\n\t\treturn digito;\n\t}\n\n\tprotected int calculaDV1(StringBuilder codigoDeBarras) {\n\t\treturn this.dvGenerator.geraDigitoMod10(codigoDeBarras.substring(18));\n\t}\n\n\t@Override\n\tpublic URL getImage() {\n\t\treturn getClass().getResource(String.format(\"/br/com/caelum/stella/boleto/img/%s.png\", NUMERO_SANTANDER));\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_SANTANDER;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\tString valor = String.valueOf(emissor.getContaCorrente());\n\n\t\tif (emissor.getDigitoContaCorrente() != 0) {\n\t\t\tvalor += emissor.getDigitoContaCorrente();\n\t\t}\n\n\t\treturn String.format(\"%06d\", Long.parseLong(valor));\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tString digito = calculaDigitoNossoNumero(emissor.getNossoNumero());\n\t\treturn String.format(\"%07d\", Long.parseLong(emissor.getNossoNumero() + digito));\n\t}\n\n\tprivate String calculaDigitoNossoNumero(long nossoNumero) {\n\t\tint[] pesos = { 7, 3, 1, 9 };\n\t\tString nnumero = String.valueOf(nossoNumero);\n\t\tint soma = 0;\n\n\t\tfor (int i = 0, j = 0; i < nnumero.length(); i++, j++) {\n\n\t\t\tif (j == pesos.length)\n\t\t\t\tj = 0;\n\t\t\tsoma += Integer.parseInt(String.valueOf(nnumero.charAt(i))) * pesos[j];\n\t\t}\n\n\t\tint resto = soma % 10;\n\n\t\tint dv = 10 - resto;\n\n\t\tif (dv == 10) {\n\t\t\treturn \"0\";\n\t\t} else {\n\t\t\treturn String.valueOf(dv);\n\t\t}\n\t}\n\n\tprotected String nossoNumeroSemAgencia(String nossoNumero) {\n\t\treturn nossoNumero.substring(3, nossoNumero.length());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_SANTANDER + \"-\" + DIGITO_SANTANDER;\n\t}\n\n\t@Override\n\tpublic GeradorDeDigito getGeradorDeDigito() {\n\t\treturn dvGenerator;\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigito;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigitoSantander;\n\npublic class Santander implements Banco {\n\n\tprivate final static String NUMERO_SANTANDER = \"033\";\n\tprivate final static String DIGITO_SANTANDER = \"7\";\n\tprivate GeradorDeDigito gdivSantander = new GeradorDeDigitoSantander();\n\n\t@Override\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\t\n\t\tEmissor emissor = boleto.getEmissor();\n\t\tStringBuilder codigoDeBarrasBuilder = new StringBuilder();\n\t\tcodigoDeBarrasBuilder.append(NUMERO_SANTANDER);\n\t\tcodigoDeBarrasBuilder.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\tcodigoDeBarrasBuilder.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarrasBuilder.append(boleto.getValorFormatado()).append(\"9\");\n\t\tcodigoDeBarrasBuilder.append(emissor.getCodigoCliente());\n\t\tcodigoDeBarrasBuilder.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcodigoDeBarrasBuilder.append(\"0\").append(emissor.getCarteira());\n\t\tint digito = gdivSantander.geraDigitoMod11(codigoDeBarrasBuilder.toString());\n\t\tcodigoDeBarrasBuilder.insert(4, digito);\n\t\treturn codigoDeBarrasBuilder.toString();\n\t}\n\t\n\t@Override\n\tpublic URL getImage() {\n\t\tString pathDoArquivo = \"/br/com/caelum/stella/boleto/img/%s.png\";\n\t\tString imagem = String.format(pathDoArquivo, NUMERO_SANTANDER);\n\t\treturn getClass().getResource(imagem);\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_SANTANDER;\n\t}\n\n\t@Override\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%03d\", emissor.getCarteira());\n\t}\n\n\t@Override\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tString nossoNumero = String.valueOf(emissor.getNossoNumero());\n\t\treturn String.format(\"%13d\", Long.parseLong(nossoNumero));\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(NUMERO_SANTANDER).append(\"-\");\n\t\treturn builder.append(DIGITO_SANTANDER).toString();\n\t}\n\n\t@Override\n\tpublic String getAgenciaECodigoCedente(Emissor emissor) {\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(String.format(\"%05d\", emissor.getAgencia()));\n\t\tbuilder.append(\"/\").append(emissor.getCodigoCliente());\n\t\treturn builder.toString();\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroECodDocumento(Emissor emissor) {\n\t\tString nossoNumero = getNossoNumeroDoEmissorFormatado(emissor);\n\t\tStringBuilder builder = new StringBuilder();\n\t\tbuilder.append(nossoNumero.substring(0, 12));\n\t\tbuilder.append(\"-\").append(nossoNumero.substring(12));\n\t\treturn  builder.toString();\n\t}\n \n\t@Override\n\tpublic GeradorDeDigito getGeradorDeDigito() {\n\t\treturn gdivSantander;\n\t}\n}\n","lineNo":37}
{"Smelly Sample":"package br.com.caelum.stella.boleto.transformer;\n\nimport java.awt.Image;\nimport java.awt.image.BufferedImage;\nimport java.io.IOException;\nimport java.net.URL;\nimport java.util.Calendar;\n\nimport javax.imageio.ImageIO;\n\nimport org.apache.commons.lang.StringUtils;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.bancos.LinhaDigitavelGenerator;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\nimport br.com.caelum.stella.boleto.exception.GeracaoBoletoException;\n\n/**\n * Classe que centraliza a criação dos boletos que tem como template o\n * template.png e antes ficava no BoletoTransformer\n * \n * \n */\n\nclass PNGPDFTransformerHelper {\n\t/* Ainda precisa de um nome melhor!! */\n\tpublic static final float IMAGEM_BOLETO_WIDTH = 2144;\n\tpublic static final float IMAGEM_BOLETO_HEIGHT = 1604;\n\tpublic static final double BOLETO_TEMPLATE_SCALE = 1 / 2d;\n\n\tprivate TextWriter writer;\n\tprivate URL imagemTitulo;\n\n\tpublic PNGPDFTransformerHelper(TextWriter writer) {\n\t\tsuper();\n\t\tthis.writer = writer;\n\t\tthis.imagemTitulo = PNGPDFTransformerHelper.class.getResource(\"/br/com/caelum/stella/boleto/img/template.png\");\n\t}\n\n\t/**\n\t * \n\t * @param boleto\n\t * @return\n\t */\n\tpublic TextWriter transform(Boleto boleto) {\n\t\tgeraTemplateComOFundoDoBoleto(boleto);\n\n\t\timprimeReciboDeSacado(boleto);\n\n\t\timprimeLinhaDigitavelEmNegrito(boleto);\n\n\t\timprimeLocaisDePagamentoEVencimento(boleto);\n\t\timprimeDadosDoCedente(boleto);\n\t\timprimeDadosDoDocumento(boleto);\n\t\timprimeDadosDoBoletoInclusiveValor(boleto);\n\t\timprimeInstrucoesDePagamento(boleto);\n\t\timprimeUnidadeCedente(boleto);\n\t\timprimeDadosDoSacado(boleto);\n\n\t\tgeraEImprimeCodigoDeBarras(boleto);\n\t\treturn writer;\n\t}\n\n\t/**\n\t * Converte um Image em um BufferedImage\n\t * \n\t * @param image\n\t * @param type\n\t */\n\tprivate BufferedImage toBufferedImage(Image image, int type) {\n\t\treturn BufferedImageGenerator.generateBufferedImageFor(image, type);\n\t}\n\n\t/**\n\t * Abre um arquivo em um BufferedImage\n\t * \n\t * @param file\n\t * @return\n\t * @throws IOException\n\t */\n\tprivate BufferedImage imageFor(URL file) throws IOException {\n\t\treturn ImageIO.read(file);\n\t}\n\n\t/**\n\t * Formata uma data para dd/mm/yyyy\n\t * \n\t * @param date\n\t * @return\n\t */\n\tprivate String formatDate(Calendar date) {\n\t\treturn BoletoFormatter.formatDate(date);\n\t}\n\n\tprivate void geraTemplateComOFundoDoBoleto(Boleto boleto) {\n\t\ttry {\n\t\t\tthis.writer.writeImage(0, 55, imageFor(imagemTitulo), 514.22f, 385.109f);\n\t\t\tthis.writer.writeImage(0, 805 - 486, imageFor(boleto.getBanco().getImage()), 100, 23);\n\t\t} catch (IOException e) {\n\t\t\tthrow new GeracaoBoletoException(\"Erro na leitura das imagens do boleto\", e);\n\t\t}\n\t\t\n\t\tfor (int i = 0; i < boleto.getDescricoes().size(); i++) {\n\t\t\tthis.writer.writeBold(5, 805 - 70 - i * 15, boleto.getDescricoes().get(i));\n\t\t}\n\t}\n\t\n\tprivate void imprimeReciboDeSacado(Boleto boleto) {\n\t\tfinal float LINHA1 = 434;\n\t\tfinal float LINHA_ENDERECO_CEDENTE = 423;\n\t\tfinal float LINHA2 = 400;\n\t\tfinal float LINHA3 = 378;\n\t\t\n\t\tthis.writer.write(50, LINHA1, boleto.getEmissor().getCedente());\n\t\tthis.writer.write(50, LINHA_ENDERECO_CEDENTE, StringUtils.defaultString(boleto.getEmissor().getEndereco()));\n\t\t\n\t\tthis.writer.write(5, LINHA2, boleto.getSacado().getNome());\n\t\tthis.writer.write(290, LINHA2, formatDate(boleto.getDatas().getVencimento()));\n\t\tthis.writer.write(377, LINHA2, BoletoFormatter.formatValue(boleto.getValorBoleto().doubleValue()));\n\t\t\n\t\tthis.writer.write(5, LINHA3, boleto.getAgenciaECodigoCedente());\n\t\tthis.writer.write(146, LINHA3, boleto.getNossoNumeroECodDocumento());\n\t}\n\t\n\tprivate void imprimeLinhaDigitavelEmNegrito(Boleto boleto) {\n\t\tfinal float LINHA4 = 319;\n\t\tthis.writer.writeBold(125, LINHA4, boleto.getBanco().getNumeroFormatadoComDigito());\n\t\tLinhaDigitavelGenerator linhaDigitavelGenerator = new LinhaDigitavelGenerator();\n\t\tthis.writer.writeBold(175, LINHA4, linhaDigitavelGenerator.geraLinhaDigitavelPara(boleto));\n\t}\n\t\n\tprivate void imprimeLocaisDePagamentoEVencimento(Boleto boleto) {\n\t\tfinal float LINHA5 = 291;\n\t\tfor (int i = 0; i < boleto.getLocaisDePagamento().size(); i++) {\n\t\t\tthis.writer.write(5, LINHA5 - (i - 1) * 10, boleto.getLocaisDePagamento().get(i));\n\t\t}\n\t\tthis.writer.write(425, LINHA5, formatDate(boleto.getDatas().getVencimento()));\n\t}\n\t\n\tprivate void imprimeDadosDoCedente(Boleto boleto) {\n\t\tfinal float LINHA6 = 271;\n\t\tthis.writer.write(5, LINHA6, boleto.getEmissor().getCedente());\n\t\tthis.writer.write(420, LINHA6, boleto.getAgenciaECodigoCedente());\n\t}\n\t\n\tprivate void imprimeDadosDoDocumento(Boleto boleto) {\n\t\tfinal float LINHA7 = 250;\n\t\tthis.writer.write(5, LINHA7, formatDate(boleto.getDatas().getDocumento()));\n\t\tthis.writer.write(70, LINHA7, boleto.getNumeroDoDocumento().equals(\"\") ? \n\t\t\t\tboleto.getBanco().getNossoNumeroDoEmissorFormatado(boleto.getEmissor()) :\n\t\t\t\t\tboleto.getNumeroDoDocumentoFormatado());\n\t\tthis.writer.write(180, LINHA7, boleto.getEspecieDocumento());\n\t\tthis.writer.write(250, LINHA7, boleto.getAceite() ? \"S\" : \"N\");\n\t\tthis.writer.write(300, LINHA7, formatDate(boleto.getDatas().getProcessamento()));\n\t\tthis.writer.write(410, LINHA7, boleto.getNossoNumeroECodDocumento());\n\t}\n\t\n\tprivate void imprimeDadosDoBoletoInclusiveValor(Boleto boleto) {\n\t\tfinal float LINHA8 = 227;\n\t\tthis.writer.write(122, LINHA8, boleto.getBanco().getCarteiraDoEmissorFormatado(boleto.getEmissor()));\n\t\tthis.writer.write(190, LINHA8, boleto.getEspecieMoeda());\n\t\tthis.writer.write(430, LINHA8, BoletoFormatter.formatValue(boleto.getValorBoleto().doubleValue()));\n\t}\n\t\n\tprivate void imprimeInstrucoesDePagamento(Boleto boleto) {\n\t\tfinal float LINHA9 = 205;\n\n\t\tfor (int i = 0; i < boleto.getInstrucoes().size(); i++) {\n\t\t\tthis.writer.write(5, LINHA9 - i * 10, boleto.getInstrucoes().get(i));\n\t\t}\n\t}\n\t\n\tprivate void imprimeUnidadeCedente(Boleto boleto) {\n\t\tfinal float LINHA10 = 132;\n\t\tfinal float LINHA_ENDERECO = 122;\n\n\t\tthis.writer.write(5, LINHA10, boleto.getEmissor().getCedente());\n\t\tthis.writer.write(5, LINHA_ENDERECO, StringUtils.defaultString(boleto.getEmissor().getEndereco()));\n\t}\n\n\tprivate void imprimeDadosDoSacado(Boleto boleto) {\n\t\tfinal float LINHA11 = 97;\n\t\tfinal float LINHA12 = 87;\n\t\tfinal float LINHA13 = 77;\n\n\t\tthis.writer.write(100, LINHA11, (boleto.getSacado().getNome() != null ? boleto.getSacado().getNome() : \"\")\n\t\t\t\t+ \" \" + (boleto.getSacado().getCpf() != null ? boleto.getSacado().getCpf() : \"\"));\n\t\t\n\t\tthis.writer.write(100, LINHA12, (boleto.getSacado().getEndereco() != null ? boleto.getSacado().getEndereco()\n\t\t\t\t: \"\"));\n\t\t\n\t\tthis.writer.write(100, LINHA13, (boleto.getSacado().getCep() != null ? boleto.getSacado().getCep() : \"\") + \" \"\n\t\t\t\t+ (boleto.getSacado().getBairro() != null ? boleto.getSacado().getBairro() : \"\") + \" - \"\n\t\t\t\t+ (boleto.getSacado().getCidade() != null ? boleto.getSacado().getCidade() : \"\") + \" \"\n\t\t\t\t+ (boleto.getSacado().getUf() != null ? boleto.getSacado().getUf() : \"\"));\n\t}\n\n\tprivate void geraEImprimeCodigoDeBarras(Boleto boleto) {\n\t\tImage imagemDoCodigoDeBarras = BarcodeGenerator.generateBarcodeFor(\n\t\t\t\tboleto.getBanco().geraCodigoDeBarrasPara(boleto), 37.00f);\n\t\t\n\t\ttry {\n\t\t\tthis.writer.writeImage(40, 10, toBufferedImage(imagemDoCodigoDeBarras, BufferedImage.TYPE_INT_ARGB),\n\t\t\t\t\timagemDoCodigoDeBarras.getWidth(null), imagemDoCodigoDeBarras.getHeight(null));\n\t\t} catch (IOException e) {\n\t\t\tthrow new CriacaoBoletoException(\"Erro na geração do código de barras\", e);\n\t\t}\n\t}\n}\n\n","Method after Refactoring":"package br.com.caelum.stella.boleto.transformer;\n\nimport java.awt.Image;\nimport java.awt.image.BufferedImage;\nimport java.io.IOException;\nimport java.net.URL;\nimport java.util.Calendar;\n\nimport javax.imageio.ImageIO;\n\nimport org.apache.commons.lang.StringUtils;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.bancos.GeradorDeLinhaDigitavel;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\nimport br.com.caelum.stella.boleto.exception.GeracaoBoletoException;\n\n/**\n * Classe que centraliza a criação dos boletos que tem como template o\n * template.png e antes ficava no BoletoTransformer\n * \n * \n */\n\nclass PNGPDFTransformerHelper {\n\t/* Ainda precisa de um nome melhor!! */\n\tpublic static final float IMAGEM_BOLETO_WIDTH = 2144;\n\tpublic static final float IMAGEM_BOLETO_HEIGHT = 1604;\n\tpublic static final double BOLETO_TEMPLATE_SCALE = 1 / 2d;\n\n\tprivate TextWriter writer;\n\tprivate URL imagemTitulo;\n\n\tpublic PNGPDFTransformerHelper(TextWriter writer) {\n\t\tsuper();\n\t\tthis.writer = writer;\n\t\tthis.imagemTitulo = PNGPDFTransformerHelper.class.getResource(\"/br/com/caelum/stella/boleto/img/template.png\");\n\t}\n\n\t/**\n\t * \n\t * @param boleto\n\t * @return\n\t */\n\tpublic TextWriter transform(Boleto boleto) {\n\t\tgeraTemplateComOFundoDoBoleto(boleto);\n\n\t\timprimeReciboDeSacado(boleto);\n\n\t\timprimeLinhaDigitavelEmNegrito(boleto);\n\n\t\timprimeLocaisDePagamentoEVencimento(boleto);\n\t\timprimeDadosDoCedente(boleto);\n\t\timprimeDadosDoDocumento(boleto);\n\t\timprimeDadosDoBoletoInclusiveValor(boleto);\n\t\timprimeInstrucoesDePagamento(boleto);\n\t\timprimeUnidadeCedente(boleto);\n\t\timprimeDadosDoSacado(boleto);\n\n\t\tgeraEImprimeCodigoDeBarras(boleto);\n\t\treturn writer;\n\t}\n\n\t/**\n\t * Converte um Image em um BufferedImage\n\t * \n\t * @param image\n\t * @param type\n\t */\n\tprivate BufferedImage toBufferedImage(Image image, int type) {\n\t\treturn BufferedImageGenerator.generateBufferedImageFor(image, type);\n\t}\n\n\t/**\n\t * Abre um arquivo em um BufferedImage\n\t * \n\t * @param file\n\t * @return\n\t * @throws IOException\n\t */\n\tprivate BufferedImage imageFor(URL file) throws IOException {\n\t\treturn ImageIO.read(file);\n\t}\n\n\t/**\n\t * Formata uma data para dd/mm/yyyy\n\t * \n\t * @param date\n\t * @return\n\t */\n\tprivate String formatDate(Calendar date) {\n\t\treturn BoletoFormatter.formatDate(date);\n\t}\n\n\tprivate void geraTemplateComOFundoDoBoleto(Boleto boleto) {\n\t\ttry {\n\t\t\tthis.writer.writeImage(0, 55, imageFor(imagemTitulo), 514.22f, 385.109f);\n\t\t\tthis.writer.writeImage(0, 805 - 486, imageFor(boleto.getBanco().getImage()), 100, 23);\n\t\t} catch (IOException e) {\n\t\t\tthrow new GeracaoBoletoException(\"Erro na leitura das imagens do boleto\", e);\n\t\t}\n\t\t\n\t\tfor (int i = 0; i < boleto.getDescricoes().size(); i++) {\n\t\t\tthis.writer.writeBold(5, 805 - 70 - i * 15, boleto.getDescricoes().get(i));\n\t\t}\n\t}\n\t\n\tprivate void imprimeReciboDeSacado(Boleto boleto) {\n\t\tfinal float LINHA1 = 434;\n\t\tfinal float LINHA_ENDERECO_CEDENTE = 423;\n\t\tfinal float LINHA2 = 400;\n\t\tfinal float LINHA3 = 378;\n\t\t\n\t\tthis.writer.write(50, LINHA1, boleto.getEmissor().getCedente());\n\t\tthis.writer.write(50, LINHA_ENDERECO_CEDENTE, StringUtils.defaultString(boleto.getEmissor().getEndereco()));\n\t\t\n\t\tthis.writer.write(5, LINHA2, boleto.getSacado().getNome());\n\t\tthis.writer.write(290, LINHA2, formatDate(boleto.getDatas().getVencimento()));\n\t\tthis.writer.write(377, LINHA2, BoletoFormatter.formatValue(boleto.getValorBoleto().doubleValue()));\n\t\t\n\t\tthis.writer.write(5, LINHA3, boleto.getAgenciaECodigoCedente());\n\t\tthis.writer.write(146, LINHA3, boleto.getNossoNumeroECodDocumento());\n\t}\n\t\n\tprivate void imprimeLinhaDigitavelEmNegrito(Boleto boleto) {\n\t\tfinal float LINHA4 = 319;\n\t\tthis.writer.writeBold(125, LINHA4, boleto.getBanco().getNumeroFormatadoComDigito());\n\t\tGeradorDeLinhaDigitavel linhaDigitavelGenerator = new GeradorDeLinhaDigitavel();\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(boleto);\n\t\tthis.writer.writeBold(175, LINHA4, linhaDigitavelGenerator.geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\t\n\tprivate void imprimeLocaisDePagamentoEVencimento(Boleto boleto) {\n\t\tfinal float LINHA5 = 291;\n\t\tfor (int i = 0; i < boleto.getLocaisDePagamento().size(); i++) {\n\t\t\tthis.writer.write(5, LINHA5 - (i - 1) * 10, boleto.getLocaisDePagamento().get(i));\n\t\t}\n\t\tthis.writer.write(425, LINHA5, formatDate(boleto.getDatas().getVencimento()));\n\t}\n\t\n\tprivate void imprimeDadosDoCedente(Boleto boleto) {\n\t\tfinal float LINHA6 = 271;\n\t\tthis.writer.write(5, LINHA6, boleto.getEmissor().getCedente());\n\t\tthis.writer.write(420, LINHA6, boleto.getAgenciaECodigoCedente());\n\t}\n\t\n\tprivate void imprimeDadosDoDocumento(Boleto boleto) {\n\t\tfinal float LINHA7 = 250;\n\t\tthis.writer.write(5, LINHA7, formatDate(boleto.getDatas().getDocumento()));\n\t\tthis.writer.write(70, LINHA7, boleto.getNumeroDoDocumento().equals(\"\") ? \n\t\t\t\tboleto.getBanco().getNossoNumeroDoEmissorFormatado(boleto.getEmissor()) :\n\t\t\t\t\tboleto.getNumeroDoDocumentoFormatado());\n\t\tthis.writer.write(180, LINHA7, boleto.getEspecieDocumento());\n\t\tthis.writer.write(250, LINHA7, boleto.getAceite() ? \"S\" : \"N\");\n\t\tthis.writer.write(300, LINHA7, formatDate(boleto.getDatas().getProcessamento()));\n\t\tthis.writer.write(410, LINHA7, boleto.getNossoNumeroECodDocumento());\n\t}\n\t\n\tprivate void imprimeDadosDoBoletoInclusiveValor(Boleto boleto) {\n\t\tfinal float LINHA8 = 227;\n\t\tthis.writer.write(122, LINHA8, boleto.getBanco().getCarteiraDoEmissorFormatado(boleto.getEmissor()));\n\t\tthis.writer.write(190, LINHA8, boleto.getEspecieMoeda());\n\t\tthis.writer.write(430, LINHA8, BoletoFormatter.formatValue(boleto.getValorBoleto().doubleValue()));\n\t}\n\t\n\tprivate void imprimeInstrucoesDePagamento(Boleto boleto) {\n\t\tfinal float LINHA9 = 205;\n\n\t\tfor (int i = 0; i < boleto.getInstrucoes().size(); i++) {\n\t\t\tthis.writer.write(5, LINHA9 - i * 10, boleto.getInstrucoes().get(i));\n\t\t}\n\t}\n\t\n\tprivate void imprimeUnidadeCedente(Boleto boleto) {\n\t\tfinal float LINHA10 = 132;\n\t\tfinal float LINHA_ENDERECO = 122;\n\n\t\tthis.writer.write(5, LINHA10, boleto.getEmissor().getCedente());\n\t\tthis.writer.write(5, LINHA_ENDERECO, StringUtils.defaultString(boleto.getEmissor().getEndereco()));\n\t}\n\n\tprivate void imprimeDadosDoSacado(Boleto boleto) {\n\t\tfinal float LINHA11 = 97;\n\t\tfinal float LINHA12 = 87;\n\t\tfinal float LINHA13 = 77;\n\n\t\tthis.writer.write(50, LINHA11, (boleto.getSacado().getNome() != null ? boleto.getSacado().getNome() : \"\")\n\t\t\t\t+ \" \" + (boleto.getSacado().getCpf() != null ? boleto.getSacado().getCpf() : \"\"));\n\t\t\n\t\tthis.writer.write(50, LINHA12, (boleto.getSacado().getEndereco() != null ? boleto.getSacado().getEndereco()\n\t\t\t\t: \"\"));\n\t\t\n\t\tthis.writer.write(50, LINHA13, (boleto.getSacado().getCep() != null ? boleto.getSacado().getCep() : \"\") + \" \"\n\t\t\t\t+ (boleto.getSacado().getBairro() != null ? boleto.getSacado().getBairro() : \"\") + \" - \"\n\t\t\t\t+ (boleto.getSacado().getCidade() != null ? boleto.getSacado().getCidade() : \"\") + \" \"\n\t\t\t\t+ (boleto.getSacado().getUf() != null ? boleto.getSacado().getUf() : \"\"));\n\t}\n\n\tprivate void geraEImprimeCodigoDeBarras(Boleto boleto) {\n\t\tImage imagemDoCodigoDeBarras = BarcodeGenerator.generateBarcodeFor(\n\t\t\t\tboleto.getBanco().geraCodigoDeBarrasPara(boleto), 39.00f);\n\t\t\n\t\ttry {\n\t\t\tthis.writer.writeImage(5, 10, toBufferedImage(imagemDoCodigoDeBarras, BufferedImage.TYPE_INT_ARGB),\n\t\t\t\t\t280, imagemDoCodigoDeBarras.getHeight(null));\n\t\t} catch (IOException e) {\n\t\t\tthrow new CriacaoBoletoException(\"Erro na geração do código de barras\", e);\n\t\t}\n\t}\n}\n\n","lineNo":129}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class BancoDoBrasilTest {\n\n\tprivate Boleto boleto;\n\tprivate BancoDoBrasil banco;\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\tDatas datas = Datas.newDatas().withDocumento(4, 5, 2008).withProcessamento(4, 5, 2008)\n\t\t\t\t.withVencimento(2, 5, 2008);\n\n\t\tthis.emissor = Emissor.newEmissor().withCedente(\"Caue\").withAgencia(1824).withDigitoAgencia('4')\n\t\t\t\t.withContaCorrente(76000).withNumeroConvenio(1207113).withDigitoContaCorrente('5').withCarteira(18)\n\t\t\t\t.withNossoNumero(9000206);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\");\n\n\t\tthis.banco = new BancoDoBrasil();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(this.emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"40.00\").withNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void numeroDoConvenioFormatadoDeveTerSeisDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNumeroConvenio(1234);\n\t\tString numeroFormatado = this.banco.getNumeroConvenioDoEmissorFormatado(emissor);\n\t\tassertEquals(6, numeroFormatado.length());\n\t\tassertEquals(\"001234\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerOnzeDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNossoNumero(9000206).withCarteira(11);\n\t\tString numeroFormatado = this.banco.getNossoNumeroDoEmissorFormatado(emissor);\n\t\tassertEquals(11, numeroFormatado.length());\n\t\tassertEquals(\"00009000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerDezesseteDigitosComCarteira18() {\n\t\tEmissor emissor = Emissor.newEmissor().withNossoNumero(9000206).withCarteira(18);\n\t\tString numeroFormatado = this.banco.getNossoNumeroDoEmissorFormatado(emissor);\n\t\tassertEquals(17, numeroFormatado.length());\n\t\tassertEquals(\"00000000009000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerDoisDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(2, numeroFormatado.length());\n\t\tassertEquals(\"01\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerOitoDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"00076000\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testNumeroFormatadoNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"001\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(0, 3));\n\t}\n\n\t@Test\n\tpublic void testCodEspecieMoedaNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"9\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(3, 4));\n\t}\n\n\t@Test\n\tpublic void testDigitoVerificadorNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"5\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(4, 5));\n\t}\n\n\t@Test\n\tpublic void testFatorVencimentoNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"3860\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(5, 9));\n\t}\n\n\t@Test\n\tpublic void testValorNominalNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"0000004000\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(9, 19));\n\t}\n\n\t@Test\n\tpublic void testCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"0000001207113000900020618\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(19, 44));\n\t}\n\n\t@Test\n\tpublic void testZerosNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"000000\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(19, 25));\n\t}\n\n\t@Test\n\tpublic void testNumConvenioFormatadoNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"1207113\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(25, 32));\n\t}\n\n\t@Test\n\tpublic void testNossoNumeroFormatadoNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"0009000206\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(32, 42));\n\t}\n\n\t@Test\n\tpublic void testCarteiraNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"18\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(42, 44));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"00195386000000040000000001207113000900020618\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tLinhaDigitavelGenerator linhaDigitavelGenerator = new LinhaDigitavelGenerator();\n\n\t\tassertEquals(\"00190.00009  01207.113000  09000.206186  5  38600000004000\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class BancoDoBrasilTest {\n\n\tprivate Boleto boleto;\n\tprivate BancoDoBrasil banco;\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\tDatas datas = Datas.newDatas().withDocumento(4, 5, 2008).withProcessamento(4, 5, 2008)\n\t\t\t\t.withVencimento(2, 5, 2008);\n\n\t\tthis.emissor = Emissor.newEmissor().withCedente(\"Caue\").withAgencia(1824).withDigitoAgencia('4')\n\t\t\t\t.withContaCorrente(76000).withNumeroConvenio(1207113).withDigitoContaCorrente('5').withCarteira(18)\n\t\t\t\t.withNossoNumero(9000206);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\");\n\n\t\tthis.banco = new BancoDoBrasil();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(this.emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"40.00\").withNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void numeroDoConvenioFormatadoDeveTerSeisDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNumeroConvenio(1234);\n\t\tString numeroFormatado = this.banco.getNumeroConvenioDoEmissorFormatado(emissor);\n\t\tassertEquals(6, numeroFormatado.length());\n\t\tassertEquals(\"001234\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerOnzeDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNossoNumero(9000206).withCarteira(11);\n\t\tString numeroFormatado = this.banco.getNossoNumeroDoEmissorFormatado(emissor);\n\t\tassertEquals(11, numeroFormatado.length());\n\t\tassertEquals(\"00009000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerDezesseteDigitosComCarteira18() {\n\t\tEmissor emissor = Emissor.newEmissor().withNossoNumero(9000206).withCarteira(18);\n\t\tString numeroFormatado = this.banco.getNossoNumeroDoEmissorFormatado(emissor);\n\t\tassertEquals(17, numeroFormatado.length());\n\t\tassertEquals(\"00000000009000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerDoisDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(2, numeroFormatado.length());\n\t\tassertEquals(\"01\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerOitoDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"00076000\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testNumeroFormatadoNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"001\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(0, 3));\n\t}\n\n\t@Test\n\tpublic void testCodEspecieMoedaNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"9\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(3, 4));\n\t}\n\n\t@Test\n\tpublic void testDigitoVerificadorNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"5\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(4, 5));\n\t}\n\n\t@Test\n\tpublic void testFatorVencimentoNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"3860\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(5, 9));\n\t}\n\n\t@Test\n\tpublic void testValorNominalNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"0000004000\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(9, 19));\n\t}\n\n\t@Test\n\tpublic void testCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"0000001207113000900020618\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(19, 44));\n\t}\n\n\t@Test\n\tpublic void testZerosNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"000000\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(19, 25));\n\t}\n\n\t@Test\n\tpublic void testNumConvenioFormatadoNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"1207113\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(25, 32));\n\t}\n\n\t@Test\n\tpublic void testNossoNumeroFormatadoNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"0009000206\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(32, 42));\n\t}\n\n\t@Test\n\tpublic void testCarteiraNoCampoLivreNoCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"18\", this.banco.geraCodigoDeBarrasPara(this.boleto).substring(42, 44));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"00195386000000040000000001207113000900020618\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoDoBrasil() {\n\t\tthis.banco = new BancoDoBrasil();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tGeradorDeLinhaDigitavel linhaDigitavelGenerator = new GeradorDeLinhaDigitavel();\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\n\t\tassertEquals(\"00190.00009  01207.113000  09000.206186  5  38600000004000\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n\n}\n","lineNo":169}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class BradescoTest {\n\n\tprivate Boleto boleto;\n\tprivate Bradesco banco;\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\tDatas datas = Datas.newDatas().withDocumento(31, 5, 2006).withProcessamento(31, 5, 2006)\n\t\t\t\t.withVencimento(10, 6, 2006);\n\n\t\tthis.emissor = Emissor.newEmissor().withCedente(\"Leonardo Bessa\").withAgencia(2949).withDigitoAgencia('1')\n\t\t\t\t.withContaCorrente(6580).withNumeroConvenio(1207113).withDigitoContaCorrente('3').withCarteira(6)\n\t\t\t\t.withNossoNumero(3);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\");\n\n\t\tthis.banco = new Bradesco();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(this.emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"1.00\").withNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void numeroDoConvenioFormatadoDeveTerSeteDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNumeroConvenio(1234);\n\t\tString numeroFormatado = this.banco.getNumeroConvenioDoEmissorFormatado(emissor);\n\t\tassertEquals(7, numeroFormatado.length());\n\t\tassertEquals(\"0001234\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerOnzeDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNossoNumero(9000206).withDigitoNossoNumero(\"7\");\n\t\tString numeroFormatado = this.banco.getNossoNumeroDoEmissorFormatado(emissor);\n\t\tassertEquals(11, numeroFormatado.length());\n\t\tassertEquals(\"00009000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerDoisDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(2, numeroFormatado.length());\n\t\tassertEquals(\"01\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerSeteDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(7, numeroFormatado.length());\n\t\tassertEquals(\"0006580\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoBradesco() {\n\t\tthis.banco = new Bradesco();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tLinhaDigitavelGenerator linhaDigitavelGenerator = new LinhaDigitavelGenerator();\n\n\t\tassertEquals(\"23792.94909  60000.000004  03000.658009  6  31680000000100\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoBradesco() {\n\t\tthis.banco = new Bradesco();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"23796316800000001002949060000000000300065800\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class BradescoTest {\n\n\tprivate Boleto boleto;\n\tprivate Bradesco banco;\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\tDatas datas = Datas.newDatas().withDocumento(31, 5, 2006).withProcessamento(31, 5, 2006)\n\t\t\t\t.withVencimento(10, 6, 2006);\n\n\t\tthis.emissor = Emissor.newEmissor().withCedente(\"Leonardo Bessa\").withAgencia(2949).withDigitoAgencia('1')\n\t\t\t\t.withContaCorrente(6580).withNumeroConvenio(1207113).withDigitoContaCorrente('3').withCarteira(6)\n\t\t\t\t.withNossoNumero(3);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\");\n\n\t\tthis.banco = new Bradesco();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(this.emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"1.00\").withNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void numeroDoConvenioFormatadoDeveTerSeteDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNumeroConvenio(1234);\n\t\tString numeroFormatado = this.banco.getNumeroConvenioDoEmissorFormatado(emissor);\n\t\tassertEquals(7, numeroFormatado.length());\n\t\tassertEquals(\"0001234\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerOnzeDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNossoNumero(9000206).withDigitoNossoNumero(\"7\");\n\t\tString numeroFormatado = this.banco.getNossoNumeroDoEmissorFormatado(emissor);\n\t\tassertEquals(11, numeroFormatado.length());\n\t\tassertEquals(\"00009000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerDoisDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(2, numeroFormatado.length());\n\t\tassertEquals(\"01\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerSeteDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(7, numeroFormatado.length());\n\t\tassertEquals(\"0006580\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoBradesco() {\n\t\tthis.banco = new Bradesco();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tGeradorDeLinhaDigitavel linhaDigitavelGenerator = new GeradorDeLinhaDigitavel();\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\n\t\tassertEquals(\"23792.94909  60000.000004  03000.658009  6  31680000000100\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoBradesco() {\n\t\tthis.banco = new Bradesco();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"23796316800000001002949060000000000300065800\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","lineNo":73}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class CaixaTest {\n\tprivate Boleto boleto;\n\tprivate Caixa banco;\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\tDatas datas = Datas.newDatas().withDocumento(31, 5, 2006).withProcessamento(31, 5, 2006)\n\t\t\t\t.withVencimento(31, 5, 2006);\n\n\t\tthis.emissor = Emissor.newEmissor().withCedente(\"Caue Guerra\").withAgencia(2949).withDigitoAgencia('1')\n\t\t\t\t.withContaCorrente(6580).withNumeroConvenio(1207113).withDigitoContaCorrente('3').withCarteira(9)\n\t\t\t\t.withNossoNumero(1200200).withCodigoFornecidoPelaAgencia(789).withCodigoOperacao(123);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\");\n\n\t\tthis.banco = new Caixa();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(this.emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(1.00).withNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void codFornecidoPelaAgenciaDeveTerOitoDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCodigoFornecidoPelaAgencia(2);\n\t\tString numeroFormatado = this.banco.getCodigoFornecidoPelaAgenciaFormatado(emissor);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"00000002\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void codOperacaoDeveTerTresDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCodigoOperacao(2);\n\t\tString numeroFormatado = this.banco.getCodigoOperacaoFormatado(emissor);\n\t\tassertEquals(3, numeroFormatado.length());\n\t\tassertEquals(\"002\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerDoisDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(2, numeroFormatado.length());\n\t\tassertEquals(\"01\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerCincoDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(5, numeroFormatado.length());\n\t\tassertEquals(\"06580\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoCaixa() {\n\t\tthis.banco = new Caixa();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tLinhaDigitavelGenerator linhaDigitavelGenerator = new LinhaDigitavelGenerator();\n\n\t\tassertEquals(\"10499.00127  00200.294916  23000.007890  8  31580000000100\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoCaixa() {\n\t\tthis.banco = new Caixa();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"10498315800000001009001200200294912300000789\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class CaixaTest {\n\tprivate Boleto boleto;\n\tprivate Caixa banco;\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\tDatas datas = Datas.newDatas().withDocumento(31, 5, 2006).withProcessamento(31, 5, 2006)\n\t\t\t\t.withVencimento(31, 5, 2006);\n\n\t\tthis.emissor = Emissor.newEmissor().withCedente(\"Caue Guerra\").withAgencia(2949).withDigitoAgencia('1')\n\t\t\t\t.withContaCorrente(6580).withNumeroConvenio(1207113).withDigitoContaCorrente('3').withCarteira(9)\n\t\t\t\t.withNossoNumero(1200200).withCodigoFornecidoPelaAgencia(789).withCodigoOperacao(123);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\");\n\n\t\tthis.banco = new Caixa();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(this.emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(1.00).withNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void codFornecidoPelaAgenciaDeveTerOitoDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCodigoFornecidoPelaAgencia(2);\n\t\tString numeroFormatado = this.banco.getCodigoFornecidoPelaAgenciaFormatado(emissor);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"00000002\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void codOperacaoDeveTerTresDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCodigoOperacao(2);\n\t\tString numeroFormatado = this.banco.getCodigoOperacaoFormatado(emissor);\n\t\tassertEquals(3, numeroFormatado.length());\n\t\tassertEquals(\"002\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerDoisDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(2, numeroFormatado.length());\n\t\tassertEquals(\"01\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerCincoDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(5, numeroFormatado.length());\n\t\tassertEquals(\"06580\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoCaixa() {\n\t\tthis.banco = new Caixa();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tGeradorDeLinhaDigitavel linhaDigitavelGenerator = new GeradorDeLinhaDigitavel();\n\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\n\t\tassertEquals(\"10499.00127  00200.294916  23000.007890  8  31580000000100\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoCaixa() {\n\t\tthis.banco = new Caixa();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"10498315800000001009001200200294912300000789\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","lineNo":73}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.*;\nimport org.junit.Assert;\nimport static org.junit.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport java.io.IOException;\n\npublic class HSBCComTipoIdentificador4Test {\n\tprivate Boleto boleto;\n\tprivate Banco banco;\n\t/*\n\t * no documento informa, que a carteira deve ser CNR\n\t */\n\tprivate int carteiraSimbolica = 0;\n\n\t@Before\n\tpublic void setUp() {\n\n\t\tDatas datas = Datas.newDatas().withDocumento(3, 7, 2000).withVencimento(4, 7, 2000);\n\n\t\tEmissor emissor = Emissor.newEmissor().withCedente(\"Alberto\").withAgencia(501).withContaCorrente(6703255)\n\t\t\t\t.withNossoNumero(39104766).withCodigoFornecidoPelaAgencia(351202).withCarteira(carteiraSimbolica);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\").withCidade(\"Salvador\").withBairro(\"Rio Vermelho\")\n\t\t\t\t.withCep(\"40000000\").withEndereco(\"Endereco em salvador\").withCpf(\"94312885087\").withUf(\"BA\");\n\n\t\tthis.banco = new HSBC();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"1200.00\").withNumeroDoDocumento(\"39104766\");\n\t}\n\n\t@Test\n\tpublic void testCodigoDoDocumentoFinalComDigitosVerificadores() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tassertEquals(\"39104766340\", ((HSBC) this.banco).getCodigoDoDocumentoFinalComDigitosVerificadores(boleto));\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoHSBC() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"39990.35128  02000.003919  04766.186029  3  10010000120000\",\n\t\t\t\tnew LinhaDigitavelGenerator().geraLinhaDigitavelPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testDataJuliana() {\n\t\tHSBC hsbc = (HSBC) banco;\n\t\tAssert.assertEquals(\"1860\", hsbc.getDataFormatoJuliano(boleto.getDatas().getVencimento(), 4));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoHSBC() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tassertEquals(\"39993100100001200000351202000003910476618602\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() throws IOException {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport static org.junit.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport java.io.IOException;\n\nimport org.junit.Assert;\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class HSBCComTipoIdentificador4Test {\n\tprivate Boleto boleto;\n\tprivate Banco banco;\n\t/*\n\t * no documento informa, que a carteira deve ser CNR\n\t */\n\tprivate int carteiraSimbolica = 0;\n\n\t@Before\n\tpublic void setUp() {\n\n\t\tDatas datas = Datas.newDatas().withDocumento(3, 7, 2000).withVencimento(4, 7, 2000);\n\n\t\tEmissor emissor = Emissor.newEmissor().withCedente(\"Alberto\").withAgencia(501).withContaCorrente(6703255)\n\t\t\t\t.withNossoNumero(39104766).withCodigoFornecidoPelaAgencia(351202).withCarteira(carteiraSimbolica);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\").withCidade(\"Salvador\").withBairro(\"Rio Vermelho\")\n\t\t\t\t.withCep(\"40000000\").withEndereco(\"Endereco em salvador\").withCpf(\"94312885087\").withUf(\"BA\");\n\n\t\tthis.banco = new HSBC();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"1200.00\").withNumeroDoDocumento(\"39104766\");\n\t}\n\n\t@Test\n\tpublic void testCodigoDoDocumentoFinalComDigitosVerificadores() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tassertEquals(\"39104766340\", ((HSBC) this.banco).getCodigoDoDocumentoFinalComDigitosVerificadores(boleto));\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoHSBC() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\n\t\tassertEquals(\"39990.35128  02000.003919  04766.186029  3  10010000120000\",\n\t\t\t\tnew GeradorDeLinhaDigitavel().geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testDataJuliana() {\n\t\tHSBC hsbc = (HSBC) banco;\n\t\tAssert.assertEquals(\"1860\", hsbc.getDataFormatoJuliano(boleto.getDatas().getVencimento(), 4));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoHSBC() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tassertEquals(\"39993100100001200000351202000003910476618602\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() throws IOException {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n\n}\n","lineNo":52}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport static org.junit.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport java.io.IOException;\n\nimport org.junit.Assert;\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class HSBCTest {\n\tprivate Boleto boleto;\n\tprivate Banco banco;\n\t/*\n\t * no documento informa, que a carteira deve ser CNR\n\t */\n\tprivate int carteiraSimbolica = 0;\n\n\t@Before\n\tpublic void setUp() {\n\n\t\tDatas datas = Datas.newDatas().withDocumento(03, 7, 2000).withVencimento(04, 7, 2000);\n\n\t\tEmissor emissor = Emissor.newEmissor().withCedente(\"Alberto\").withAgencia(501).withContaCorrente(6703255)\n\t\t\t\t.withNossoNumero(39104766).withCodigoFornecidoPelaAgencia(351202).withCarteira(carteiraSimbolica);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\").withCidade(\"Salvador\").withBairro(\"Rio Vermelho\")\n\t\t\t\t.withCep(\"40000000\").withEndereco(\"Endereco em salvador\").withCpf(\"94312885087\").withUf(\"BA\");\n\n\t\tthis.banco = new HSBC();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"1200.00\").withNumeroDoDocumento(\"39104766\");\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoHSBC() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"39990.35128  02000.003919  04766.186029  3  10010000120000\",\n\t\t\t\tnew LinhaDigitavelGenerator().geraLinhaDigitavelPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testDataJuliana() {\n\t\tHSBC hsbc = (HSBC) banco;\n\t\tAssert.assertEquals(\"1860\", hsbc.getDataFormatoJuliano(boleto.getDatas().getVencimento(), 4));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoHSBC() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tassertEquals(\"39993100100001200000351202000003910476618602\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() throws IOException {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport static org.junit.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport java.io.IOException;\n\nimport org.junit.Assert;\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class HSBCTest {\n\tprivate Boleto boleto;\n\tprivate Banco banco;\n\t/*\n\t * no documento informa, que a carteira deve ser CNR\n\t */\n\tprivate int carteiraSimbolica = 0;\n\n\t@Before\n\tpublic void setUp() {\n\n\t\tDatas datas = Datas.newDatas().withDocumento(03, 7, 2000).withVencimento(04, 7, 2000);\n\n\t\tEmissor emissor = Emissor.newEmissor().withCedente(\"Alberto\").withAgencia(501).withContaCorrente(6703255)\n\t\t\t\t.withNossoNumero(39104766).withCodigoFornecidoPelaAgencia(351202).withCarteira(carteiraSimbolica);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\").withCidade(\"Salvador\").withBairro(\"Rio Vermelho\")\n\t\t\t\t.withCep(\"40000000\").withEndereco(\"Endereco em salvador\").withCpf(\"94312885087\").withUf(\"BA\");\n\n\t\tthis.banco = new HSBC();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"1200.00\").withNumeroDoDocumento(\"39104766\");\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoHSBC() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\n\t\tassertEquals(\"39990.35128  02000.003919  04766.186029  3  10010000120000\",\n\t\t\t\tnew GeradorDeLinhaDigitavel().geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testDataJuliana() {\n\t\tHSBC hsbc = (HSBC) banco;\n\t\tAssert.assertEquals(\"1860\", hsbc.getDataFormatoJuliano(boleto.getDatas().getVencimento(), 4));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoHSBC() {\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tassertEquals(\"39993100100001200000351202000003910476618602\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() throws IOException {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n\n}\n","lineNo":47}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class ItauTest {\n\tprivate Boleto boleto;\n\tprivate Itau banco;\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\tDatas datas = Datas.newDatas().withDocumento(31, 5, 2006).withProcessamento(31, 5, 2006)\n\t\t\t\t.withVencimento(10, 6, 2006);\n\n\t\tthis.emissor = Emissor.newEmissor().withCedente(\"Caue Guerra\").withAgencia(2949).withDigitoAgencia('1')\n\t\t\t\t.withContaCorrente(6580).withNumeroConvenio(1207113).withDigitoContaCorrente('3').withCarteira(6)\n\t\t\t\t.withNossoNumero(3);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\");\n\n\t\tthis.banco = new Itau();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(this.emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"1.00\").withNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerOitoDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNossoNumero(9000206);\n\t\tString numeroFormatado = this.banco.getNossoNumeroDoEmissorFormatado(emissor);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"09000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerTresDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(3, numeroFormatado.length());\n\t\tassertEquals(\"001\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerCincoDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(5, numeroFormatado.length());\n\t\tassertEquals(\"06580\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoItau() {\n\t\tthis.banco = new Itau();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tLinhaDigitavelGenerator linhaDigitavelGenerator = new LinhaDigitavelGenerator();\n\n\t\tassertEquals(\"34190.06006  00000.332940  90658.090007  9  31680000000100\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoItau() {\n\t\tthis.banco = new Itau();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"34199316800000001000060000000332949065809000\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport static junit.framework.Assert.assertEquals;\nimport static org.junit.Assert.assertNotNull;\n\nimport org.junit.Before;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.Sacado;\n\npublic class ItauTest {\n\tprivate Boleto boleto;\n\tprivate Itau banco;\n\tprivate Emissor emissor;\n\n\t@Before\n\tpublic void setUp() {\n\t\tDatas datas = Datas.newDatas().withDocumento(31, 5, 2006).withProcessamento(31, 5, 2006)\n\t\t\t\t.withVencimento(10, 6, 2006);\n\n\t\tthis.emissor = Emissor.newEmissor().withCedente(\"Caue Guerra\").withAgencia(2949).withDigitoAgencia('1')\n\t\t\t\t.withContaCorrente(6580).withNumeroConvenio(1207113).withDigitoContaCorrente('3').withCarteira(6)\n\t\t\t\t.withNossoNumero(3);\n\n\t\tSacado sacado = Sacado.newSacado().withNome(\"Fulano\");\n\n\t\tthis.banco = new Itau();\n\n\t\tthis.boleto = Boleto.newBoleto().withDatas(datas).withEmissor(this.emissor).withSacado(sacado)\n\t\t\t\t.withValorBoleto(\"1.00\").withNumeroDoDocumento(\"4323\");\n\t}\n\n\t@Test\n\tpublic void nossoNumeroFormatadoDeveTerOitoDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withNossoNumero(9000206);\n\t\tString numeroFormatado = this.banco.getNossoNumeroDoEmissorFormatado(emissor);\n\t\tassertEquals(8, numeroFormatado.length());\n\t\tassertEquals(\"09000206\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void carteiraFormatadoDeveTerTresDigitos() {\n\t\tEmissor emissor = Emissor.newEmissor().withCarteira(1);\n\t\tString numeroFormatado = this.banco.getCarteiraDoEmissorFormatado(emissor);\n\t\tassertEquals(3, numeroFormatado.length());\n\t\tassertEquals(\"001\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void contaCorrenteFormatadaDeveTerCincoDigitos() {\n\t\tString numeroFormatado = this.banco.getContaCorrenteDoEmissorFormatado(this.emissor);\n\t\tassertEquals(5, numeroFormatado.length());\n\t\tassertEquals(\"06580\", numeroFormatado);\n\t}\n\n\t@Test\n\tpublic void testLinhaDoBancoItau() {\n\t\tthis.banco = new Itau();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\t\tGeradorDeLinhaDigitavel linhaDigitavelGenerator = new GeradorDeLinhaDigitavel();\n\t\tString codigoDeBarras = boleto.getBanco().geraCodigoDeBarrasPara(this.boleto);\n\n\t\tassertEquals(\"34190.06006  00000.332940  90658.090007  9  31680000000100\",\n\t\t\t\tlinhaDigitavelGenerator.geraLinhaDigitavelPara(codigoDeBarras));\n\t}\n\n\t@Test\n\tpublic void testCodigoDeBarraDoBancoItau() {\n\t\tthis.banco = new Itau();\n\t\tthis.boleto = this.boleto.withBanco(this.banco);\n\n\t\tassertEquals(\"34199316800000001000060000000332949065809000\", this.banco.geraCodigoDeBarrasPara(this.boleto));\n\t}\n\n\t@Test\n\tpublic void testGetImage() {\n\t\tassertNotNull(this.banco.getImage());\n\t}\n}\n","lineNo":64}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos.gerador;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\npublic class DigitoPara {\n\n\tprivate List<Integer> numero;\n\tprivate int inicio;\n\tprivate int fim;\n\n\tpublic DigitoPara(String trecho) {\n\t\tthis.numero = new ArrayList<Integer>();\n\t\tchar[] digitos = trecho.toCharArray();\n\t\tfor (char digito : digitos) {\n\t\t\tthis.numero.add(Character.getNumericValue(digito));\n\t\t}\n\t}\n\n\tpublic DigitoPara comMultiplicadoresDeAte(int inicio, int fim) {\n\t\tthis.inicio = inicio;\n\t\tthis.fim = fim;\n\t\treturn this;\n\t}\n\n\tpublic int mod(int modulo) {\n\t\tint soma = 0;\n\t\tfor (int i = numero.size() - 1, multiplicador = inicio; i >= 0; i--, multiplicador++) {\n\t\t\tif (multiplicador > fim)\n\t\t\t\tmultiplicador = inicio;\n\t\t\tsoma += numero.get(i) * multiplicador;\n\t\t}\n\t\treturn modulo - (soma % modulo);\n\t}\n\t\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos.gerador;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.Collections;\nimport java.util.List;\n\n/**\n * Uma fluent interface para o cálculo de dígitos, que é usado em diversos boletos e \n * documentos. \n * \n * Para exemplificar, o dígito do trecho 0000039104766 para os multiplicadores indo de \n * 2 a 7 e usando módulo 11 é a seguinte:\n * \n * <pre>\n *\t0  0  0  0  0  3  9  1  0  4  7  6  6 (trecho numérico)\n *\t2  7  6  5  4  3  2  7  6  5  4  3  2 (multiplicadores, da direita para a esquerda e ciclando)\n *\t----------------------------------------- multiplicações algarismo a algarismo \n *\t 0  0  0  0  0  9 18  7  0 20 28 18 12 ---> soma = 112\n * <\/pre>\n * \n * Tira-se o módulo dessa soma e, então, calcula-se o complementar do módulo e, se o número \n * for 0, 10 ou 11, o dígito passa a ser 1.\n * \n * <pre>\n * \t\tsoma = 112\n * \t\tsoma % 11 = 2\n * \t\t11 - (soma % 11) = 9\n * <\/pre>\n * \n * @author ceci\n */\npublic class DigitoPara {\n\n\tprivate List<Integer> numero;\n\tprivate List<Integer> multiplicadores;\n\tprivate boolean complementar;\n\tprivate List<Integer> aSubstituir;\n\tprivate String substituto;\n\n\t/**\n\t * Cria o objeto a ser preenchido com interface fluente e armazena o trecho numérico\n\t * em uma lista de algarismos. Isso é necessário porque a linha digitada pode ser \n\t * muito maior do que um int suporta.\n\t * \n\t * @param trecho Refere-se à linha numérica sobre a qual o dígito deve ser calculado\n\t */\n\tpublic DigitoPara(String trecho) {\n\t\tthis.aSubstituir = Collections.emptyList();\n\t\tthis.numero = new ArrayList<Integer>();\n\t\tchar[] digitos = trecho.toCharArray();\n\t\tfor (char digito : digitos) {\n\t\t\tthis.numero.add(Character.getNumericValue(digito));\n\t\t}\n\t\tCollections.reverse(numero);\n\t}\n\n\t/**\n\t * Para multiplicadores (ou pesos) sequenciais e em ordem crescente, esse método permite \n\t * criar a lista de multiplicadores que será usada cíclicamente, caso o número base seja\n\t * maior do que a sequência de multiplicadores.\n\t * \n\t * @param inicio Primeiro número do intervalo sequencial de multiplicadores\n\t * @param fim Último número do intervalo sequencial de multiplicadores\n\t */\n\tpublic DigitoPara comMultiplicadoresDeAte(int inicio, int fim) {\n\t\tthis.multiplicadores = new ArrayList<Integer>();\n\t\tfor (int i = inicio; i <= fim; i++) {\n\t\t\tmultiplicadores.add(i);\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Há documentos em que os multiplicadores não usam todos os números de um intervalo \n\t * ou alteram sua ordem. Nesses casos, a lista de multiplicadores pode ser passada \n\t * através de varargs.\n\t * \n\t * @param multiplicadoresEmOrdem Sequência de inteiros com os multiplicadores em ordem\n\t */\n\tpublic DigitoPara comMultiplicadores(Integer... multiplicadoresEmOrdem) {\n\t\tthis.multiplicadores = Arrays.asList(multiplicadoresEmOrdem);\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * \u2030 comum que os geradores de dígito precisem do complementar do módulo em vez\n\t * do módulo em sí. Então, a chamada desse método habilita a flag que é usada \n\t * no método mod para decidir se o resultado devolvido é o módulo puro ou seu \n\t * complementar.\n\t */\n\tpublic DigitoPara complementarAoModulo() {\n\t\tthis.complementar = true;\n\t\treturn this;\n\t}\n\n\t\n\tpublic DigitoPara trocandoPorSeEncontrar(String substituto, Integer... i) {\n\t\tthis.substituto = substituto;\n\t\tthis.aSubstituir = Arrays.asList(i);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Faz a soma geral das multiplicações dos algarismos pelos multiplicadores, tira o \n\t * módulo e devolve seu complementar.\n\t * \n\t * @param modulo Inteiro pelo qual o resto será tirado e também seu complementar\n\t * @return String o dígito vindo do módulo com o número passado e configurações extra.\n\t */\n\tpublic String mod(int modulo) {\n\t\tint soma = 0;\n\t\tint multiplicadorDaVez = 0;\n\t\tfor (int algarismo : numero) {\n\t\t\tsoma += algarismo * multiplicadores.get(multiplicadorDaVez);\n\t\t\tmultiplicadorDaVez = proximoMultiplicador(multiplicadorDaVez);\n\t\t}\n\t\tint resultado = soma % modulo;\n\t\tif (complementar)\n\t\t\tresultado = modulo - resultado;\n\t\treturn aSubstituir.contains(resultado) ? substituto : String.valueOf(resultado);\n\t}\n\n\t/**\n\t * Devolve o próximo multiplicador a ser usado, isto é, a próxima posição da lista de\n\t * multiplicadores ou, se chegar ao fim da lista, a primeira posição, novamente.\n\t *  \n\t * @param multiplicadorDaVez Essa é a posição do último multiplicador usado.\n\t */\n\tprivate int proximoMultiplicador(int multiplicadorDaVez) {\n\t\tmultiplicadorDaVez++;\n\t\tif (multiplicadorDaVez == multiplicadores.size())\n\t\t\tmultiplicadorDaVez = 0;\n\t\treturn multiplicadorDaVez;\n\t}\n}\n","lineNo":118}
{"Smelly Sample":"package br.com.caelum.stella.boleto.transformer;\n\nimport java.awt.Image;\nimport java.awt.image.BufferedImage;\nimport java.io.IOException;\nimport java.net.URL;\nimport java.util.Calendar;\n\nimport javax.imageio.ImageIO;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.bancos.LinhaDigitavelGenerator;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\nimport br.com.caelum.stella.boleto.exception.GeracaoBoletoException;\n\n/**\n * Classe que centraliza a criação dos boletos que tem como template o\n * template.png e antes ficava no BoletoTransformer\n * \n * \n */\n\nclass PNGPDFTransformerHelper {\n\t/*Ainda precisa de um nome melhor!!*/\n\n\tpublic static final float IMAGEM_BOLETO_WIDTH = 2144;\n\tpublic static final float IMAGEM_BOLETO_HEIGHT = 1604;\n\tpublic static final double BOLETO_TEMPLATE_SCALE = 1 / 2d;\n\n\tprivate static final float LINHA1 = 434;\n\tprivate static final float LINHA2 = 412;\n\tprivate static final float LINHA3 = 391;\n\tprivate static final float LINHA4 = 319;\n\tprivate static final float LINHA5 = 291;\n\tprivate static final float LINHA6 = 271;\n\tprivate static final float LINHA7 = 250;\n\tprivate static final float LINHA8 = 227;\n\tprivate static final float LINHA9 = 205;\n\tprivate static final float LINHA10 = 132;\n\tprivate static final float LINHA11 = 97;\n\tprivate static final float LINHA12 = 87;\n\tprivate static final float LINHA13 = 77;\n\tprivate TextWriter writer;\n\tprivate URL imagemTitulo;\n\n\n\tpublic PNGPDFTransformerHelper(TextWriter writer) {\n\t\tsuper();\n\t\tthis.writer = writer;\n\t\tthis.imagemTitulo = PNGPDFTransformerHelper.class\n\t\t\t\t.getResource(\"/br/com/caelum/stella/boleto/img/template.png\");\t\t\n\t}\n\n\t/**\n\t * \n\t * @param boleto\n\t * @return\n\t */\n\tpublic TextWriter transform(Boleto boleto) {\n\t\t// gera template com o fundo do boleto\n\t\ttry {\n\t\t\tthis.writer.writeImage(0, 55, imageFor(imagemTitulo), 514.22f,\n\t\t\t\t\t385.109f);\n\t\t\tthis.writer.writeImage(0, 805 - 486, imageFor(boleto.getBanco()\n\t\t\t\t\t.getImage()), 100, 23);\n\t\t} catch (IOException e) {\n\t\t\tthrow new GeracaoBoletoException(\n\t\t\t\t\t\"Erro na leitura das imagens do boleto\", e);\n\t\t}\n\n\t\tfor (int i = 0; i < boleto.getDescricoes().size(); i++) {\n\t\t\tthis.writer.writeBold(5, 805 - 70 - i * 15, boleto.getDescricoes()\n\t\t\t\t\t.get(i));\n\t\t}\n\n\t\tthis.writer.write(50, LINHA1, boleto.getEmissor().getCedente());\n\n\t\tthis.writer.write(5, LINHA2, boleto.getSacado().getNome());\n\n\t\tthis.writer.write(230, LINHA2, formatDate(boleto.getDatas()\n\t\t\t\t.getVencimento()));\n\n\t\tthis.writer.write(400, LINHA2, BoletoFormatter.formatValue(boleto\n\t\t\t\t.getValorBoleto().doubleValue()));\n\n\t\tthis.writer.write(5, LINHA3, boleto.getAgenciaECodigoCedente());\n\n\t\tthis.writer.write(146, LINHA3, boleto.getBanco()\n\t\t\t\t.getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\n\t\tthis.writer.writeBold(125, LINHA4, boleto.getBanco().getNumeroFormatadoComDigito());\n\n\t\tLinhaDigitavelGenerator linhaDigitavelGenerator = new LinhaDigitavelGenerator();\n\t\tthis.writer.writeBold(175, LINHA4, linhaDigitavelGenerator\n\t\t\t\t.geraLinhaDigitavelPara(boleto));\n\n\t\tfor (int i = 0; i < boleto.getLocaisDePagamento().size(); i++) {\n\t\t\tthis.writer.write(5, LINHA5 - (i - 1) * 10, boleto\n\t\t\t\t\t.getLocaisDePagamento().get(i));\n\t\t}\n\n\t\tthis.writer.write(425, LINHA5, formatDate(boleto.getDatas()\n\t\t\t\t.getVencimento()));\n\n\t\tthis.writer.write(5, LINHA6, boleto.getEmissor().getCedente());\n\n\t\tthis.writer.write(420, LINHA6, boleto.getAgenciaECodigoCedente());\n\n\t\tthis.writer.write(5, LINHA7, formatDate(boleto.getDatas()\n\t\t\t\t.getDocumento()));\n\n\t\tthis.writer.write(70, LINHA7,\n\t\t\t\t!boleto.getNumeroDoDocumento().equals(\"\") ? boleto\n\t\t\t\t\t\t.getNumeroDoDocumentoFormatado() : boleto.getBanco()\n\t\t\t\t\t\t.getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\n\t\tthis.writer.write(180, LINHA7, boleto.getEspecieDocumento());\n\n\t\tthis.writer.write(250, LINHA7, boleto.getAceite() ? \"S\" : \"N\");\n\n\t\tthis.writer.write(300, LINHA7, formatDate(boleto.getDatas()\n\t\t\t\t.getProcessamento()));\n\n\t\tthis.writer.write(410, LINHA7, boleto.getEmissor().getCarteira()\n\t\t\t\t+ \" / \"\n\t\t\t\t+ boleto.getBanco().getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\n\t\tthis.writer.write(122, LINHA8, boleto.getBanco()\n\t\t\t\t.getCarteiraDoEmissorFormatado(boleto.getEmissor()));\n\n\t\tthis.writer.write(190, LINHA8, boleto.getEspecieMoeda());\n\n\t\tthis.writer.write(430, LINHA8, BoletoFormatter.formatValue(boleto\n\t\t\t\t.getValorBoleto().doubleValue()));\n\n\t\tfor (int i = 0; i < boleto.getInstrucoes().size(); i++) {\n\t\t\tthis.writer\n\t\t\t\t\t.write(5, LINHA9 - i * 10, boleto.getInstrucoes().get(i));\n\t\t}\n\n\t\tthis.writer.write(5, LINHA10, boleto.getEmissor().getCedente());\n\n\t\tthis.writer.write(100, LINHA11, (boleto.getSacado().getNome() != null ? boleto.getSacado().getNome() : \"\") + \" \"\n\t\t\t\t+ (boleto.getSacado().getCpf() != null ? boleto.getSacado().getCpf() : \"\"));\n\n\t\tthis.writer.write(100, LINHA12, (boleto.getSacado().getEndereco() != null ? boleto.getSacado().getEndereco() : \"\"));\n\n\t\tthis.writer.write(100, LINHA13, (boleto.getSacado().getCep() != null ? boleto.getSacado().getCep() : \"\") + \" \"\n\t\t\t\t+ (boleto.getSacado().getBairro() != null ? boleto.getSacado().getBairro() : \"\") + \" - \"\n\t\t\t\t+ (boleto.getSacado().getCidade() != null ? boleto.getSacado().getCidade() : \"\") + \" \"\n\t\t\t\t+ (boleto.getSacado().getUf() != null ? boleto.getSacado().getUf() : \"\"));\n\n\t\tImage imagemDoCodigoDeBarras = BarcodeGenerator\n\t\t\t\t.generateBarcodeFor(boleto.getBanco().geraCodigoDeBarrasPara(\n\t\t\t\t\t\tboleto),37.00f);\t\t\n\n\t\ttry {\n\t\t\tthis.writer.writeImage(40, 10, toBufferedImage(\n\t\t\t\t\timagemDoCodigoDeBarras, BufferedImage.TYPE_INT_ARGB),\n\t\t\t\t\timagemDoCodigoDeBarras.getWidth(null),\n\t\t\t\t\timagemDoCodigoDeBarras.getHeight(null));\n\t\t} catch (IOException e) {\n\t\t\tthrow new CriacaoBoletoException(\n\t\t\t\t\t\"Erro na geração do código de barras\", e);\n\t\t}\n\t\treturn writer;\n\n\t}\n\n\t/**\n\t * Converte um Image em um BufferedImage\n\t * \n\t * @param image\n\t * @param type\n\t */\n\tprivate BufferedImage toBufferedImage(Image image, int type) {\n\t\treturn BufferedImageGenerator.generateBufferedImageFor(image,type);\n\t}\n\n\t/**\n\t * Abre um arquivo em um BufferedImage\n\t * \n\t * @param file\n\t * @return\n\t * @throws IOException\n\t */\n\tprivate BufferedImage imageFor(URL file) throws IOException {\n\t\treturn ImageIO.read(file);\n\t}\n\n\t/**\n\t * Formata uma data para dd/mm/yyyy\n\t * \n\t * @param date\n\t * @return\n\t */\n\tprivate String formatDate(Calendar date) {\n\t\treturn BoletoFormatter.formatDate(date);\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.transformer;\n\nimport java.awt.Image;\nimport java.awt.image.BufferedImage;\nimport java.io.IOException;\nimport java.net.URL;\nimport java.util.Calendar;\n\nimport javax.imageio.ImageIO;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.bancos.LinhaDigitavelGenerator;\nimport br.com.caelum.stella.boleto.exception.CriacaoBoletoException;\nimport br.com.caelum.stella.boleto.exception.GeracaoBoletoException;\n\n/**\n * Classe que centraliza a criação dos boletos que tem como template o\n * template.png e antes ficava no BoletoTransformer\n * \n * \n */\n\nclass PNGPDFTransformerHelper {\n\t/*Ainda precisa de um nome melhor!!*/\n\n\tpublic static final float IMAGEM_BOLETO_WIDTH = 2144;\n\tpublic static final float IMAGEM_BOLETO_HEIGHT = 1604;\n\tpublic static final double BOLETO_TEMPLATE_SCALE = 1 / 2d;\n\n\tprivate static final float LINHA1 = 434;\n\tprivate static final float LINHA_ENDERECO_CEDENTE = 423;\n\tprivate static final float LINHA_ENDERECO = 122;\n\t\n\tprivate static final float LINHA2 = 400;\n\tprivate static final float LINHA3 = 378;\n\tprivate static final float LINHA4 = 319;\n\tprivate static final float LINHA5 = 291;\n\tprivate static final float LINHA6 = 271;\n\tprivate static final float LINHA7 = 250;\n\tprivate static final float LINHA8 = 227;\n\tprivate static final float LINHA9 = 205;\n\tprivate static final float LINHA10 = 132;\n\tprivate static final float LINHA11 = 97;\n\tprivate static final float LINHA12 = 87;\n\tprivate static final float LINHA13 = 77;\n\tprivate TextWriter writer;\n\tprivate URL imagemTitulo;\n\n\n\tpublic PNGPDFTransformerHelper(TextWriter writer) {\n\t\tsuper();\n\t\tthis.writer = writer;\n\t\tthis.imagemTitulo = PNGPDFTransformerHelper.class.getResource(\"/br/com/caelum/stella/boleto/img/template.png\");\t\t\n\t}\n\n\t/**\n\t * \n\t * @param boleto\n\t * @return\n\t */\n\tpublic TextWriter transform(Boleto boleto) {\n\t\t// gera template com o fundo do boleto\n\t\ttry {\n\t\t\tthis.writer.writeImage(0, 55, imageFor(imagemTitulo), 514.22f,\n\t\t\t\t\t385.109f);\n\t\t\tthis.writer.writeImage(0, 805 - 486, imageFor(boleto.getBanco()\t.getImage()), 100, 23);\n\t\t} catch (IOException e) {\n\t\t\tthrow new GeracaoBoletoException(\"Erro na leitura das imagens do boleto\", e);\n\t\t}\n\n\t\tfor (int i = 0; i < boleto.getDescricoes().size(); i++) {\n\t\t\tthis.writer.writeBold(5, 805 - 70 - i * 15, boleto.getDescricoes().get(i));\n\t\t}\n\n\t\tthis.writer.write(50, LINHA1, boleto.getEmissor().getCedente());\n\t\t\n\t\t//TODO REMOVER  VALOR FIXO\n\t\tthis.writer.write(50, LINHA_ENDERECO_CEDENTE, \"RODOVIA SC 401, KM 1 - EDIF?CIO CELTA, PARQTEC ALFA 88030-000 | FLORIAN\u201cPOLIS\");\n\t\t\n\t\tthis.writer.write(5, LINHA2, boleto.getSacado().getNome());\n\n\t\tthis.writer.write(290, LINHA2, formatDate(boleto.getDatas().getVencimento()));\n\n\t\tthis.writer.write(377, LINHA2, BoletoFormatter.formatValue(boleto.getValorBoleto().doubleValue()));\n\n\t\tthis.writer.write(5, LINHA3, boleto.getAgenciaECodigoCedente());\n\n\t\tString nossoNumeroDoEmissorFormatado = boleto.getBanco().getNossoNumeroDoEmissorFormatado(boleto.getEmissor());\n\t\t\n\t\tString nossoDigitoNumeroDoEmissorFormatado = boleto.getBanco().getDigitoNossoNumeroDoEmissorFormatado(boleto.getEmissor());\n\n\t\t\n\t\t//TODO POLIMORFISMO AQUI\n\t\t\n\t\tif (boleto.getBanco().getNumeroFormatado().equals(\"237\")){\n\t\t\tif (nossoDigitoNumeroDoEmissorFormatado.isEmpty()){\n\t\t\t\tthis.writer.write(146, LINHA3, boleto.getEmissor().getCarteira()+ \" / \"+ nossoNumeroDoEmissorFormatado);\n\t\t\t} else {\n\t\t\t\tthis.writer.write(146, LINHA3, boleto.getEmissor().getCarteira()+ \" / \"\t+ nossoNumeroDoEmissorFormatado+\"-\"+nossoDigitoNumeroDoEmissorFormatado);\n\t\t\t}\n\t\t\t\n\t\t}\n\t\tif (boleto.getBanco().getNumeroFormatado().equals(\"001\")){\n\t\t\tif (nossoDigitoNumeroDoEmissorFormatado.isEmpty()){\n\t\t\t\tthis.writer.write(146, LINHA3, nossoNumeroDoEmissorFormatado);\n\t\t\t} else {\n\t\t\t\tthis.writer.write(146, LINHA3,  nossoNumeroDoEmissorFormatado+\"-\"+nossoDigitoNumeroDoEmissorFormatado);\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t String digitoNumeroBanco = boleto.getBanco().getDigitoNumeroBanco();\n\t\t \n\t\tif (boleto.getBanco().getNumeroFormatado().equals(\"237\")){\n\t\t\t if (digitoNumeroBanco.isEmpty()){\n\t\t\t\t this.writer.writeBold(125, LINHA4, boleto.getBanco().getNumeroFormatadoComDigito());\n\t\t\t } else{\n\t\t\t\t this.writer.writeBold(125, LINHA4, boleto.getBanco().getNumeroFormatadoComDigito()+\"-\"+digitoNumeroBanco);\n\t\t\t }\n\t\t}\n\t\tif (boleto.getBanco().getNumeroFormatado().equals(\"001\")){\n\t\t\t this.writer.writeBold(125, LINHA4, boleto.getBanco().getNumeroFormatadoComDigito()+\"-\"+digitoNumeroBanco);\n\t\t}\n\t\t \n\n\n\t\tLinhaDigitavelGenerator linhaDigitavelGenerator = new LinhaDigitavelGenerator();\n\t\tthis.writer.writeBold(175, LINHA4, linhaDigitavelGenerator\n\t\t\t\t.geraLinhaDigitavelPara(boleto));\n\n\t\tfor (int i = 0; i < boleto.getLocaisDePagamento().size(); i++) {\n\t\t\tthis.writer.write(5, LINHA5 - (i - 1) * 10, boleto\n\t\t\t\t\t.getLocaisDePagamento().get(i));\n\t\t}\n\n\t\tthis.writer.write(425, LINHA5, formatDate(boleto.getDatas().getVencimento()));\n\n\t\tthis.writer.write(5, LINHA6, boleto.getEmissor().getCedente());\n\n\t\tthis.writer.write(420, LINHA6, boleto.getAgenciaECodigoCedente());\n\n\t\tthis.writer.write(5, LINHA7, formatDate(boleto.getDatas()\n\t\t\t\t.getDocumento()));\n\n\t\tthis.writer.write(70, LINHA7,\n\t\t\t\t!boleto.getNumeroDoDocumento().equals(\"\") ? boleto\n\t\t\t\t\t\t.getNumeroDoDocumentoFormatado() : boleto.getBanco()\n\t\t\t\t\t\t.getNossoNumeroDoEmissorFormatado(boleto.getEmissor()));\n\n\t\tthis.writer.write(180, LINHA7, boleto.getEspecieDocumento());\n\n\t\tthis.writer.write(250, LINHA7, boleto.getAceite() ? \"S\" : \"N\");\n\n\t\tthis.writer.write(300, LINHA7, formatDate(boleto.getDatas()\n\t\t\t\t.getProcessamento()));\n\n\t\t\n\t\t\n\t\t\n\t\t// TODO POLIMORFISMO AQUI\n\t\tif (boleto.getBanco().getNumeroFormatado().equals(\"237\")){\n\t\t\tif (nossoDigitoNumeroDoEmissorFormatado.isEmpty()){\n\t\t\t\tthis.writer.write(410, LINHA7, boleto.getEmissor().getCarteira()+ \" / \"+ nossoNumeroDoEmissorFormatado);\n\t\t\t} else {\n\t\t\t\tthis.writer.write(410, LINHA7, boleto.getEmissor().getCarteira()+ \" / \"\t+ nossoNumeroDoEmissorFormatado+\"-\"+nossoDigitoNumeroDoEmissorFormatado);\n\t\t\t}\n\t\t\t\n\t\t}\n\t\tif (boleto.getBanco().getNumeroFormatado().equals(\"001\")){\n\t\t\tif (nossoDigitoNumeroDoEmissorFormatado.isEmpty()){\n\t\t\t\tthis.writer.write(410, LINHA7, nossoNumeroDoEmissorFormatado);\n\t\t\t} else {\n\t\t\t\tthis.writer.write(410, LINHA7,  nossoNumeroDoEmissorFormatado+\"-\"+nossoDigitoNumeroDoEmissorFormatado);\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\tthis.writer.write(122, LINHA8, boleto.getBanco()\n\t\t\t\t.getCarteiraDoEmissorFormatado(boleto.getEmissor()));\n\n\t\tthis.writer.write(190, LINHA8, boleto.getEspecieMoeda());\n\n\t\tthis.writer.write(430, LINHA8, BoletoFormatter.formatValue(boleto\n\t\t\t\t.getValorBoleto().doubleValue()));\n\n\t\tfor (int i = 0; i < boleto.getInstrucoes().size(); i++) {\n\t\t\tthis.writer\n\t\t\t\t\t.write(5, LINHA9 - i * 10, boleto.getInstrucoes().get(i));\n\t\t}\n\n\t\tthis.writer.write(5, LINHA10, boleto.getEmissor().getCedente());\n\t\t//TODO REMOVER INFO FIXA\n\t\tthis.writer.write(5, LINHA_ENDERECO, \"RODOVIA SC 401, KM 1 - EDIF?CIO CELTA, PARQTEC ALFA 88030-000 | FLORIAN\u201cPOLIS\");\n\n\t\tthis.writer.write(100, LINHA11, (boleto.getSacado().getNome() != null ? boleto.getSacado().getNome() : \"\") + \" \"\n\t\t\t\t+ (boleto.getSacado().getCpf() != null ? boleto.getSacado().getCpf() : \"\"));\n\n\t\tthis.writer.write(100, LINHA12, (boleto.getSacado().getEndereco() != null ? boleto.getSacado().getEndereco() : \"\"));\n\n\t\tthis.writer.write(100, LINHA13, (boleto.getSacado().getCep() != null ? boleto.getSacado().getCep() : \"\") + \" \"\n\t\t\t\t+ (boleto.getSacado().getBairro() != null ? boleto.getSacado().getBairro() : \"\") + \" - \"\n\t\t\t\t+ (boleto.getSacado().getCidade() != null ? boleto.getSacado().getCidade() : \"\") + \" \"\n\t\t\t\t+ (boleto.getSacado().getUf() != null ? boleto.getSacado().getUf() : \"\"));\n\n\t\tImage imagemDoCodigoDeBarras = BarcodeGenerator\n\t\t\t\t.generateBarcodeFor(boleto.getBanco().geraCodigoDeBarrasPara(\n\t\t\t\t\t\tboleto),37.00f);\t\t\n\n\t\ttry {\n\t\t\tthis.writer.writeImage(40, 10, toBufferedImage(\n\t\t\t\t\timagemDoCodigoDeBarras, BufferedImage.TYPE_INT_ARGB),\n\t\t\t\t\timagemDoCodigoDeBarras.getWidth(null),\n\t\t\t\t\timagemDoCodigoDeBarras.getHeight(null));\n\t\t} catch (IOException e) {\n\t\t\tthrow new CriacaoBoletoException(\n\t\t\t\t\t\"Erro na geração do código de barras\", e);\n\t\t}\n\t\treturn writer;\n\n\t}\n\n\t/**\n\t * Converte um Image em um BufferedImage\n\t * \n\t * @param image\n\t * @param type\n\t */\n\tprivate BufferedImage toBufferedImage(Image image, int type) {\n\t\treturn BufferedImageGenerator.generateBufferedImageFor(image,type);\n\t}\n\n\t/**\n\t * Abre um arquivo em um BufferedImage\n\t * \n\t * @param file\n\t * @return\n\t * @throws IOException\n\t */\n\tprivate BufferedImage imageFor(URL file) throws IOException {\n\t\treturn ImageIO.read(file);\n\t}\n\n\t/**\n\t * Formata uma data para dd/mm/yyyy\n\t * \n\t * @param date\n\t * @return\n\t */\n\tprivate String formatDate(Calendar date) {\n\t\treturn BoletoFormatter.formatDate(date);\n\t}\n\n}\n","lineNo":88}
{"Smelly Sample":"package br.com.caelum.stella.validation.ie;\n\nimport java.util.regex.Pattern;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.SimpleMessageProducer;\nimport br.com.caelum.stella.validation.DigitoVerificadorInfo;\nimport br.com.caelum.stella.validation.RotinaDeDigitoVerificador;\nimport br.com.caelum.stella.validation.ValidadorDeDV;\n\n/**\n * <p>\n * Documentação de referência:\n * <\/p>\n * <a href=\"http://www.pfe.fazenda.sp.gov.br/consist_ie.shtm\">Secretaria da\n * Fazenda do Estado de São Paulo<\/a> <a\n * href=\"http://www.sintegra.gov.br/Cad_Estados/cad_BA.html\">SINTEGRA - ROTEIRO\n * DE CR?TICA DA INSCRI\u2021ÃO ESTADUAL <\/a>\n * \n */\npublic class IEBahiaValidator extends AbstractIEValidator {\n\n    private static final RotinaDeDigitoVerificador[] rotinas = { IEConstraints.Rotina.E, IEConstraints.Rotina.POS_IE };\n\n    private static final int DVX_POSITION = 6 + 8;\n\n    private static final int DVY_POSITION = 6 + 7;\n\n    private static final Integer[] DVX_MULTIPLIERS = IEConstraints.P2;\n\n    private static final Integer[] DVY_MULTIPLIERS = IEConstraints.P3;\n\n    private static final DigitoVerificadorInfo DVX_INFO_MOD11 = new DigitoVerificadorInfo(0, rotinas, 11,\n            DVX_MULTIPLIERS, DVX_POSITION);\n\n    private static final ValidadorDeDV DVX_CHECKER_MOD11 = new ValidadorDeDV(DVX_INFO_MOD11);\n\n    private static final DigitoVerificadorInfo DVY_INFO_MOD11 = new DigitoVerificadorInfo(0, rotinas, 11,\n            DVY_MULTIPLIERS, DVY_POSITION);\n\n    private static final ValidadorDeDV DVY_CHECKER_MOD11 = new ValidadorDeDV(DVY_INFO_MOD11);\n\n    private static final DigitoVerificadorInfo DVX_INFO_MOD10 = new DigitoVerificadorInfo(0, rotinas, 10,\n            DVX_MULTIPLIERS, DVX_POSITION);\n\n    private static final ValidadorDeDV DVX_CHECKER_MOD10 = new ValidadorDeDV(DVX_INFO_MOD10);\n\n    private static final DigitoVerificadorInfo DVY_INFO_MOD10 = new DigitoVerificadorInfo(0, rotinas, 10,\n            DVY_MULTIPLIERS, DVY_POSITION);\n\n    private static final ValidadorDeDV DVY_CHECKER_MOD10 = new ValidadorDeDV(DVY_INFO_MOD10);\n\n\n    /*\n     * 612345-57\n     * \n     * 123456-63\n     */\n    public static final Pattern FORMATED = Pattern.compile(\"(\\\\d{6})[-](\\\\d{2})\");\n\n    public static final Pattern UNFORMATED = Pattern.compile(\"(\\\\d{6})(\\\\d{2})\");\n\n\t/**\n\t * Este considera, por padrão, que as cadeias estão formatadas e utiliza um\n\t * {@linkplain SimpleMessageProducer} para geração de mensagens.\n\t */\n\tpublic IEBahiaValidator() {\n\t\tsuper(true);\n\t}\n\n\t/**\n\t * O validador utiliza um {@linkplain SimpleMessageProducer} para geração de\n\t * mensagens.\n\t * \n\t * @param isFormatted\n\t *            considerar cadeia formatada quando <code>true<\/code>\n\t */\n\tpublic IEBahiaValidator(boolean isFormatted) {\n\t\tsuper(isFormatted);\n\t}\n\n\tpublic IEBahiaValidator(MessageProducer messageProducer, boolean isFormatted) {\n\t\tsuper(messageProducer, isFormatted);\n\t}\n\n\n\t@Override\n\tprotected Pattern getUnformattedPattern() {\n\t\treturn UNFORMATED;\n\t}\n\n\t@Override\n\tprotected Pattern getFormattedPattern() {\n\t\treturn FORMATED;\n\t}\n  \n    protected boolean hasValidCheckDigits(String value) {\n        String testedValue = IEConstraints.PRE_VALIDATION_FORMATTER.format(value);\n        boolean result = false;\n        switch (value.charAt(0)) {\n        case '6':\n        case '7':\n        case '9':\n            result = DVX_CHECKER_MOD11.isDVValid(testedValue) && DVY_CHECKER_MOD11.isDVValid(testedValue);\n            break;\n        default:\n            result = DVX_CHECKER_MOD10.isDVValid(testedValue) && DVY_CHECKER_MOD10.isDVValid(testedValue);\n        }\n        return result;\n    }\n\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation.ie;\n\nimport java.util.regex.Pattern;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.SimpleMessageProducer;\nimport br.com.caelum.stella.validation.DigitoVerificadorInfo;\nimport br.com.caelum.stella.validation.RotinaDeDigitoVerificador;\nimport br.com.caelum.stella.validation.ValidadorDeDV;\n\n/**\n * <p>\n * Documentação de referência:\n * <\/p>\n * <a href=\"http://www.pfe.fazenda.sp.gov.br/consist_ie.shtm\">Secretaria da\n * Fazenda do Estado de São Paulo<\/a> <a\n * href=\"http://www.sintegra.gov.br/Cad_Estados/cad_BA.html\">SINTEGRA - ROTEIRO\n * DE CR?TICA DA INSCRI\u2021ÃO ESTADUAL <\/a>\n * \n */\npublic class IEBahiaValidator extends AbstractIEValidator {\n\n    private static final RotinaDeDigitoVerificador[] rotinas = { IEConstraints.Rotina.E, IEConstraints.Rotina.POS_IE };\n\n    private static final int DVX_POSITION = 6 + 8;\n\n    private static final int DVY_POSITION = 6 + 7;\n\n    private static final Integer[] DVX_MULTIPLIERS = IEConstraints.P2;\n\n    private static final Integer[] DVY_MULTIPLIERS = IEConstraints.P3;\n\n    private static final DigitoVerificadorInfo DVX_INFO_MOD11 = new DigitoVerificadorInfo(0, rotinas, 11,\n            DVX_MULTIPLIERS, DVX_POSITION);\n\n    private static final ValidadorDeDV DVX_CHECKER_MOD11 = new ValidadorDeDV(DVX_INFO_MOD11);\n\n    private static final DigitoVerificadorInfo DVY_INFO_MOD11 = new DigitoVerificadorInfo(0, rotinas, 11,\n            DVY_MULTIPLIERS, DVY_POSITION);\n\n    private static final ValidadorDeDV DVY_CHECKER_MOD11 = new ValidadorDeDV(DVY_INFO_MOD11);\n\n    private static final DigitoVerificadorInfo DVX_INFO_MOD10 = new DigitoVerificadorInfo(0, rotinas, 10,\n            DVX_MULTIPLIERS, DVX_POSITION);\n\n    private static final ValidadorDeDV DVX_CHECKER_MOD10 = new ValidadorDeDV(DVX_INFO_MOD10);\n\n    private static final DigitoVerificadorInfo DVY_INFO_MOD10 = new DigitoVerificadorInfo(0, rotinas, 10,\n            DVY_MULTIPLIERS, DVY_POSITION);\n\n    private static final ValidadorDeDV DVY_CHECKER_MOD10 = new ValidadorDeDV(DVY_INFO_MOD10);\n\n\n    /*\n     * 612345-57\n     * \n     * 123456-63\n     */\n    public static final Pattern FORMATED = Pattern.compile(\"(\\\\d{6,7})[-](\\\\d{2})\");\n\n    public static final Pattern UNFORMATED = Pattern.compile(\"(\\\\d{6,7})(\\\\d{2})\");\n\n\t/**\n\t * Este considera, por padrão, que as cadeias estão formatadas e utiliza um\n\t * {@linkplain SimpleMessageProducer} para geração de mensagens.\n\t */\n\tpublic IEBahiaValidator() {\n\t\tsuper(true);\n\t}\n\n\t/**\n\t * O validador utiliza um {@linkplain SimpleMessageProducer} para geração de\n\t * mensagens.\n\t * \n\t * @param isFormatted\n\t *            considerar cadeia formatada quando <code>true<\/code>\n\t */\n\tpublic IEBahiaValidator(boolean isFormatted) {\n\t\tsuper(isFormatted);\n\t}\n\n\tpublic IEBahiaValidator(MessageProducer messageProducer, boolean isFormatted) {\n\t\tsuper(messageProducer, isFormatted);\n\t}\n\n\n\t@Override\n\tprotected Pattern getUnformattedPattern() {\n\t\treturn UNFORMATED;\n\t}\n\n\t@Override\n\tprotected Pattern getFormattedPattern() {\n\t\treturn FORMATED;\n\t}\n  \n    protected boolean hasValidCheckDigits(String value) {\n        String testedValue = IEConstraints.PRE_VALIDATION_FORMATTER.format(value);\n        boolean result = false;\n        char charToCheck;\n        \n        if(value.length() == 8){\n        \tcharToCheck= value.charAt(0);\n        }else{\n        \tcharToCheck= value.charAt(1);\n        }\n        \n\t\tswitch (charToCheck) {\n        case '6':\n        case '7':\n        case '9':\n            result = DVX_CHECKER_MOD11.isDVValid(testedValue) && DVY_CHECKER_MOD11.isDVValid(testedValue);\n            break;\n        default:\n            result = DVX_CHECKER_MOD10.isDVValid(testedValue) && DVY_CHECKER_MOD10.isDVValid(testedValue);\n        }\n        return result;\n    }\n\n\n}\n","lineNo":100}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\n\npublic class Santander implements Banco {\n\n\tprivate final static String NUMERO_SANTANDER = \"033\";\n\n\tprivate final GeradorDeDigitoDeBoleto dvGenerator = new GeradorDeDigitoDeBoleto();\n\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(NUMERO_SANTANDER);\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\t// Digito Verificador sera inserido aqui.\n\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\n\t\tEmissor emissor = boleto.getEmissor();\n\n\t\tcodigoDeBarras.append(emissor.getAgenciaFormatado());\n\t\tcodigoDeBarras.append(getContaCorrenteDoEmissorFormatado(emissor));\n\n\t\tcodigoDeBarras.append(calculaDigitaoDeCobranca(emissor));\n\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor));\n\n\t\tcodigoDeBarras.insert(4,\n\t\t\t\tthis.dvGenerator.geraDigitoMod11(codigoDeBarras.toString()));\n\n\t\treturn codigoDeBarras.toString();\n\t}\n\n\t/**\n\t * Calculo relacionado apenas ao Banco Real\n\t * \n\t * @param emissor\n\t * @return\n\t */\n\tprivate int calculaDigitaoDeCobranca(Emissor emissor) {\n\t\treturn this.dvGenerator\n\t\t\t\t.geraDigitoMod10(getNossoNumeroDoEmissorFormatado(emissor)\n\t\t\t\t\t\t+ emissor.getAgenciaFormatado()\n\t\t\t\t\t\t+ getContaCorrenteDoEmissorFormatado(emissor));\n\t}\n\n\tpublic URL getImage() {\n\t\treturn getClass().getResource(\n\t\t\t\tString.format(\"/br/com/caelum/stella/boleto/img/%s.png\",\n\t\t\t\t\t\tgetNumeroFormatado()));\n\t}\n\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_SANTANDER;\n\t}\n\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%07d\", emissor.getContaCorrente());\n\t}\n\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%013d\", emissor.getNossoNumero());\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport java.net.URL;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigito;\nimport br.com.caelum.stella.boleto.bancos.gerador.GeradorDeDigitoSantander;\n\npublic class Santander implements Banco {\n\n\tprivate final static String NUMERO_SANTANDER = \"033\";\n\tprivate final static String NUMERO_SANTANDER_COM_DIGITO = \"033-7\";\n\n\tprivate final GeradorDeDigito dvGenerator = new GeradorDeDigitoSantander();\n\n\tpublic String geraCodigoDeBarrasPara(Boleto boleto) {\n\t\tStringBuilder codigoDeBarras = new StringBuilder();\n\t\tcodigoDeBarras.append(NUMERO_SANTANDER);\n\t\tcodigoDeBarras.append(String.valueOf(boleto.getCodigoEspecieMoeda()));\n\t\t// Digito Verificador sera inserido aqui.\n\n\t\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\t\tcodigoDeBarras.append(boleto.getValorFormatado());\n\n\t\tEmissor emissor = boleto.getEmissor();\n\t\t//campo livre\n\t\tcodigoDeBarras.append(String.format(\"%05d\", Integer.parseInt(emissor.getAgenciaFormatado())));\n\t\tcodigoDeBarras.append(getContaCorrenteDoEmissorFormatado(emissor));\n\n\t\tcodigoDeBarras.append(getNossoNumeroDoEmissorLimpo(emissor));\n\t\tcodigoDeBarras.append(\"00\"); // filler\n\t\tcodigoDeBarras.append(NUMERO_SANTANDER);\n\t\t\n\t\tcodigoDeBarras.append(calculaDV1(codigoDeBarras));\n\t\t\n\t\tcodigoDeBarras.append(calculaDV2(codigoDeBarras));\n\t\t\n\t\tcodigoDeBarras.insert(4,this.dvGenerator.geraDigitoMod10(codigoDeBarras.toString()));\n\t\treturn codigoDeBarras.toString();\n\t}\n\t\n\tprivate Object getNossoNumeroDoEmissorLimpo(Emissor emissor) {\n\t\tString nossoNumero = String.valueOf(emissor.getNossoNumero());\n\t\t\n\t\tif(nossoNumero.length() > 7){\n\t\t\tnossoNumero = nossoNumeroSemAgencia(nossoNumero);\n\t\t}\n\t\treturn String.format(\"%07d\", Long.parseLong(nossoNumero));\n\t}\n\n\tprotected int calculaDV2(StringBuilder codigoDeBarras) {\n\t\t\n\t\tint tamanho = codigoDeBarras.length();\n\t\tint ultimaPosicao = tamanho -1;\n\t\tint dv1 = Integer.parseInt(codigoDeBarras.substring(ultimaPosicao));\n\t\t\n\t\tint digito = this.dvGenerator.geraDigitoMod(codigoDeBarras.substring(18),2,7, 11);\n\t\tif(digito == 1){\n\t\t\tint novoDV1 = (dv1 + 1)  % 10;\n\t\t\tcodigoDeBarras.replace(ultimaPosicao, tamanho, String.valueOf(novoDV1));\n\t\t\treturn calculaDV2(codigoDeBarras);\n\t\t}\n\t\t\n\t\tif( digito > 1){\n\t\t\treturn 11 - digito;\n\t\t}\n\t\treturn digito;\n\t}\n\n\tprotected int  calculaDV1(StringBuilder codigoDeBarras) {\n\t\treturn this.dvGenerator.geraDigitoMod10(codigoDeBarras.substring(18));\n\t}\n\t\n\tpublic URL getImage() {\n\t\treturn getClass().getResource(\n\t\t\t\tString.format(\"/br/com/caelum/stella/boleto/img/%s.png\",\n\t\t\t\t\t\tNUMERO_SANTANDER));\n\t}\n\n\tpublic String getNumeroFormatado() {\n\t\treturn NUMERO_SANTANDER;\n\t}\n\n\tpublic String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\t\treturn String.format(\"%02d\", emissor.getCarteira());\n\t}\n\n\tpublic String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\t\tString valor = String.valueOf(emissor.getContaCorrente());\n\t\t\n\t\tif(emissor.getDigitoContaCorrente() != 0){\n\t\t\tvalor += emissor.getDigitoContaCorrente();\n\t\t}\n\t\t\n\t\treturn String.format(\"%06d\", Long.parseLong(valor));\n\t}\n\n\t@Override\n\tpublic String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\t\tString digito = calculaDigitoNossoNumero(emissor.getNossoNumero());\n\t\treturn String.format(\"%07d\", Long.parseLong(emissor.getNossoNumero() + digito));\n\t}\n\n\tprivate String calculaDigitoNossoNumero(long nossoNumero) {\n\t\tint[] pesos =  {7,3,1,9};\n\t\tString nnumero = String.valueOf(nossoNumero);\n\t\tint soma = 0;\n\t\t\n\t\tfor(int i = 0, j = 0; i< nnumero.length(); i++, j++ ){\n\t\t\t\n\t\t\tif(j == pesos.length)\n\t\t\t\tj = 0;\n\t\t\tsoma+= Integer.parseInt(String.valueOf(nnumero.charAt(i))) * pesos[j];\n\t\t}\n\t\t\n\t\tint resto = soma % 10;\n\t\t\n\t\tint dv = 10 - resto;\n\t\t\n\t\tif(dv == 10){\n\t\t\treturn \"0\";\n\t\t}else{\n\t\t\treturn String.valueOf(dv);\n\t\t}\n\t}\n\n\tprotected String nossoNumeroSemAgencia(String nossoNumero) {\n\t\treturn nossoNumero.substring(3, nossoNumero.length());\n\t}\n\n\t@Override\n\tpublic String getNumeroFormatadoComDigito() {\n\t\treturn NUMERO_SANTANDER_COM_DIGITO;\n\t}\n\n\t@Override\n\tpublic GeradorDeDigito getGeradorDeDigito() {\n\t\treturn dvGenerator;\n\t}\n}\n","lineNo":91}
{"Smelly Sample":"package br.com.caelum.stella.example;\n\nimport br.com.caelum.stella.ValidationMessage;\nimport br.com.caelum.stella.validation.CPFValidator;\n\npublic class SimpleExample {\n    public static void main(String[] args) {\n        String cpf = \"867.554.707-24\";\n        for (ValidationMessage error : new CPFValidator().invalidMessagesFor(cpf)) {\n            System.out.println(error.getMessage());\n        }\n\n        new CPFValidator().assertValid(\"867.554.707-24\");\n\n    }\n}\n","Method after Refactoring":"package br.com.caelum.stella.example;\n\nimport java.util.List;\n\nimport br.com.caelum.stella.ValidationMessage;\nimport br.com.caelum.stella.validation.CPFValidator;\n\npublic class SimpleExample {\n\tpublic static void main(String[] args) {\n\t\tString cpf = \"867.554.707-24\";\n\t\tList<ValidationMessage> messages = new CPFValidator().invalidMessagesFor(cpf);\n\t\tfor (ValidationMessage error : messages) {\n\t\t\tSystem.out.println(error.getMessage());\n\t\t}\n\n\t\tnew CPFValidator().assertValid(\"867.554.707-24\");\n\t}\n}\n","lineNo":11}
{"Smelly Sample":"package br.com.caelum.stella.boleto;\n\nimport java.util.Calendar;\nimport java.util.GregorianCalendar;\n\n/**\n * Bean que representa as datas relacionadas a um Boleto.\n * \n * @author Paulo Silveira\n * @author Caue Guerra\n * @author Leonardo Bessa\n * \n */\npublic class Datas {\n    private Calendar documento;\n    private Calendar processamento;\n    private Calendar vencimento;\n    private static final Calendar MINIMUM_DATE = new GregorianCalendar(1997,\n            10, 7);\n    private static final Calendar MAXIMUM_DATE = new GregorianCalendar(2024, 1,\n            1);\n\n    private Datas() {\n    }\n\n    /**\n     * Cria novas datas<br/>\n     * Data do documento padrão: data atual<br/>\n     * Data do processamento padrão: data atual\n     * \n     */\n    public static Datas newDatas() {\n        return new Datas().withDocumento(Calendar.getInstance())\n                .withProcessamento(Calendar.getInstance());\n    }\n\n    /**\n     * Devolve a data do documento do boleto. (data de geração do boleto)<br/>\n     * Valor padrão: data de criação do boleto\n     * \n     * @return\n     */\n    public Calendar getDocumento() {\n        return this.documento;\n    }\n\n    /**\n     * Associa uma data do documento.<br/>\n     * Valor padrão: data atual\n     * \n     * @param documento\n     */\n    public Datas withDocumento(Calendar documento) {\n        if (documento.getTime().before(MINIMUM_DATE.getTime())) {\n            throw new IllegalArgumentException(\n                    \"O ano do documento deve ser maior do que 1997.\");\n        }\n        if (documento.getTime().after(MAXIMUM_DATE.getTime())) {\n            throw new IllegalArgumentException(\n                    \"O ano do documento deve ser menor do que 2024.\");\n        }\n        this.documento = documento;\n        return this;\n    }\n\n    /**\n     * Associa uma data do documento.<br/>\n     * Valor padrão: data atual\n     * \n     * @param documento\n     */\n    public Datas withDocumento(int dia, int mes, int ano) {\n        return withDocumento(dataPara(dia, mes, ano));\n    }\n\n    /**\n     * Devolve a data de processamento do boleto. (data de geração do boleto)<br/>\n     * Valor padrão: data de criação do boleto\n     * \n     * @return\n     */\n    public Calendar getProcessamento() {\n        return this.processamento;\n    }\n\n    /**\n     * Associa uma data do processamento.<br/>\n     * Valor padrão: data atual\n     * \n     * @param processamento\n     */\n    public Datas withProcessamento(Calendar processamento) {\n        if (processamento.getTime().before(MINIMUM_DATE.getTime())) {\n            throw new IllegalArgumentException(\n                    \"O ano do processamento deve ser maior do que 1997.\");\n        }\n        if (processamento.getTime().after(MAXIMUM_DATE.getTime())) {\n            throw new IllegalArgumentException(\n                    \"O ano do processamento deve ser menor do que 2024.\");\n        }\n        this.processamento = processamento;\n        return this;\n    }\n\n    /**\n     * Associa uma data do processamento.<br/>\n     * Valor padrão: data atual\n     * \n     * @param processamento\n     */\n    public Datas withProcessamento(int dia, int mes, int ano) {\n        return withProcessamento(dataPara(dia, mes, ano));\n    }\n\n    /**\n     * Retorna a data de vencimento do boleto\n     */\n    public Calendar getVencimento() {\n        return this.vencimento;\n    }\n\n    \n    \n    /**\n     * Modifica o vencimento do respectivo boleto com um Calendar.\n     */\n    public Datas withVencimento(Calendar vencimento) {\n        if (vencimento.getTime().before(MINIMUM_DATE.getTime())) {\n            throw new IllegalArgumentException(\n                    \"O ano do vencimento deve ser maior do que 1997.\");\n        }\n        if (vencimento.getTime().after(MAXIMUM_DATE.getTime())) {\n            throw new IllegalArgumentException(\n                    \"O ano do vencimento deve ser menor do que 2024.\");\n        }\n        this.vencimento = vencimento;\n        return this;\n    }\n\n    /**\n     * Modifica o vencimento.\n     * \n     */\n    public Datas withVencimento(int dia, int mes, int ano) {\n        return withVencimento(dataPara(dia, mes, ano));\n    }\n\n    private Calendar dataPara(int dia, int mes, int ano) {\n        Calendar c = Calendar.getInstance();\n        c.set(Calendar.DAY_OF_MONTH, dia);\n        c.set(Calendar.MONTH, mes - 1);\n        c.set(Calendar.YEAR, ano);\n        return c;\n    }\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto;\n\nimport java.util.Calendar;\nimport java.util.GregorianCalendar;\n\n/**\n * Bean que representa as datas relacionadas a um Boleto.\n * \n * @author Paulo Silveira\n * @author Caue Guerra\n * @author Leonardo Bessa\n * \n */\npublic class Datas {\n    private Calendar documento;\n    private Calendar processamento;\n    private Calendar vencimento;\n    private static final Calendar MINIMUM_DATE = new GregorianCalendar(1997,\n            10, 7);\n    private static final Calendar MAXIMUM_DATE = new GregorianCalendar(2024, 1,\n            1);\n\n    private Datas() {\n    }\n\n    /**\n     * Cria novas datas<br/>\n     * Data do documento padrão: data atual<br/>\n     * Data do processamento padrão: data atual\n     * \n     */\n    public static Datas newDatas() {\n        Calendar data = Calendar.getInstance();\n\t\treturn new Datas().withDocumento(data)\n                .withProcessamento(data);\n    }\n\n    /**\n     * Devolve a data do documento do boleto. (data de geração do boleto)<br/>\n     * Valor padrão: data de criação do boleto\n     * \n     * @return\n     */\n    public Calendar getDocumento() {\n        return this.documento;\n    }\n\n    /**\n     * Associa uma data do documento.<br/>\n     * Valor padrão: data atual\n     * \n     * @param documento\n     */\n    public Datas withDocumento(Calendar documento) {\n        if (documento.getTime().before(MINIMUM_DATE.getTime())) {\n            throw new IllegalArgumentException(\n                    \"O ano do documento deve ser maior do que 1997.\");\n        }\n        if (documento.getTime().after(MAXIMUM_DATE.getTime())) {\n            throw new IllegalArgumentException(\n                    \"O ano do documento deve ser menor do que 2024.\");\n        }\n        this.documento = documento;\n        return this;\n    }\n\n    /**\n     * Associa uma data do documento.<br/>\n     * Valor padrão: data atual\n     * \n     * @param documento\n     */\n    public Datas withDocumento(int dia, int mes, int ano) {\n        return withDocumento(dataPara(dia, mes, ano));\n    }\n\n    /**\n     * Devolve a data de processamento do boleto. (data de geração do boleto)<br/>\n     * Valor padrão: data de criação do boleto\n     * \n     * @return\n     */\n    public Calendar getProcessamento() {\n        return this.processamento;\n    }\n\n    /**\n     * Associa uma data do processamento.<br/>\n     * Valor padrão: data atual\n     * \n     * @param processamento\n     */\n    public Datas withProcessamento(Calendar processamento) {\n        if (processamento.getTime().before(MINIMUM_DATE.getTime())) {\n            throw new IllegalArgumentException(\n                    \"O ano do processamento deve ser maior do que 1997.\");\n        }\n        if (processamento.getTime().after(MAXIMUM_DATE.getTime())) {\n            throw new IllegalArgumentException(\n                    \"O ano do processamento deve ser menor do que 2024.\");\n        }\n        this.processamento = processamento;\n        return this;\n    }\n\n    /**\n     * Associa uma data do processamento.<br/>\n     * Valor padrão: data atual\n     * \n     * @param processamento\n     */\n    public Datas withProcessamento(int dia, int mes, int ano) {\n        return withProcessamento(dataPara(dia, mes, ano));\n    }\n\n    /**\n     * Retorna a data de vencimento do boleto\n     */\n    public Calendar getVencimento() {\n        return this.vencimento;\n    }\n\n    \n    \n    /**\n     * Modifica o vencimento do respectivo boleto com um Calendar.\n     */\n    public Datas withVencimento(Calendar vencimento) {\n        if (vencimento.getTime().before(MINIMUM_DATE.getTime())) {\n            throw new IllegalArgumentException(\n                    \"O ano do vencimento deve ser maior do que 1997.\");\n        }\n        if (vencimento.getTime().after(MAXIMUM_DATE.getTime())) {\n            throw new IllegalArgumentException(\n                    \"O ano do vencimento deve ser menor do que 2024.\");\n        }\n        this.vencimento = vencimento;\n        return this;\n    }\n\n    /**\n     * Modifica o vencimento.\n     * \n     */\n    public Datas withVencimento(int dia, int mes, int ano) {\n        return withVencimento(dataPara(dia, mes, ano));\n    }\n\n    private Calendar dataPara(int dia, int mes, int ano) {\n        Calendar c = Calendar.getInstance();\n        c.set(Calendar.DAY_OF_MONTH, dia);\n        c.set(Calendar.MONTH, mes - 1);\n        c.set(Calendar.YEAR, ano);\n        return c;\n    }\n}\n","lineNo":33}
{"Smelly Sample":"package br.com.caelum.stella.nfe.builder.generator;\n\nimport java.io.PrintWriter;\nimport java.util.Arrays;\nimport java.util.HashSet;\nimport java.util.Set;\nimport java.util.regex.Matcher;\nimport java.util.regex.Pattern;\n\nimport net.vidageek.fluid.generator.Fluid;\nimport br.com.caelum.stella.nfe.modelo.*;\n\n/**\n * @author jonasabreu\n * \n */\nfinal public class BuilderGenerator {\n    private static final String PACKAGE = \"br.com.caelum.stella.nfe.fluid\";\n    private static final Pattern PATTERN = Pattern.compile(\"public interface (.*?)<T>\");\n\n    public static void main(final String[] args) throws Throwable {\n        Set<Class<?>> set = new HashSet<Class<?>>();\n        Class<?> classes[] = { Adi.class, Arma.class, Avulsa.class, CabecMsg.class, CanonicalizationMethod.class,\n                CIDE.class, Cobr.class, COFINS.class, COFINSAliq.class, COFINSNT.class, COFINSOutr.class,\n                COFINSQtde.class, COFINSST.class, Comb.class, Compra.class, Dest.class, Det.class, DFe.class, DI.class,\n                DigestMethod.class, Dup.class, Emit.class, Exclui.class, Exporta.class, Fat.class, ICMS.class,\n                ICMS00.class, ICMS10.class, ICMS20.class, ICMS30.class, ICMS40.class, ICMS51.class, ICMS60.class,\n                ICMS70.class, ICMS90.class, ICMSComb.class, ICMSCons.class, ICMSInter.class, ICMSTot.class, Ide.class,\n                II.class, Imposto.class, InfAdic.class, InfAtuCadEmiDFe.class, InfCad.class, InfCadEmiDFe.class,\n                InfCanc.class, InfCons.class, InfInut.class, InfNFe.class, InfProt.class, InfRec.class,\n                InfRetAtuCadEmiDFe.class, IPI.class, IPINT.class, IPITrib.class, ISSQN.class, ISSQNtot.class,\n                KeyInfoType.class, Lacres.class, Med.class, NFref.class, ObjectFactory.class, ObsCont.class,\n                ObsFisco.class, PIS.class, PISAliq.class, PISNT.class, PISOutr.class, PISQtde.class, PISST.class,\n                ProcRef.class, Prod.class, ReferenceType.class, RefNF.class, RetTransp.class, RetTrib.class,\n                SignatureMethod.class, SignatureType.class, SignatureValueType.class, SignedInfoType.class,\n                TAtuCadEmiDFe.class, TCadEmiDFe.class, TCancNFe.class, TConsCad.class, TConsReciNFe.class,\n                TConsSitNFe.class, TConsStatServ.class, TEmissor.class, TEndereco.class, TEnviNFe.class,\n                TInutNFe.class, TLocal.class, TNFe.class, TNfeProc.class, Total.class, TProcCancNFe.class,\n                TProcInutNFe.class, TProtNFe.class, TransformsType.class, TransformType.class, Transp.class,\n                Transporta.class, TRetAtuCadEmiDFe.class, TRetCancNFe.class, TRetConsCad.class, TRetConsReciNFe.class,\n                TRetConsSitNFe.class, TRetConsStatServ.class, TRetEnviNFe.class, TRetInutNFe.class, TVeiculo.class,\n                VeicProd.class, Vol.class, X509DataType.class };\n\n        set.addAll(Arrays.asList(classes));\n\n        for (Class<?> type : set) {\n            String code = new Fluid(type, PACKAGE).generateInterface(set);\n            System.out.println(\"Writing interface \" + getInterfaceName(code));\n            PrintWriter writer = new PrintWriter(\"stella-nfe/src/main/java/\" + PACKAGE.replaceAll(\"\\\\.\", \"\\\\/\") + \"/\"\n                    + getInterfaceName(code) + \".java\");\n            writer.print(code);\n            writer.close();\n        }\n\n    }\n\n    private static String getInterfaceName(final String code) {\n        Matcher matcher = PATTERN.matcher(code);\n        matcher.find();\n        return matcher.group(1);\n    }\n}\n","Method after Refactoring":"package br.com.caelum.stella.nfe.builder.generator;\n\nimport java.io.PrintWriter;\nimport java.util.Arrays;\nimport java.util.HashSet;\nimport java.util.Set;\nimport java.util.regex.Matcher;\nimport java.util.regex.Pattern;\n\nimport net.vidageek.fluid.generator.Fluid;\nimport br.com.caelum.stella.nfe.modelo.*;\n\n/**\n * @author jonasabreu\n * \n */\nfinal public class BuilderGenerator {\n    private static final String PACKAGE = \"br.com.caelum.stella.nfe.fluid\";\n    private static final Pattern PATTERN = Pattern.compile(\"public interface (.*?)<T>\");\n\n    public static void main(final String[] args) throws Throwable {\n        Set<Class<?>> set = new HashSet<Class<?>>();\n        Class<?> classes[] = { Adi.class, Arma.class, Avulsa.class, CabecMsg.class, CanonicalizationMethod.class,\n                CIDE.class, Cobr.class, COFINS.class, COFINSAliq.class, COFINSNT.class, COFINSOutr.class,\n                COFINSQtde.class, COFINSST.class, Comb.class, Compra.class, Dest.class, Det.class, DFe.class, DI.class,\n                DigestMethod.class, Dup.class, Emit.class, Exclui.class, Exporta.class, Fat.class, ICMS.class,\n                ICMS00.class, ICMS10.class, ICMS20.class, ICMS30.class, ICMS40.class, ICMS51.class, ICMS60.class,\n                ICMS70.class, ICMS90.class, ICMSComb.class, ICMSCons.class, ICMSInter.class, ICMSTot.class, Ide.class,\n                II.class, Imposto.class, InfAdic.class, InfAtuCadEmiDFe.class, InfCad.class, InfCadEmiDFe.class,\n                InfCanc.class, InfCons.class, InfInut.class, InfNFe.class, InfProt.class, InfRec.class,\n                InfRetAtuCadEmiDFe.class, IPI.class, IPINT.class, IPITrib.class, ISSQN.class, ISSQNtot.class,\n                KeyInfoType.class, Lacres.class, Med.class, NFref.class, ObjectFactory.class, ObsCont.class,\n                ObsFisco.class, PIS.class, PISAliq.class, PISNT.class, PISOutr.class, PISQtde.class, PISST.class,\n                ProcRef.class, Prod.class, ReferenceType.class, RefNF.class, RetTransp.class, RetTrib.class,\n                SignatureMethod.class, SignatureType.class, SignatureValueType.class, SignedInfoType.class,\n                TAtuCadEmiDFe.class, TCadEmiDFe.class, TCancNFe.class, TConsCad.class, TConsReciNFe.class,\n                TConsSitNFe.class, TConsStatServ.class, TEmissor.class, TEndereco.class, TEnviNFe.class,\n                TInutNFe.class, TLocal.class, TNFe.class, TNfeProc.class, Total.class, TProcCancNFe.class,\n                TProcInutNFe.class, TProtNFe.class, TransformsType.class, TransformType.class, Transp.class,\n                Transporta.class, TRetAtuCadEmiDFe.class, TRetCancNFe.class, TRetConsCad.class, TRetConsReciNFe.class,\n                TRetConsSitNFe.class, TRetConsStatServ.class, TRetEnviNFe.class, TRetInutNFe.class, TVeiculo.class,\n                VeicProd.class, Vol.class, X509DataType.class };\n\n        set.addAll(Arrays.asList(classes));\n\n        String datapoints = \"\";\n        datapoints += \"package \" + PACKAGE + \".datapoints;\\n\\n\";\n        datapoints += \"import org.junit.experimental.theories.DataPoint;\\n\\n\";\n        datapoints += \"public interface BuilderDataPoints {\\n\\n\";\n\n        for (Class<?> type : set) {\n            String code = new Fluid(type, PACKAGE).generateInterface(set);\n\n            String interfaceName = getInterfaceName(code);\n\n            System.out.println(\"Writing interface \" + interfaceName);\n\n            PrintWriter writer = new PrintWriter(\"stella-nfe/src/main/java/\" + PACKAGE.replaceAll(\"\\\\.\", \"\\\\/\") + \"/\"\n                    + interfaceName + \".java\");\n            writer.print(code);\n            writer.close();\n\n            datapoints += \"    @DataPoint\\n\";\n            datapoints += \"    public Class<?> \" + lowerCase(interfaceName) + \" = \" + PACKAGE + \".\" + interfaceName\n                    + \".class;\\n\\n\";\n        }\n\n        datapoints += \"}\\n\";\n        System.out.println(\"Writing Datapoint Definition\");\n        PrintWriter writer = new PrintWriter(\"stella-nfe/src/test/java/\" + PACKAGE.replaceAll(\"\\\\.\", \"\\\\/\")\n                + \"/datapoints/BuilderDataPoints.java\");\n        writer.print(datapoints);\n        writer.close();\n\n    }\n\n    private static String lowerCase(final String interfaceName) {\n        return Character.toLowerCase(interfaceName.charAt(0)) + interfaceName.substring(1);\n    }\n\n    private static String getInterfaceName(final String code) {\n        Matcher matcher = PATTERN.matcher(code);\n        matcher.find();\n        return matcher.group(1);\n    }\n}\n","lineNo":54}
{"Smelly Sample":"package br.com.caelum.stella.boleto.transformer;\n\nimport java.io.ByteArrayInputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.StringWriter;\nimport java.math.BigDecimal;\nimport java.util.ArrayList;\nimport java.util.Calendar;\nimport java.util.Collection;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.Properties;\n\nimport org.apache.velocity.Template;\nimport org.apache.velocity.VelocityContext;\nimport org.apache.velocity.app.VelocityEngine;\nimport org.apache.velocity.exception.MethodInvocationException;\nimport org.apache.velocity.exception.ParseErrorException;\nimport org.apache.velocity.exception.ResourceNotFoundException;\n\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.CriacaoBoletoException;\nimport br.com.caelum.stella.boleto.GeracaoBoletoException;\nimport br.com.caelum.stella.boleto.bancos.LinhaDigitavelGenerator;\nimport br.com.caelum.stella.boleto.bancos.Real;\n\npublic class HTMLBoletoWriter implements BoletoWriter {\n\n\tprivate String urlImagens;\n\tprivate Template template;\n\tprivate Collection<Boleto> boletos;\n\tprivate VelocityEngine velocityEngine;\n\n\t/**\n\t * \n\t * @param urlImagens\n\t *            url, fisica(e\\home\\...) ou\n\t *            online(http://www.site.com.br/imgBoleto/), onde esto as\n\t *            imagens.\n\t * \n\t */\n\tpublic HTMLBoletoWriter(String urlImagens) {\n\t\tthis.urlImagens = urlImagens;\n\t\tthis.boletos = new ArrayList<Boleto>();\n\t\tthis.velocityEngine = new VelocityEngine();\n\t\tProperties config = new Properties();\n\t\tconfig\n\t\t\t\t.setProperty(\"file.resource.loader.class\",\n\t\t\t\t\t\t\"org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader\");\n\t\ttry {\n\t\t\tthis.velocityEngine.init(config);\n\t\t\tthis.template = velocityEngine\n\t\t\t\t\t.getTemplate(\"/br/com/caelum/stella/boleto/html/template_html.vm\");\n\t\t} catch (Exception e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\tthrow new GeracaoBoletoException(\n\t\t\t\t\t\"No foi possivel iniciar a configurao do Velocity\", e);\n\t\t}\n\t}\n\n\t/**\n\t * \n\t * @param boleto\n\t * \n\t */\n\tpublic void write(Boleto boleto) {\n\t\tthis.boletos.add(boleto);\n\t}\n\n\tpublic boolean newPage() {\n\t\t// TODO Auto-generated method stub\n\t\treturn false;\n\t}\n\n\tpublic InputStream toInputStream() {\n\t\t// TODO Auto-generated method stub\n\n\t\tStringWriter writer = new StringWriter();\n\t\tVelocityContext context = new VelocityContext();\n\t\tcontext.put(\"boletos\", boletos);\n\t\tcontext.put(\"urlImagens\", urlImagens);\n\t\tcontext.put(\"boletoHelper\", new TemplateHelper());\n\t\tcontext.put(\"writer\",this);\n\t\ttry {\n\t\t\ttemplate.merge(context, writer);\n\t\t} catch (ResourceNotFoundException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\tthrow new CriacaoBoletoException(\"Erro na criao do boleto\", e);\n\t\t} catch (ParseErrorException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\tthrow new CriacaoBoletoException(\"Erro na criao do boleto\", e);\n\t\t} catch (MethodInvocationException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\tthrow new CriacaoBoletoException(\"Erro na criao do boleto\", e);\n\t\t} catch (IOException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\tthrow new CriacaoBoletoException(\"Erro na criao do boleto\", e);\n\t\t}\n\t\treturn new ByteArrayInputStream(writer.toString().getBytes());\n\t}\n\n\t/**\n\t * Apenas para ajudar com algumas coisas que ficam meio complicadas se\n\t * colocadas diretas no template\n\t * \n\t * @author Alberto Pc\n\t * \n\t */\n\tpublic class TemplateHelper {\t\t\n\t\tprivate BoletoFormatter formatter;\n\t\tprivate LinhaDigitavelGenerator linhaDigitavelGenerator;\n\n\t\t/**\n\t\t * Como a classe tinha que ter visibilidade pblica, pois o template fica em outro pacote, deixei o construtor\n\t\t * privado para no correr o risco de algum usar.\n\t\t */\n\t\tprivate TemplateHelper() {\n\t\t\tthis.formatter = new BoletoFormatter();\n\t\t\tthis.linhaDigitavelGenerator = new LinhaDigitavelGenerator();\n\t\t}\n\n\t\tpublic char aceite(Boleto boleto) {\n\t\t\treturn boleto.getAceite() ? 'S' : 'N';\n\t\t}\n\n\t\tpublic String formataData(Calendar data) {\n\t\t\treturn formatter.formatDate(data);\n\t\t}\n\n\t\tpublic String formataValor(BigDecimal valor) {\n\t\t\treturn formatter.formatValue(valor.doubleValue());\n\t\t}\n\n\t\tpublic String nossoNumero(Boleto boleto) {\n\t\t\treturn boleto.getBanco().getNossoNumeroDoEmissorFormatado(\n\t\t\t\t\tboleto.getEmissor());\n\t\t}\n\n\t\tpublic String carteira(Boleto boleto) {\n\t\t\treturn boleto.getBanco().getCarteiraDoEmissorFormatado(\n\t\t\t\t\tboleto.getEmissor());\n\t\t}\n\n\t\tpublic String contaCorrente(Boleto boleto) {\n\t\t\treturn boleto.getBanco().getContaCorrenteDoEmissorFormatado(\n\t\t\t\t\tboleto.getEmissor());\n\t\t}\n\n\t\tpublic String linhaDigitavel(Boleto boleto) {\n\t\t\treturn this.linhaDigitavelGenerator.geraLinhaDigitavelPara(boleto);\n\t\t}\n\t}\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.transformer;\n\nimport java.io.ByteArrayInputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.StringWriter;\nimport java.math.BigDecimal;\nimport java.net.URL;\nimport java.util.ArrayList;\nimport java.util.Calendar;\nimport java.util.Collection;\nimport java.util.List;\nimport java.util.Properties;\n\nimport org.apache.velocity.Template;\nimport org.apache.velocity.VelocityContext;\nimport org.apache.velocity.app.VelocityEngine;\nimport org.apache.velocity.exception.MethodInvocationException;\nimport org.apache.velocity.exception.ParseErrorException;\nimport org.apache.velocity.exception.ResourceNotFoundException;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.CriacaoBoletoException;\nimport br.com.caelum.stella.boleto.Datas;\nimport br.com.caelum.stella.boleto.Emissor;\nimport br.com.caelum.stella.boleto.GeracaoBoletoException;\nimport br.com.caelum.stella.boleto.Sacado;\nimport br.com.caelum.stella.boleto.bancos.LinhaDigitavelGenerator;\n\npublic class HTMLBoletoWriter implements BoletoWriter {\n\n\tprivate URL urlServletBoleto;\n\tprivate Template template;\n\tprivate Collection<BoletoTemplateWrapper> boletos;\n\tprivate VelocityEngine velocityEngine;\n\n\t/**\n\t * \n\t * @param urlServletBoleto\n\t *            url de sua app. Ex: http://www.algumsite.com.br/stella-boleto/\n\t */\n\tpublic HTMLBoletoWriter(URL urlServletBoleto) {\n\t\tthis.urlServletBoleto = urlServletBoleto;\n\t\tthis.boletos = new ArrayList<BoletoTemplateWrapper>();\n\t\tthis.velocityEngine = new VelocityEngine();\n\t\tProperties config = new Properties();\n\t\tconfig\n\t\t\t\t.setProperty(\"file.resource.loader.class\",\n\t\t\t\t\t\t\"org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader\");\n\t\ttry {\n\t\t\tthis.velocityEngine.init(config);\n\t\t\tthis.template = velocityEngine\n\t\t\t\t\t.getTemplate(\"/br/com/caelum/stella/boleto/template_html.vm\");\n\t\t} catch (Exception e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\tthrow new GeracaoBoletoException(\n\t\t\t\t\t\"No foi possivel iniciar a configurao do Velocity\", e);\n\t\t}\n\t}\n\n\t/**\n\t * \n\t * @param boleto\n\t * \n\t */\n\tpublic void write(Boleto boleto) {\n\t\tBoletoTemplateWrapper wrapper = new BoletoTemplateWrapper(boleto);\n\t\tthis.boletos.add(wrapper);\n\t}\n\n\tpublic boolean newPage() {\n\t\t// TODO Auto-generated method stub\n\t\treturn true;\n\t}\n\n\tpublic InputStream toInputStream() {\n\t\t// TODO Auto-generated method stub\n\n\t\tStringWriter writer = new StringWriter();\n\t\tVelocityContext context = new VelocityContext();\n\t\tcontext.put(\"boletos\", boletos);\n\t\tcontext.put(\"urlServletBoleto\", urlServletBoleto.toExternalForm());\n\t\ttry {\n\t\t\ttemplate.merge(context, writer);\n\t\t} catch (ResourceNotFoundException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\tthrow new CriacaoBoletoException(\"Erro na criao do boleto\", e);\n\t\t} catch (ParseErrorException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\tthrow new CriacaoBoletoException(\"Erro na criao do boleto\", e);\n\t\t} catch (MethodInvocationException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\tthrow new CriacaoBoletoException(\"Erro na criao do boleto\", e);\n\t\t} catch (IOException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\tthrow new CriacaoBoletoException(\"Erro na criao do boleto\", e);\n\t\t}\n\t\treturn new ByteArrayInputStream(writer.toString().getBytes());\n\t}\n\n\t/**\n\t * Apenas para ajudar com algumas coisas que ficam meio complicadas se\n\t * colocadas diretas no template\n\t * \n\t * @author Alberto Pc\n\t * \n\t */\n\tpublic class BoletoTemplateWrapper {\n\t\tprivate LinhaDigitavelGenerator linhaDigitavelGenerator;\n\t\tprivate Boleto boleto;\n\t\tprivate String linhaDigitavel;\n\t\tprivate String codigoDeBarras;\n\n\t\t/**\n\t\t * Como a classe tinha que ter visibilidade pblica, pois o template\n\t\t * fica em outro pacote, deixei o construtor privado para no correr o\n\t\t * risco de algum usar.\n\t\t */\n\t\tprivate BoletoTemplateWrapper(Boleto boleto) {\n\t\t\tthis.boleto = boleto;\n\t\t\tthis.linhaDigitavelGenerator = new LinhaDigitavelGenerator();\n\t\t\tlinhaDigitavel = linhaDigitavelGenerator\n\t\t\t\t\t.geraLinhaDigitavelPara(this.boleto);\n\t\t\tcodigoDeBarras = this.boleto.getBanco().geraCodigoDeBarrasPara(\n\t\t\t\t\tthis.boleto);\n\t\t}\n\n\t\tpublic char aceite() {\n\t\t\treturn getAceite() ? 'S' : 'N';\n\t\t}\n\n\t\tpublic String formataData(Calendar data) {\n\t\t\treturn BoletoFormatter.formatDate(data);\n\t\t}\n\n\t\tpublic String formataValor() {\n\t\t\treturn BoletoFormatter.formatValue(boleto.getValorBoleto()\n\t\t\t\t\t.doubleValue());\n\t\t}\n\n\t\tpublic String nossoNumero() {\n\t\t\treturn getBanco().getNossoNumeroDoEmissorFormatado(\n\t\t\t\t\tboleto.getEmissor());\n\t\t}\n\n\t\tpublic String carteira() {\n\t\t\treturn getBanco()\n\t\t\t\t\t.getCarteiraDoEmissorFormatado(boleto.getEmissor());\n\t\t}\n\n\t\tpublic String contaCorrente() {\n\t\t\treturn getBanco().getContaCorrenteDoEmissorFormatado(\n\t\t\t\t\tboleto.getEmissor());\n\t\t}\n\n\t\tpublic String linhaDigitavel() {\n\t\t\treturn linhaDigitavel;\n\t\t}\n\n\t\tpublic String codigoDeBarras() {\n\t\t\treturn codigoDeBarras;\n\t\t}\n\n\t\tpublic boolean getAceite() {\n\t\t\treturn boleto.getAceite();\n\t\t}\n\n\t\tpublic Banco getBanco() {\n\t\t\treturn boleto.getBanco();\n\t\t}\n\n\t\tpublic int getCodEspecieMoeda() {\n\t\t\treturn boleto.getCodEspecieMoeda();\n\t\t}\n\n\t\tpublic Datas getDatas() {\n\t\t\treturn boleto.getDatas();\n\t\t}\n\n\t\tpublic List<String> getDescricoes() {\n\t\t\treturn boleto.getDescricoes();\n\t\t}\n\n\t\tpublic Emissor getEmissor() {\n\t\t\treturn boleto.getEmissor();\n\t\t}\n\n\t\tpublic String getEspecieDocumento() {\n\t\t\treturn boleto.getEspecieDocumento();\n\t\t}\n\n\t\tpublic String getEspecieMoeda() {\n\t\t\treturn boleto.getEspecieMoeda();\n\t\t}\n\n\t\tpublic String getFatorVencimento() {\n\t\t\treturn boleto.getFatorVencimento();\n\t\t}\n\n\t\tpublic List<String> getInstrucoes() {\n\t\t\treturn boleto.getInstrucoes();\n\t\t}\n\n\t\tpublic List<String> getLocaisDePagamento() {\n\t\t\treturn boleto.getLocaisDePagamento();\n\t\t}\n\n\t\tpublic String getNoDocumento() {\n\t\t\treturn boleto.getNoDocumento();\n\t\t}\n\n\t\tpublic String getNoDocumentoFormatado() {\n\t\t\treturn boleto.getNoDocumentoFormatado();\n\t\t}\n\n\t\tpublic BigDecimal getQtdMoeda() {\n\t\t\treturn boleto.getQtdMoeda();\n\t\t}\n\n\t\tpublic Sacado getSacado() {\n\t\t\treturn boleto.getSacado();\n\t\t}\n\n\t\tpublic BigDecimal getValorBoleto() {\n\t\t\treturn boleto.getValorBoleto();\n\t\t}\n\n\t\tpublic String getValorFormatado() {\n\t\t\treturn boleto.getValorFormatado();\n\t\t}\n\n\t\tpublic BigDecimal getValorMoeda() {\n\t\t\treturn boleto.getValorMoeda();\n\t\t}\n\n\t\tpublic String nomeArquivoCodigoDeBarras() {\n\t\t\treturn codigoDeBarras + \"_\"\n\t\t\t\t\t+ boleto.getBanco().getNumeroFormatado() + \".png\";\n\t\t}\n\n\t}\n}\n","lineNo":68}
{"Smelly Sample":"package br.com.caelum.stella.gateway.redecard.integration;\n\nimport java.text.ParseException;\nimport java.text.SimpleDateFormat;\nimport java.util.Calendar;\n\nimport javax.servlet.http.HttpServletRequest;\n\nimport br.com.caelum.stella.gateway.core.IntegrationHandler;\nimport br.com.caelum.stella.gateway.core.ProblematicTransactionException;\n\n/**\n * Classe responsvel por verificar o retorno da solicitao de autorizao da Redecard.\n * @author Alberto Pc\n *\n */\npublic class RedecardVerificaRetornoAutorizacao implements\n\t\tIntegrationHandler<RedecardAutorizacaoReturn> {\n\t\n\tprivate final HttpServletRequest request;\n\t\n\t\n\tpublic RedecardVerificaRetornoAutorizacao(final HttpServletRequest request) {\n\t\tsuper();\n\t\tthis.request = request;\n\t}\n\n\n\n\tpublic RedecardAutorizacaoReturn handle() {\n\t\t// TODO Auto-generated method stub\n\t\tfinal int codigoRetorno = Integer.valueOf(request.getParameter(\"CODRET\"));\n\t\tfinal String mensagemRetorno = request.getParameter(\"MSGRET\");\n\t\tfinal String numPedido = request.getParameter(\"NUMPEDIDO\");\n\t\tfinal String dataDesformatada = request.getParameter(\"DATA\");\n\t\tCalendar dataAutorizacao;\n\t\ttry {\t\t\t\t\t\t\t\t\n\t\t\tdataAutorizacao = converteDataStringParaCalendar(dataDesformatada);\n\t\t} catch (ParseException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\tthrow new ProblematicTransactionException(\"A converso da data de autorizacao falhou \"+dataDesformatada,e,new RedecardAutorizacaoReturn(codigoRetorno,mensagemRetorno,numPedido));\n\t\t}\t\t\n\t\tRedecardAutorizacaoReturn autorizacaoReturn = new RedecardAutorizacaoReturn(codigoRetorno,mensagemRetorno,dataAutorizacao,numPedido,request.getParameter(\"NR_CARTAO\"),request.getParameter(\"ORIGEM_BIN\"),request.getParameter(\"NUMAUTOR\"),request.getParameter(\"NUMCV\"),request.getParameter(\"NUMAUTENT\"),request.getParameter(\"NUMSQN\"));\n\t\tif(autorizacaoReturn.getCodigoRetorno()>49){\n\t\t\tthrow new ProblematicTransactionException(autorizacaoReturn.getMensagemRetorno(),autorizacaoReturn);\n\t\t}\n\t\treturn autorizacaoReturn;\n\t}\n\n\n\n\tprivate Calendar converteDataStringParaCalendar(String dataDesformatada) throws ParseException {\n\t\tSimpleDateFormat formatter = new SimpleDateFormat(\"yyyyMMdd\");\n\t\tCalendar dataAutorizacao = Calendar.getInstance();\n\t\tdataAutorizacao.setTime(formatter.parse(dataDesformatada));\t\t\n\t\treturn dataAutorizacao;\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.gateway.redecard.integration;\n\nimport java.text.ParseException;\nimport java.text.SimpleDateFormat;\nimport java.util.Calendar;\n\nimport javax.servlet.http.HttpServletRequest;\n\nimport br.com.caelum.stella.gateway.core.IntegrationHandler;\nimport br.com.caelum.stella.gateway.core.ProblematicTransactionException;\n\n/**\n * Classe responsvel por verificar o retorno da solicitao de autorizao da Redecard.\n * @author Alberto e Rafael\n *\n */\npublic class RedecardVerificaRetornoAutorizacao implements\n\t\tIntegrationHandler<RedecardAutorizacaoReturn> {\n\t\n\tprivate final HttpServletRequest request;\n\t\n\t\n\tpublic RedecardVerificaRetornoAutorizacao(final HttpServletRequest request) {\n\t\tsuper();\n\t\tthis.request = request;\n\t}\n\n\n\n\tpublic RedecardAutorizacaoReturn handle() {\n\t\t// TODO Auto-generated method stub\n\t\tfinal String mensagemRetorno = request.getParameter(\"MSGRET\");\n\t\tfinal String codigoRetorno = request.getParameter(\"CODRET\");\n\t\tfinal String numPedido = request.getParameter(\"NUMPEDIDO\");\n\t\tif(codigoRetorno==null){\n\t\t\tfinal int codigoRetornoAprovado = 0;\t\t\t\n\t\t\tfinal String dataDesformatada = request.getParameter(\"DATA\");\n\t\t\tCalendar dataAutorizacao;\n\t\t\ttry {\n\t\t\t\tdataAutorizacao = converteDataStringParaCalendar(dataDesformatada);\n\t\t\t} catch (ParseException e) {\n\t\t\t\t// TODO Auto-generated catch block\n\t\t\t\tthrow new ProblematicTransactionException(\n\t\t\t\t\t\t\"A converso da data de autorizacao falhou \"\n\t\t\t\t\t\t\t\t+ dataDesformatada, e,\n\t\t\t\t\t\tnew RedecardAutorizacaoReturn(codigoRetornoAprovado,\n\t\t\t\t\t\t\t\tmensagemRetorno, numPedido));\n\t\t\t}\n\t\t\tRedecardAutorizacaoReturn autorizacaoReturn = new RedecardAutorizacaoReturn(\n\t\t\t\t\tcodigoRetornoAprovado, mensagemRetorno, dataAutorizacao, numPedido,\n\t\t\t\t\trequest.getParameter(\"NR_CARTAO\"), request\n\t\t\t\t\t\t\t.getParameter(\"ORIGEM_BIN\"), request\n\t\t\t\t\t\t\t.getParameter(\"NUMAUTOR\"), request\n\t\t\t\t\t\t\t.getParameter(\"NUMCV\"), request\n\t\t\t\t\t\t\t.getParameter(\"NUMAUTENT\"), request\n\t\t\t\t\t\t\t.getParameter(\"NUMSQN\"));\n\t\t\treturn autorizacaoReturn;\n\t\t}\n\t\telse{\n\t\t\tthrow new ProblematicTransactionException(mensagemRetorno,new RedecardAutorizacaoReturn(Integer.valueOf(codigoRetorno),mensagemRetorno,numPedido));\n\t\t}\n\t}\n\n\n\n\tprivate Calendar converteDataStringParaCalendar(String dataDesformatada) throws ParseException {\n\t\tSystem.out.println(dataDesformatada);\n\t\tSimpleDateFormat formatter = new SimpleDateFormat(\"yyyyMMdd\");\n\t\tCalendar dataAutorizacao = Calendar.getInstance();\n\t\tdataAutorizacao.setTime(formatter.parse(dataDesformatada));\t\t\n\t\treturn dataAutorizacao;\n\t}\n\n}\n","lineNo":33}
{"Smelly Sample":"package br.com.caelum.stella.nfe.builder.generator;\n\nimport java.io.File;\nimport java.io.FileNotFoundException;\nimport java.io.IOException;\nimport java.io.PrintStream;\nimport java.lang.reflect.Field;\nimport java.util.List;\n\nimport net.vidageek.mirror.Mirror;\nimport br.com.caelum.stella.nfe.builder.generated.Adi;\n\n/**\n * @author jonasabreu\n * \n *         Objeto que usa um pouco de magia preta pra gerar um builder a partir\n *         dos fields de um objeto.\n */\nfinal public class JAXBBuilderCodeGenerator {\n\n\tpublic static void main(final String[] args) throws IOException {\n\t\tClass<?>[] sources = { Adi.class};\n\t\tgenerateBuilderFor(sources);\n\t}\n\n\tprivate static void generateBuilderFor(Class<?>... sources)\n\t\t\tthrows FileNotFoundException {\n\t\tfor (Class<?> type : sources) {\n\t\t\tgenerateBuilderFor(type);\n\t\t}\n\t}\n\n\tprivate static void generateBuilderFor(Class<?> source)\n\t\t\tthrows FileNotFoundException {\n\t\tClassObject clazz = new ClassObject(source);\n\n\t\tList<Field> fields = Mirror.on(source).reflectAll().fields();\n\t\tfor (Field field : fields) {\n\t\t\tclazz.addMethod(field.getName(), field.getType());\n\t\t}\n\n\t\tclazz.setPackageName(\"br.com.caelum.stella.nfe.builder.generated\");\n\n\t\tString mainPath = \"src/main/java/\";\n\t\tString testPath = \"src/test/java/\";\n\t\tString packagePath = clazz.getPackageName().replace('.', '/') + \"/\";\n\t\tString extension = \".java\";\n\t\tString implementationPathName = mainPath + packagePath\n\t\t\t\t+ clazz.getImplementationName() + extension;\n\t\tString interfacePathName = mainPath + packagePath\n\t\t\t\t+ clazz.getInterfaceName() + extension;\n\t\tString interfaceTestPathName = testPath + packagePath\n\t\t\t\t+ clazz.getInterfaceTestName() + extension;\n\n\t\tgenerateSourceCode(clazz.getInterface(), interfacePathName);\n\t\tgenerateSourceCode(clazz.getImplementation(), implementationPathName);\n\t\tgenerateSourceCode(clazz.getInterfaceTest(), interfaceTestPathName);\n\n\t\tSystem.out.println(clazz.getInterface());\n\t\tSystem.out.println(clazz.getImplementation());\n\t\tSystem.out.println(clazz.getInterfaceTest());\n\t}\n\n\tprivate static void generateSourceCode(String code, String pathName)\n\t\t\tthrows FileNotFoundException {\n\t\tFile impl = new File(pathName);\n\t\tPrintStream implPrintStream = new PrintStream(impl);\n\t\timplPrintStream.print(code);\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.nfe.builder.generator;\n\nimport java.io.File;\nimport java.io.FileNotFoundException;\nimport java.io.IOException;\nimport java.io.PrintStream;\nimport java.lang.reflect.Field;\nimport java.util.List;\n\nimport javax.xml.bind.annotation.XmlElement;\n\nimport net.vidageek.mirror.Mirror;\nimport br.com.caelum.stella.nfe.modelo.*;\n\n/**\n * @author jonasabreu\n * \n *         Objeto que usa um pouco de magia preta pra gerar um builder a partir\n *         dos fields de um objeto.\n */\nfinal public class JAXBBuilderCodeGenerator {\n\n\tprivate static boolean enableFileGeneration = false;\n\n\tpublic static void main(final String[] args) throws IOException {\n\t\tClass<?>[] sources = { Avulsa.class};\n\t\tgenerateBuilderFor(sources);\n\t}\n\n\tprivate static void generateBuilderFor(Class<?>... sources)\n\t\t\tthrows FileNotFoundException {\n\t\tfor (Class<?> type : sources) {\n\t\t\tgenerateBuilderFor(type);\n\t\t}\n\t}\n\n\tprivate static void generateBuilderFor(Class<?> source)\n\t\t\tthrows FileNotFoundException {\n\t\tClassObject clazz = new ClassObject(source);\n\n\t\tList<Field> fields = Mirror.on(source).reflectAll().fields();\n\t\tfor (Field field : fields) {\n\t\t\tString name = field.getName();\n\t\t\tXmlElement annotation = field.getAnnotation(XmlElement.class);\n\t\t\tif (annotation != null\n\t\t\t\t\t&& !\"##default\".equals(annotation.name())) {\n\t\t\t\tname = annotation.name();\n\t\t\t}\n\t\t\tclazz.addMethod(name, field.getType());\n\t\t}\n\n\t\tclazz.setPackageName(\"br.com.caelum.stella.nfe.builder.generated\");\n\n\t\tString mainPath = \"src/main/java/\";\n\t\tString testPath = \"src/test/java/\";\n\t\tString packagePath = clazz.getPackageName().replace('.', '/') + \"/\";\n\t\tString extension = \".java\";\n\t\tString implementationPathName = mainPath + packagePath\n\t\t\t\t+ clazz.getImplementationName() + extension;\n\t\tString interfacePathName = mainPath + packagePath\n\t\t\t\t+ clazz.getInterfaceName() + extension;\n\t\tString interfaceTestPathName = testPath + packagePath\n\t\t\t\t+ clazz.getInterfaceTestName() + extension;\n\n\t\tgenerateSourceCode(clazz.getInterface(), interfacePathName);\n\t\tgenerateSourceCode(clazz.getImplementation(), implementationPathName);\n\t\tgenerateSourceCode(clazz.getInterfaceTest(), interfaceTestPathName);\n\n\t\tSystem.out.println(clazz.getInterface());\n\t\tSystem.out.println(clazz.getImplementation());\n\t\tSystem.out.println(clazz.getInterfaceTest());\n\t}\n\n\tprivate static void generateSourceCode(String code, String pathName)\n\t\t\tthrows FileNotFoundException {\n\t\tif (enableFileGeneration) {\n\t\t\tFile impl = new File(pathName);\n\t\t\tPrintStream implPrintStream = new PrintStream(impl);\n\t\t\timplPrintStream.print(code);\n\t\t}\n\t}\n\n}\n","lineNo":43}
{"Smelly Sample":"package br.com.caelum.stella.faces.validation;\n\nimport javax.el.ELContext;\nimport javax.el.ValueExpression;\nimport javax.faces.context.FacesContext;\nimport javax.faces.validator.Validator;\nimport javax.faces.webapp.ValidatorELTag;\nimport javax.servlet.jsp.JspException;\n\n@SuppressWarnings(\"serial\")\npublic class StellaIEValidatorTag extends ValidatorELTag {\n\tprivate boolean formatted;\n\tprivate String estadoComponentId;\n\n\tpublic StellaIEValidatorTag() {\n\t\tsuper.setId(StellaIEValidator.VALIDATOR_ID);\n\t}\n\n\t@Override\n\tprotected Validator createValidator() throws JspException {\n\t\tStellaIEValidator validator = new StellaIEValidator();\n\t\tif (estadoComponentId!=null){\n\t\t    validator.setEstadoComponentId(estadoComponentId);\n\t\t}\n\t\tvalidator.setFormatted(formatted);\n\t\treturn validator;\n\t}\n\n\tpublic void setFormatted(ValueExpression formatted) {\n\t\tELContext elContext = FacesContext.getCurrentInstance().getELContext();\n\t\tthis.formatted = (Boolean) formatted.getValue(elContext);\n\t}\n\t\n\tpublic void setEstadoId(ValueExpression estadoId) {\n            ELContext elContext = FacesContext.getCurrentInstance().getELContext();\n            this.estadoComponentId = (String) estadoId.getValue(elContext);\n    }\n\n\tpublic void release() {\n\t\tsuper.release();\n\t\tthis.formatted = false;\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.faces.validation;\n\nimport javax.el.ELContext;\nimport javax.el.ValueExpression;\nimport javax.faces.context.FacesContext;\nimport javax.faces.validator.Validator;\nimport javax.faces.webapp.ValidatorELTag;\nimport javax.servlet.jsp.JspException;\n\n@SuppressWarnings(\"serial\")\npublic class StellaIEValidatorTag extends ValidatorELTag {\n    private ValueExpression formatted;\n    private ValueExpression estado;\n    private ValueExpression estadoComponentId;\n    private ValueExpression binding;\n\n    public StellaIEValidatorTag() {\n        super.setId(StellaIEValidator.VALIDATOR_ID);\n    }\n\n    @Override\n    protected Validator createValidator() throws JspException {\n        ELContext elContext = getELContext();\n        StellaIEValidator validator = getBoundValidator(elContext);\n\n        if (binding != null) {\n            validator.setBinding(binding);\n        }\n        if (estado != null) {\n            String estadoValue = estado.getValue(elContext).toString();\n            validator.setEstado(estadoValue);\n        }\n        if (estadoComponentId != null) {\n            String componentId = estadoComponentId.getValue(elContext).toString();\n            validator.setEstadoComponentId(componentId);\n        }\n        if (formatted != null) {\n            Boolean formattedValue = (Boolean) formatted.getValue(elContext);\n            validator.setFormatted(formattedValue);\n        }\n\n        return validator;\n    }\n\n    protected ELContext getELContext() {\n        FacesContext context = FacesContext.getCurrentInstance();\n        ELContext elContext = context.getELContext();\n        return elContext;\n    }\n\n    private StellaIEValidator getBoundValidator(ELContext elContext) {\n        StellaIEValidator validator = null;\n        if (binding != null) {\n            validator = (StellaIEValidator) binding.getValue(elContext);\n        }\n        if (validator == null) {\n            validator = new StellaIEValidator();\n            if (binding != null) {\n                binding.setValue(elContext, validator);\n            }\n        }\n        return validator;\n    }\n\n    public void setFormatted(ValueExpression formatted) {\n        this.formatted = formatted;\n    }\n\n    public void setEstado(ValueExpression estado) {\n        this.estado = estado;\n    }\n\n    public void setEstadoComponentId(ValueExpression estadoComponentId) {\n        this.estadoComponentId = estadoComponentId;\n    }\n\n    public void setBinding(ValueExpression binding) {\n        this.binding = binding;\n    }\n\n    public ValueExpression getBinding() {\n        return binding;\n    }\n\n    public void release() {\n        super.release();\n        this.formatted = null;\n        this.estado = null;\n        this.estadoComponentId = null;\n    }\n}\n","lineNo":34}
{"Smelly Sample":"package br.com.caelum.stella.faces.validation;\n\nimport javax.el.ELContext;\nimport javax.el.ValueExpression;\nimport javax.faces.context.FacesContext;\nimport javax.faces.validator.Validator;\nimport javax.faces.webapp.ValidatorELTag;\nimport javax.servlet.jsp.JspException;\n\n@SuppressWarnings(\"serial\")\npublic class StellaIEValidatorTag extends ValidatorELTag {\n\tprivate boolean formatted;\n\tprivate String estadoComponentId;\n\n\tpublic StellaIEValidatorTag() {\n\t\tsuper.setId(StellaIEValidator.VALIDATOR_ID);\n\t}\n\n\t@Override\n\tprotected Validator createValidator() throws JspException {\n\t\tStellaIEValidator validator = new StellaIEValidator();\n\t\tif (estadoComponentId!=null){\n\t\t    validator.setEstadoComponentId(estadoComponentId);\n\t\t}\n\t\tvalidator.setFormatted(formatted);\n\t\treturn validator;\n\t}\n\n\tpublic void setFormatted(ValueExpression formatted) {\n\t\tELContext elContext = FacesContext.getCurrentInstance().getELContext();\n\t\tthis.formatted = (Boolean) formatted.getValue(elContext);\n\t}\n\t\n\tpublic void setEstadoId(ValueExpression estadoId) {\n            ELContext elContext = FacesContext.getCurrentInstance().getELContext();\n            this.estadoComponentId = (String) estadoId.getValue(elContext);\n    }\n\n\tpublic void release() {\n\t\tsuper.release();\n\t\tthis.formatted = false;\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.faces.validation;\n\nimport javax.el.ELContext;\nimport javax.el.ValueExpression;\nimport javax.faces.context.FacesContext;\nimport javax.faces.validator.Validator;\nimport javax.faces.webapp.ValidatorELTag;\nimport javax.servlet.jsp.JspException;\n\n@SuppressWarnings(\"serial\")\npublic class StellaIEValidatorTag extends ValidatorELTag {\n    private ValueExpression formatted;\n    private ValueExpression estado;\n    private ValueExpression estadoComponentId;\n    private ValueExpression binding;\n\n    public StellaIEValidatorTag() {\n        super.setId(StellaIEValidator.VALIDATOR_ID);\n    }\n\n    @Override\n    protected Validator createValidator() throws JspException {\n        ELContext elContext = getELContext();\n        StellaIEValidator validator = getBoundValidator(elContext);\n\n        if (binding != null) {\n            validator.setBinding(binding);\n        }\n        if (estado != null) {\n            String estadoValue = estado.getValue(elContext).toString();\n            validator.setEstado(estadoValue);\n        }\n        if (estadoComponentId != null) {\n            String componentId = estadoComponentId.getValue(elContext).toString();\n            validator.setEstadoComponentId(componentId);\n        }\n        if (formatted != null) {\n            Boolean formattedValue = (Boolean) formatted.getValue(elContext);\n            validator.setFormatted(formattedValue);\n        }\n\n        return validator;\n    }\n\n    protected ELContext getELContext() {\n        FacesContext context = FacesContext.getCurrentInstance();\n        ELContext elContext = context.getELContext();\n        return elContext;\n    }\n\n    private StellaIEValidator getBoundValidator(ELContext elContext) {\n        StellaIEValidator validator = null;\n        if (binding != null) {\n            validator = (StellaIEValidator) binding.getValue(elContext);\n        }\n        if (validator == null) {\n            validator = new StellaIEValidator();\n            if (binding != null) {\n                binding.setValue(elContext, validator);\n            }\n        }\n        return validator;\n    }\n\n    public void setFormatted(ValueExpression formatted) {\n        this.formatted = formatted;\n    }\n\n    public void setEstado(ValueExpression estado) {\n        this.estado = estado;\n    }\n\n    public void setEstadoComponentId(ValueExpression estadoComponentId) {\n        this.estadoComponentId = estadoComponentId;\n    }\n\n    public void setBinding(ValueExpression binding) {\n        this.binding = binding;\n    }\n\n    public ValueExpression getBinding() {\n        return binding;\n    }\n\n    public void release() {\n        super.release();\n        this.formatted = null;\n        this.estado = null;\n        this.estadoComponentId = null;\n    }\n}\n","lineNo":38}
{"Smelly Sample":"package br.com.caelum.stella.inwords;\n\nimport java.text.DecimalFormat;\n\n/**\n * @author Victor dos Santos Pereira\n * @author Leonardo Bessa\n * \n */\npublic class NumericToWordsConverter {\n\n    private final FormatoDeExtenso formato;\n\n    public NumericToWordsConverter(FormatoDeExtenso formato) {\n        this.formato = formato;\n    }\n\n    public String toWords(long numero) {\n        return this.getFullLongNumberInWords(numero, false);\n    }\n\n    public String toWords(double number) {\n\n        // formata o numero no padrao: 0.0###### e o separa em duas partes\n        DecimalFormat decimalFormat = new DecimalFormat();\n        decimalFormat.applyPattern(\"0.0######\");\n        char decimalSeparator = decimalFormat.getDecimalFormatSymbols()\n                .getDecimalSeparator();\n        String[] parts = (decimalFormat.format(number)).split(\"[\"\n                + decimalSeparator + \"]\");\n\n        // se a parte fracionada for \"0\" altera para \"\"\n        parts[1] = (parts[1].equals(\"0\") ? \"\" : parts[1]);\n\n        // formata o fracionado com o numero de casas decimais especificas\n        for (int i = parts[1].length(); i < formato.getCasasDecimais(); i++) {\n            parts[1] += \"0\";\n        }\n\n        // retorna o extenso passando os parametros: parte inteira e fracionada\n        return this.toWords(Long.parseLong(parts[0]), Long.parseLong(parts[1]));\n    }\n\n    private String getString(String paramMessage) {\n        return Messages.getString(\"Extenso.\" + paramMessage);\n    }\n\n    private String getUnit(boolean isUnitary, boolean isFraction) {\n        String result;\n        if (isFraction) {\n            result = (isUnitary ? formato.getDecimal() : formato.getDecimais());\n        } else {\n            result = (isUnitary ? formato.getUnidade() : formato.getUnidades());\n        }\n        return result;\n    }\n\n    private String getAndSeparator() {\n        return this.getString(\"sep\");\n    }\n\n    private String getThousandSeparator(boolean isFirstGroup) {\n        return (isFirstGroup ? getAndSeparator() : this.getString(\"sep.mil\"));\n    }\n\n    private String getThousandSuffixInWords(int thousandPower,\n            boolean isUnitary, boolean isFraction) {\n        return (thousandPower == 0 ? this.getUnit(isUnitary, isFraction) : this\n                .getString(\"1e\" + 3 * thousandPower + \".\"\n                        + (isUnitary ? \"singular\" : \"plural\")));\n    }\n\n    private String getThousandBlockInWords(String number) {\n\n        String result;\n        int value = Integer.parseInt(number);\n        if (value <= 20) {\n            result = Messages.getString(\"Extenso.\" + number);\n        } else if (value <= 99) {\n            int d = value / 10;\n            int u = value % 10;\n            String dezena = Messages.getString(\"Extenso.\" + d * 10);\n            if (u == 0) {\n                result = dezena;\n            } else {\n                String unidade = Messages.getString(\"Extenso.\" + u);\n                result = dezena + getAndSeparator() + unidade;\n            }\n        } else if (value == 100) {\n            result = Messages.getString(\"Extenso.100\");\n        } else {\n            int c = (value / 100) * 100;\n            String centena = (c == 100) ? Messages.getString(\"Extenso.100+?\")\n                    : Messages.getString(\"Extenso.\" + c);\n            int resto = value % 100;\n            if (resto == 0) {\n                result = centena;\n            } else {\n                result = centena + getAndSeparator()\n                        + getThousandBlockInWords(\"\" + resto);\n            }\n        }\n        return result;\n    }\n\n    private String getThousandBlockWithSuffixInWords(int thousandGroup,\n            int thousandPower, boolean isUnitary, boolean isFraction) {\n        String result;\n        if (thousandPower == 0) {\n            result = this.getThousandSuffixInWords(thousandPower, isUnitary,\n                    isFraction);\n        } else {\n            result = this.getThousandSuffixInWords(thousandPower,\n                    thousandGroup == 1, isFraction);\n        }\n        if ((thousandPower != 1) || (thousandGroup != 1)) {\n            result = (this.getThousandBlockInWords(\"\" + thousandGroup) + \" \" + result)\n                    .trim();\n        }\n        return result;\n    }\n\n    private String getFullLongNumberInWords(long number, boolean isFraction) {\n        String result;\n        if (number == 0) {\n            result = this.getThousandBlockInWords(\"0\");\n        } else {\n            result = \"\";\n            boolean isFirstThousandGroup = true;\n            int thousandPower = 0;\n            long currentWorkingValue = number;\n            while (currentWorkingValue > 0) {\n                int thousandGroup = (int) (currentWorkingValue % 1000);\n                if ((thousandGroup != 0)) {\n                    if (!result.equals(\"\")) {\n                        result = this\n                                .getThousandSeparator(isFirstThousandGroup)\n                                + result;\n                        isFirstThousandGroup = false;\n                    }\n                    if (result.equals(\"\") && !formato.getUnidade().equals(\"\")) {\n                        if (thousandPower > 0) {\n                            result = (thousandPower == 1 ? \" \" : \" de \")\n                                    + this.getUnit(false, isFraction);\n                        }\n                    }\n                    result = this.getThousandBlockWithSuffixInWords(\n                            thousandGroup, thousandPower,\n                            currentWorkingValue == 1, isFraction)\n                            + result;\n                }\n                thousandPower++;\n                currentWorkingValue /= 1000;\n            }\n        }\n        return result;\n    }\n\n    private String toWords(long inteiro, long fracionado) {\n        if (Long.valueOf(fracionado).toString().length() > formato\n                .getCasasDecimais()) {\n            throw new IllegalArgumentException(\n                    \"Quantidade de algarismos significativos excede o permitido.\");\n        }\n        String result = \"\";\n        if (inteiro != 0 || fracionado == 0) {\n            result = this.toWords(inteiro);\n        }\n        if (inteiro != 0 && fracionado != 0) {\n            result += getAndSeparator();\n        }\n        if (fracionado != 0) {\n            result += this.getFullLongNumberInWords(fracionado, true);\n        }\n        return result;\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.inwords;\n\nimport java.text.DecimalFormat;\n\n/**\n * @author Victor dos Santos Pereira\n * @author Leonardo Bessa\n * \n */\npublic class NumericToWordsConverter {\n\n    private final FormatoDeExtenso formato;\n\n    public NumericToWordsConverter(FormatoDeExtenso formato) {\n        this.formato = formato;\n    }\n\n    public String toWords(long numero) {\n        return toWords((double) numero);\n    }\n\n    public String toWords(double number) {\n        StringBuffer result = new StringBuffer();\n        if (number == 0) {\n            result.append(getNumber(0));\n        } else {\n\n            final StringBuffer pattern = new StringBuffer();\n            pattern.append(\"###,000.\");\n            for (int i = 1; i <= formato.getCasasDecimais(); i++) {\n                pattern.append(\"0\");\n            }\n            DecimalFormat decimalFormat = new DecimalFormat(pattern.toString());\n            String formatted = decimalFormat.format(number);\n            String[] parts = formatted.split(\"[.]\");\n            String formattedInt = parts[0];\n            String formattedMod = parts[1];\n            String[] ints = formattedInt.split(\"[,]\");\n            ThousandBlock[] blocks = new ThousandBlock[ints.length];\n            for (int i = 0; i < blocks.length; i++) {\n                String block = ints[i];\n                blocks[i] = new ThousandBlock(block);\n            }\n            ThousandBlock modBlock = new ThousandBlock(formattedMod);\n            boolean hasMod = !modBlock.isZero();\n            boolean hasInteger = (blocks.length > 1)\n                    || (!blocks[blocks.length - 1].isZero());\n\n            if (hasInteger) {\n                appendIntegers(result, blocks);\n                appendIntegersUnits(number, result, blocks);\n            }\n            if (hasInteger && hasMod) {\n                result.append(getAndSeparator());\n            }\n            if (hasMod) {\n                appendIntegers(result, modBlock);\n                result.append(\" \");\n                if (modBlock.isUnitary()) {\n                    result.append(formato.getDecimal());\n                } else {\n                    result.append(formato.getDecimais());\n                }\n            }\n        }\n        return result.toString();\n    }\n\n    private void appendIntegersUnits(double number, StringBuffer result,\n            ThousandBlock[] blocks) {\n        if (blocks.length != 1 || !blocks[0].isZero()) {\n            result.append(\" \");\n            if (number >= 2) {\n                int length = blocks.length;\n                if (length > 2 && blocks[length - 1].isZero()\n                        && blocks[length - 2].isZero()) {\n                    result.append(\"de \");\n                }\n                result.append(formato.getUnidades());\n            } else {\n                result.append(formato.getUnidade());\n            }\n        }\n    }\n\n    private void appendIntegers(StringBuffer result, ThousandBlock... blocks) {\n        boolean hasStarted = false;\n        for (int i = 0; i < blocks.length; i++) {\n            ThousandBlock thousandBlock = blocks[i];\n            if (!(hasStarted && thousandBlock.isZero())) {\n                int thousandPower = (blocks.length - i - 1);\n                if (hasStarted) {\n                    if (thousandBlock.isUnitary()) {\n                        result.append(getAndSeparator());\n                    } else {\n                        if (thousandPower < 1) {\n                            result.append(getAndSeparator());\n                        } else {\n                            result.append(getThousandSeparator());\n                        }\n                    }\n                }\n\n                result.append(thousandBlock.toWords());\n\n                if (thousandPower > 0) {\n                    result.append(\" \");\n                    result.append(this.getString(\"1e\"\n                            + 3\n                            * thousandPower\n                            + \".\"\n                            + (thousandBlock.isUnitary() ? \"singular\"\n                                    : \"plural\")));\n                }\n                hasStarted = true;\n            }\n        }\n    }\n\n    private final class ThousandBlock {\n\n        private int numberValue;\n\n        public ThousandBlock(String number) {\n            super();\n            if (number.length() > 3) {\n                throw new IllegalArgumentException(\n                        \"ThousandBlock deve conter numeros\"\n                                + \" de no maximo 3 digitos.\");\n            }\n            this.numberValue = Integer.parseInt(number);\n        }\n\n        public boolean isZero() {\n            return numberValue == 0;\n        }\n\n        public boolean isUnitary() {\n            return numberValue == 1;\n        }\n\n        public String toWords() {\n            String result;\n            if (numberValue <= 20) {\n                result = NumericToWordsConverter.this.getNumber(numberValue);\n            } else if (numberValue <= 99) {\n                int d = numberValue / 10;\n                int u = numberValue % 10;\n                String dezena = NumericToWordsConverter.this.getNumber(d * 10);\n                if (u == 0) {\n                    result = dezena;\n                } else {\n                    String unidade = NumericToWordsConverter.this.getNumber(u);\n                    result = dezena + getAndSeparator() + unidade;\n                }\n            } else if (numberValue == 100) {\n                result = NumericToWordsConverter.this.getNumber(100);\n            } else {\n                int c = (numberValue / 100) * 100;\n                String centena;\n                if (c == 100) {\n                    centena = NumericToWordsConverter.this.getString(\"100+?\");\n                } else {\n                    centena = NumericToWordsConverter.this.getNumber(c);\n                }\n                int resto = numberValue % 100;\n                if (resto == 0) {\n                    result = centena;\n                } else {\n                    result = centena + getAndSeparator()\n                            + getThousandBlockInWords(\"\" + resto);\n                }\n            }\n            return result;\n        }\n\n    }\n\n    private String getThousandSeparator() {\n        return getString(\"sep.mil\");\n    }\n\n    private String getAndSeparator() {\n        return getString(\"sep\");\n    }\n\n    private String getString(String paramMessage) {\n        return Messages.getString(\"Extenso.\" + paramMessage);\n    }\n\n    private String getNumber(int number) {\n        DecimalFormat formater = new DecimalFormat();\n        formater.applyPattern(\"000\");\n        String formatted = formater.format(number);\n        return Messages.getString(\"Extenso.\" + formatted);\n    }\n\n    private String getThousandBlockInWords(String number) {\n\n        String result;\n        int value = Integer.parseInt(number);\n        if (value <= 20) {\n            result = this.getNumber(value);\n        } else if (value <= 99) {\n            int d = value / 10;\n            int u = value % 10;\n            String dezena = this.getNumber(d * 10);\n            if (u == 0) {\n                result = dezena;\n            } else {\n                String unidade = this.getNumber(u);\n                result = dezena + getAndSeparator() + unidade;\n            }\n        } else if (value == 100) {\n            result = this.getNumber(100);\n        } else {\n            int c = (value / 100) * 100;\n            String centena = (c == 100) ? this.getString(\"100+?\") : this\n                    .getNumber(c);\n            int resto = value % 100;\n            if (resto == 0) {\n                result = centena;\n            } else {\n                result = centena + getAndSeparator()\n                        + getThousandBlockInWords(\"\" + resto);\n            }\n        }\n        return result;\n    }\n}\n","lineNo":34}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.CriacaoBoletoException;\nimport br.com.caelum.stella.boleto.Emissor;\n\n/**\n * Gera dados de um boleto relativos ao Banco Bradesco.\n * \n * @see <a *\n *      href=\"http://stella.caelum.com.br/boleto-setup.html\">http://stella.caelum\n *      * .com.br/boleto-setup.html< /a>\n * \n * @see <a * href=\n *      \"http://www.bradesco.com.br/br/pj/conteudo/sol_rec/pdf/manualtecnico.pdf\"\n *      >MANUAL * DO BLOQUETO DE COBRAN\u2021A< /a>\n * \n * @author Leonardo Bessa\n * \n */\npublic class Bradesco implements Banco {\n\n    private static final String NUMERO_BRADESCO = \"237\";\n\n    private final DVGenerator dvGenerator = new DVGenerator();\n\n    public String geraCodigoDeBarrasPara(Boleto boleto) {\n\tStringBuilder codigoDeBarras = new StringBuilder();\n\tcodigoDeBarras.append(getNumeroFormatado());\n\tcodigoDeBarras.append(String.valueOf(boleto.getCodEspecieMoeda()));\n\t// Digito Verificador sera inserido aqui.\n\n\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\tcodigoDeBarras.append(boleto.getValorFormatado());\n\n\t// CAMPO LIVRE\n\tcodigoDeBarras.append(boleto.getEmissor().getAgenciaFormatado());\n\tcodigoDeBarras\n\t\t.append(getCarteiraDoEmissorFormatado(boleto.getEmissor()));\n\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(boleto\n\t\t.getEmissor()));\n\tcodigoDeBarras.append(getContaCorrenteDoEmissorFormatado(boleto\n\t\t.getEmissor()));\n\tcodigoDeBarras.append(\"0\");\n\n\tcodigoDeBarras.insert(4, dvGenerator\n\t\t.geraDVCodigoDeBarras(codigoDeBarras.toString()));\n\n\tString result = codigoDeBarras.toString();\n\n\tif (result.length() != 44) {\n\t    throw new CriacaoBoletoException(\n\t\t    \"Erro na geração do código de barras.\");\n\t}\n\n\treturn result;\n    }\n\n    public String geraLinhaDigitavelPara(Boleto boleto) {\n\tString codigoDeBarras = geraCodigoDeBarrasPara(boleto);\n\n\tStringBuilder bloco1 = new StringBuilder();\n\tbloco1.append(getNumeroFormatado());\n\tbloco1.append(String.valueOf(boleto.getCodEspecieMoeda()));\n\tbloco1.append(codigoDeBarras.substring(19, 24));\n\tbloco1.append(dvGenerator.geraDVLinhaDigitavel(bloco1.toString()));\n\n\tStringBuilder bloco2 = new StringBuilder();\n\tbloco2.append(codigoDeBarras.substring(24, 34));\n\tbloco2.append(dvGenerator.geraDVLinhaDigitavel(bloco2.toString()));\n\n\tStringBuilder bloco3 = new StringBuilder();\n\tbloco3.append(codigoDeBarras.substring(34, 44));\n\tbloco3.append(dvGenerator.geraDVLinhaDigitavel(bloco3.toString()));\n\n\tStringBuilder bloco4 = new StringBuilder();\n\tbloco4.append(codigoDeBarras.charAt(4));\n\tbloco4.append(codigoDeBarras.substring(5, 9));\n\tbloco4.append(boleto.getValorFormatado());\n\n\tStringBuilder linhaDigitavel = new StringBuilder();\n\tlinhaDigitavel.append(bloco1);\n\tlinhaDigitavel.append(bloco2);\n\tlinhaDigitavel.append(bloco3);\n\tlinhaDigitavel.append(bloco4);\n\n\tlinhaDigitavel = linhaDigitavelFormater(linhaDigitavel);\n\n\treturn linhaDigitavel.toString();\n    }\n\n    private StringBuilder linhaDigitavelFormater(StringBuilder linhaDigitavel) {\n\tlinhaDigitavel.insert(5, '.');\n\tlinhaDigitavel.insert(11, \"  \");\n\tlinhaDigitavel.insert(18, '.');\n\tlinhaDigitavel.insert(25, \"  \");\n\tlinhaDigitavel.insert(32, '.');\n\tlinhaDigitavel.insert(39, \"  \");\n\tlinhaDigitavel.insert(42, \"  \");\n\n\treturn linhaDigitavel;\n    }\n\n    public String getNumeroFormatado() {\n\treturn NUMERO_BRADESCO;\n    }\n\n    public java.net.URL getImage() {\n\treturn getClass().getResource(\n\t\tString.format(\"/br/com/caelum/stella/boleto/img/%s.png\",\n\t\t\tgetNumeroFormatado()));\n    }\n\n    public String getNumConvenioDoEmissorFormatado(Emissor emissor) {\n\treturn String.format(\"%07d\", emissor.getNumConvenio());\n    }\n\n    public String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\treturn String.format(\"%07d\", emissor.getContaCorrente());\n    }\n\n    public String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\treturn String.format(\"%02d\", emissor.getCarteira());\n    }\n\n    public String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\treturn String.format(\"%011d\", emissor.getNossoNumero());\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.CriacaoBoletoException;\nimport br.com.caelum.stella.boleto.Emissor;\n\n/**\n * Gera dados de um boleto relativos ao Banco Bradesco.\n * \n * @see <a *\n *      href=\"http://stella.caelum.com.br/boleto-setup.html\">http://stella.caelum\n *      * .com.br/boleto-setup.html< /a>\n * \n * @see <a * href=\n *      \"http://www.bradesco.com.br/br/pj/conteudo/sol_rec/pdf/manualtecnico.pdf\"\n *      >MANUAL * DO BLOQUETO DE COBRAN\u2021A< /a>\n * \n * @author Leonardo Bessa\n * \n */\npublic class Bradesco implements Banco {\n\n    private static final String NUMERO_BRADESCO = \"237\";\n\n    private final DVGenerator dvGenerator = new DVGenerator();\n\n    public String geraCodigoDeBarrasPara(Boleto boleto) {\n\tStringBuilder codigoDeBarras = new StringBuilder();\n\tcodigoDeBarras.append(getNumeroFormatado());\n\tcodigoDeBarras.append(String.valueOf(boleto.getCodEspecieMoeda()));\n\t// Digito Verificador sera inserido aqui.\n\n\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\tcodigoDeBarras.append(boleto.getValorFormatado());\n\n\tEmissor emissor = boleto.getEmissor();\n\n\t// CAMPO LIVRE\n\tcodigoDeBarras.append(emissor.getAgenciaFormatado());\n\tcodigoDeBarras.append(getCarteiraDoEmissorFormatado(emissor));\n\tcodigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor));\n\tcodigoDeBarras.append(getContaCorrenteDoEmissorFormatado(emissor));\n\tcodigoDeBarras.append(\"0\");\n\n\tcodigoDeBarras.insert(4, dvGenerator\n\t\t.geraDVCodigoDeBarras(codigoDeBarras.toString()));\n\n\tString result = codigoDeBarras.toString();\n\n\tif (result.length() != 44) {\n\t    throw new CriacaoBoletoException(\n\t\t    \"Erro na geração do código de barras.\");\n\t}\n\n\treturn result;\n    }\n\n    public String geraLinhaDigitavelPara(Boleto boleto) {\n\tString codigoDeBarras = geraCodigoDeBarrasPara(boleto);\n\n\tStringBuilder bloco1 = new StringBuilder();\n\tbloco1.append(getNumeroFormatado());\n\tbloco1.append(String.valueOf(boleto.getCodEspecieMoeda()));\n\tbloco1.append(codigoDeBarras.substring(19, 24));\n\tbloco1.append(dvGenerator.geraDVLinhaDigitavel(bloco1.toString()));\n\n\tStringBuilder bloco2 = new StringBuilder();\n\tbloco2.append(codigoDeBarras.substring(24, 34));\n\tbloco2.append(dvGenerator.geraDVLinhaDigitavel(bloco2.toString()));\n\n\tStringBuilder bloco3 = new StringBuilder();\n\tbloco3.append(codigoDeBarras.substring(34, 44));\n\tbloco3.append(dvGenerator.geraDVLinhaDigitavel(bloco3.toString()));\n\n\tStringBuilder bloco4 = new StringBuilder();\n\tbloco4.append(codigoDeBarras.charAt(4));\n\tbloco4.append(codigoDeBarras.substring(5, 9));\n\tbloco4.append(boleto.getValorFormatado());\n\n\tStringBuilder linhaDigitavel = new StringBuilder();\n\tlinhaDigitavel.append(bloco1);\n\tlinhaDigitavel.append(bloco2);\n\tlinhaDigitavel.append(bloco3);\n\tlinhaDigitavel.append(bloco4);\n\n\tlinhaDigitavel = linhaDigitavelFormater(linhaDigitavel);\n\n\treturn linhaDigitavel.toString();\n    }\n\n    private StringBuilder linhaDigitavelFormater(StringBuilder linhaDigitavel) {\n\tlinhaDigitavel.insert(5, '.');\n\tlinhaDigitavel.insert(11, \"  \");\n\tlinhaDigitavel.insert(18, '.');\n\tlinhaDigitavel.insert(25, \"  \");\n\tlinhaDigitavel.insert(32, '.');\n\tlinhaDigitavel.insert(39, \"  \");\n\tlinhaDigitavel.insert(42, \"  \");\n\n\treturn linhaDigitavel;\n    }\n\n    public String getNumeroFormatado() {\n\treturn NUMERO_BRADESCO;\n    }\n\n    public java.net.URL getImage() {\n\treturn getClass().getResource(\n\t\tString.format(\"/br/com/caelum/stella/boleto/img/%s.png\",\n\t\t\tgetNumeroFormatado()));\n    }\n\n    public String getNumConvenioDoEmissorFormatado(Emissor emissor) {\n\treturn String.format(\"%07d\", emissor.getNumConvenio());\n    }\n\n    public String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\treturn String.format(\"%07d\", emissor.getContaCorrente());\n    }\n\n    public String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\treturn String.format(\"%02d\", emissor.getCarteira());\n    }\n\n    public String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\treturn String.format(\"%011d\", emissor.getNossoNumero());\n    }\n\n}\n","lineNo":37}
{"Smelly Sample":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.CriacaoBoletoException;\nimport br.com.caelum.stella.boleto.Emissor;\n\n/**\n * Gera dados de um boleto relativos ao Banco do Brasil.\n * \n * @see <a *\n *      href=\"http://stella.caelum.com.br/boleto-setup.html\">http://stella.caelum\n *      * .com.br/boleto-setup.html< /a>\n * \n * @author Cauê Guerra\n * @author Paulo Silveira\n * \n */\npublic class BancoDoBrasil implements Banco {\n\n    private static final String NUMERO_BB = \"001\";\n\n    private final DVGenerator dvGenerator = new DVGenerator();\n\n    public String geraCodigoDeBarrasPara(Boleto boleto) {\n\tStringBuilder codigoDeBarras = new StringBuilder();\n\tcodigoDeBarras.append(getNumeroFormatado());\n\tcodigoDeBarras.append(String.valueOf(boleto.getCodEspecieMoeda()));\n\t// Digito Verificador sera inserido aqui.\n\n\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\tcodigoDeBarras.append(boleto.getValorFormatado());\n\n\t// CAMPO LIVRE\n\tcodigoDeBarras.append(\"000000\");\n\tcodigoDeBarras.append(boleto.getEmissor().getNumConvenioFormatado());\n\tcodigoDeBarras.append(boleto.getEmissor().getNossoNumeroFormatado());\n\tcodigoDeBarras\n\t\t.append(getCarteiraDoEmissorFormatado(boleto.getEmissor()));\n\n\tcodigoDeBarras.insert(4, dvGenerator\n\t\t.geraDVCodigoDeBarras(codigoDeBarras.toString()));\n\n\tString result = codigoDeBarras.toString();\n\n\tif (result.length() != 44) {\n\t    throw new CriacaoBoletoException(\n\t\t    \"Erro na geração do código de barras.\");\n\t}\n\n\treturn result;\n    }\n\n    public String geraLinhaDigitavelPara(Boleto boleto) {\n\tString codigoDeBarras = geraCodigoDeBarrasPara(boleto);\n\n\tStringBuilder bloco1 = new StringBuilder();\n\tbloco1.append(getNumeroFormatado());\n\tbloco1.append(String.valueOf(boleto.getCodEspecieMoeda()));\n\tbloco1.append(codigoDeBarras.substring(19, 24));\n\tbloco1.append(dvGenerator.geraDVLinhaDigitavel(bloco1.toString()));\n\n\tStringBuilder bloco2 = new StringBuilder();\n\tbloco2.append(codigoDeBarras.substring(24, 34));\n\tbloco2.append(dvGenerator.geraDVLinhaDigitavel(bloco2.toString()));\n\n\tStringBuilder bloco3 = new StringBuilder();\n\tbloco3.append(codigoDeBarras.substring(34, 44));\n\tbloco3.append(dvGenerator.geraDVLinhaDigitavel(bloco3.toString()));\n\n\tStringBuilder bloco4 = new StringBuilder();\n\tbloco4.append(codigoDeBarras.charAt(4));\n\tbloco4.append(codigoDeBarras.substring(5, 9));\n\tbloco4.append(boleto.getValorFormatado());\n\n\tStringBuilder linhaDigitavel = new StringBuilder();\n\tlinhaDigitavel.append(bloco1);\n\tlinhaDigitavel.append(bloco2);\n\tlinhaDigitavel.append(bloco3);\n\tlinhaDigitavel.append(bloco4);\n\n\tlinhaDigitavel = linhaDigitavelFormater(linhaDigitavel);\n\n\treturn linhaDigitavel.toString();\n    }\n\n    private StringBuilder linhaDigitavelFormater(StringBuilder linhaDigitavel) {\n\tlinhaDigitavel.insert(5, '.');\n\tlinhaDigitavel.insert(11, \"  \");\n\tlinhaDigitavel.insert(18, '.');\n\tlinhaDigitavel.insert(25, \"  \");\n\tlinhaDigitavel.insert(32, '.');\n\tlinhaDigitavel.insert(39, \"  \");\n\tlinhaDigitavel.insert(42, \"  \");\n\n\treturn linhaDigitavel;\n    }\n\n    public String getNumeroFormatado() {\n\treturn NUMERO_BB;\n    }\n\n    public java.net.URL getImage() {\n\treturn getClass().getResource(\n\t\tString.format(\"/br/com/caelum/stella/boleto/img/%s.png\",\n\t\t\tgetNumeroFormatado()));\n    }\n\n    public String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\treturn String.format(\"%08d\", emissor.getContaCorrente());\n    }\n\n    public String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\treturn String.format(\"%02d\", emissor.getCarteira());\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto.bancos;\n\nimport br.com.caelum.stella.boleto.Banco;\nimport br.com.caelum.stella.boleto.Boleto;\nimport br.com.caelum.stella.boleto.CriacaoBoletoException;\nimport br.com.caelum.stella.boleto.Emissor;\n\n/**\n * Gera dados de um boleto relativos ao Banco do Brasil.\n * \n * @see <a *\n *      href=\"http://stella.caelum.com.br/boleto-setup.html\">http://stella.caelum\n *      * .com.br/boleto-setup.html< /a>\n * \n * @author Cauê Guerra\n * @author Paulo Silveira\n * \n */\npublic class BancoDoBrasil implements Banco {\n\n    private static final String NUMERO_BB = \"001\";\n\n    private final DVGenerator dvGenerator = new DVGenerator();\n\n    public String geraCodigoDeBarrasPara(Boleto boleto) {\n\tStringBuilder codigoDeBarras = new StringBuilder();\n\tcodigoDeBarras.append(getNumeroFormatado());\n\tcodigoDeBarras.append(String.valueOf(boleto.getCodEspecieMoeda()));\n\t// Digito Verificador sera inserido aqui.\n\n\tcodigoDeBarras.append(boleto.getFatorVencimento());\n\tcodigoDeBarras.append(boleto.getValorFormatado());\n\n\tEmissor emissor = boleto.getEmissor();\n\t// CAMPO LIVRE\n\tif (emissor.getNumConvenio() < 1000000) {\n\t    if (emissor.getCarteira() == 16 || emissor.getCarteira() == 18) {\n\t\tcodigoDeBarras\n\t\t\t.append(getNumConvenioDoEmissorFormatado(emissor));\n\t\tcodigoDeBarras\n\t\t\t.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcodigoDeBarras.append(\"21\");\n\t    } else {\n\t\tcodigoDeBarras\n\t\t\t.append(getNossoNumeroDoEmissorFormatado(emissor));\n\t\tcodigoDeBarras.append(emissor.getAgenciaFormatado());\n\t\tcodigoDeBarras.append(emissor.getCedente());\n\t\tcodigoDeBarras.append(boleto.getBanco()\n\t\t\t.getCarteiraDoEmissorFormatado(emissor));\n\t    }\n\t} else if (emissor.getCarteira() == 17 || emissor.getCarteira() == 18) {\n\t    codigoDeBarras.append(\"000000\");\n\t    codigoDeBarras.append(getNumConvenioDoEmissorFormatado(emissor));\n\t    codigoDeBarras.append(getNossoNumeroDoEmissorFormatado(emissor)\n\t\t    .substring(7));\n\t    codigoDeBarras.append(boleto.getBanco()\n\t\t    .getCarteiraDoEmissorFormatado(emissor));\n\t} else {\n\t    throw new CriacaoBoletoException(\n\t\t    \"Erro na geração do código de barras.\");\n\t}\n\n\tcodigoDeBarras.insert(4, dvGenerator\n\t\t.geraDVCodigoDeBarras(codigoDeBarras.toString()));\n\n\tString result = codigoDeBarras.toString();\n\n\tif (result.length() != 44) {\n\t    throw new CriacaoBoletoException(\n\t\t    \"Erro na geração do código de barras.\");\n\t}\n\n\treturn result;\n    }\n\n    public String geraLinhaDigitavelPara(Boleto boleto) {\n\tString codigoDeBarras = geraCodigoDeBarrasPara(boleto);\n\n\tStringBuilder bloco1 = new StringBuilder();\n\tbloco1.append(getNumeroFormatado());\n\tbloco1.append(String.valueOf(boleto.getCodEspecieMoeda()));\n\tbloco1.append(codigoDeBarras.substring(19, 24));\n\tbloco1.append(dvGenerator.geraDVLinhaDigitavel(bloco1.toString()));\n\n\tStringBuilder bloco2 = new StringBuilder();\n\tbloco2.append(codigoDeBarras.substring(24, 34));\n\tbloco2.append(dvGenerator.geraDVLinhaDigitavel(bloco2.toString()));\n\n\tStringBuilder bloco3 = new StringBuilder();\n\tbloco3.append(codigoDeBarras.substring(34, 44));\n\tbloco3.append(dvGenerator.geraDVLinhaDigitavel(bloco3.toString()));\n\n\tStringBuilder bloco4 = new StringBuilder();\n\tbloco4.append(codigoDeBarras.charAt(4));\n\tbloco4.append(codigoDeBarras.substring(5, 9));\n\tbloco4.append(boleto.getValorFormatado());\n\n\tStringBuilder linhaDigitavel = new StringBuilder();\n\tlinhaDigitavel.append(bloco1);\n\tlinhaDigitavel.append(bloco2);\n\tlinhaDigitavel.append(bloco3);\n\tlinhaDigitavel.append(bloco4);\n\n\tlinhaDigitavel = linhaDigitavelFormater(linhaDigitavel);\n\n\treturn linhaDigitavel.toString();\n    }\n\n    private StringBuilder linhaDigitavelFormater(StringBuilder linhaDigitavel) {\n\tlinhaDigitavel.insert(5, '.');\n\tlinhaDigitavel.insert(11, \"  \");\n\tlinhaDigitavel.insert(18, '.');\n\tlinhaDigitavel.insert(25, \"  \");\n\tlinhaDigitavel.insert(32, '.');\n\tlinhaDigitavel.insert(39, \"  \");\n\tlinhaDigitavel.insert(42, \"  \");\n\n\treturn linhaDigitavel;\n    }\n\n    public String getNumeroFormatado() {\n\treturn NUMERO_BB;\n    }\n\n    public java.net.URL getImage() {\n\treturn getClass().getResource(\n\t\tString.format(\"/br/com/caelum/stella/boleto/img/%s.png\",\n\t\t\tgetNumeroFormatado()));\n    }\n\n    public String getNumConvenioDoEmissorFormatado(Emissor emissor) {\n\tif (emissor.getNumConvenio() < 1000000) {\n\t    return String.format(\"%06d\", emissor.getNumConvenio());\n\t} else {\n\t    return String.format(\"%07d\", emissor.getNumConvenio());\n\t}\n    }\n\n    public String getContaCorrenteDoEmissorFormatado(Emissor emissor) {\n\treturn String.format(\"%08d\", emissor.getContaCorrente());\n    }\n\n    public String getCarteiraDoEmissorFormatado(Emissor emissor) {\n\treturn String.format(\"%02d\", emissor.getCarteira());\n    }\n\n    public String getNossoNumeroDoEmissorFormatado(Emissor emissor) {\n\tif (emissor.getCarteira() == 18) {\n\t    return String.format(\"%017d\", emissor.getNossoNumero());\n\t} else {\n\t    return String.format(\"%011d\", emissor.getNossoNumero());\n\t}\n    }\n\n}\n","lineNo":34}
{"Smelly Sample":"package br.com.caelum.stella.inwords;\n\nimport java.text.DecimalFormat;\n\n/**\n * @author Victor dos Santos Pereira\n * @author Leonardo Bessa\n * \n */\npublic class NumericToWordsConverter {\n\n\tprivate FormatoDeExtenso formato;\n\n\tpublic NumericToWordsConverter(FormatoDeExtenso formato) {\n\t\tthis.formato = formato;\n\t}\n\t\n\tprivate String getString(String paramMessage) {\n\t\treturn Messages.getString(\"Extenso.\"+paramMessage);\n\t}\n\n\tprivate String getUnit(boolean isUnitary, boolean isFraction) {\n\t\tString result;\n\t\tif (isFraction) {\n\t\t\tresult = (isUnitary ? formato.getDecimal() : formato.getDecimais());\n\t\t} else {\n\t\t\tresult = (isUnitary ? formato.getUnidade() : formato.getUnidades());\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate String getAndSeparator() {\n\t\treturn this.getString(\"sep\");\n\t}\n\n\tprivate String getThousandSeparator(boolean firstThousandGroup) {\n\t\treturn (firstThousandGroup ? getAndSeparator() : this.getString(\"sep.mil\"));\n\t}\n\n\tprivate String getNumberInWords(int power, int algarism) {\n\t\treturn this.getString(power + \".\" + algarism);\n\t}\n\n\tprivate String getThousandSuffixInWords(int thousandPower, boolean isUnitary, boolean isFraction) {\n\t\treturn (thousandPower == 0 \n\t\t\t\t\t? this.getUnit(isUnitary, isFraction)\n\t\t\t\t\t: this.getString(\"mil.\" + thousandPower + \".\" + (isUnitary ? '1' : '2'))\n\t\t\t\t);\n\t}\n\n\tprivate String getThousandBlockInWords(int number) {\n\t\tString result;\n\t\tif (number == 0) {\n\t\t\tresult = this.getNumberInWords(0, 0);\n\t\t} else if (number == 100) {\n\t\t\tresult = this.getNumberInWords(2, 0);\n\t\t} else {\n\t\t\tresult = \"\";\n\t\t\tint power = 0;\n\t\t\tint algarism = 0;\n\t\t\tfor (int i = 0; i < 3; i++) {\n\t\t\t\t// testa se são numeros de 11 a 19\n\t\t\t\tif ((i == 1) && ((number % 10) == 1) && (algarism != 0)) {\n\t\t\t\t\tpower = 3;\n\t\t\t\t\tresult = \"\";\n\t\t\t\t} else {\n\t\t\t\t\tpower = i;\n\t\t\t\t\talgarism = (number % 10);\n\t\t\t\t}\n\t\t\t\tif (algarism != 0) {\n\t\t\t\t\tif (!result.equals(\"\")) {\n\t\t\t\t\t\tresult = this.getAndSeparator() + result;\n\t\t\t\t\t}\n\t\t\t\t\tresult = this.getNumberInWords(power, algarism) + result;\n\t\t\t\t}\n\t\t\t\tnumber /= 10;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate String getThousandBlockWithSuffixInWords(int thousandGroup, int thousandPower, \n\t\t\tboolean isUnitary, boolean isFraction) {\n\t\tString result;\n\t\tif (thousandPower == 0) {\n\t\t\tresult = this.getThousandSuffixInWords(thousandPower, isUnitary, isFraction);\n\t\t} else {\n\t\t\tresult = this.getThousandSuffixInWords(thousandPower, thousandGroup == 1, isFraction);\n\t\t}\n\t\tif ((thousandPower != 1) || (thousandGroup != 1)) {\n\t\t\tresult = (this.getThousandBlockInWords(thousandGroup) + \" \" + result).trim();\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate String getFullLongNumberInWords(long number, boolean isFraction) {\n\t\tString result;\n\t\tif (number == 0) {\n\t\t\tresult = this.getThousandBlockInWords(0);\n\t\t} else {\n\t\t\tresult = \"\";\n\t\t\tboolean isFirstThousandGroup = true;\n\t\t\tint thousandPower = 0;\t\t\t\n\t\t\twhile (number > 0) {\n\t\t\t\tint thousandGroup = (int) (number % 1000);\n\t\t\t\tif ((thousandGroup != 0)) {\n\t\t\t\t\tif (!result.equals(\"\")) {\n\t\t\t\t\t\tresult = this\n\t\t\t\t\t\t\t\t.getThousandSeparator(isFirstThousandGroup)\n\t\t\t\t\t\t\t\t+ result;\n\t\t\t\t\t\tisFirstThousandGroup = false;\n\t\t\t\t\t}\n\t\t\t\t\tif ( result.equals(\"\") && !formato.getUnidade().equals(\"\") ) {\n\t\t\t\t\t\tif (thousandPower > 0) {\n\t\t\t\t\t\t\tresult = (thousandPower == 1 ? \" \" : \" de \") + this.getUnit(false, isFraction);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tresult = this.getThousandBlockWithSuffixInWords(\n\t\t\t\t\t\t\tthousandGroup, thousandPower, number==1, isFraction) \n\t\t\t\t\t\t\t+ result;\n\t\t\t\t}\n\t\t\t\tthousandPower++;\n\t\t\t\tnumber /= 1000;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate void validateArguments() {\n\t\tif ((formato.getUnidade() == null) || (formato.getUnidades() == null)) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.getUnidade().nulo\"));\n\t\t} else if ((formato.getDecimal() == null) || (formato.getDecimais() == null)) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.getDecimal().nulo\"));\n\t\t} else if ((formato.getCasasDecimais() < 0)\t|| (formato.getCasasDecimais() > 6)) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.getCasasDecimais().invalido\"));\n\t\t}\n\t}\n\n\tprivate void validateLong(long number) {\n\t\tif (number < 0) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.numero.negativo\"));\n\t\t}\n\t}\n\n\tprivate void validateDouble(double number) {\n\t\tif (number < 0) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.numero.negativo\"));\n\t\t}\n\t\tif (number > Long.MAX_VALUE) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.numero.maior.que.long\"));\n\t\t}\n\t}\n\n\tpublic String toWords(long numero) {\n\t\tthis.validateArguments();\n\t\tthis.validateLong(numero);\n\t\treturn this.getFullLongNumberInWords(numero, false);\n\t}\n\n\tpublic String toWords(long inteiro, long fracionado) {\n\t\tif (new Long(fracionado).toString().length() > formato.getCasasDecimais()) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.numero.casas.excedido\"));\n\t\t}\n\t\tString result = \"\";\n\t\tif (inteiro != 0 || fracionado == 0) {\n\t\t\tresult = this.toWords(inteiro);\n\t\t}\n\t\tif (inteiro != 0 && fracionado != 0) {\n\t\t\tresult += getAndSeparator();\n\t\t}\n\t\tif (fracionado != 0) {\n\t\t\tthis.validateLong(fracionado);\n\t\t\tresult += this.getFullLongNumberInWords(fracionado, true);\n\t\t}\n\t\treturn result;\n\t}\n\n\tpublic String toWords(double number) {\n\n\t\t// valida se o numero é maior que long\n\t\tthis.validateDouble(number);\n\n\t\t// formata o numero no padrao: 0.0###### e o separa em duas partes\n\t\tDecimalFormat decimalFormat = new DecimalFormat();\n\t\tdecimalFormat.applyPattern(\"0.0######\");\n\t\tchar decimalSeparator = decimalFormat.getDecimalFormatSymbols()\t.getDecimalSeparator();\n\t\tString[] parts = (decimalFormat.format(number)).split(\"[\"+decimalSeparator+\"]\");\n\n\t\t// se a parte fracionada for \"0\" altera para \"\"\n\t\tparts[1] = (parts[1].equals(\"0\") ? \"\" : parts[1]);\n\n\t\t// verifica se parte Inteira + parte Fracionada tem mais algarismos\n\t\t// significativos que o permitido\n\t\tif (parts[0].length() + parts[1].length() > 15) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.numero.muito.grande\"));\n\t\t}\n\n\t\t// formata o fracionado com o numero de casas decimais especificas\n\t\tfor (int i = parts[1].length(); i < formato.getCasasDecimais(); i++) {\n\t\t\tparts[1] += \"0\";\n\t\t}\n\n\t\t// retorna o extenso passando os parametros: parte inteira e fracionada\n\t\treturn this.toWords(Long.parseLong(parts[0]), Long.parseLong(parts[1]));\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.inwords;\n\nimport java.text.DecimalFormat;\n\n/**\n * @author Victor dos Santos Pereira\n * @author Leonardo Bessa\n * \n */\npublic class NumericToWordsConverter {\n\n    private final FormatoDeExtenso formato;\n\n    public NumericToWordsConverter(FormatoDeExtenso formato) {\n        this.formato = formato;\n    }\n\n    private String getString(String paramMessage) {\n        return Messages.getString(\"Extenso.\" + paramMessage);\n    }\n\n    private String getUnit(boolean isUnitary, boolean isFraction) {\n        String result;\n        if (isFraction) {\n            result = (isUnitary ? formato.getDecimal() : formato.getDecimais());\n        } else {\n            result = (isUnitary ? formato.getUnidade() : formato.getUnidades());\n        }\n        return result;\n    }\n\n    private String getAndSeparator() {\n        return this.getString(\"sep\");\n    }\n\n    private String getThousandSeparator(boolean isFirstGroup) {\n        return (isFirstGroup ? getAndSeparator() : this\n                .getString(\"sep.mil\"));\n    }\n\n    private String getNumberInWords(int power, int algarism) {\n        return this.getString(power + \".\" + algarism);\n    }\n\n    private String getThousandSuffixInWords(int thousandPower,\n            boolean isUnitary, boolean isFraction) {\n        return (thousandPower == 0 ? this.getUnit(isUnitary, isFraction) : this\n                .getString(\"mil.\" + thousandPower + \".\"\n                        + (isUnitary ? '1' : '2')));\n    }\n\n    private String getThousandBlockInWords(int number) {\n        String result;\n        if (number == 0) {\n            result = this.getNumberInWords(0, 0);\n        } else if (number == 100) {\n            result = this.getNumberInWords(2, 0);\n        } else {\n            result = \"\";\n            int power = 0;\n            int algarism = 0;\n            int actualValue = number;\n            for (int i = 0; i < 3; i++) {\n                // testa se são numeros de 11 a 19\n                if ((i == 1) && ((actualValue % 10) == 1) && (algarism != 0)) {\n                    power = 3;\n                    result = \"\";\n                } else {\n                    power = i;\n                    algarism = (actualValue % 10);\n                }\n                if (algarism != 0) {\n                    if (!\"\".equals(result)) {\n                        result = this.getAndSeparator() + result;\n                    }\n                    result = this.getNumberInWords(power, algarism) + result;\n                }\n                actualValue /= 10;\n            }\n        }\n        return result;\n    }\n\n    private String getThousandBlockWithSuffixInWords(int thousandGroup,\n            int thousandPower, boolean isUnitary, boolean isFraction) {\n        String result;\n        if (thousandPower == 0) {\n            result = this.getThousandSuffixInWords(thousandPower, isUnitary,\n                    isFraction);\n        } else {\n            result = this.getThousandSuffixInWords(thousandPower,\n                    thousandGroup == 1, isFraction);\n        }\n        if ((thousandPower != 1) || (thousandGroup != 1)) {\n            result = (this.getThousandBlockInWords(thousandGroup) + \" \" + result)\n                    .trim();\n        }\n        return result;\n    }\n\n    private String getFullLongNumberInWords(long number, boolean isFraction) {\n        String result;\n        if (number == 0) {\n            result = this.getThousandBlockInWords(0);\n        } else {\n            result = \"\";\n            boolean isFirstThousandGroup = true;\n            int thousandPower = 0;\n            long currentWorkingValue = number;\n            while (currentWorkingValue > 0) {\n                int thousandGroup = (int) (currentWorkingValue % 1000);\n                if ((thousandGroup != 0)) {\n                    if (!result.equals(\"\")) {\n                        result = this\n                                .getThousandSeparator(isFirstThousandGroup)\n                                + result;\n                        isFirstThousandGroup = false;\n                    }\n                    if (result.equals(\"\") && !formato.getUnidade().equals(\"\")) {\n                        if (thousandPower > 0) {\n                            result = (thousandPower == 1 ? \" \" : \" de \")\n                                    + this.getUnit(false, isFraction);\n                        }\n                    }\n                    result = this.getThousandBlockWithSuffixInWords(\n                            thousandGroup, thousandPower, currentWorkingValue == 1,\n                            isFraction)\n                            + result;\n                }\n                thousandPower++;\n                currentWorkingValue /= 1000;\n            }\n        }\n        return result;\n    }\n\n    private void validateArguments() {\n        if ((formato.getUnidade() == null) || (formato.getUnidades() == null)) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.getUnidade().nulo\"));\n        } else if ((formato.getDecimal() == null)\n                || (formato.getDecimais() == null)) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.getDecimal().nulo\"));\n        } else if ((formato.getCasasDecimais() < 0)\n                || (formato.getCasasDecimais() > 6)) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.getCasasDecimais().invalido\"));\n        }\n    }\n\n    private void validateLong(long number) {\n        if (number < 0) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.numero.negativo\"));\n        }\n    }\n\n    private void validateDouble(double number) {\n        if (number < 0) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.numero.negativo\"));\n        }\n        if (number > Long.MAX_VALUE) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.numero.maior.que.long\"));\n        }\n    }\n\n    public String toWords(long numero) {\n        this.validateArguments();\n        this.validateLong(numero);\n        return this.getFullLongNumberInWords(numero, false);\n    }\n\n    public String toWords(long inteiro, long fracionado) {\n        if (Long.valueOf(fracionado).toString().length() > formato\n                .getCasasDecimais()) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.numero.casas.excedido\"));\n        }\n        String result = \"\";\n        if (inteiro != 0 || fracionado == 0) {\n            result = this.toWords(inteiro);\n        }\n        if (inteiro != 0 && fracionado != 0) {\n            result += getAndSeparator();\n        }\n        if (fracionado != 0) {\n            this.validateLong(fracionado);\n            result += this.getFullLongNumberInWords(fracionado, true);\n        }\n        return result;\n    }\n\n    public String toWords(double number) {\n\n        // valida se o numero é maior que long\n        this.validateDouble(number);\n\n        // formata o numero no padrao: 0.0###### e o separa em duas partes\n        final DecimalFormat decimalFormat = new DecimalFormat();\n        decimalFormat.applyPattern(\"0.0######\");\n        final char decimalSeparator = decimalFormat.getDecimalFormatSymbols()\n                .getDecimalSeparator();\n        String[] parts = (decimalFormat.format(number)).split(\"[\"\n                + decimalSeparator + \"]\");\n\n        // se a parte fracionada for \"0\" altera para \"\"\n        parts[1] = (parts[1].equals(\"0\") ? \"\" : parts[1]);\n\n        // verifica se parte Inteira + parte Fracionada tem mais algarismos\n        // significativos que o permitido\n        if (parts[0].length() + parts[1].length() > 15) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.numero.muito.grande\"));\n        }\n\n        // formata o fracionado com o numero de casas decimais especificas\n        for (int i = parts[1].length(); i < formato.getCasasDecimais(); i++) {\n            parts[1] += \"0\";\n        }\n\n        // retorna o extenso passando os parametros: parte inteira e fracionada\n        return this.toWords(Long.parseLong(parts[0]), Long.parseLong(parts[1]));\n    }\n\n}\n","lineNo":62}
{"Smelly Sample":"package br.com.caelum.stella.inwords;\n\nimport java.text.DecimalFormat;\n\n/**\n * @author Victor dos Santos Pereira\n * @author Leonardo Bessa\n * \n */\npublic class NumericToWordsConverter {\n\n\tprivate FormatoDeExtenso formato;\n\n\tpublic NumericToWordsConverter(FormatoDeExtenso formato) {\n\t\tthis.formato = formato;\n\t}\n\t\n\tprivate String getString(String paramMessage) {\n\t\treturn Messages.getString(\"Extenso.\"+paramMessage);\n\t}\n\n\tprivate String getUnit(boolean isUnitary, boolean isFraction) {\n\t\tString result;\n\t\tif (isFraction) {\n\t\t\tresult = (isUnitary ? formato.getDecimal() : formato.getDecimais());\n\t\t} else {\n\t\t\tresult = (isUnitary ? formato.getUnidade() : formato.getUnidades());\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate String getAndSeparator() {\n\t\treturn this.getString(\"sep\");\n\t}\n\n\tprivate String getThousandSeparator(boolean firstThousandGroup) {\n\t\treturn (firstThousandGroup ? getAndSeparator() : this.getString(\"sep.mil\"));\n\t}\n\n\tprivate String getNumberInWords(int power, int algarism) {\n\t\treturn this.getString(power + \".\" + algarism);\n\t}\n\n\tprivate String getThousandSuffixInWords(int thousandPower, boolean isUnitary, boolean isFraction) {\n\t\treturn (thousandPower == 0 \n\t\t\t\t\t? this.getUnit(isUnitary, isFraction)\n\t\t\t\t\t: this.getString(\"mil.\" + thousandPower + \".\" + (isUnitary ? '1' : '2'))\n\t\t\t\t);\n\t}\n\n\tprivate String getThousandBlockInWords(int number) {\n\t\tString result;\n\t\tif (number == 0) {\n\t\t\tresult = this.getNumberInWords(0, 0);\n\t\t} else if (number == 100) {\n\t\t\tresult = this.getNumberInWords(2, 0);\n\t\t} else {\n\t\t\tresult = \"\";\n\t\t\tint power = 0;\n\t\t\tint algarism = 0;\n\t\t\tfor (int i = 0; i < 3; i++) {\n\t\t\t\t// testa se são numeros de 11 a 19\n\t\t\t\tif ((i == 1) && ((number % 10) == 1) && (algarism != 0)) {\n\t\t\t\t\tpower = 3;\n\t\t\t\t\tresult = \"\";\n\t\t\t\t} else {\n\t\t\t\t\tpower = i;\n\t\t\t\t\talgarism = (number % 10);\n\t\t\t\t}\n\t\t\t\tif (algarism != 0) {\n\t\t\t\t\tif (!result.equals(\"\")) {\n\t\t\t\t\t\tresult = this.getAndSeparator() + result;\n\t\t\t\t\t}\n\t\t\t\t\tresult = this.getNumberInWords(power, algarism) + result;\n\t\t\t\t}\n\t\t\t\tnumber /= 10;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate String getThousandBlockWithSuffixInWords(int thousandGroup, int thousandPower, \n\t\t\tboolean isUnitary, boolean isFraction) {\n\t\tString result;\n\t\tif (thousandPower == 0) {\n\t\t\tresult = this.getThousandSuffixInWords(thousandPower, isUnitary, isFraction);\n\t\t} else {\n\t\t\tresult = this.getThousandSuffixInWords(thousandPower, thousandGroup == 1, isFraction);\n\t\t}\n\t\tif ((thousandPower != 1) || (thousandGroup != 1)) {\n\t\t\tresult = (this.getThousandBlockInWords(thousandGroup) + \" \" + result).trim();\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate String getFullLongNumberInWords(long number, boolean isFraction) {\n\t\tString result;\n\t\tif (number == 0) {\n\t\t\tresult = this.getThousandBlockInWords(0);\n\t\t} else {\n\t\t\tresult = \"\";\n\t\t\tboolean isFirstThousandGroup = true;\n\t\t\tint thousandPower = 0;\t\t\t\n\t\t\twhile (number > 0) {\n\t\t\t\tint thousandGroup = (int) (number % 1000);\n\t\t\t\tif ((thousandGroup != 0)) {\n\t\t\t\t\tif (!result.equals(\"\")) {\n\t\t\t\t\t\tresult = this\n\t\t\t\t\t\t\t\t.getThousandSeparator(isFirstThousandGroup)\n\t\t\t\t\t\t\t\t+ result;\n\t\t\t\t\t\tisFirstThousandGroup = false;\n\t\t\t\t\t}\n\t\t\t\t\tif ( result.equals(\"\") && !formato.getUnidade().equals(\"\") ) {\n\t\t\t\t\t\tif (thousandPower > 0) {\n\t\t\t\t\t\t\tresult = (thousandPower == 1 ? \" \" : \" de \") + this.getUnit(false, isFraction);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tresult = this.getThousandBlockWithSuffixInWords(\n\t\t\t\t\t\t\tthousandGroup, thousandPower, number==1, isFraction) \n\t\t\t\t\t\t\t+ result;\n\t\t\t\t}\n\t\t\t\tthousandPower++;\n\t\t\t\tnumber /= 1000;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate void validateArguments() {\n\t\tif ((formato.getUnidade() == null) || (formato.getUnidades() == null)) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.getUnidade().nulo\"));\n\t\t} else if ((formato.getDecimal() == null) || (formato.getDecimais() == null)) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.getDecimal().nulo\"));\n\t\t} else if ((formato.getCasasDecimais() < 0)\t|| (formato.getCasasDecimais() > 6)) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.getCasasDecimais().invalido\"));\n\t\t}\n\t}\n\n\tprivate void validateLong(long number) {\n\t\tif (number < 0) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.numero.negativo\"));\n\t\t}\n\t}\n\n\tprivate void validateDouble(double number) {\n\t\tif (number < 0) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.numero.negativo\"));\n\t\t}\n\t\tif (number > Long.MAX_VALUE) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.numero.maior.que.long\"));\n\t\t}\n\t}\n\n\tpublic String toWords(long numero) {\n\t\tthis.validateArguments();\n\t\tthis.validateLong(numero);\n\t\treturn this.getFullLongNumberInWords(numero, false);\n\t}\n\n\tpublic String toWords(long inteiro, long fracionado) {\n\t\tif (new Long(fracionado).toString().length() > formato.getCasasDecimais()) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.numero.casas.excedido\"));\n\t\t}\n\t\tString result = \"\";\n\t\tif (inteiro != 0 || fracionado == 0) {\n\t\t\tresult = this.toWords(inteiro);\n\t\t}\n\t\tif (inteiro != 0 && fracionado != 0) {\n\t\t\tresult += getAndSeparator();\n\t\t}\n\t\tif (fracionado != 0) {\n\t\t\tthis.validateLong(fracionado);\n\t\t\tresult += this.getFullLongNumberInWords(fracionado, true);\n\t\t}\n\t\treturn result;\n\t}\n\n\tpublic String toWords(double number) {\n\n\t\t// valida se o numero é maior que long\n\t\tthis.validateDouble(number);\n\n\t\t// formata o numero no padrao: 0.0###### e o separa em duas partes\n\t\tDecimalFormat decimalFormat = new DecimalFormat();\n\t\tdecimalFormat.applyPattern(\"0.0######\");\n\t\tchar decimalSeparator = decimalFormat.getDecimalFormatSymbols()\t.getDecimalSeparator();\n\t\tString[] parts = (decimalFormat.format(number)).split(\"[\"+decimalSeparator+\"]\");\n\n\t\t// se a parte fracionada for \"0\" altera para \"\"\n\t\tparts[1] = (parts[1].equals(\"0\") ? \"\" : parts[1]);\n\n\t\t// verifica se parte Inteira + parte Fracionada tem mais algarismos\n\t\t// significativos que o permitido\n\t\tif (parts[0].length() + parts[1].length() > 15) {\n\t\t\tthrow new IllegalArgumentException(this.getString(\"erro.numero.muito.grande\"));\n\t\t}\n\n\t\t// formata o fracionado com o numero de casas decimais especificas\n\t\tfor (int i = parts[1].length(); i < formato.getCasasDecimais(); i++) {\n\t\t\tparts[1] += \"0\";\n\t\t}\n\n\t\t// retorna o extenso passando os parametros: parte inteira e fracionada\n\t\treturn this.toWords(Long.parseLong(parts[0]), Long.parseLong(parts[1]));\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.inwords;\n\nimport java.text.DecimalFormat;\n\n/**\n * @author Victor dos Santos Pereira\n * @author Leonardo Bessa\n * \n */\npublic class NumericToWordsConverter {\n\n    private final FormatoDeExtenso formato;\n\n    public NumericToWordsConverter(FormatoDeExtenso formato) {\n        this.formato = formato;\n    }\n\n    private String getString(String paramMessage) {\n        return Messages.getString(\"Extenso.\" + paramMessage);\n    }\n\n    private String getUnit(boolean isUnitary, boolean isFraction) {\n        String result;\n        if (isFraction) {\n            result = (isUnitary ? formato.getDecimal() : formato.getDecimais());\n        } else {\n            result = (isUnitary ? formato.getUnidade() : formato.getUnidades());\n        }\n        return result;\n    }\n\n    private String getAndSeparator() {\n        return this.getString(\"sep\");\n    }\n\n    private String getThousandSeparator(boolean isFirstGroup) {\n        return (isFirstGroup ? getAndSeparator() : this\n                .getString(\"sep.mil\"));\n    }\n\n    private String getNumberInWords(int power, int algarism) {\n        return this.getString(power + \".\" + algarism);\n    }\n\n    private String getThousandSuffixInWords(int thousandPower,\n            boolean isUnitary, boolean isFraction) {\n        return (thousandPower == 0 ? this.getUnit(isUnitary, isFraction) : this\n                .getString(\"mil.\" + thousandPower + \".\"\n                        + (isUnitary ? '1' : '2')));\n    }\n\n    private String getThousandBlockInWords(int number) {\n        String result;\n        if (number == 0) {\n            result = this.getNumberInWords(0, 0);\n        } else if (number == 100) {\n            result = this.getNumberInWords(2, 0);\n        } else {\n            result = \"\";\n            int power = 0;\n            int algarism = 0;\n            int actualValue = number;\n            for (int i = 0; i < 3; i++) {\n                // testa se são numeros de 11 a 19\n                if ((i == 1) && ((actualValue % 10) == 1) && (algarism != 0)) {\n                    power = 3;\n                    result = \"\";\n                } else {\n                    power = i;\n                    algarism = (actualValue % 10);\n                }\n                if (algarism != 0) {\n                    if (!\"\".equals(result)) {\n                        result = this.getAndSeparator() + result;\n                    }\n                    result = this.getNumberInWords(power, algarism) + result;\n                }\n                actualValue /= 10;\n            }\n        }\n        return result;\n    }\n\n    private String getThousandBlockWithSuffixInWords(int thousandGroup,\n            int thousandPower, boolean isUnitary, boolean isFraction) {\n        String result;\n        if (thousandPower == 0) {\n            result = this.getThousandSuffixInWords(thousandPower, isUnitary,\n                    isFraction);\n        } else {\n            result = this.getThousandSuffixInWords(thousandPower,\n                    thousandGroup == 1, isFraction);\n        }\n        if ((thousandPower != 1) || (thousandGroup != 1)) {\n            result = (this.getThousandBlockInWords(thousandGroup) + \" \" + result)\n                    .trim();\n        }\n        return result;\n    }\n\n    private String getFullLongNumberInWords(long number, boolean isFraction) {\n        String result;\n        if (number == 0) {\n            result = this.getThousandBlockInWords(0);\n        } else {\n            result = \"\";\n            boolean isFirstThousandGroup = true;\n            int thousandPower = 0;\n            long currentWorkingValue = number;\n            while (currentWorkingValue > 0) {\n                int thousandGroup = (int) (currentWorkingValue % 1000);\n                if ((thousandGroup != 0)) {\n                    if (!result.equals(\"\")) {\n                        result = this\n                                .getThousandSeparator(isFirstThousandGroup)\n                                + result;\n                        isFirstThousandGroup = false;\n                    }\n                    if (result.equals(\"\") && !formato.getUnidade().equals(\"\")) {\n                        if (thousandPower > 0) {\n                            result = (thousandPower == 1 ? \" \" : \" de \")\n                                    + this.getUnit(false, isFraction);\n                        }\n                    }\n                    result = this.getThousandBlockWithSuffixInWords(\n                            thousandGroup, thousandPower, currentWorkingValue == 1,\n                            isFraction)\n                            + result;\n                }\n                thousandPower++;\n                currentWorkingValue /= 1000;\n            }\n        }\n        return result;\n    }\n\n    private void validateArguments() {\n        if ((formato.getUnidade() == null) || (formato.getUnidades() == null)) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.getUnidade().nulo\"));\n        } else if ((formato.getDecimal() == null)\n                || (formato.getDecimais() == null)) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.getDecimal().nulo\"));\n        } else if ((formato.getCasasDecimais() < 0)\n                || (formato.getCasasDecimais() > 6)) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.getCasasDecimais().invalido\"));\n        }\n    }\n\n    private void validateLong(long number) {\n        if (number < 0) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.numero.negativo\"));\n        }\n    }\n\n    private void validateDouble(double number) {\n        if (number < 0) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.numero.negativo\"));\n        }\n        if (number > Long.MAX_VALUE) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.numero.maior.que.long\"));\n        }\n    }\n\n    public String toWords(long numero) {\n        this.validateArguments();\n        this.validateLong(numero);\n        return this.getFullLongNumberInWords(numero, false);\n    }\n\n    public String toWords(long inteiro, long fracionado) {\n        if (Long.valueOf(fracionado).toString().length() > formato\n                .getCasasDecimais()) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.numero.casas.excedido\"));\n        }\n        String result = \"\";\n        if (inteiro != 0 || fracionado == 0) {\n            result = this.toWords(inteiro);\n        }\n        if (inteiro != 0 && fracionado != 0) {\n            result += getAndSeparator();\n        }\n        if (fracionado != 0) {\n            this.validateLong(fracionado);\n            result += this.getFullLongNumberInWords(fracionado, true);\n        }\n        return result;\n    }\n\n    public String toWords(double number) {\n\n        // valida se o numero é maior que long\n        this.validateDouble(number);\n\n        // formata o numero no padrao: 0.0###### e o separa em duas partes\n        final DecimalFormat decimalFormat = new DecimalFormat();\n        decimalFormat.applyPattern(\"0.0######\");\n        final char decimalSeparator = decimalFormat.getDecimalFormatSymbols()\n                .getDecimalSeparator();\n        String[] parts = (decimalFormat.format(number)).split(\"[\"\n                + decimalSeparator + \"]\");\n\n        // se a parte fracionada for \"0\" altera para \"\"\n        parts[1] = (parts[1].equals(\"0\") ? \"\" : parts[1]);\n\n        // verifica se parte Inteira + parte Fracionada tem mais algarismos\n        // significativos que o permitido\n        if (parts[0].length() + parts[1].length() > 15) {\n            throw new IllegalArgumentException(this\n                    .getString(\"erro.numero.muito.grande\"));\n        }\n\n        // formata o fracionado com o numero de casas decimais especificas\n        for (int i = parts[1].length(); i < formato.getCasasDecimais(); i++) {\n            parts[1] += \"0\";\n        }\n\n        // retorna o extenso passando os parametros: parte inteira e fracionada\n        return this.toWords(Long.parseLong(parts[0]), Long.parseLong(parts[1]));\n    }\n\n}\n","lineNo":109}
{"Smelly Sample":"package br.com.caelum.stella.boleto;\n\nimport static org.junit.Assert.assertEquals;\n\nimport java.math.BigDecimal;\nimport java.util.Calendar;\n\nimport org.junit.Test;\n\npublic class BoletoTest {\n\n    @Test\n    public void testNewBoletoSeTemDefaultsCorretos() {\n        Boleto b = Boleto.newBoleto();\n        assertEquals(\"R$\", b.getEspecieMoeda());\n        assertEquals(9, b.getCodEspecieMoeda());\n        assertEquals(false, b.getAceite());\n        assertEquals(\"DV\", b.getEspecieDocumento());\n    }\n\n    @Test\n    public void testGetFatorVencimentoParaDataDaManha() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 1);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void testGetFatorVencimentoParaDataDaNoite() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 23);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void testGetFatorVencimentoParaDataDaExtremaNoite() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 23);\n        data.set(Calendar.MINUTE, 59);\n        data.set(Calendar.SECOND, 59);\n        data.set(Calendar.MILLISECOND, 999);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void testGetFatorVencimentoParaDataDoExtremaManha() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 0);\n        data.set(Calendar.MINUTE, 0);\n        data.set(Calendar.SECOND, 0);\n        data.set(Calendar.MILLISECOND, 0);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void testGetValorFormatadoPorString() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(\"3.00\");\n        assertEquals(\"0000000300\", b.getValorFormatado());\n    }\n\n    @Test\n    public void testGetValorFormatadoPorStringSemPontos() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(\"300\");\n        assertEquals(\"0000030000\", b.getValorFormatado());\n    }\n\n    @Test\n    public void testGetValorFormatadoPorDouble() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(3d);\n        assertEquals(\"0000000300\", b.getValorFormatado());\n    }\n\n    @Test\n    public void testGetValorFormatadoPorBigDecimal() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(new BigDecimal(3));\n        assertEquals(\"0000000300\", b.getValorFormatado());\n    }\n\n    @Test\n    public void testGetNoDocumentoFormatado() {\n        Boleto b = Boleto.newBoleto();\n        b.withNoDocumento(\"232\");\n        assertEquals(\"0232\", b.getNoDocumentoFormatado());\n    }\n\n    @Test(expected = IllegalArgumentException.class)\n    public void testBoletoComMaisDe5Instrucoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withInstrucoes(\"\", \"\", \"\", \"\", \"\", \"\");\n    }\n\n    @Test\n    public void testBoletoCom5Instrucoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withInstrucoes(\"\", \"\", \"\", \"\", \"\");\n    }\n\n    @Test(expected = IllegalArgumentException.class)\n    public void testBoletoComMaisDe5Descricoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withDescricoes(\"\", \"\", \"\", \"\", \"\", \"\");\n    }\n\n    @Test\n    public void testBoletoCom5Descricoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withDescricoes(\"\", \"\", \"\", \"\", \"\");\n    }\n\n    @Test(expected = IllegalArgumentException.class)\n    public void testBoletoComMaisDe2Locais() {\n        Boleto b = Boleto.newBoleto();\n        b.withLocaisDePagamento(\"\", \"\", \"\");\n    }\n\n    @Test\n    public void testBoletoCom2Locais() {\n        Boleto b = Boleto.newBoleto();\n        b.withLocaisDePagamento(\"\", \"\");\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto;\n\nimport static org.junit.Assert.assertEquals;\n\nimport java.math.BigDecimal;\nimport java.util.Calendar;\n\nimport org.junit.Test;\n\npublic class BoletoTest {\n\n    @Test\n    public void novoBoletoDeveTerAlgunsValoresPadrao() {\n        Boleto b = Boleto.newBoleto();\n        assertEquals(\"R$\", b.getEspecieMoeda());\n        assertEquals(9, b.getCodEspecieMoeda());\n        assertEquals(false, b.getAceite());\n        assertEquals(\"DV\", b.getEspecieDocumento());\n    }\n\n    @Test\n    public void regraDoFatorVencimentoParaDataDaManha() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 1);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void regraDoFatorVencimentoParaDataDaNoite() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 23);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void regraDoFatorVencimentoParaDataDaExtremaNoite() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 23);\n        data.set(Calendar.MINUTE, 59);\n        data.set(Calendar.SECOND, 59);\n        data.set(Calendar.MILLISECOND, 999);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void regraDoFatorVencimentoParaDataDoExtremaManha() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 0);\n        data.set(Calendar.MINUTE, 0);\n        data.set(Calendar.SECOND, 0);\n        data.set(Calendar.MILLISECOND, 0);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void valorFormatadoPorStringDeveTerDezDigitos() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(\"3.00\");\n        String valorFormatado = b.getValorFormatado();\n        assertEquals(10, valorFormatado.length());\n        assertEquals(\"0000000300\", valorFormatado);\n    }\n\n    @Test\n    public void valorFormatadoPorStringSemPontos() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(\"300\");\n        assertEquals(\"0000030000\", b.getValorFormatado());\n    }\n\n    @Test\n    public void valorFormatadoPorDouble() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(3d);\n        assertEquals(\"0000000300\", b.getValorFormatado());\n    }\n\n    @Test\n    public void valorFormatadoPorBigDecimal() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(new BigDecimal(3));\n        assertEquals(\"0000000300\", b.getValorFormatado());\n    }\n\n    @Test\n    public void numeroDoDocumentoFormatadoDeveTerQuatroDigitos() {\n        Boleto b = Boleto.newBoleto();\n        b.withNoDocumento(\"232\");\n        String numeroFormatado = b.getNoDocumentoFormatado();\n        assertEquals(4, numeroFormatado.length());\n        assertEquals(\"0232\", numeroFormatado);\n    }\n\n    @Test(expected = IllegalArgumentException.class)\n    public void boletoNaoDeveAceitarMaisDeCincoInstrucoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withInstrucoes(\"\", \"\", \"\", \"\", \"\", \"\");\n    }\n\n    @Test\n    public void boletoDeveAceitarNoMaximoCincoInstrucoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withInstrucoes(\"\", \"\", \"\", \"\", \"\");\n        assertEquals(5, b.getInstrucoes().size());\n    }\n\n    @Test(expected = IllegalArgumentException.class)\n    public void boletoNaoDeveAceitarMaisDeCincoDescricoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withDescricoes(\"\", \"\", \"\", \"\", \"\", \"\");\n    }\n\n    @Test\n    public void boletoDeveAceitarNoMaximoCincoDescricoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withDescricoes(\"\", \"\", \"\", \"\", \"\");\n        assertEquals(5, b.getDescricoes().size());\n    }\n\n    @Test(expected = IllegalArgumentException.class)\n    public void boletoNaoDeveAceitarMaisDeDoisLocais() {\n        Boleto b = Boleto.newBoleto();\n        b.withLocaisDePagamento(\"\", \"\", \"\");\n    }\n\n    @Test\n    public void boletoDeveAceitarNoMaximoDoisLocais() {\n        Boleto b = Boleto.newBoleto();\n        b.withLocaisDePagamento(\"\", \"\");\n        assertEquals(2, b.getLocaisDePagamento().size());\n    }\n\n}\n","lineNo":95}
{"Smelly Sample":"package br.com.caelum.stella.boleto;\n\nimport static org.junit.Assert.assertEquals;\n\nimport java.math.BigDecimal;\nimport java.util.Calendar;\n\nimport org.junit.Test;\n\npublic class BoletoTest {\n\n    @Test\n    public void testNewBoletoSeTemDefaultsCorretos() {\n        Boleto b = Boleto.newBoleto();\n        assertEquals(\"R$\", b.getEspecieMoeda());\n        assertEquals(9, b.getCodEspecieMoeda());\n        assertEquals(false, b.getAceite());\n        assertEquals(\"DV\", b.getEspecieDocumento());\n    }\n\n    @Test\n    public void testGetFatorVencimentoParaDataDaManha() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 1);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void testGetFatorVencimentoParaDataDaNoite() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 23);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void testGetFatorVencimentoParaDataDaExtremaNoite() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 23);\n        data.set(Calendar.MINUTE, 59);\n        data.set(Calendar.SECOND, 59);\n        data.set(Calendar.MILLISECOND, 999);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void testGetFatorVencimentoParaDataDoExtremaManha() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 0);\n        data.set(Calendar.MINUTE, 0);\n        data.set(Calendar.SECOND, 0);\n        data.set(Calendar.MILLISECOND, 0);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void testGetValorFormatadoPorString() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(\"3.00\");\n        assertEquals(\"0000000300\", b.getValorFormatado());\n    }\n\n    @Test\n    public void testGetValorFormatadoPorStringSemPontos() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(\"300\");\n        assertEquals(\"0000030000\", b.getValorFormatado());\n    }\n\n    @Test\n    public void testGetValorFormatadoPorDouble() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(3d);\n        assertEquals(\"0000000300\", b.getValorFormatado());\n    }\n\n    @Test\n    public void testGetValorFormatadoPorBigDecimal() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(new BigDecimal(3));\n        assertEquals(\"0000000300\", b.getValorFormatado());\n    }\n\n    @Test\n    public void testGetNoDocumentoFormatado() {\n        Boleto b = Boleto.newBoleto();\n        b.withNoDocumento(\"232\");\n        assertEquals(\"0232\", b.getNoDocumentoFormatado());\n    }\n\n    @Test(expected = IllegalArgumentException.class)\n    public void testBoletoComMaisDe5Instrucoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withInstrucoes(\"\", \"\", \"\", \"\", \"\", \"\");\n    }\n\n    @Test\n    public void testBoletoCom5Instrucoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withInstrucoes(\"\", \"\", \"\", \"\", \"\");\n    }\n\n    @Test(expected = IllegalArgumentException.class)\n    public void testBoletoComMaisDe5Descricoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withDescricoes(\"\", \"\", \"\", \"\", \"\", \"\");\n    }\n\n    @Test\n    public void testBoletoCom5Descricoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withDescricoes(\"\", \"\", \"\", \"\", \"\");\n    }\n\n    @Test(expected = IllegalArgumentException.class)\n    public void testBoletoComMaisDe2Locais() {\n        Boleto b = Boleto.newBoleto();\n        b.withLocaisDePagamento(\"\", \"\", \"\");\n    }\n\n    @Test\n    public void testBoletoCom2Locais() {\n        Boleto b = Boleto.newBoleto();\n        b.withLocaisDePagamento(\"\", \"\");\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.boleto;\n\nimport static org.junit.Assert.assertEquals;\n\nimport java.math.BigDecimal;\nimport java.util.Calendar;\n\nimport org.junit.Test;\n\npublic class BoletoTest {\n\n    @Test\n    public void novoBoletoDeveTerAlgunsValoresPadrao() {\n        Boleto b = Boleto.newBoleto();\n        assertEquals(\"R$\", b.getEspecieMoeda());\n        assertEquals(9, b.getCodEspecieMoeda());\n        assertEquals(false, b.getAceite());\n        assertEquals(\"DV\", b.getEspecieDocumento());\n    }\n\n    @Test\n    public void regraDoFatorVencimentoParaDataDaManha() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 1);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void regraDoFatorVencimentoParaDataDaNoite() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 23);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void regraDoFatorVencimentoParaDataDaExtremaNoite() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 23);\n        data.set(Calendar.MINUTE, 59);\n        data.set(Calendar.SECOND, 59);\n        data.set(Calendar.MILLISECOND, 999);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void regraDoFatorVencimentoParaDataDoExtremaManha() {\n        Boleto b = Boleto.newBoleto();\n\n        Calendar data = Calendar.getInstance();\n        data.set(Calendar.DAY_OF_MONTH, 2);\n        data.set(Calendar.MONTH, 5 - 1);\n        data.set(Calendar.YEAR, 2008);\n\n        data.set(Calendar.HOUR_OF_DAY, 0);\n        data.set(Calendar.MINUTE, 0);\n        data.set(Calendar.SECOND, 0);\n        data.set(Calendar.MILLISECOND, 0);\n\n        b.withDatas(Datas.newDatas().withVencimento(data));\n\n        assertEquals(3860, b.getFatorVencimento());\n    }\n\n    @Test\n    public void valorFormatadoPorStringDeveTerDezDigitos() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(\"3.00\");\n        String valorFormatado = b.getValorFormatado();\n        assertEquals(10, valorFormatado.length());\n        assertEquals(\"0000000300\", valorFormatado);\n    }\n\n    @Test\n    public void valorFormatadoPorStringSemPontos() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(\"300\");\n        assertEquals(\"0000030000\", b.getValorFormatado());\n    }\n\n    @Test\n    public void valorFormatadoPorDouble() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(3d);\n        assertEquals(\"0000000300\", b.getValorFormatado());\n    }\n\n    @Test\n    public void valorFormatadoPorBigDecimal() {\n        Boleto b = Boleto.newBoleto();\n        b.withValorBoleto(new BigDecimal(3));\n        assertEquals(\"0000000300\", b.getValorFormatado());\n    }\n\n    @Test\n    public void numeroDoDocumentoFormatadoDeveTerQuatroDigitos() {\n        Boleto b = Boleto.newBoleto();\n        b.withNoDocumento(\"232\");\n        String numeroFormatado = b.getNoDocumentoFormatado();\n        assertEquals(4, numeroFormatado.length());\n        assertEquals(\"0232\", numeroFormatado);\n    }\n\n    @Test(expected = IllegalArgumentException.class)\n    public void boletoNaoDeveAceitarMaisDeCincoInstrucoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withInstrucoes(\"\", \"\", \"\", \"\", \"\", \"\");\n    }\n\n    @Test\n    public void boletoDeveAceitarNoMaximoCincoInstrucoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withInstrucoes(\"\", \"\", \"\", \"\", \"\");\n        assertEquals(5, b.getInstrucoes().size());\n    }\n\n    @Test(expected = IllegalArgumentException.class)\n    public void boletoNaoDeveAceitarMaisDeCincoDescricoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withDescricoes(\"\", \"\", \"\", \"\", \"\", \"\");\n    }\n\n    @Test\n    public void boletoDeveAceitarNoMaximoCincoDescricoes() {\n        Boleto b = Boleto.newBoleto();\n        b.withDescricoes(\"\", \"\", \"\", \"\", \"\");\n        assertEquals(5, b.getDescricoes().size());\n    }\n\n    @Test(expected = IllegalArgumentException.class)\n    public void boletoNaoDeveAceitarMaisDeDoisLocais() {\n        Boleto b = Boleto.newBoleto();\n        b.withLocaisDePagamento(\"\", \"\", \"\");\n    }\n\n    @Test\n    public void boletoDeveAceitarNoMaximoDoisLocais() {\n        Boleto b = Boleto.newBoleto();\n        b.withLocaisDePagamento(\"\", \"\");\n        assertEquals(2, b.getLocaisDePagamento().size());\n    }\n\n}\n","lineNo":125}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport static br.com.caelum.stella.constraint.CPFConstraints.CPF_FORMATED;\nimport static br.com.caelum.stella.constraint.CPFConstraints.CPF_UNFORMATED;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.HashMap;\nimport java.util.List;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.formatter.CPFFormatter;\n\n/**\n * Verifica se uma cadeia (String) é válida para o documento de CPF (Cadastro de\n * Pessoa Física).\n * \n * @author Leonardo Bessa\n */\npublic class CPFValidator extends AbstractValidator<String> {\n\tprivate static final int MOD = 11;\n\tprivate final boolean isFormatted;\n\tprivate final boolean isIgnoringRepeatedDigits;\n\n\t@SuppressWarnings(\"serial\")\n\tprivate static final DigitChecker digitChecker = new DigitChecker(\n\t\t\tnew HashMap<Integer, List<Integer>>() {\n\t\t\t\t{\n\t\t\t\t\tInteger dv1Position = 10;\n\t\t\t\t\tInteger[] dv1Multipliers = { 10, 9, 8, 7, 6, 5, 4, 3, 2 };\n\t\t\t\t\tInteger dv2Position = 11;\n\t\t\t\t\tInteger[] dv2Multipliers = { 11, 10, 9, 8, 7, 6, 5, 4, 3, 2 };\n\t\t\t\t\tthis.put(dv1Position, Arrays.asList(dv1Multipliers));\n\t\t\t\t\tthis.put(dv2Position, Arrays.asList(dv2Multipliers));\n\t\t\t\t}\n\t\t\t}, MOD) {\n\t\t@Override\n\t\tprotected int rotinaPosProdutoInterno(int resto) {\n\t\t\treturn (resto < 2) ? 0 : 11 - resto;\n\t\t}\n\t};\n\n\t/**\n\t * <p>\n\t * Construtor do Validador de CPF.\n\t * <\/p>\n\t * <p>\n\t * Por padrão o validador criado aceita cadeias de CPF com todos os dígitos\n\t * repetidos, quando todas as outras condições de validação são aceitas.\n\t * Para considerar estes documentos inválidos use o construtor\n\t * {@link #CPFValidator(MessageProducer, boolean, boolean)} com a váriavel\n\t * {@linkplain #isIgnoringRepeatedDigits} em <code>false<\/code>.\n\t * <\/p>\n\t * \n\t * @param messageProducer\n\t *            produtor de mensagem de erro.\n\t * @param isFormatted\n\t *            considera cadeia no formato de CPF: \"ddd.ddd.ddd-dd\" onde \"d\"\n\t *            é um dígito decimal.\n\t */\n\tpublic CPFValidator(MessageProducer messageProducer, boolean isFormatted) {\n\t\tsuper(messageProducer);\n\t\tthis.isFormatted = isFormatted;\n\t\tthis.isIgnoringRepeatedDigits = true;\n\t}\n\n\t/**\n\t * @param messageProducer\n\t *            produtor de mensagem de erro.\n\t * @param isFormatted\n\t *            condição para considerar cadeia no formato de CPF:\n\t *            \"ddd.ddd.ddd-dd\" onde \"d\" é um dígito decimal.\n\t * @param isIgnoringRepeatedDigits\n\t *            condição para ignorar cadeias de CPF com todos os dígitos\n\t *            repetidos.\n\t */\n\tpublic CPFValidator(MessageProducer messageProducer, boolean isFormatted,\n\t\t\tboolean isIgnoringRepeatedDigits) {\n\t\tsuper(messageProducer);\n\t\tthis.isFormatted = isFormatted;\n\t\tthis.isIgnoringRepeatedDigits = isIgnoringRepeatedDigits;\n\t}\n\n\t/**\n\t * Valida se a cadeia está de acordo com as regras de um CPF.\n\t * \n\t * @see br.com.caelum.stella.Validator#assertValid(java.lang.Object)\n\t * @return <code>true<\/code> se a cadeia é válida ou é nula;\n\t *         <code>false<\/code> caso contrario.\n\t */\n\tprotected List<InvalidValue> getInvalidValues(String cpf) {\n\t\tList<InvalidValue> errors = new ArrayList<InvalidValue>();\n\t\terrors.clear();\n\t\tif (cpf != null) {\n\t\t\tif (isFormatted) {\n\t\t\t\tif (!CPF_FORMATED.matcher(cpf).matches()) {\n\t\t\t\t\terrors.add(CPFError.INVALID_FORMAT);\n\t\t\t\t}\n\t\t\t\tcpf = (new CPFFormatter()).unformat(cpf);\n\t\t\t} else if (!(CPF_UNFORMATED.matcher(cpf).matches())) {\n\t\t\t\terrors.add(CPFError.INVALID_DIGITS);\n\t\t\t}\n\t\t\tif (errors.isEmpty() && (!isIgnoringRepeatedDigits)\n\t\t\t\t\t&& hasAllRepeatedDigits(cpf)) {\n\t\t\t\terrors.add(CPFError.REPEATED_DIGITS);\n\t\t\t}\n\t\t\tif (errors.isEmpty() && !digitChecker.hasValidCheckDigits(cpf)) {\n\t\t\t\terrors.add(CPFError.INVALID_CHECK_DIGITS);\n\t\t\t}\n\t\t}\n\t\treturn errors;\n\t}\n\t\n\n\tprivate boolean hasAllRepeatedDigits(String cpf) {\n\t\tfor (int i = 1; i < cpf.length(); i++) {\n\t\t\tif (cpf.charAt(i) != cpf.charAt(0)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport static br.com.caelum.stella.constraint.CPFConstraints.CPF_FORMATED;\nimport static br.com.caelum.stella.constraint.CPFConstraints.CPF_UNFORMATED;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.formatter.CPFFormatter;\n\n/**\n * Verifica se uma cadeia (String) é válida para o documento de CPF (Cadastro de\n * Pessoa Física).\n * \n * @author Leonardo Bessa\n */\npublic class CPFValidator extends AbstractValidator<String> {\n\tprivate static final int MOD = 11;\n\n\tprivate final boolean isFormatted;\n\n\tprivate final boolean isIgnoringRepeatedDigits;\n\n\tprivate static class RotinaPosProdutoInterno implements\n\t\t\tRotinaDeDigitoVerificador {\n\t\tpublic Integer transform(RotinaParameters parameter) {\n\t\t\tInteger mod = parameter.getDigitoVerificadorInfo().getMod();\n\t\t\tInteger result = parameter.getResult() % mod;\n\t\t\tif (result < 2) {\n\t\t\t\tresult = 0;\n\t\t\t} else {\n\t\t\t\tresult = 11 - result;\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t}\n\n\tprivate static final Integer DV1_POSITION = 10;\n\n\tprivate static final Integer[] DV1_MULTIPLIERS = { 10, 9, 8, 7, 6, 5, 4, 3,\n\t\t\t2 };\n\n\tprivate static final Integer DV2_POSITION = 11;\n\n\tprivate static final Integer[] DV2_MULTIPLIERS = { 11, 10, 9, 8, 7, 6, 5,\n\t\t\t4, 3, 2 };\n\n\tprivate static final DigitoVerificadorInfo DV1_INFO = new DigitoVerificadorInfo(\n\t\t\t0,\n\t\t\tnew RotinaDeDigitoVerificador[] { new RotinaPosProdutoInterno() },\n\t\t\tMOD, DV1_MULTIPLIERS, DV1_POSITION);\n\n\tprivate static final DigitoVerificadorInfo DV2_INFO = new DigitoVerificadorInfo(\n\t\t\t0,\n\t\t\tnew RotinaDeDigitoVerificador[] { new RotinaPosProdutoInterno() },\n\t\t\tMOD, DV2_MULTIPLIERS, DV2_POSITION);\n\n\tprivate static final ValidadorDeDV DV1_CHECKER = new ValidadorDeDV(DV1_INFO);\n\n\tprivate static final ValidadorDeDV DV2_CHECKER = new ValidadorDeDV(DV2_INFO);\n\n\t/**\n\t * <p>\n\t * Construtor do Validador de CPF.\n\t * <\/p>\n\t * <p>\n\t * Por padrão o validador criado aceita cadeias de CPF com todos os dígitos\n\t * repetidos, quando todas as outras condições de validação são aceitas.\n\t * Para considerar estes documentos inválidos use o construtor\n\t * {@link #CPFValidator(MessageProducer, boolean, boolean)} com a váriavel\n\t * {@linkplain #isIgnoringRepeatedDigits} em <code>false<\/code>.\n\t * <\/p>\n\t * \n\t * @param messageProducer\n\t *            produtor de mensagem de erro.\n\t * @param isFormatted\n\t *            considera cadeia no formato de CPF: \"ddd.ddd.ddd-dd\" onde \"d\"\n\t *            é um dígito decimal.\n\t */\n\tpublic CPFValidator(MessageProducer messageProducer, boolean isFormatted) {\n\t\tsuper(messageProducer);\n\t\tthis.isFormatted = isFormatted;\n\t\tthis.isIgnoringRepeatedDigits = true;\n\t}\n\n\t/**\n\t * @param messageProducer\n\t *            produtor de mensagem de erro.\n\t * @param isFormatted\n\t *            condição para considerar cadeia no formato de CPF:\n\t *            \"ddd.ddd.ddd-dd\" onde \"d\" é um dígito decimal.\n\t * @param isIgnoringRepeatedDigits\n\t *            condição para ignorar cadeias de CPF com todos os dígitos\n\t *            repetidos.\n\t */\n\tpublic CPFValidator(MessageProducer messageProducer, boolean isFormatted,\n\t\t\tboolean isIgnoringRepeatedDigits) {\n\t\tsuper(messageProducer);\n\t\tthis.isFormatted = isFormatted;\n\t\tthis.isIgnoringRepeatedDigits = isIgnoringRepeatedDigits;\n\t}\n\n\t/**\n\t * Valida se a cadeia está de acordo com as regras de um CPF.\n\t * \n\t * @see br.com.caelum.stella.Validator#assertValid(java.lang.Object)\n\t * @return <code>true<\/code> se a cadeia é válida ou é nula;\n\t *         <code>false<\/code> caso contrario.\n\t */\n\tprotected List<InvalidValue> getInvalidValues(String cpf) {\n\t\tList<InvalidValue> errors = new ArrayList<InvalidValue>();\n\t\tif (cpf != null) {\n\t\t\tString unformatedCPF = checkForCorrectFormat(cpf, errors);\n\n\t\t\tif (errors.isEmpty()) {\n\t\t\t\tif ((!isIgnoringRepeatedDigits)\n\t\t\t\t\t\t&& hasAllRepeatedDigits(unformatedCPF)) {\n\t\t\t\t\terrors.add(CPFError.REPEATED_DIGITS);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (errors.isEmpty()) {\n\t\t\t\tif (!hasValidCheckDigits(unformatedCPF)) {\n\t\t\t\t\terrors.add(CPFError.INVALID_CHECK_DIGITS);\n\t\t\t\t}\t\t\t\t\n\t\t\t}\n\t\t}\n\t\treturn errors;\n\t}\n\n\tprivate String checkForCorrectFormat(String string, List<InvalidValue> errors) {\n\t\tString unformatedCPF = null;\n\t\tif (isFormatted) {\n\t\t\tif (!CPF_FORMATED.matcher(string).matches()) {\n\t\t\t\terrors.add(CPFError.INVALID_FORMAT);\n\t\t\t}\n\t\t\tunformatedCPF = (new CPFFormatter()).unformat(string);\n\t\t} else {\n\t\t\tif (!(CPF_UNFORMATED.matcher(string).matches())) {\n\t\t\t\terrors.add(CPFError.INVALID_DIGITS);\n\t\t\t}\n\t\t\tunformatedCPF = string;\n\t\t}\n\t\treturn unformatedCPF;\n\t}\n\n\tprivate boolean hasValidCheckDigits(String value) {\n\t\treturn (DV1_CHECKER.DVisValid(value)) && (DV2_CHECKER.DVisValid(value));\n\t}\n\n\tprivate boolean hasAllRepeatedDigits(String cpf) {\n\t\tfor (int i = 1; i < cpf.length(); i++) {\n\t\t\tif (cpf.charAt(i) != cpf.charAt(0)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n}\n","lineNo":114}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.*;\n\nimport java.util.List;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(2).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n        try {\n        \tvalidator.assertValid(\"1234567890123\");\n        \tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n        errors = validator.getValidationMessages(\"1234567890123\");\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"123456789012345\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"1111111a111111\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n\n        assertTrue(validator.assertValid(\"63025530002409\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"61519128000150\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"68745386000102\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n        assertTrue(validator.assertValid(null));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 742213250001-30\n        assertFalse(validator.assertValid(\"74221325000160\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 266371420001-58\n        assertFalse(validator.assertValid(\"26637142000154\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertTrue(validator.assertValid(\"26.637.142/0001-58\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 0);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldVotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertFalse(validator.assertValid(\"26637142000158\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.assertTrue;\nimport static org.junit.Assert.fail;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.Validator;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1234567890123\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"123456789012345\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1111111a111111\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = \"63025530002409\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"61519128000150\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"68745386000102\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = null;\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        // VALID CNPJ = 742213250001-30\n        try {\n        \tString value = \"74221325000160\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        // VALID CNPJ = 266371420001-58\n        try {\n        \tString value = \"26637142000154\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26.637.142/0001-58\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26637142000158\";\n\t\t\tvalidator.assertValid(value);\n\t\t\tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","lineNo":34}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.*;\n\nimport java.util.List;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(2).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n        try {\n        \tvalidator.assertValid(\"1234567890123\");\n        \tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n        errors = validator.getValidationMessages(\"1234567890123\");\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"123456789012345\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"1111111a111111\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n\n        assertTrue(validator.assertValid(\"63025530002409\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"61519128000150\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"68745386000102\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n        assertTrue(validator.assertValid(null));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 742213250001-30\n        assertFalse(validator.assertValid(\"74221325000160\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 266371420001-58\n        assertFalse(validator.assertValid(\"26637142000154\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertTrue(validator.assertValid(\"26.637.142/0001-58\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 0);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldVotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertFalse(validator.assertValid(\"26637142000158\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.assertTrue;\nimport static org.junit.Assert.fail;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.Validator;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1234567890123\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"123456789012345\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1111111a111111\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = \"63025530002409\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"61519128000150\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"68745386000102\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = null;\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        // VALID CNPJ = 742213250001-30\n        try {\n        \tString value = \"74221325000160\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        // VALID CNPJ = 266371420001-58\n        try {\n        \tString value = \"26637142000154\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26.637.142/0001-58\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26637142000158\";\n\t\t\tvalidator.assertValid(value);\n\t\t\tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","lineNo":59}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.*;\n\nimport java.util.List;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(2).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n        try {\n        \tvalidator.assertValid(\"1234567890123\");\n        \tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n        errors = validator.getValidationMessages(\"1234567890123\");\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"123456789012345\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"1111111a111111\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n\n        assertTrue(validator.assertValid(\"63025530002409\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"61519128000150\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"68745386000102\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n        assertTrue(validator.assertValid(null));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 742213250001-30\n        assertFalse(validator.assertValid(\"74221325000160\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 266371420001-58\n        assertFalse(validator.assertValid(\"26637142000154\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertTrue(validator.assertValid(\"26.637.142/0001-58\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 0);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldVotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertFalse(validator.assertValid(\"26637142000158\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.assertTrue;\nimport static org.junit.Assert.fail;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.Validator;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1234567890123\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"123456789012345\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1111111a111111\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = \"63025530002409\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"61519128000150\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"68745386000102\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = null;\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        // VALID CNPJ = 742213250001-30\n        try {\n        \tString value = \"74221325000160\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        // VALID CNPJ = 266371420001-58\n        try {\n        \tString value = \"26637142000154\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26.637.142/0001-58\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26637142000158\";\n\t\t\tvalidator.assertValid(value);\n\t\t\tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","lineNo":84}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.*;\n\nimport java.util.List;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(2).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n        try {\n        \tvalidator.assertValid(\"1234567890123\");\n        \tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n        errors = validator.getValidationMessages(\"1234567890123\");\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"123456789012345\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"1111111a111111\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n\n        assertTrue(validator.assertValid(\"63025530002409\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"61519128000150\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"68745386000102\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n        assertTrue(validator.assertValid(null));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 742213250001-30\n        assertFalse(validator.assertValid(\"74221325000160\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 266371420001-58\n        assertFalse(validator.assertValid(\"26637142000154\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertTrue(validator.assertValid(\"26.637.142/0001-58\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 0);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldVotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertFalse(validator.assertValid(\"26637142000158\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.assertTrue;\nimport static org.junit.Assert.fail;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.Validator;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1234567890123\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"123456789012345\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1111111a111111\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = \"63025530002409\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"61519128000150\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"68745386000102\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = null;\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        // VALID CNPJ = 742213250001-30\n        try {\n        \tString value = \"74221325000160\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        // VALID CNPJ = 266371420001-58\n        try {\n        \tString value = \"26637142000154\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26.637.142/0001-58\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26637142000158\";\n\t\t\tvalidator.assertValid(value);\n\t\t\tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","lineNo":107}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.*;\n\nimport java.util.List;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(2).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n        try {\n        \tvalidator.assertValid(\"1234567890123\");\n        \tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n        errors = validator.getValidationMessages(\"1234567890123\");\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"123456789012345\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"1111111a111111\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n\n        assertTrue(validator.assertValid(\"63025530002409\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"61519128000150\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"68745386000102\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n        assertTrue(validator.assertValid(null));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 742213250001-30\n        assertFalse(validator.assertValid(\"74221325000160\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 266371420001-58\n        assertFalse(validator.assertValid(\"26637142000154\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertTrue(validator.assertValid(\"26.637.142/0001-58\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 0);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldVotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertFalse(validator.assertValid(\"26637142000158\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.assertTrue;\nimport static org.junit.Assert.fail;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.Validator;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1234567890123\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"123456789012345\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1111111a111111\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = \"63025530002409\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"61519128000150\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"68745386000102\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = null;\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        // VALID CNPJ = 742213250001-30\n        try {\n        \tString value = \"74221325000160\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        // VALID CNPJ = 266371420001-58\n        try {\n        \tString value = \"26637142000154\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26.637.142/0001-58\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26637142000158\";\n\t\t\tvalidator.assertValid(value);\n\t\t\tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","lineNo":114}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.*;\n\nimport java.util.List;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(2).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n        try {\n        \tvalidator.assertValid(\"1234567890123\");\n        \tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n        errors = validator.getValidationMessages(\"1234567890123\");\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"123456789012345\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"1111111a111111\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n\n        assertTrue(validator.assertValid(\"63025530002409\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"61519128000150\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"68745386000102\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n        assertTrue(validator.assertValid(null));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 742213250001-30\n        assertFalse(validator.assertValid(\"74221325000160\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 266371420001-58\n        assertFalse(validator.assertValid(\"26637142000154\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertTrue(validator.assertValid(\"26.637.142/0001-58\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 0);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldVotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertFalse(validator.assertValid(\"26637142000158\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.assertTrue;\nimport static org.junit.Assert.fail;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.Validator;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1234567890123\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"123456789012345\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1111111a111111\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = \"63025530002409\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"61519128000150\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"68745386000102\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = null;\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        // VALID CNPJ = 742213250001-30\n        try {\n        \tString value = \"74221325000160\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        // VALID CNPJ = 266371420001-58\n        try {\n        \tString value = \"26637142000154\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26.637.142/0001-58\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26637142000158\";\n\t\t\tvalidator.assertValid(value);\n\t\t\tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","lineNo":121}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.*;\n\nimport java.util.List;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(2).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n        try {\n        \tvalidator.assertValid(\"1234567890123\");\n        \tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n        errors = validator.getValidationMessages(\"1234567890123\");\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"123456789012345\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"1111111a111111\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n\n        assertTrue(validator.assertValid(\"63025530002409\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"61519128000150\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"68745386000102\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n        assertTrue(validator.assertValid(null));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 742213250001-30\n        assertFalse(validator.assertValid(\"74221325000160\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 266371420001-58\n        assertFalse(validator.assertValid(\"26637142000154\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertTrue(validator.assertValid(\"26.637.142/0001-58\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 0);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldVotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertFalse(validator.assertValid(\"26637142000158\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.assertTrue;\nimport static org.junit.Assert.fail;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.Validator;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1234567890123\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"123456789012345\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1111111a111111\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = \"63025530002409\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"61519128000150\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"68745386000102\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = null;\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        // VALID CNPJ = 742213250001-30\n        try {\n        \tString value = \"74221325000160\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        // VALID CNPJ = 266371420001-58\n        try {\n        \tString value = \"26637142000154\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26.637.142/0001-58\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26637142000158\";\n\t\t\tvalidator.assertValid(value);\n\t\t\tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","lineNo":144}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.*;\n\nimport java.util.List;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(2).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n        try {\n        \tvalidator.assertValid(\"1234567890123\");\n        \tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n        errors = validator.getValidationMessages(\"1234567890123\");\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"123456789012345\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"1111111a111111\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n\n        assertTrue(validator.assertValid(\"63025530002409\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"61519128000150\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"68745386000102\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n        assertTrue(validator.assertValid(null));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 742213250001-30\n        assertFalse(validator.assertValid(\"74221325000160\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 266371420001-58\n        assertFalse(validator.assertValid(\"26637142000154\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertTrue(validator.assertValid(\"26.637.142/0001-58\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 0);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldVotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertFalse(validator.assertValid(\"26637142000158\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.assertTrue;\nimport static org.junit.Assert.fail;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.Validator;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1234567890123\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"123456789012345\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1111111a111111\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = \"63025530002409\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"61519128000150\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"68745386000102\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = null;\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        // VALID CNPJ = 742213250001-30\n        try {\n        \tString value = \"74221325000160\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        // VALID CNPJ = 266371420001-58\n        try {\n        \tString value = \"26637142000154\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26.637.142/0001-58\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26637142000158\";\n\t\t\tvalidator.assertValid(value);\n\t\t\tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","lineNo":168}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.*;\n\nimport java.util.List;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(2).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n        try {\n        \tvalidator.assertValid(\"1234567890123\");\n        \tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n        errors = validator.getValidationMessages(\"1234567890123\");\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"123456789012345\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"1111111a111111\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n\n        assertTrue(validator.assertValid(\"63025530002409\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"61519128000150\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"68745386000102\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n        assertTrue(validator.assertValid(null));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 742213250001-30\n        assertFalse(validator.assertValid(\"74221325000160\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 266371420001-58\n        assertFalse(validator.assertValid(\"26637142000154\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertTrue(validator.assertValid(\"26.637.142/0001-58\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 0);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldVotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertFalse(validator.assertValid(\"26637142000158\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.assertTrue;\nimport static org.junit.Assert.fail;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.Validator;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1234567890123\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"123456789012345\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1111111a111111\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = \"63025530002409\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"61519128000150\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"68745386000102\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = null;\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        // VALID CNPJ = 742213250001-30\n        try {\n        \tString value = \"74221325000160\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        // VALID CNPJ = 266371420001-58\n        try {\n        \tString value = \"26637142000154\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26.637.142/0001-58\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26637142000158\";\n\t\t\tvalidator.assertValid(value);\n\t\t\tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","lineNo":195}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.*;\n\nimport java.util.List;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(2).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n        try {\n        \tvalidator.assertValid(\"1234567890123\");\n        \tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n        errors = validator.getValidationMessages(\"1234567890123\");\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"123456789012345\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"1111111a111111\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n\n        assertTrue(validator.assertValid(\"63025530002409\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"61519128000150\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"68745386000102\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n        assertTrue(validator.assertValid(null));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 742213250001-30\n        assertFalse(validator.assertValid(\"74221325000160\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 266371420001-58\n        assertFalse(validator.assertValid(\"26637142000154\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertTrue(validator.assertValid(\"26.637.142/0001-58\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 0);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldVotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertFalse(validator.assertValid(\"26637142000158\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.assertTrue;\nimport static org.junit.Assert.fail;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.Validator;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1234567890123\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"123456789012345\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1111111a111111\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = \"63025530002409\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"61519128000150\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"68745386000102\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = null;\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        // VALID CNPJ = 742213250001-30\n        try {\n        \tString value = \"74221325000160\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        // VALID CNPJ = 266371420001-58\n        try {\n        \tString value = \"26637142000154\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26.637.142/0001-58\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26637142000158\";\n\t\t\tvalidator.assertValid(value);\n\t\t\tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","lineNo":220}
{"Smelly Sample":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.*;\n\nimport java.util.List;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.ValidationMessage;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(2).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n        try {\n        \tvalidator.assertValid(\"1234567890123\");\n        \tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n        errors = validator.getValidationMessages(\"1234567890123\");\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"123456789012345\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        assertFalse(validator.assertValid(\"1111111a111111\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n\n        assertTrue(validator.assertValid(\"63025530002409\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"61519128000150\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        assertTrue(validator.assertValid(\"68745386000102\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n\n        List<ValidationMessage> errors;\n        assertTrue(validator.assertValid(null));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.isEmpty());\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 742213250001-30\n        assertFalse(validator.assertValid(\"74221325000160\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, false);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 266371420001-58\n        assertFalse(validator.assertValid(\"26637142000154\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertTrue(validator.assertValid(\"26.637.142/0001-58\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 0);\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldVotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        AbstractValidator validator = new CNPJValidator(messageProducer, true);\n        List<ValidationMessage> errors;\n\n        // VALID CNPJ = 26.637.142/0001-58\n        assertFalse(validator.assertValid(\"26637142000158\"));\n        errors = validator.getValidationMessages();\n        assertTrue(errors.size() == 1);\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","Method after Refactoring":"package br.com.caelum.stella.validation;\n\nimport static org.junit.Assert.assertTrue;\nimport static org.junit.Assert.fail;\n\nimport org.jmock.Expectations;\nimport org.jmock.Mockery;\nimport org.junit.Test;\n\nimport br.com.caelum.stella.MessageProducer;\nimport br.com.caelum.stella.Validator;\n\n/**\n * @author Leonardo Bessa\n * @author Fabio Kung\n */\npublic class CNPJValidatorTest {\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithLessDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1234567890123\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithMoreDigitsThanAllowed() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"123456789012345\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJWithInvalidCharacter() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        try {\n        \tString value = \"1111111a111111\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = \"63025530002409\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"61519128000150\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        \n        try {\n        \tString value = \"68745386000102\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shoulValidateNullCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        try {\n        \tString value = null;\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithFirstCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n        // VALID CNPJ = 742213250001-30\n        try {\n        \tString value = \"74221325000160\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateCNPJCheckDigitsWithSecondCheckDigitWrong() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_CHECK_DIGITS);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, false);\n\n        // VALID CNPJ = 266371420001-58\n        try {\n        \tString value = \"26637142000154\";\n\t\t\tvalidator.assertValid(value);\n        \tfail();\n        } catch (InvalidStateException e) {\n        \tassertTrue(e.getValidationMessages().size()==1);\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldValidateValidFormattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26.637.142/0001-58\";\n\t\t\tvalidator.assertValid(value);\n        } catch (InvalidStateException e) {\n        \tfail();\n\t\t}\n        mockery.assertIsSatisfied();\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    @Test\n    public void shouldNotValidateValidUnformattedCNPJ() {\n        Mockery mockery = new Mockery();\n        final MessageProducer messageProducer = mockery\n                .mock(MessageProducer.class);\n\n        mockery.checking(new Expectations() {\n            {\n                exactly(1).of(messageProducer).getMessage(\n                        CNPJError.INVALID_FORMAT);\n            }\n        });\n        Validator validator = new CNPJValidator(messageProducer, true);\n\n        // VALID CNPJ = 26.637.142/0001-58\n        try {\n        \tString value = \"26637142000158\";\n\t\t\tvalidator.assertValid(value);\n\t\t\tfail();\n        } catch (InvalidStateException e) {\n\t\t}\n\n        mockery.assertIsSatisfied();\n    }\n\n}\n","lineNo":245}
